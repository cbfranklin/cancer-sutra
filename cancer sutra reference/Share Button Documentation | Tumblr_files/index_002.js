require=function t(e,i,s){function o(a,r){if(!i[a]){if(!e[a]){var l="function"==typeof require&&require;if(!r&&l)return l(a,!0);if(n)return n(a,!0);throw new Error("Cannot find module '"+a+"'")}var h=i[a]={exports:{}};e[a][0].call(h.exports,function(t){var i=e[a][1][t];return o(i?i:t)},h,h.exports,t,e,i,s)}return i[a].exports}for(var n="function"==typeof require&&require,a=0;a<s.length;a++)o(s[a]);return o}({1:[function(t,e){"use strict";var i=t("prima/bootloader"),s=t("prima/lib/domeventor"),o=t("prima/lib/logger"),n=(t("prima/lib/data"),t("numeral"),i.extend({setup:function(){i.prototype.setup.apply(this,arguments),s.init(),o.log("Exec","Bootstrap/DOMEventor"),o.log("Exec","Bootstrap/Legacy"),t("./legacy")},initialize:function(){this.context=new(t("context"))}}));e.exports=n},{"./legacy":292,context:"EFn+ou",numeral:"ubjloo","prima/bootloader":425,"prima/lib/data":431,"prima/lib/domeventor":433,"prima/lib/logger":436}],2:[function(t,e){var i=t("prima/collection"),s=t("../models/tumblelog"),o=i.extend({model:s});e.exports=o},{"../models/tumblelog":300,"prima/collection":427}],3:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/component"),o=t("./views/account-popover"),n=t("app/lib/currentuser"),a=s.extend({name:"AccountPopover",view:function(t){return t=i.extend({},{model:n(),pinnedTarget:this.container,isFixedPosition:!0,autoTeardown:!1,teardownOnEscape:!1},t),new o(t)},show:function(){this.view.show()},render:function(){return this.view.render(),this.trigger("append"),this}});e.exports=a},{"./views/account-popover":9,"app/lib/currentuser":296,lodash:"K2RcUv","prima/component":428}],4:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<ul data-blog-details-inner class="blog-sub-nav-details"><li class="blog-sub-nav-item ',isSelected("/blog/"+model.name)&&(__p+="selected"),__p+='" data-js-menu-item><a href="/blog/'+(null==(__t=model.name)?"":_.escape(__t))+'" class="blog-sub-nav-item-link" data-js-menu-item-link><div class="blog-sub-nav-item-label">'+(null==(__t=__("Posts"))?"":_.escape(__t))+"</div>",model.post_count>0&&(__p+='<div class="blog-sub-nav-item-data">'+(null==(__t=numberFormat(model.post_count))?"":_.escape(__t))+"</div>"),__p+="</a></li>",model.radar_feature_premium&&(__p+='<li class="blog-sub-nav-item ',isSelected("/radar/analytics")&&(__p+="selected"),__p+='" data-js-menu-item><a href="/radar/analytics" class="blog-sub-nav-item-link" data-js-menu-item-link><div class="blog-sub-nav-item-label">'+(null==(__t=__("Reach"))?"":_.escape(__t))+"</div></a></li>"),__p+='<li class="blog-sub-nav-item ',isSelected("/blog/"+model.name+"/followers")&&(__p+="selected"),__p+='" data-js-menu-item><a href="/blog/'+(null==(__t=model.name)?"":_.escape(__t))+'/followers" class="blog-sub-nav-item-link" data-js-menu-item-link><div class="blog-sub-nav-item-label">'+(null==(__t=__("Followers"))?"":_.escape(__t))+"</div>",model.follower_count>0&&(__p+='<div class="blog-sub-nav-item-data">'+(null==(__t=numberFormat(model.follower_count))?"":_.escape(__t))+"</div>"),__p+="</a></li>",model.activity_data&&model.activity_data.sparkline&&(__p+='<li class="blog-sub-nav-item ',isSelected("/blog/"+model.name+"/activity")&&(__p+="selected"),__p+='" data-js-menu-item><a href="/blog/'+(null==(__t=model.name)?"":_.escape(__t))+'/activity" class="blog-sub-nav-item-link" data-js-menu-item-link><div class="blog-sub-nav-item-label">'+(null==(__t=__("Activity"))?"":_.escape(__t))+'</div><div class="blog-sub-nav-item-data sparkline" data-sparkline="'+(null==(__t=model.activity_data.sparkline)?"":_.escape(__t))+'"></div></a></li>'),__p+="",model.member_count>0&&(__p+='<li class="blog-sub-nav-item ',isSelected(model.dashboard_url+"/members")&&(__p+="selected"),__p+='" data-js-menu-item><a href="'+(null==(__t=model.dashboard_url)?"":_.escape(__t))+'/members" class="blog-sub-nav-item-link" data-js-menu-item-link><div class="blog-sub-nav-item-label">'+(null==(__t=__("Members"))?"":_.escape(__t))+'</div><div class="blog-sub-nav-item-data">'+(null==(__t=numberFormat(model.member_count))?"":_.escape(__t))+"</div></a></li>"),__p+="",model.draft_count>0&&(__p+='<li class="blog-sub-nav-item ',isSelected(model.dashboard_url+"/drafts")&&(__p+="selected"),__p+='" data-js-menu-item><a href="'+(null==(__t=model.dashboard_url)?"":_.escape(__t))+'/drafts" class="blog-sub-nav-item-link" data-js-menu-item-link><div class="blog-sub-nav-item-label">'+(null==(__t=__("Drafts"))?"":_.escape(__t))+'</div><div class="blog-sub-nav-item-data">'+(null==(__t=numberFormat(model.draft_count))?"":_.escape(__t))+"</div></a></li>"),__p+="",model.queued_post_count>0&&(__p+='<li class="blog-sub-nav-item ',isSelected(model.dashboard_url+"/queue")&&(__p+="selected"),__p+='" data-js-menu-item><a href="'+(null==(__t=model.dashboard_url)?"":_.escape(__t))+'/queue" class="blog-sub-nav-item-link" data-js-menu-item-link><div class="blog-sub-nav-item-label">'+(null==(__t=__("Queue"))?"":_.escape(__t))+'</div><div class="blog-sub-nav-item-data">'+(null==(__t=numberFormat(model.queued_post_count))?"":_.escape(__t))+"</div></a></li>"),__p+="",model.transcoding_count>0&&(__p+='<li class="blog-sub-nav-item ',isSelected(model.dashboard_url+"/processing")&&(__p+="selected"),__p+='" data-js-menu-item><a href="'+(null==(__t=model.dashboard_url)?"":_.escape(__t))+'/processing" class="blog-sub-nav-item-link" data-js-menu-item-link><div class="blog-sub-nav-item-label">'+(null==(__t=__("Processing"))?"":_.escape(__t))+'</div><div class="blog-sub-nav-item-data">'+(null==(__t=numberFormat(model.transcoding_count))?"":_.escape(__t))+"</div></a></li>"),__p+="",model.is_visible_premium_partner&&(__p+='<li class="blog-sub-nav-item ',isSelected(model.analytics_url)&&(__p+="selected"),__p+='" data-js-menu-item><a href="'+(null==(__t=model.analytics_url)?"":_.escape(__t))+'" class="blog-sub-nav-item-link" data-js-menu-item-link><div class="blog-sub-nav-item-label">'+(null==(__t=__("Analytics"))?"":_.escape(__t))+"</div></a></li>"),__p+="",model.can_view_customize&&(__p+='<li class="blog-sub-nav-item ',isSelected("/settings/blog/"+model.name)&&(__p+="selected"),__p+='" data-js-menu-item><a href="/settings/blog/'+(null==(__t=model.name)?"":_.escape(__t))+'" class="blog-sub-nav-item-link" data-js-menu-item-link><div class="blog-sub-nav-item-label">'+(null==(__t=__("Edit appearance"))?"":_.escape(__t))+"</div></a></li>"),__p+="</ul>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],5:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="blog-list-item blog-list-item--on-light '+(null==(__t=model.is_private_group_channel?"blog-list-item--private":"")?"":_.escape(__t))+'">'+(null==(__t=_subview("loader"))?"":__t)+'<a data-js-action-blog-anchor data-js-menu-item-link class="blog-list-item-anchor" href="/blog/'+(null==(__t=model.name)?"":_.escape(__t))+'"><span class="blog-list-item-avatar"><img class="blog-list-item-avatar-image" alt="avatar" src="'+(null==(__t=avatarUrl)?"":_.escape(__t))+'">',model.unread_count>0&&(__p+=' <span class="blog-list-item-icon blog-list-item-unread-notice tab_notice tab-notice--outlined tab-notice--active on-light"><span class="tab_notice_value">'+(null==(__t=model.unread_count>99?"99+":model.unread_count)?"":_.escape(__t))+"</span></span>"),__p+='</span> <span class="blog-list-item-info"><span class="blog-list-item-info-name">'+(null==(__t=model.name)?"":_.escape(__t))+"</span>",model.is_private_group_channel&&(__p+='<i class="blog-list-item-icon blog-list-item-icon-private icon_lock_12"></i>'),__p+='<br><span class="blog-list-item-info-title">'+(null==(__t=model.directory_safe_title)?"":__t)+'</span></span></a> <a data-js-action-details-open class="blog-list-item-button blog-list-item-button-details icon_manburger"></a></div>'+(null==(__t=_subview("details"))?"":__t);return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],6:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="popover popover_menu popover_gradient"><div class="popover_inner"><ul data-js-account-list class="popover_inner_list"><li class="popover_header">'+(null==(__t=__("Account"))?"":_.escape(__t)),viewFlags.account&&(__p+='<div class="popover_item_suffix"><a data-js-action-logout class="logout" href="/logout" id="logout_button">'+(null==(__t=__("Log out"))?"":_.escape(__t))+"</a></div>"),__p+="</li>",viewFlags.account&&(__p+='<li class="popover_menu_item" data-js-menu-item><a class="popover_menu_item_anchor" href="/likes" data-js-menu-item-link>',model.liked_post_count&&model.liked_post_count>0&&(__p+='<div class="popover_item_suffix">'+(null==(__t=numberFormat(model.liked_post_count))?"":_.escape(__t))+"</div>"),__p+='<i class="popover_menu_item_anchor_icon icon_like"></i>'+(null==(__t=__("Likes"))?"":_.escape(__t))+"</a></li>",model.friend_count&&model.friend_count>0&&(__p+='<li class="popover_menu_item" data-js-menu-item><a class="popover_menu_item_anchor" href="/following" data-js-menu-item-link><div class="popover_item_suffix">'+(null==(__t=numberFormat(model.friend_count))?"":_.escape(__t))+'</div><i class="popover_menu_item_anchor_icon icon_following"></i>'+(null==(__t=__("Following"))?"":_.escape(__t))+"</a></li>"),__p+=""),__p+='<li class="popover_menu_item" data-js-menu-item><a class="popover_menu_item_anchor" href="/settings" data-js-menu-item-link><i class="popover_menu_item_anchor_icon icon_settings"></i>'+(null==(__t=__("Settings"))?"":_.escape(__t))+'</a></li><li class="popover_menu_item" data-js-menu-item><a class="popover_menu_item_anchor" href="/help" data-js-menu-item-link><i class="popover_menu_item_anchor_icon icon_help"></i>'+(null==(__t=__("Help"))?"":_.escape(__t))+"</a></li>",viewFlags.channels?__p+='<li class="popover_header">'+(null==(__t=__("Blogs"))?"":_.escape(__t))+'<div class="popover_item_suffix"><a href="/new/blog">+&nbsp;'+(null==(__t=__("New"))?"":_.escape(__t))+"</a></div></li>":viewFlags.account||(__p+='<li class="popover_menu_item" data-js-menu-item><a data-js-action-logout class="popover_menu_item_anchor logout" href="/logout" id="logout_button" data-js-menu-item-link><i class="popover_menu_item_anchor_icon icon_logout"></i>'+(null==(__t=__("Log out"))?"":_.escape(__t))+"</a></li>"),__p+="",viewFlags.channels&&(__p+='<li class="popover_menu_sublist"><ul data-js-channel-list></ul></li>'),__p+="</ul></div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],7:[function(t,e){"use strict";var i=t("lodash"),s=t("velocity-animate"),o=t("numeral"),n=t("prima/views/base"),a=t("../templates/account-popover-blog-sub-nav-details.tpl"),r=n.extend({template:a,className:"popover_menu_item_blog_details",serialize:function(){return{isSelected:this.isSelected,numberFormat:this.numberFormat}},isSelected:function(t){var e="/"+Backbone.history.fragment;return e===t},numberFormat:function(t){return o(t).format("0,0")},addSparkline:function(){var t=this.$el.find(".sparkline"),e=JSON.parse(this.model.get("activity_data").sparkline);e&&0!==i.max(e)&&i.isFunction(t.sparkline)&&(t.sparkline(e,{type:"line",lineColor:"#7f7f7f",fillColor:!1,lineWidth:4,spotColor:!1,minSpotColor:!1,maxSpotColor:!1,disableInteraction:!0,width:"72px",height:"30px"}),t.find("canvas").css({height:"15px",width:"36px"}))},afterRender:function(){this.cacheElements({$detailsInner:"[data-blog-details-inner]"}),i.defer(i.bind(this.addSparkline,this))},show:function(){this.animateOpen()},hide:function(){this.animateClosed()},animateOpen:function(){var t=this.$detailsInner.outerHeight();return s(this.$el,{height:t},{duration:250,easing:"ease-in-out"})},animateClosed:function(){return s(this.$el,{height:0},{duration:250,easing:"ease-in-out"})},showImmediately:function(){this.$el.css({height:"auto"})},teardown:function(){return this.remove(),this}});e.exports=r},{"../templates/account-popover-blog-sub-nav-details.tpl":4,lodash:"K2RcUv",numeral:"ubjloo","prima/views/base":497,"velocity-animate":"lWl/mc"}],8:[function(t,e){"use strict";var i=t("lodash"),s=t("when"),o=t("app/lib/avatar-size"),n=t("prima/views/base"),a=t("../templates/account-popover-blog-sub-nav.tpl"),r=t("components/loader"),l=t("./account-popover-blog-sub-nav-details"),h=n.extend({tagName:"li",className:"popover_menu_item popover_menu_item_blog",template:a,events:{"click [data-js-action-details-open]":"onClickItem","click [data-js-menu-item-link]":"onClickBlogLink"},defaults:{open:!1,showImmediately:!1,detailsReady:!1,uncloseable:!1},initialize:function(){this.on("change:open",this.toggleOpen),this.on("change:uncloseable",this.toggleUncloseable),this.setAvatarSize(),this.$el.attr({id:"blog-list-item--"+this.model.get("name"),"data-js-menu-item":!0})},setAvatarSize:function(){var t=o(this.model.get("avatar_url"));this.set("avatarUrl",t(64))},toggleUncloseable:function(){this.$el.toggleClass("popover_menu_item_blog--uncloseable",this.get("uncloseable"))},toggleOpen:function(t,e){i.isObject(t)||(e=!!t),e?(this.toggleLoader(!0),this.toggleAnimate(!0),this.$el.addClass("popover_menu_item_blog--open")):(this.toggleAnimate(!1),this.$el.removeClass("popover_menu_item_blog--open"))},toggleLoader:function(t){t===!0?this.loader?this.loader.set("loading",!0):this.loader=new r({$container:this.$el,type:"bar",classModifiers:"top",loading:!0}):this.loader.set("loading",!1)},toggleAnimate:function(t,e){i.isObject(t)||(e=!!t),this.getDetailsView().then(e?i.bind(function(t){this.toggleLoader(!1),this.get("showImmediately")?(t.showImmediately(),this.set("showImmediately",!1)):t.show()},this):function(t){t.hide()})},onClickItem:function(t){t.preventDefault(),this.toggle("open")},onClickBlogLink:function(t){t.metaKey||this.toggleLoader(!0),t.stopPropagation()},isLoaded:function(){return this.model.has("follower_count")},loadDetails:function(){return this.model.fetch_analytics_data()},getDetailsView:function(){return s.promise(i.bind(function(t,e){return this.subviews.details?void t(this.subviews.details):void(this.isLoaded()?t(this.renderDetailsView()):this.loadDetails().then(i.bind(function(){t(this.renderDetailsView())},this)).catch(function(t){e(t)}))},this))},renderDetailsView:function(){return this.subviews.details?this.subviews.details:(this.subviews.details=new l({model:this.model}),this.renderSubviews(),this.subviews.details)},teardown:function(){return this.remove(),this}});e.exports=h},{"../templates/account-popover-blog-sub-nav.tpl":5,"./account-popover-blog-sub-nav-details":7,"app/lib/avatar-size":293,"components/loader":356,lodash:"K2RcUv","prima/views/base":497,when:"RG2dij"}],9:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("numeral"),n=t("app/lib/scrollbar"),a=t("prima/views/base"),r=t("../templates/account-popover.tpl"),l=t("prima/events"),h=t("prima/lib/flags"),d=t("prima/utils/bindendevent").transition,c=t("prima/lib/clickoutside"),u=t("prima/lib/translate"),p=t("prima/mixins/popoverbase"),m=t("prima/mixins/selectorcache"),g=t("app/components/dialog"),f=t("./account-popover-blog-sub-nav"),_=a.extend({className:"popover--account-popover",mixins:[p,m],template:r,defaults:{popoverData:{},preventInteraction:!0,order:[]},events:{"click [data-js-action-logout]":"logout"},initialize:function(t){this.options=s.extend({},this.defaults,t)},logout:function(t){t.preventDefault();var e=i(t.currentTarget),o=u("Are you sure you want to log out?"),n=e.attr("href");return this.hide(),g.confirm(o,s.bind(function(){window.location.href=n})),!1},numberFormat:function(t){return o(t).format("0,0")},render:function(){return this.$el.html(this.template({viewFlags:{channels:h.bool("nav_redesign_blog"),account:h.bool("nav_redesign_account")},model:this.model.toJSON(),numberFormat:this.numberFormat})),this.$pinned.addClass("active"),h.bool("nav_redesign_blog")&&(this.renderUserChannels(),this.makeChannelsSortable()),this.$main=this.$el.find(".popover"),s.delay(s.bind(function(){this.$main.addClass("popover--active"),this.updateScrollbar(),this.bindClickOutside()},this),1),this.bindKeyNavigation(),this},updateScrollbar:function(){this.channelScrollBar&&this.channelScrollBar.update()},afterRender:function(){},bindClickOutside:function(){this.clickOutside=new c(this.el,{preventInteraction:!0}),this.clickOutside.on("click:outside",this.hide,this),this.listenTo(l,"DOMEventor:keyup:escape",this.hide)},unbindClickOutside:function(){this.clickOutside.remove(),this.clickOutside=null,this.stopListening(l,"DOMEventor:keyup:escape")},renderUserChannels:function(){var t=document.createDocumentFragment(),e=this.model.channels.models;if(e.length){var i=this.model.channels.findWhere({is_current:!0});i&&(s.pull(e,i),e.unshift(i)),s.each(e,s.bind(function(e){t.appendChild(this.renderUserChannelItem(e).el)},this)),this.firstItem=this.subViews[e[0].get("name")],this.firstItem.set({showImmediately:!0,uncloseable:!0,open:!0}),this.js$("channel-list").append(t),this.model.channels.length>1&&(s.defer(s.bind(this.addChannelScrollbar,this)),s.defer(s.bind(this.setOrder,this)))}},addChannelScrollbar:function(){this.channelScrollBar=new n(this.js$("channel-list")),this.js$("channel-list").addClass("popover_sublist popover_sublist--scrollable")},renderUserChannelItem:function(t){return this.subViews[t.get("name")]=new f({model:t}),this.listenTo(this.subViews[t.get("name")],"all",this._onSubviewEvent,this),this.subViews[t.get("name")].render()},_onSubviewEvent:function(){var t=s.toArray(arguments);t[0]="subview:"+t[0],this.trigger.apply(this,t)},_removeSubviewReference:function(t){t.off("all",this._onSubviewEvent,this)},makeChannelsSortable:function(){this.model.channels.length>1&&(this.sortable=new window.Tumblr.SortableView({el:this.js$("channel-list"),items:".popover_menu_item",callback:s.bind(this.saveOrder,this),scrollable:!0}))},getOrder:function(){return s.map(this.sortable.sequence(),function(t){return t.replace("blog-list-item--","")})},setOrder:function(t){t||(t=this.getOrder()),this.set("order",t)},saveOrder:function(){if(this.model.channels.length<=1)return!1;var t=this.getOrder();s.isEqual(t,this.get("order"))||(this.setOrder(t),i.ajax({type:"POST",url:"/order",data:"channel_names="+JSON.stringify(t)}),this.firstItem.set({uncloseable:!1}))},hide:function(){this.$pinned.removeClass("active"),this.$main.removeClass("popover--active"),this.unbindClickOutside(),this.unbindKeyNavigation(),this.resetKeyboardSelection(),d(this.$el,s.bind(function(){this.afterHide()},this))},afterHide:function(){this.$el.css({display:"none"})},show:function(){this.bindKeyNavigation(),this.bindClickOutside(),this.$pinned.addClass("active"),this.$el.css({display:"block"}),s.delay(s.bind(function(){this.updateScrollbar(),this.$main.addClass("popover--active")},this),1)},bindKeyNavigation:function(){this.listenTo(l,"DOMEventor:keydown:up",this.highlightPreviousItem),this.listenTo(l,"DOMEventor:keydown:down",this.highlightNextItem),this.listenTo(l,"DOMEventor:keydown:left",this.collapseItem),this.listenTo(l,"DOMEventor:keydown:right",this.expandItem),this.listenTo(l,"DOMEventor:keydown:enter",this.openItemLink)},unbindKeyNavigation:function(){this.stopListening(l,"DOMEventor:keydown:up"),this.stopListening(l,"DOMEventor:keydown:down"),this.stopListening(l,"DOMEventor:keydown:left"),this.stopListening(l,"DOMEventor:keydown:right"),this.stopListening(l,"DOMEventor:keydown:enter")},highlightNextItem:function(t){t.preventDefault();var e=this.$el.find("[data-js-menu-item]:visible"),i=this.$el.find(".currentItem"),o=i.length>0?s.findIndex(e,i.get(0))+1:0;o===e.length&&(o=0);var n=e.get(o);this.highlightItem(n)},highlightPreviousItem:function(t){t.preventDefault();var e=this.$el.find("[data-js-menu-item]:visible"),i=s.findIndex(e,this.$el.find(".currentItem").get(0))-1;-1===i&&(i=e.length-1);var o=e.get(i);this.highlightItem(o)},highlightItem:function(t){this.resetKeyboardSelection();var e=i(t);e.addClass("currentItem"),this.scrollToItem(e)},scrollToItem:function(t){var e=this.js$("channel-list");if(t.closest(e).length){var i=t.closest(".popover_menu_item_blog--open");i.length>0&&(t=i);var s=e.offset().top,o=s+e.height(),n=t.offset().top,a=n+t.height(),r=0;n>=s&&o>=a||(r=s>n?n-s:a-o,e.animate({scrollTop:e.scrollTop()+r},100))}},resetKeyboardSelection:function(){this.$el.find(".currentItem").removeClass("currentItem")},expandItem:function(t){t.preventDefault(),this.$el.find(".currentItem.popover_menu_item_blog:not(.popover_menu_item_blog--open) [data-js-action-details-open]").trigger("click")},collapseItem:function(t){t.preventDefault();var e=this.$el.find(".currentItem.popover_menu_item_blog--open");if(e.length||(e=this.$el.find("[data-js-menu-item]:has(.currentItem)")),e.length>0){var i=e.find("[data-js-action-details-open]:visible");i.length>0&&(i.trigger("click"),this.highlightItem(e.get(0)))}},openItemLink:function(t){t.preventDefault();var e=this.$el.find(".currentItem [data-js-menu-item-link]:first");e.length>0&&e.get(0).click()},beforeTeardown:function(){return s.each(this.subViews,function(t){this._removeSubviewReference(t)},this),this.channelScrollBar&&this.channelScrollBar.destroy(),this.remove(),this.$pinned.removeClass("active"),this}});e.exports=_},{"../templates/account-popover.tpl":6,"./account-popover-blog-sub-nav":8,"app/components/dialog":39,"app/lib/scrollbar":297,jquery:"HlZQrA",lodash:"K2RcUv",numeral:"ubjloo","prima/events":429,"prima/lib/clickoutside":430,"prima/lib/flags":"f/LVtH","prima/lib/translate":456,"prima/mixins/popoverbase":465,"prima/mixins/selectorcache":467,"prima/utils/bindendevent":474,"prima/views/base":497}],10:[function(t,e){"use strict";var i=t("jquery"),s=t("prima/component"),o=t("prima/events"),n=(t("prima/lib/flags"),t("prima/utils/bindendevent").transition),a=t("./views/account-tour-guide"),r=s.extend({name:"AccountTourGuide",initialize:function(){this.$glass=null,this.$container=i(this.container),this.$body=i("body"),this.$tabBar=i(".tab-bar"),this.listenTo(this.view,"clickCloseButton",this.close)},onClickGlass:function(){this.triggerEvent("clickClose"),this.close()},onClickEsc:function(){this.triggerEvent("clickClose"),this.close()},view:function(){return new a({pinnedTarget:this.container,isFixedPosition:!0})},showGlass:function(){this.$glass=i("<div>",{"class":"glass--account-tour-guide"}).appendTo(this.$body);var t=_.bind(function(){this.$glass.addClass("active")},this);_.delay(t,150),this.$glass.on("click",_.bind(this.onClickGlass,this))},hideGlass:function(){this.$glass.removeClass("active"),this.$glass.remove(),this.$glass=null},close:function(){this.view&&(this.view.teardown(),this.hideGlass(),o.trigger("keycommands:resume"),o.trigger("drawer:resume"),o.trigger("toaster:resume"),this.stopListening(o,"DOMEventor:flatresize"),this.stopListening(o,"DOMEventor:keyup:escape"),this.trigger("close"))},open:function(){this.showGlass(),n(this.$glass,_.bind(function(){this.append()},this)),o.trigger("keycommands:suspend"),o.trigger("drawer:suspend"),o.trigger("toaster:suspend"),this.listenTo(o,"DOMEventor:keyup:escape",this.onClickEsc),this.triggerEvent("seen"),i.ajax({url:"/svc/post/set_seen_atg",type:"POST",with_form_key:!0})},append:function(){return this.view.render(),this.clonedTabNavAccountItem=this.$tabBar.find(".tab_nav_account").clone(),this.clonedTabNavActivityItem=this.$tabBar.find(".tab_activity").clone(),this.view.$tabBar.append([this.clonedTabNavAccountItem,this.clonedTabNavActivityItem]),this.listenTo(o,"DOMEventor:flatresize",this.positionClonedTabNavAccountItem),this.trigger("append"),this},triggerEvent:function(t){this.trigger(t),o.trigger("TourGuideAccount:"+t,{loggingData:t})}});e.exports=r},{"./views/account-tour-guide":12,jquery:"HlZQrA","prima/component":428,"prima/events":429,"prima/lib/flags":"f/LVtH","prima/utils/bindendevent":474}],11:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="popover popover_gradient"><div class="popover_inner"><div class="step current"><h3 class="title">'+(null==(__t=__("Don't freak out. Your things are right here."))?"":_.escape(__t))+'</h3><p class="content">'+(null==(__t=__("Your blog info, account info, and recent activity are in these menus."))?"":_.escape(__t))+'</p><button class="button-continue flat-button" type="button" data-js-next-step>'+(null==(__t=__("Wait, why?"))?"":_.escape(__t))+'</button> <button class="button-close blue flat-button" type="button" data-js-close>'+(null==(__t=__("Okay, phew"))?"":_.escape(__t))+'</button></div><div class="step"><h3 class="title">'+(null==(__t=__("Why?"))?"":_.escape(__t))+'</h3><p class="content">'+(null==(__t=__("It's so you never have to scroll to the top of the dashboard to access this stuff."))?"":_.escape(__t))+'</p><button class="button-close blue flat-button full-width" type="button" data-js-close>'+(null==(__t=__("Ohhh"))?"":_.escape(__t))+'</button></div></div></div><div class="tab_bar"></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],12:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("../templates/account-tour-guide.tpl"),n=t("prima/events"),a=t("prima/mixins/popoverbase"),r=s.extend({className:"popover--account-tour-guide",mixins:[a],template:o,defaults:{},events:{"click [data-js-next-step]":"onClickNexStep","click [data-js-close]":"onClickClose"},initialize:function(t){this.options=i.extend({},this.defaults,t)},render:function(){return this.duration=300,this.$el.html(this.template()),this.$wrapper=this.$el.find(".popover_inner"),this.$tabBar=this.$el.find(".tab_bar"),this},onClickNexStep:function(){var t=this.$el.find(".step:nth-child(1)"),e=this.$el.find(".step:nth-child(2)"),i=this.duration,s=e.height();t.fadeOut(i),this.$wrapper.animate({height:s},i,"swing",function(){e.fadeIn(i)}),this.triggerEvent("clickNextButton")},onClickClose:function(){this.$el.find(".popover_inner").animate({height:0,opacity:0},this.duration,i.bind(function(){this.teardown()},this)),this.triggerEvent("clickCloseButton")},beforeTeardown:function(){return this.remove(),this},triggerEvent:function(t){this.trigger(t),n.trigger("TourGuideAccount:"+t,{loggingData:t})}});e.exports=r},{"../templates/account-tour-guide.tpl":11,lodash:"K2RcUv","prima/events":429,"prima/mixins/popoverbase":465,"prima/view":496}],13:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/component"),o=t("./views/activity-popover"),n=t("app/lib/currentuser"),a=s.extend({name:"ActivityPopover",view:function(t){return t=i.extend({},{model:n(),pinnedTarget:this.container,isFixedPosition:!0,autoTeardown:!1,teardownOnEscape:!1},t),new o(t)},show:function(){this.view.show()},render:function(){return this.view.render(),this.trigger("append"),this}});e.exports=a},{"./views/activity-popover":28,"app/lib/currentuser":296,lodash:"K2RcUv","prima/component":428}],14:[function(t,e){var i=t("prima/model"),s=i.extend({});e.exports=s},{"prima/model":471}],15:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="date_header clearfix"><div class="part_relative_date">'+(null==(__t=model.dateHeader.fromNow())?"":__t)+'</div><div class="part_full_date">'+(null==(__t=model.dateHeader.format("dddd, MMMM D"))?"":__t)+"</div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],16:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="ui_note '+(null==(__t=model.type)?"":__t)+" "+(null==(__t=model.from_tumblelog&&model.from_tumblelog.is_friend?" is_friend":"")?"":__t)+'" data-timestamp="'+(null==(__t=model.timestamp)?"":__t)+'" data-tumblelog-name="'+(null==(__t=model.from_tumblelog?model.from_tumblelog.name:"")?"":__t)+'"><div class="stage"><div class="part_activity"><div class="part_main"><span class="activity">'+(null==(__t=model.message)?"":__t),model.post&&model.post.summary&&(__p+='<span class="summary">&#8220;'+(null==(__t=model.post.summary)?"":__t)+"&#8221;</span>"),__p+='</span></div></div><a class="part_glass" target="_blank" href="'+(null==(__t=model.clickthrough_url)?"":__t)+'"></a><div class="part_avatar">',__p+=model.from_tumblelog?'<div class="ui_avatar"><div data-avatar-url="'+(null==(__t=model.from_tumblelog.avatar_url_128)?"":__t)+'" target="_blank" class="ui_avatar_link frame '+(null==(__t=model.type)?"":__t)+'" title="'+(null==(__t=model.from_tumblelog.name)?"":__t)+'"><a href="'+(null==(__t=model.from_tumblelog.tumblr_url)?"":__t)+'" class="avatar" style="background-image: url(\''+(null==(__t=model.from_tumblelog.avatar_url_48)?"":__t)+'\')"><div class="inner_frame"></div><div class="avatar_glass"></div><span class="ui_avatar_tumblelog_name">'+(null==(__t=model.from_tumblelog.name)?"":__t)+"</span></a></div></div>":'<div class="ui_avatar"><div data-avatar-url="/images/anonymous_avatar_64.gif" target="_blank" class="ui_avatar_link frame '+(null==(__t=model.type)?"":__t)+'" title="Anoymous"><div class="avatar" style="background-image: url(\'/images/anonymous_avatar_64.gif\')"><div class="inner_frame"></div><div class="avatar_glass"></div><span class="ui_avatar_tumblelog_name"></span></div></div></div>',__p+='</div><div class="part_icon">',!model.from_tumblelog||model.from_tumblelog.is_friend||"follower"!==model.type&&"user_mention"!==model.type?model.post&&(__p+=' <a href="'+(null==(__t=model.post.url)?"":__t)+'" target="_blank" class="ui_post_badge '+(null==(__t=model.post.type)?"":__t)+'"><div class="inner_frame"></div></a>'):__p+='<a class="note_follow plus-follow-button blue" href="/follow/'+(null==(__t=model.from_tumblelog.name)?"":__t)+'" data-tumblelog-name="'+(null==(__t=model.from_tumblelog.name)?"":__t)+'" title="'+(null==(__t=__("Follow"))?"":__t)+'"><span class="icon_plus follow_icon"></span></a>',__p+="</div>",model.note_meta&&(model.note_meta.answer_text||model.note_meta.reply_text)?__p+='<div class="part_response '+(null==(__t=model.note_meta.answer_text?"is_part_answer":"")?"":__t)+" "+(null==(__t=model.note_meta.reply_text?"is_part_reply":"")?"":__t)+'"><blockquote>'+(null==(__t=model.note_meta.answer_text?model.note_meta.answer_text:"")?"":__t)+(null==(__t=model.note_meta.reply_text?model.note_meta.reply_text:"")?"":__t)+"</blockquote></div>":"reblog"===model.type&&model.new_post&&model.new_post.diff?__p+='<div class="part_response is_part_reblog"><blockquote>'+(null==(__t=model.new_post.diff)?"":__t)+"</blockquote></div>":"user_mention"==model.type&&model.new_post&&model.new_post.quote&&(__p+='<div class="part_response is_part_user_mention"><blockquote>'+(null==(__t=model.new_post.quote)?"":__t)+"</blockquote></div>"),__p+="</div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],17:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="",__p+=model.activity_notifications.length>1?'<div class="blog-activity-content"><ul data-js-blog-activity-notification-list class="ui_notes"></ul></div><a href="/blog/'+(null==(__t=model.name)?"":_.escape(__t))+'/activity" class="blog-activity-more">'+(null==(__t=__("See everything"))?"":_.escape(__t))+"</a>":'<div class="blog-activity--empty"><i class="icon_activity"></i><p class="blog-activity--empty-text">'+(null==(__t=__("Check out this tab when you make a post to see Likes, Reblogs, and new followers."))?"":_.escape(__t))+"</p></div>",__p+="";
return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],18:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<a class="activity-popover-sparkline-link" href="'+(null==(__t=activityPageUrl)?"":__t)+'" title="Activity"><div class="sparkline"></div></a>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],19:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="pop-menu"><ul class="inner select-right" data-js-tumblelog-select-scrollbar>',_.forEach(channels,function(t){__p+='<li class="item-option '+(null==(__t=t.name===currentTumblelog?"select":"")?"":_.escape(__t))+'" data-js-tumblelogchoice><img class="ts-avatar" src="'+(null==(__t=t.avatarUrl)?"":_.escape(__t))+'" alt="'+(null==(__t=t.name)?"":_.escape(__t))+'"><div class="ts-info"><p class="ts-name">'+(null==(__t=t.displayName)?"":_.escape(__t))+'</p><p class="ts-title">'+(null==(__t=t.directory_safe_title)?"":__t)+"</p></div></li>"}),__p+="</ul></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],20:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<button class="activity-popover-tumblelog-select" data-js-clickabletumbleloglabel><span class="tumblelog-select-avatar"><img class="tumblelog-select-avatar-image" src="'+(null==(__t=avatarUrl)?"":_.escape(__t))+'" alt="'+(null==(__t=displayName)?"":__t)+'" data-js-tumblelogavatar></span> <span class="tumblelog-select-display-name" data-js-tumbleloglabel>'+(null==(__t=displayName)?"":__t)+"</span>",requiresDropdown&&(__p+=' <i class="tumblelog-select-carrot icon_arrow_carrot_down" data-js-tumblelogselectpin></i>'),__p+="</button>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],21:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="popover popover_menu popover_gradient"><div class="popover_inner"><div class="activity-popover-header">'+(null==(__t=_subview("tumblelogSelect"))?"":__t)+(null==(__t=_subview("sparkline"))?"":__t)+"</div>"+(null==(__t=_subview("loader"))?"":__t)+'<div class="activity-popover-notifications">'+(null==(__t=_subview("activityNotifications"))?"":__t)+"</div></div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],22:[function(t,e){"use strict";var i=t("prima/views/base"),s=t("../templates/activity-popover-date.tpl"),o=t("moment"),n=i.extend({tagName:"li",className:"blog-activity-date",template:s,events:{},defaults:{},beforeRender:function(){this.model.set("now",o())},teardown:function(){return this.remove(),this}});e.exports=n},{"../templates/activity-popover-date.tpl":15,moment:"iROhDJ","prima/views/base":497}],23:[function(t,e){"use strict";var i=t("prima/views/base"),s=t("../templates/activity-popover-notification-item.tpl"),o=t("app/models/tumblelog"),n=t("prima/utils/bindendevent").animation,a=i.extend({tagName:"li",className:"blog-activity-notification",template:s,events:{"click .plus-follow-button":"onClickFollow"},defaults:{tumblelogToFollow:!1,followSource:"FOLLOW_SOURCE_ACTIVITY_POPOVER"},initialize:function(t){if(this.options=_.defaults(t,this.defaults),!this.model.get("is_friend")&&!this.get("tumblelogToFollow")){var e=this.model.get("from_tumblelog");e&&(this.set("tumblelogToFollow",new o({name:e.name})),this.listenTo(this.get("tumblelogToFollow"),"change:following",this.onFollow))}},beforeRender:function(){var t="";this.model.get("new_post")&&this.model.get("new_post").url?t=this.model.get("new_post").url:this.model.get("post")&&this.model.get("post").url?t=this.model.get("post").url:this.model.get("from_tumblelog")&&this.model.get("from_tumblelog").tumblr_url&&(t=this.model.get("from_tumblelog").tumblr_url),this.model.set("clickthrough_url",t)},afterRender:function(){this.cacheElements({$tumblelogLink:this.$el.find(".notification-tumblelog-link"),$followButton:this.$el.find(".plus-follow-button"),$ui_post_badge:this.$el.find(".ui_post_badge")});var t=this.model.get("post"),e={},i="",s=t?t.type:"regular";switch(s){case"photo":case"photoset":e.backgroundImage="url('"+t.media_url+"')";break;case"video":t.video_thumbnail_url&&(e.backgroundImage="url('"+t.video_thumbnail_url+"')",i="has_video_thumbnail");break;case"note":t.is_ask?i="ask":t.is_answer&&(i="ask_answer");break;case"postcard":i="fanmail"}this.$tumblelogLink&&this.$tumblelogLink.addClass("js-hover-trigger-TumblelogPopover"),this.$ui_post_badge.css(e).addClass(i)},onClickFollow:function(t){t.preventDefault(),this.$followButton.closest(".ui_note").addClass("is_friend"),this.get("tumblelogToFollow").follow({tumblelog:this.get("tumblelogToFollow").name})},onFollow:function(t,e){n(this.$followButton,_.bind(function(){this.hideFollowButton()},this)),this.$followButton.toggleClass("follow_poof",e)},hideFollowButton:function(){this.$followButton.css({display:"none"})},teardown:function(){return this.remove(),this}});e.exports=a},{"../templates/activity-popover-notification-item.tpl":16,"app/models/tumblelog":300,"prima/utils/bindendevent":474,"prima/views/base":497}],24:[function(t,e){"use strict";var i=t("prima/views/base"),s=t("../templates/activity-popover-notifications.tpl"),o=t("prima/mixins/selectorcache"),n=t("app/lib/scrollbar"),a=t("./activity-popover-notification-item"),r=t("./activity-popover-date"),l=t("../models/notification"),h=t("moment"),d=i.extend({className:"blog-activity",template:s,mixins:[o],defaults:{removable:!0},initialize:function(){},addChannelScrollbar:function(){this.notificationScrollBar=new n(this.js$("blog-activity-notification-list"))},afterRender:function(){this.model.get("activity_notifications").length>1&&(_.defer(_.bind(this.addChannelScrollbar,this)),this.js$("blog-activity-notification-list").addClass("popover_sublist popover_sublist--scrollable"),this.createSubviews())},beforeTeardown:function(){this.notificationScrollBar&&this.notificationScrollBar.destroy()},createSubviews:function(){for(var t,e=this.model.get("activity_notifications"),i=0;i<e.length;i++){var s,o=h.unix(e[i].timestamp).startOf("day");if(t&&o.fromNow()==t.fromNow()||(s=o),s){e[i].dateHeader=s;var n=new r({model:new l(e[i])});this.appendSubview(n,"ul[data-js-blog-activity-notification-list]")}var d=new a({model:new l(e[i])});this.appendSubview(d,"ul[data-js-blog-activity-notification-list]"),t=h.unix(e[i].timestamp).startOf("day"),s&&(s=!1)}},teardown:function(){return this.remove(),this}});e.exports=d},{"../models/notification":14,"../templates/activity-popover-notifications.tpl":17,"./activity-popover-date":22,"./activity-popover-notification-item":23,"app/lib/scrollbar":297,moment:"iROhDJ","prima/mixins/selectorcache":467,"prima/views/base":497}],25:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/views/base"),o=t("../templates/activity-popover-sparkline.tpl"),n=s.extend({template:o,className:"activity-popover-sparkline-container",defaults:{removable:!0,sparklineFormatting:{type:"line",lineColor:"#7f7f7f",fillColor:!1,lineWidth:4,spotColor:!1,minSpotColor:!1,maxSpotColor:!1,disableInteraction:!0,width:"72px",height:"30px"}},getTemplateData:function(){return{activityPageUrl:"/blog/"+this.model.get("name")+"/activity"}},addSparkline:function(){var t=this.$el.find(".sparkline"),e=JSON.parse(this.model.get("activity_data").sparkline);e&&0!==i.max(e)&&i.isFunction(t.sparkline)&&(t.sparkline(e,this.get("sparklineFormatting")),t.find("canvas").css({height:"15px",width:"36px"}))},afterRender:function(){i.defer(i.bind(this.addSparkline,this))},teardown:function(){return this.remove(),this}});e.exports=n},{"../templates/activity-popover-sparkline.tpl":18,lodash:"K2RcUv","prima/views/base":497}],26:[function(t,e){"use strict";var i=t("prima/views/base"),s=t("../templates/activity-popover-tumblelog-select-dropdown.tpl"),o=t("prima/mixins/popoverbase"),n=t("prima/mixins/selectorcache"),a=t("app/lib/avatar-size"),r=t("app/lib/scrollbar"),l=i.extend({className:"popover--activity-popover-tumblelog-select-dropdown",events:{"click [data-js-tumblelogChoice]":"selectBlog"},mixins:[n,o],template:s,defaultOptions:{avatarSize:128},defaults:{currentTumblelog:!1,channels:!1},initialize:function(t){if(this.options=t=_.extend({},this.defaultOptions,t),_.extend(this.attributes,_.pick(t,_.keys(this.defaults))),this.channels=this.get("channels"),!this.get("currentTumblelog")){var e=this.channels.findWhere({is_current:!0});this.set("currentTumblelog",e)}},selectBlog:function(t){var e=this.$(t.currentTarget).index();this.set("currentTumblelog",this.channels.at(e)),this.teardown()},addChannelScrollbar:function(){this.tumblelogSelectScrollBar||(this.tumblelogSelectScrollBar=new r(this.js$("tumblelog-select-scrollBar")))},afterRender:function(){return this.delegateEvents(),_.defer(_.bind(this.addChannelScrollbar,this)),this.js$("tumblelog-select-scrollBar").addClass("popover_sublist popover_sublist--scrollable"),this},getTemplateData:function(){var t=this.toJSON();return t.channels=this.channels.map(function(t){return _.extend({avatarUrl:a(t.get("avatar_url"),this.options.avatarSize),displayName:t.getDisplayName()},t.toJSON())},this),t},beforeTeardown:function(){this.tumblelogSelectScrollBar&&(this.tumblelogSelectScrollBar.destroy(),this.tumblelogSelectScrollBar=null)},teardown:function(){return this.$el.remove(),this}});e.exports=l},{"../templates/activity-popover-tumblelog-select-dropdown.tpl":19,"app/lib/avatar-size":293,"app/lib/scrollbar":297,"prima/mixins/popoverbase":465,"prima/mixins/selectorcache":467,"prima/views/base":497}],27:[function(t,e){"use strict";var i=t("prima/views/base"),s=t("../templates/activity-popover-tumblelog-select.tpl"),o=t("./activity-popover-tumblelog-select-dropdown"),n=t("prima/mixins/selectorcache"),a=t("app/lib/avatar-size"),r=i.extend({template:s,className:"activity-popover-tumblelog-select-container",mixins:[n],defaults:{currentTumblelog:!1,isOpen:!1,requiresDropdown:!1},initialize:function(t){if(this.options=_.extend({},this.defaults,t),!this.get("currentTumblelog")){var e=this.model.findWhere({is_current:!0});this.set("currentTumblelog",e)}this.set("requiresDropdown",_.size(this.model)>1)},getTemplateData:function(){return{avatarUrl:a(this.getCurrentTumblelog("avatar_url"),25),displayName:this.getCurrentTumblelog("name"),requiresDropdown:this.get("requiresDropdown")}},createDropdown:function(){var t={identifier:"activityPopover:tumblelogSelectDropdown",pinnedTarget:this.js$("tumblelogAvatar"),popoverContainer:".popover--activity-popover",shift:{x:86,y:10},channels:this.model,currentTumblelog:this.getCurrentTumblelog()};this.tumblelogSelectDropdown=new o(t),this.listenTo(this.tumblelogSelectDropdown,"change:currentTumblelog",this.adjustCurrentTumblelog),this.listenTo(this.tumblelogSelectDropdown,"open",this.onDropdownOpen),this.listenTo(this.tumblelogSelectDropdown,"close",this.onDropdownClose)},onDropdownOpen:function(){this.set("isOpen",!0),this.js$("tumblelogSelectPin").addClass("is_open")},onDropdownClose:function(){this.set("isOpen",!1),this.js$("tumblelogSelectPin").removeClass("is_open")},toggleTumblelogSelectDropdown:function(){this.tumblelogSelectDropdown.isOrWasRecentlyRendered()||this.tumblelogSelectDropdown.render()},afterRender:function(){return this.get("requiresDropdown")&&(this.createDropdown(),this.js$("clickableTumblelogLabel").css({cursor:"pointer"}),this.$el.on("click [data-js-clickableTumblelogLabel]",_.bind(this.toggleTumblelogSelectDropdown,this))),this},getCurrentTumblelog:function(t){return this.get("currentTumblelog")&&this.get("currentTumblelog").has(t)&&_.isString(t)?this.get("currentTumblelog").get(t):this.get("currentTumblelog")},adjustCurrentTumblelog:function(){this.set("currentTumblelog",this.tumblelogSelectDropdown.get("currentTumblelog"));var t=a(this.getCurrentTumblelog("avatar_url"),25);this.js$("tumblelogAvatar").attr("src",t),this.js$("tumblelogLabel").text(this.getCurrentTumblelog("name"))},teardown:function(){return this.remove(),this.$el.off("click [data-js-clickableTumblelogLabel]"),this}});e.exports=r},{"../templates/activity-popover-tumblelog-select.tpl":20,"./activity-popover-tumblelog-select-dropdown":26,"app/lib/avatar-size":293,"prima/mixins/selectorcache":467,"prima/views/base":497}],28:[function(t,e){"use strict";var i=t("prima/views/base"),s=t("../templates/activity-popover.tpl"),o=t("prima/events"),n=t("prima/mixins/popoverbase"),a=(t("prima/lib/translate"),t("prima/lib/clickoutside")),r=t("prima/utils/bindendevent").transition,l=t("when"),h=t("./activity-popover-tumblelog-select"),d=t("./activity-popover-sparkline"),c=t("./activity-popover-notifications"),u=t("components/loader"),p=i.extend({defaults:{popoverData:{},preventInteraction:!0,currentTumblelog:!1},className:"popover--activity-popover",mixins:[n],template:s,initialize:function(t){if(this.options=_.extend({},this.defaults,t),!this.get("currentTumblelog")){var e=this.model.channels.findWhere({is_current:!0});this.set("currentTumblelog",e)}},render:function(){return this.$el.html(this.template()),this.$pinned.addClass("active"),this.cacheElements({$activityNotifications:".activity-popover-notifications",$activityHeader:".activity-popover-header",$activityPopoverMenu:".popover_menu"}),_.delay(_.bind(function(){this.$activityPopoverMenu.addClass("popover--active"),this.bindClickOutside(),this.addTumblelogPopoverZIndex()},this),1),this.createSubviews(),this},addTumblelogPopoverZIndex:function(){this.$el.attr("data-tumblelog-popover-zindex",this.$el.css("z-index"))},bindClickOutside:function(){this.clickOutside=new a(this.el,{preventInteraction:!0}),this.clickOutside.on("click:outside",this.hide,this),this.listenTo(o,"DOMEventor:keyup:escape",this.hide)},unbindClickOutside:function(){this.clickOutside.remove(),this.clickOutside=null,this.stopListening(o,"DOMEventor:keyup:escape")},createSubviews:function(){this.subviews.tumblelogSelect=new h({model:this.model.channels}),this.subviews.sparkline=new d({model:this.get("currentTumblelog")}),this.subviews.activityNotifications=new c({model:this.get("currentTumblelog")}),this.listenTo(this.subviews.tumblelogSelect,"change:currentTumblelog",this.updateSubviews)},hasNecessaryData:function(){return this.get("currentTumblelog").has("activity_notifications")},loadData:function(){return this.get("currentTumblelog").fetch_analytics_data()},prepareActivityNotifications:function(){return l.promise(_.bind(function(t,e){this.hasNecessaryData()?t(this.renderNewSubviews()):(this.toggleLoader(!0),this.loadData().then(_.bind(function(){t(this.renderNewSubviews())},this)).catch(function(t){e(t)}))},this))},updateSubviews:function(){this.set("currentTumblelog",this.subviews.tumblelogSelect.getCurrentTumblelog()),this.prepareActivityNotifications()},removeSubviews:function(){this.subviews&&_.each(this.subviews,function(t){t.get("removable")&&t.remove()})},renderNewSubviews:function(){this.removeSubviews(),this.toggleLoader(!1),this.subviews.activityNotifications=new c({model:this.get("currentTumblelog")}),this.subviews.sparkline=new d({model:this.get("currentTumblelog")}),this.appendSubview(this.subviews.activityNotifications,this.$activityNotifications),this.appendSubview(this.subviews.sparkline,this.$activityHeader)},toggleLoader:function(t){t===!0?this.loader?this.loader.set("loading",!0):this.loader=new u({$container:this.$el,type:"bar",classModifiers:"top",loading:!0}):this.loader.set("loading",!1)},beforeTeardown:function(){return this.remove(),this.$pinned.removeClass("active"),this},hide:function(){this.unbindClickOutside(),this.$pinned.removeClass("active"),this.$activityPopoverMenu.removeClass("popover--active"),r(this.$el,_.bind(function(){this.afterHide()},this))},afterHide:function(){this.$el.css({display:"none"})},show:function(){this.bindClickOutside(),this.$pinned.addClass("active"),this.$el.css({display:"block"}),_.delay(_.bind(function(){this.$activityPopoverMenu.addClass("popover--active")},this),1)}});e.exports=p},{"../templates/activity-popover.tpl":21,"./activity-popover-notifications":24,"./activity-popover-sparkline":25,"./activity-popover-tumblelog-select":27,"components/loader":356,"prima/events":429,"prima/lib/clickoutside":430,"prima/lib/translate":456,"prima/mixins/popoverbase":465,"prima/utils/bindendevent":474,"prima/views/base":497,when:"RG2dij"}],29:[function(t,e){"use strict";e.exports=t("./views/blog_card_view")},{"./views/blog_card_view":33}],30:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{}){__p+="";var is_popover="boolean"==typeof popover?popover:!1,has_avatar=avatar_url&&global_theme_params.show_avatar,has_bg_img=global_theme_params.header_image_focused&&global_theme_params.show_header_image,has_title=title&&global_theme_params.show_title,has_description=description_sanitized&&global_theme_params.show_description,expanded_name=cname?cname:name+".tumblr.com",description_color=title_color_rgb?"rgba("+title_color_rgb+",0.7)":global_theme_params.title_color,header_class=global_theme_params.header_stretch?"":" no_stretch_header";header_class+=has_bg_img?"":" no_header_image",header_class+=has_avatar?"":" no_avatar",header_class+=!has_bg_img||has_avatar||has_title||has_description?"":" header_image_only",header_class+=has_title||has_description?" has_info":" no_info",__p+='<div class="indash_header_wrapper '+(null==(__t=header_class)?"":__t)+" tumblelog_name_"+(null==(__t=name)?"":_.escape(__t))+'" style="background-color:'+(null==(__t=global_theme_params.background_color)?"":__t)+"; color:"+(null==(__t=global_theme_params.title_color)?"":__t)+'">',show_navigation&&(__p+='<div class="navigation"><div class="navigation_bg" style="background-color: '+(null==(__t=global_theme_params.background_color)?"":__t)+'"></div><div class="navigation_inner">',"undefined"!==name&&(__p+='<h3><a href="'+(null==(__t=url)?"":__t)+'" target="_blank" class="blog_name" data-peepr="{&quot;tumblelog&quot;: &quot;'+(null==(__t=name)?"":_.escape(__t))+'&quot;}"><span class="name">'+(null==(__t=name)?"":_.escape(__t))+'</span> <span class="full_url">'+(null==(__t=expanded_name)?"":_.escape(__t))+"</span></a></h3>"),__p+="",show_share_controls&&(__p+='<a class="open_blog_button nav_icon icon_export"></a>'),__p+="",!customizable&&show_user_controls&&(__p+=' <a class="info_popover_button nav_icon user_dropdown_lockup"><i class="user_dropdown_icon user_dropdown_icon_user icon_user_settings"></i> <i class="user_dropdown_icon user_dropdown_icon_arrow icon_arrow_carrot_down"></i></a>'),__p+="",!customizable&&show_follow_button&&(__p+="",__p+=following?' <button class="chrome unfollow" type="button">'+(null==(__t=unfollowText)?"":_.escape(__t))+'</button> <button class="chrome follow" type="button" style="display:none">'+(null==(__t=followText)?"":_.escape(__t))+"</button>":' <button class="chrome unfollow" type="button" style="display:none">'+(null==(__t=unfollowText)?"":_.escape(__t))+'</button> <button class="chrome follow" type="button">'+(null==(__t=followText)?"":_.escape(__t))+"</button>",__p+=""),__p+="</div></div>"),__p+="",global_theme_params.header_image_focused&&global_theme_params.show_header_image&&(__p+='<div class="header_image_wrapper',has_avatar&&(__p+=" has_avatar"),__p+='"><div class="header_image" style="background-image:url('+(null==(__t=global_theme_params.header_image_focused)?"":__t)+')">',__p+=is_popover||!customizable?'<a href="'+(null==(__t=url)?"":__t)+'" target="_blank"><img src="'+(null==(__t=global_theme_params.header_image_focused)?"":__t)+'" alt="'+(null==(__t=title)?"":_.escape(__t))+'"></a>':' <img src="'+(null==(__t=global_theme_params.header_image_focused)?"":__t)+'" alt="">',__p+="</div></div>"),__p+="",avatar_url&&global_theme_params.show_avatar&&(__p+='<div class="avatar '+(null==(__t=global_theme_params.avatar_shape)?"":__t)+'" style="background-color:'+(null==(__t=global_theme_params.background_color)?"":__t)+"; background-image:url("+(null==(__t=avatar_url)?"":__t)+"); color:"+(null==(__t=global_theme_params.background_color)?"":__t)+'">',__p+=is_popover||!customizable?'<a href="'+(null==(__t=url)?"":__t)+'" target="_blank"><img src="'+(null==(__t=avatar_url)?"":__t)+'" alt="'+(null==(__t=title)?"":_.escape(__t))+'"></a>':' <img src="'+(null==(__t=avatar_url)?"":__t)+'" alt="">',__p+="</div>"),__p+="",(has_title||has_description)&&(__p+='<div class="info_wrapper"><div class="info">',has_title&&(__p+='<h1 class="title" style="font-family:'+(null==(__t=title_font_family||"inherit")?"":__t)+"; font-weight:"+(null==(__t=global_theme_params.title_font_weight)?"":__t)+'">'+(null==(__t=title)?"":_.escape(__t))+"</h1>"),__p+="",has_description&&(__p+='<div class="description" style="color:'+(null==(__t=description_color)?"":__t)+'"><div class="description_inner">'+(null==(__t=description_sanitized)?"":__t)+"</div></div>"),__p+="</div></div>"),__p+="</div>"}return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],31:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{}){__p+="";var color="undefined"!=typeof loader_color?loader_color:"#D9D9D9";__p+='<div class="Knight-Rider-loader centered animate"><div class="Knight-Rider-bar" style="background-color:'+(null==(__t=color)?"":__t)+'"></div><div class="Knight-Rider-bar" style="background-color:'+(null==(__t=color)?"":__t)+'"></div><div class="Knight-Rider-bar" style="background-color:'+(null==(__t=color)?"":__t)+'"></div></div>'}return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],32:[function(t,e){"use strict";var i={"1785 GLC Baskerville":{display_name:"1785 Baskerville",family:"'1785 GLC Baskerville', serif",path:"1785glcbaskerville",_v:"1"},"Alternate Gothic":{display_name:"Alternate Gothic",family:"'Alternate Gothic', sans-serif",path:"alternategothic",_v:"3"},Arquitecta:{display_name:"Arquitecta",family:"'Arquitecta', sans-serif",path:"arquitecta",_v:"3"},Avalon:{display_name:"Avalon",family:"'Avalon', sans-serif",path:"avalon",_v:"1"},Baskerville:{display_name:"Baskerville",family:"Baskerville, 'Times New Roman', Times, serif"},"Bodoni Recut FS":{display_name:"Bodoni",family:"'Bodoni Recut FS', serif",path:"bodonirecutfs",_v:"3"},Bookmania:{display_name:"Bookmania",family:"'Bookmania', serif",path:"bookmania",_v:"1"},"Brutal Type":{display_name:"Brutal Type",family:"'Brutal Type', sans-serif",path:"brutaltype",_v:"1"},Calluna:{display_name:"Calluna",family:"'Calluna', serif",path:"calluna",_v:"3"},"Calluna Sans":{display_name:"Calluna Sans",family:"'Calluna Sans', sans-serif",path:"callunasans",_v:"3"},Capita:{display_name:"Capita",family:"'Capita', serif",path:"capita",_v:"1"},"Caslon FS":{display_name:"Caslon FS",family:"'Caslon FS', serif",path:"caslonfs",_v:"3"},"Clarendon Text Pro":{display_name:"Clarendon",family:"'Clarendon Text Pro', serif",path:"clarendontextpro",_v:"3"},"Clearface FS":{display_name:"Clearface",family:"'Clearface FS', serif",path:"clearface",_v:"4"},"Courier New":{display_name:"Courier New",family:"'Courier New', Courier, monospace"},Futura:{display_name:"Futura",family:"Futura, 'Century Gothic', AppleGothic, sans-serif"},"Garamond Classic FS":{display_name:"Garamond",family:"'Garamond Classic FS', serif",path:"garamondclassicfs",_v:"3"},Georgia:{display_name:"Georgia",family:"Georgia, Palatino, 'Palatino Linotype', Times, 'Times New Roman', serif"},Gibson:{display_name:"Gibson",family:"'Gibson', sans-serif",path:"gibson",_v:"3"},"Grumpy Black 48":{display_name:"Grumpy",family:"'Grumpy Black 48', serif",path:"grumpyblack48",_v:"3"},"Helvetica Neue":{display_name:"Helvetica",family:"'Helvetica Neue', Arial, Helvetica, sans-serif"},"Lorimer No 2":{display_name:"Lorimer No 2",family:"'Lorimer No 2', sans-serif",path:"lorimerno2",_v:"3"},"Lucida Sans":{display_name:"Lucida Sans",family:"'Lucida Sans', 'Lucida Grande', 'Lucida Sans Unicode', sans-serif"},"News Gothic FS":{display_name:"News Gothic",family:"'News Gothic FS', sans-serif",path:"newsgothicfs",_v:"3"},"Pratt Pro":{display_name:"Pratt Pro",family:"'Pratt Pro', serif",path:"prattpro",_v:"1"},Quadrat:{display_name:"Quadrat",family:"'Quadrat', serif",path:"quadrat",_v:"1"},"Sofia Pro":{display_name:"Sofia Pro",family:"'Sofia Pro', sans-serif",path:"sofiapro",_v:"2"},Spade:{display_name:"Spade",family:"'Spade', serif",path:"spade",_v:"1"},"Square Serif":{display_name:"Square Serif",family:"'Square Serif', serif",path:"squareserif",_v:"4"},Streetscript:{display_name:"Streetscript",family:"'Streetscript', sans-serif",path:"streetscript",_v:"1"},"Typewriter FS":{display_name:"Typewriter",family:"'Typewriter FS', serif",path:"typewriterfs",_v:"1"},Verdana:{display_name:"Verdana",family:"Verdana, Geneva, Tahoma, sans-serif"},Ziclets:{display_name:"Ziclets",family:"'Ziclets', serif",path:"ziclets",_v:"1"}};e.exports=i},{}],33:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("./header/compact"),n=t("./posts/highlighted"),a=s.extend({defaults:{include_info_popover:!0},className:"poptica_header",initialize:function(t){this.options=i.extend({},this.defaults,t),this.header=new o({model:this.model,targetPost:this.options.targetPost,include_info_popover:this.options.include_info_popover}),this.posts=new n({model:this.model}),this.bindEvents()},bindEvents:function(){this.listenToOnce(this.header,"ready",this._triggerReady)},_triggerReady:function(){this.trigger("ready")},render:function(){return this.$el.append(this.header.render().el,this.posts.render().el),this}});e.exports=a},{"./header/compact":34,"./posts/highlighted":35,lodash:"K2RcUv","prima/view":496}],34:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/lib/flags"),n=t("prima/lib/data"),a=t("prima/view"),r=t("prima/events"),l=t("prima/utils/colors"),h=t("prima/utils/url"),d=t("prima/lib/translate"),c=t("../../templates/blog_card.tpl"),u=t("../../utils/webfonts"),p=a.extend({className:"indash_tumblelog_compact",template:c,defaults:{current_data:{},unfollow_data:{},follow_data:{},template_data:{},hide_posts_on_unfollow:!1,stripDescriptionLineBreaks:!1,include_info_popover:!0},events:{"click .description a":"_descriptionLinkClicked","click .info_popover_button":"_infoPopoverButtonClicked","click .follow":"_onFollowClick","click .unfollow":"_onFollowClick"},initialize:function(t){if(this.options=i.extend({},this.defaults,t||{}),this.bindEvents(),this.is_rendered=!1,this.assets_host=n.get("Context/hosts/assets_host")||"",this.$description=null,this.$description_inner=null,!i.isEmpty(this.current_data)){var e=i.extend({},this.current_data,this.model.toJSON());this.model.set(e,{silent:!0})}this.model.get("global_theme_params")&&i.delay(i.bind(this.render,this),1)},bindEvents:function(){this.listenTo(this.model,"change:following",this._renderFollowButton),this.listenTo(this.model,"change:global_theme_params",this.render)},render:function(){var t=this.model.toJSON();if(t.following||(t.following=!1),this.is_rendered||!t.global_theme_params)return this;var e=i.result(u,t.global_theme_params.title_font),s=l.hexToRgb(t.global_theme_params.title_color);if(this.$el.html(this.template(i.merge(t,{show_navigation:!0,show_share_controls:!1,show_user_controls:this.options.include_info_popover,show_follow_button:!0,show_dismiss_controls:!1,title_font_family:e?e.family:!1,title_color_rgb:String(i.values(s).join(",")),followText:d("Follow"),unfollowText:d("Unfollow")},this.options.template_data))),this.$description=this.$(".description"),this.$description_inner=this.$description.find(".description_inner"),this._renderFontStyles(),this._renderInlineStyles(),this.options.include_info_popover){var o={el:this.$el,auto_show:!1,trigger:this.$el.find(".info_popover_button"),recipient:this.model.get("name"),asks:this.model.get("asks"),anonymous_asks:this.model.get("anonymous_asks"),url:this.model.get("url"),skip_glass:!0,model:this.model,targetPost:this.options.targetPost};r.trigger("popticainfopopover:initialize",{options:o})}return this.is_rendered=!0,this.$description.length&&(i.delay(i.bind(this.truncateDescription,this),100),this.options.stripDescriptionLineBreaks&&this.stripDescriptionLineBreaks()),this.trigger("ready"),this},stripDescriptionLineBreaks:function(){this.$description_inner.find("br").remove();var t=this.$description_inner.html(),e=t.replace(/[\n\r]/g," ");this.$description_inner.html(e)},truncateDescription:function(){var t=this.$description_inner.get(0);if(!(t.scrollHeight<=t.clientHeight)){var e=this.model.get("global_theme_params"),s=e.background_color,o=l.hexToRgb(s);this.$description.append(this.description_gradient_template({background_color:String(i.values(o).join(","))}))}},_onFollowClick:function(t){if(t.preventDefault(),!o.bool("is_logged_in"))return void window.open("/follow/"+this.model.get("name"),"_self");var e={follow_data:this.options.follow_data};this.model.get("following")?this._confirm_unfollow(e):(r.trigger("tumblelog:log_follow"),this.model.follow(e))},_confirm_unfollow:function(){var t=d("Are you sure you want to unfollow %1$s?").replace("%1$s","<strong>"+this.model.get("name")+"</strong>"),e={text:t,text_ok:d("Ok"),text_cancel:d("Nevermind")},i=this.model.requestUnfollow(),s={tumblelog:this.model.get("name")};i.promise.then(function(){r.trigger("tumblelog:log_unfollow",{loggingData:s})}),r.trigger("dialog:confirm:promise",i,e)},_infoPopoverButtonClicked:function(t){t.preventDefault(),t.stopPropagation(),r.trigger("popticainfopopover:show")},_descriptionLinkClicked:function(t){t.preventDefault();var e=s(t.currentTarget).attr("href");try{if(h&&h.hasAllowedProtocol(e)){if(!h.isAbsoluteUrl(e)){var i="http://"+this.model.get("name")+".tumblr.com/";e="/"===e.charAt(0)?e.substr(1):e,e=i+e}window.open(e,"_blank")}}catch(o){}},_renderFollowButton:function(){var t=this.model.get("following");this.$el.find(".follow").toggle(!t),this.$el.find(".unfollow").toggle(t)},_hidePosts:function(){},_open_dialog:function(t,e){function s(t,e){t.is_disabled=t.is_menu_open,e&&e()}this.is_disabled=!0,t.fail(i.bind(s,null,this)),t.done(i.bind(s,null,this,e))},_renderInlineStyles:function(){var t=this.model.get("global_theme_params"),e=t.header_image_focused&&t.header_stretch&&t.show_header_image,i=l.hexToHsv(t.background_color),s=l.hexToHsv(t.link_color),o=t.link_color;return l.compare(s,i)&&(o=l.readable(i)),e||(this.$(".navigation .nav_icon").css("color",o),this.$(".navigation .blog_name").css("color",o),this.$(".navigation button").css({color:t.background_color,"background-color":o})),this.$(".description a").css("color",t.link_color),this},_renderFontStyles:function(){if(u){var t=this.model.get("global_theme_params");if(i.has(u,t.title_font)){var e=i.result(u,t.title_font),o="webfont_"+e.path;if(e.path&&!s("head #"+o).length){var n=this.assets_host+"/fonts/"+e.path+"/stylesheet.css";n+=i.has(e,"_v")?"?v="+e._v:"",s("<link>",{id:o,rel:"stylesheet",type:"text/css",href:n}).appendTo(s("head"))}}}},description_gradient_template:i.template('<div class="description_gradient" style="background: -moz-linear-gradient(top,  rgba(<%= background_color %>,0) 0%, rgba(<%= background_color %>,0.75) 50%, rgba(<%= background_color %>,1) 100%);background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(<%= background_color %>,0)), color-stop(50%,rgba(<%= background_color %>,0.75)), color-stop(100%,rgba(<%= background_color %>,1)));background: -webkit-linear-gradient(top,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);background: -o-linear-gradient(top,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);background: -ms-linear-gradient(top,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);background: linear-gradient(to bottom,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);"></div>')});
e.exports=p},{"../../templates/blog_card.tpl":30,"../../utils/webfonts":32,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/lib/data":431,"prima/lib/flags":"f/LVtH","prima/lib/translate":456,"prima/utils/colors":477,"prima/utils/url":494,"prima/view":496}],35:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/events"),a=t("../../templates/posts/highlighted_posts.tpl"),r=o.extend({className:"recent_posts",template:a,events:{"click a":"onPostClick",mouseenter:"onMouseEnter"},defaults:{on_bottom:!0,$popover:s(),min_load_time:500,model:{},dashboard_post:{}},initialize:function(t){i.extend(this,this.defaults,t),this.model&&(this.renderLoader(),this.renderInlineStyles(),this.posts=this.model.get("highlighted_posts"),i.isUndefined(this.posts)&&this.fetchPosts(),this.bindEvents())},bindEvents:function(){this.listenTo(this.model,"change:highlighted_posts",this.render),this.listenTo(this.model,"change:global_theme_params",this.renderInlineStyles)},fetchPosts:function(){this.model.fetch_popover_data({is_tumblelog_popover:!0})},updatePosts:function(t){this.model=t,this.posts=this.model.get("highlighted_posts"),i.isUndefined(this.posts)?this.fetchPosts():this.render(!0)},renderLoader:function(){var t=this.model.toJSON();this.$el.html(this.template({loader_color:t.global_theme_params?t.global_theme_params.title_color:"#D9D9D9"}))},renderInlineStyles:function(){var t=this.model.get("global_theme_params");t&&this.$el.css("background-color",t.background_color)},render:function(t){var e=this.posts||this.model.get("highlighted_posts");if(!i.isArray(e))return this;var s=e.join("");return e.length<2?(setTimeout(i.bind(function(){this.$popover.addClass("is_empty"),this.$el.html("")},this),this.min_load_time),this):(this.$el.addClass("has_"+e.length+"_posts"),t===!0?(this.$el.addClass("is_cached").html(s),this):(setTimeout(i.bind(function(){this.$el.addClass("is_loaded").html(s)},this),this.min_load_time),this))},onPostClick:function(){},onMouseEnter:function(){n.trigger("TumblelogPopover:mouseenter_posts")}});e.exports=r},{"../../templates/posts/highlighted_posts.tpl":31,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/view":496}],36:[function(t,e){"use strict";var i=t("app/vendor/ace"),s=i.acequire("ace/lib/dom"),o=t("./post_form.scss").getCSSText(),n={isDark:!1,cssClass:"ace-post-form",cssText:o};s.importCssString(n.cssText,n.cssClass),e.exports=n},{"./post_form.scss":37,"app/vendor/ace":"4e8++S"}],37:[function(t,e){var i,s=t("sassr/style"),o=".ace-post-form .ace_selection{background-color:rgba(220, 235, 244, 0.8);}.ace-post-form .ace_entity{color:#f2992e;}.ace-post-form .ace_string{color:#748089;}.ace-post-form .ace_underline{color:#56bc8a;text-decoration:underline;}.ace-post-form .ace_storage{color:#d95e40;}.ace-post-form .ace_operator{color:#748089;}.ace-post-form .ace_identifier{color:#444444;}.ace-post-form .ace_function{color:#f2992e;}.ace-post-form .ace_type{color:#a77dc2;}.ace-post-form .ace_constant{color:#d95e40;}.ace-post-form .ace_variable{color:#56bc8a;}.ace-post-form .ace_keyword{color:#f2992e;}.ace-post-form .ace_tag,.ace-post-form .ace_attribute-equals,.ace-post-form .ace_attribute-name{color:#529ecc;}.ace-post-form .ace_attribute-value{color:#a77dc2;}.ace-post-form .ace_heading{color:#529ecc;}.ace-post-form .ace_strong{color:#000000;}.ace-post-form .ace_emphasis{color:#748089;}.ace-post-form .ace_list.ace_markup{color:#a77dc2;}";e.exports.getStyleElement=function(){return s.style},e.exports.getCSSText=function(){return o},e.exports.append=function(){return i||s.inject(o),i=!0,s.style},e.exports.remove=function(){return i&&s.eject(o),i=!1,s.style}},{"sassr/style":520}],38:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/view"),n=t("prima/events"),a=o.extend({id:"milestone-confetti",tagName:"canvas",defaults:{amount:100,autoParty:!1,colors:["#D95E40","#F2992E","#56BC8A","#529ECC","#A77DC2","#748089"],size:40,speed:.5,onDone:i.noop},__resize:function(){this.$parent.length&&(this.el.width=this.$parent.width(),this.el.height=this.$parent.height())},_updateConfetti:function(t,e){this.confettiAngle+=.001,t.off||(t.tiltAngle+=t.tiltAngleIncrement,t.tilt=15*Math.sin(t.tiltAngle-e/3),t.y+=(Math.cos(this.confettiAngle+t.density)+.5*t.radius)*this.options.speed),t.y>this.el.height+20&&(this.isAnimating?(t.tilt=a.range(-10,10,!0),t.tileAngle=0,t.tiltAngleIncrement=a.range(.05,.1),t.x=Math.random()*this.el.width,t.y=-20):t.off||(t.off=!0,this.confettiOffscreen++))},_stopAnimating:function(){this.animationInterval&&(clearInterval(this.animationInterval),this.animationInterval=null),this.isAnimating=!1},_startAnimating:function(t){t=t||!1,this._stopAnimating(),this.animationInterval=setInterval(s.bind(this.draw,this),15),this.isAnimating=t?!0:this.isAnimating},initialize:function(t){this.options=s.extend({},this.defaults,t||{}),this.colors=this.options.colors,this.$win=i(window),this.$parent=i(),this.context=this.el.getContext("2d"),this.animationInterval=null,this.confetti=[],this.confettiAngle=0,this.confettiOffscreen=0,this.isAnimating=!1},render:function(){return s.defer(s.bind(this.setup,this)),this},setup:function(){this.$parent=this.$el.parent(),this.$parent.length&&(this.el.width=this.$parent.width(),this.el.height=this.$parent.height()),this.listenTo(n,"DOMEventor:flatresize",this.__resize);for(var t=this.options.size,e=.5*t,i=0,s=this.options.amount;s>i;i++)this.confetti.push({x:Math.random()*this.el.width,y:Math.random()*-this.el.height,radius:a.range(e,t),density:a.range(10,s),tilt:a.range(-10,10,!0),tiltAngle:0,tiltAngleIncrement:a.range(.05,.1),color:this.colors[a.range(0,this.colors.length-1,!0)],off:!1});this.options.autoParty&&this.party()},draw:function(){if(this.context.clearRect(0,0,this.el.width,this.el.height),this.confettiOffscreen===this.confetti.length)return void this.remove();for(var t=5,e=0;e<this.confetti.length;e++){var i=this.confetti[e];this.context.beginPath(),this.context.lineWidth=.5*i.radius,this.context.strokeStyle=i.color,this.context.moveTo(i.x+i.tilt+i.radius/t,i.y),this.context.lineTo(i.x+i.tilt,i.y+i.tilt+i.radius/t),this.context.stroke(),this._updateConfetti(i,e)}},party:function(){return this.confettiOffscreen=0,this._startAnimating(!0),this},stopPartying:function(){return this.isAnimating=!1,this},remove:function(){return this._stopAnimating(),this.options.onDone(),o.prototype.remove.call(this)}},{range:function(t,e,i){i=i||!1;var s=(e-t)*Math.random()+t;return i?Math.round(s):s}});e.exports=a},{jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/view":496}],39:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/component"),o=t("./views/dialog"),n=s.extend({name:"Dialog",initialize:function(t){this.dialogView=o,this.options=i.extend({},this.defaults,t)},alert:function(t,e,i){return this.dialogView.alert.call(this.dialogView,t,e,i)},confirm:function(t,e,i,s,o){return this.dialogView.confirm.call(this.dialogView,t,e,i,s,o)},dialog:function(t){return this.dialogView.dialog.call(this.dialogView,t)},isActive:function(t){return this.dialogView.isActive.call(this.dialogView,t)},close:function(t){return this.dialogView.close.call(this.dialogView,t)},getDialogEl:function(){return this.dialogView.getDialogEl.call(this.dialogView)},__:function(t){return this.dialogView.__.call(this.dialogView,t)}});e.exports=new n},{"./views/dialog":43,lodash:"K2RcUv","prima/component":428}],40:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<button class="ui_button btn_'+(null==(__t=btn_id)?"":__t)+" chrome "+(null==(__t=btn_class)?"":__t)+'" data-btn-id="'+(null==(__t=btn_id)?"":__t)+'"><span>'+(null==(__t=text)?"":__t)+"</span></button>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],41:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<span class="text">'+(null==(__t=text)?"":__t)+"</span>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],42:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="ui_dialog '+(null==(__t=type)?"":__t)+'">'+(null==(__t=content_html)?"":__t)+'<div class="buttons">'+(null==(__t=buttons_html)?"":__t)+"</div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],43:[function(t,e,i){"use strict";var s=t("jquery"),o=t("lodash"),n=t("prima/view"),a=t("prima/events"),r=t("prima/lib/translate"),l=n.extend({el:".ui_dialog",translations:{},defaultTemplates:{dialog:t("../templates/dialog.tpl"),content:t("../templates/content.tpl"),button:t("../templates/button.tpl")},events:{"click .ui_button":"buttonClick"},defaultDialog:{text:"",type:"default",has_form:"auto",visible_glass:!0,confirm_by_enter:!0,close_by_space:!0,key_tab:!0,key_close:!0,scroll_lock:!1,keycommand_maintain:!1,animate:!0,animate_in:{dialog_el:".ui_dialog",dialog_class:"add_animation fadeIn"},on_close:function(){},on_open:function(){}},initialize:function(){this.options=o.extend(this.defaults,this.options),this.templates=this.defaultTemplates,this.is_visible=!1,this.dialogQueueOrder=[],this.dialogQueue={},this.queueCounter=0,this.currentDialog=!1,this.currentDialogId=0,this.uid=0,this.$body=s("body"),this._initClickLock(),this._setupKeys(),a&&!i.Dialog&&(this.listenTo(a,"dialog:dialog",this.dialog),this.listenTo(a,"dialog:confirm",this.confirm),this.listenTo(a,"dialog:confirm:promise",this.confirmPromise),this.listenTo(a,"dialog:alert",this.alert),this.listenTo(a,"dialog:close",this.close))},dialog:function(t){return o.isObject(t)?this._dialog(t):!1},confirm:function(t,e,i,s,n){o.isString(t)&&(t={text:t});var a={callback_ok:e,callback_cancel:i,text_ok:s,text_cancel:n};t=o.extend({},a,t);var l={text:t.text,type:"confirm",visible_glass:!0,keycommand_maintain:t.keycommand_maintain||!1,templates:t.templates||null,escape_button:0,buttons:{0:{text:t.text_cancel||r("Cancel"),close:!0,callback:o.isFunction(t.callback_cancel)?t.callback_cancel:function(){}},1:{text:t.text_ok||r("OK"),selected:!0,btn_class:"blue",close:!0,callback:o.isFunction(t.callback_ok)?t.callback_ok:function(){}}}};return this._dialog(l)},confirmPromise:function(t,e){this.confirm(e,t.resolve,t.reject)},alert:function(t,e,i){o.isString(t)&&(t={text:t});var s={callback_ok:e,text_ok:i};t=o.extend({},s,t);var n={text:t.text,type:"alert",visible_glass:!0,keycommand_maintain:t.keycommand_maintain||!1,templates:t.templates||null,escape_button:0,buttons:{0:{text:t.text_ok||r("OK"),selected:!0,btn_class:"blue",close:!0,callback:o.isFunction(t.callback_ok)?t.callback_ok:function(){}}}};return this._dialog(n)},getDialogEl:function(){return this.el},buttonClick:function(t){var e=s(t.currentTarget),i=e.data("btn-id");if(o.isUndefined(this.currentDialog.buttons[i])||e.hasClass("disabled"))return!1;var n=this.currentDialog.buttons[i],a=null;o.isFunction(n.callback)&&(a=n.callback(this)),a!==!1&&(!o.isUndefined(n.close)&&n.close||o.isUndefined(n.close))&&this.close()},isActive:function(t){return this.currentDialog===!1||this.currentDialog.uid!==t?!1:!0},close:function(t){if(this.currentDialog===!1)return!1;if(o.isUndefined(t)&&(t=!1),t!==!1&&this.currentDialog.uid!==t)return!1;if(this.$dialog_lock.hide(),s(".ui_dialog_pos").remove(),this.is_visible=!1,this.currentDialog.keycommand_maintain||a.trigger("keycommands:resume"),o.isFunction(this.currentDialog.on_close)&&this.currentDialog.on_close(),a.trigger("dialog:closed"),this.currentDialog=!1,s("html").removeClass("dialog_lock"),this.dialogQueueOrder.length>0){var e=this.dialogQueueOrder.shift(),i=this.dialogQueue[e];delete this.dialogQueue[e],this._dialog(i)}},_tab:function(){var t=this.$el.find(".buttons .tab_frame"),e=t.filter(".focus"),i=t.index(e),s=t.length,o=!1;o=s>i+1?i+1:0,e.removeClass("focus init_focus");var n=t.eq(o);n.length>0&&(n.addClass("focus"),n.find("button").focus())},_formIsTabToButton:function(t,e){var i=this.$el.find(":focus");if(0===i.length)return!0;var s=this.$el.find(".buttons .tab_frame"),o=this.$el.find(":input:visible"),n=o.index(i);if(e&&n===o.length-1)return this.$el.find(":input:visible:first").focus(),t.preventDefault(),s.removeClass("focus init_focus"),!1;if(n>=0){var a=this.$el.find(":input:visible:eq("+(n+1)+")");if(a.length>0&&a.hasClass("ui_button"))return!0}return s.removeClass("focus init_focus"),!1},_select:function(){var t=this.$el.find(".buttons .tab_frame.focus"),e=t;1===e.length&&e.find(".ui_button").click()},_formIsFocusOnButton:function(){var t=this.$el.find(":focus");return 0===t.length?!1:t.hasClass("ui_button")},_escape:function(){if(!o.isUndefined(this.currentDialog.escape_button)){var t=this.$el.find(".btn_"+this.currentDialog.escape_button);t.length&&t.click()}},_dialog:function(t){if(o.isUndefined(t.uid)&&(t.uid=this._getUid()),this.currentDialog!==!1)return this.dialogQueueOrder.push(this.queueCounter),this.dialogQueue[this.queueCounter]=t,this.queueCounter++,t.uid;o.defaults(t,this.defaultDialog);var e=this._buildButtons(t.buttons);o.extend(t,{buttons_html:e});var i=this.templates;o.isObject(t.templates)&&(i=o.extend({},this.templates,t.templates));var n=o.isString(i.dialog)?o.template(i.dialog):i.dialog,r=o.isString(i.content)?o.template(i.content):i.content;t.content_html=r(t);var l=n(t);this.$dialog_lock.show(),o.isUndefined(t.visible_glass)?this.$dialog_lock.removeClass("opaque"):t.visible_glass&&this.$dialog_lock.addClass("opaque"),!o.isUndefined(t.scroll_lock)&&t.scroll_lock&&s("html").addClass("dialog_lock"),this.currentDialogId=t.uid,this.currentDialog=t;var h=s('<div id="dialog_'+this.currentDialogId+'" class="ui_dialog_pos">'+l+"</div>");return h.appendTo(this.$body),this.setElement(h),this.is_visible=!0,t.animate&&o.isObject(t.animate_in)&&this.$el.find(t.animate_in.dialog_el).length&&this.$el.find(t.animate_in.dialog_el).addClass(t.animate_in.dialog_class),this._focus(),this.currentDialog.keycommand_maintain||a.trigger("keycommands:suspend"),o.isUndefined(t.has_form)&&(t.has_form="auto"),"auto"===t.has_form&&(t.has_form=this.$el.find("form, input").length>0),o.isFunction(t.on_open)&&t.on_open(),this.el=this.$el[0],this.delegateEvents(),a.trigger("dialog:opened"),t.uid},_button:function(t,e,i){var s,n=o.isString(this.templates.button)?o.template(this.templates.button):this.templates.button;o.isObject(this.currentDialog.templates)&&(s=this.currentDialog.templates.button);var a=n({btn_class:e,text:t,btn_id:o.isUndefined(i)?"":i});return a='<div class="tab_frame">'+a+"</div>"},_focus:function(){if(!this.currentDialog)return!1;for(var t in this.currentDialog.buttons){var e=this.currentDialog.buttons[t];if(!o.isUndefined(e.selected)&&e.selected){var i=this.$el.find(".btn_"+t);i.length>0&&i.parent().addClass("focus init_focus")}}},_setupKeys:function(){s(document).on("keydown",o.bind(function(t){var e=t.ctrlKey||t.shiftKey||t.metaKey;if(this.is_visible&&!e){var i=t.keyCode||t.which;if(9===i&&this.currentDialog.key_tab){if(this.currentDialog.has_form&&!this._formIsTabToButton(t,!0))return;t.preventDefault(),this._tab(t)}if(13===i&&this.currentDialog.confirm_by_enter||32===i&&this.currentDialog.close_by_space){if(this.currentDialog.has_form&&32===i&&!this._formIsFocusOnButton(t))return;t.preventDefault(),this._select(t)}27===i&&this.currentDialog.key_close&&(t.preventDefault(),this._escape(t))}},this))},_buildButtons:function(t){if(!o.isObject(t))return"";var e=0;for(var i in t)t.hasOwnProperty(i)&&e++;for(var s="",n=0;e>n;n++)if(!o.isUndefined(t[n])){var a=o.isUndefined(t[n].text)?"":t[n].text,r=o.isUndefined(t[n].btn_class)?"":t[n].btn_class,l=o.isUndefined(t[n].selected)?!1:t[n].selected;s+=this._button(a,r,n,l)}return s},_initClickLock:function(){var t=this.$dialog_lock=s("<div>",{"class":"ui_dialog_lock"});s(document).ready(function(){t.prependTo("body")})},_getUid:function(){return this.uid++},__:function(t){return r(t)}});e.exports=new l},{"../templates/button.tpl":40,"../templates/content.tpl":41,"../templates/dialog.tpl":42,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/lib/translate":456,"prima/view":496}],44:[function(t,e){"use strict";var i,s=t("jquery"),o=t("lodash"),n=t("prima/lib/translate"),a=t("prima/component"),r=t("prima/events"),l=t("app/components/dialog"),h=t("./views/drawer-view"),d=a.extend({name:"drawer",selector:"body",defaults:{suspended:!1,needsCloseConfirmation:!1},initialize:function(){this.$glass=null,this.$container=s(this.container),this.bindEvents()},bindEvents:function(){this.listenTo(r,"DOMEventor:keydown:escape",this.initiateClose),this.listenTo(r,"post:form:show",this.suspend),this.listenTo(r,"post:form:hide",this.resume),this.listenTo(r,"drawer:suspend",this.suspend),this.listenTo(r,"drawer:resume",this.resume),this.listenTo(r,"drawer:enableCloseConfirmation",this.enableCloseConfirmation),this.listenTo(r,"drawer:disableCloseConfirmation",this.disableCloseConfirmation),this.$container.on("click.drawerOpen","[data-drawer-open]",o.bind(this.onClickOpen,this))},suspend:function(){this.set("suspended",!0)},resume:function(){this.set("suspended",!1)},enableCloseConfirmation:function(){this.set("needsCloseConfirmation",!0)},disableCloseConfirmation:function(){this.set("needsCloseConfirmation",!1)},canOpen:function(){return!this.get("suspended")&&!this.view},toggle:function(t,e){this.canOpen?this.open(t,e):this.close()},open:function(t,e){this.view=new h({subviews:{"drawer-content":{constructor:t,options:e||{}}}}),this.showGlass(),r.trigger("keycommands:suspend"),r.trigger("toaster:suspend"),this.append(),this.trigger("open"),r.trigger("drawer:open")},onClickOpen:function(t){t.preventDefault();var e=s(t.currentTarget).attr("data-drawer-open");this.trigger("open:"+e),r.trigger("drawer:open:"+e)},initiateClose:function(){this.view&&(this.get("needsCloseConfirmation")===!0?l.confirm(n("Close without sending?"),o.bind(this.close,this),this.noop,n("OK"),n("Cancel")):this.close())},close:function(){this.view&&(this.view.animateRemove(),this.view=null,this.hideGlass(),r.trigger("keycommands:resume"),r.trigger("toaster:resume"),this.trigger("close"),r.trigger("drawer:close"))},remove:function(){return this.close(),this},showGlass:function(){this.$glass=s("<div>",{"class":"ui_peepr_glass"}).appendTo(this.$container);var t=o.bind(function(){this.$container.addClass("peepr")},this);o.delay(t,50),this.$glass.on("click",o.bind(this.initiateClose,this))},hideGlass:function(){var t=this.$glass;this.$glass=null,this.$container.removeClass("peepr"),o.delay(function(){t.remove()},150)}});e.exports=function(){return i||(i=new d),i}},{"./views/drawer-view":46,"app/components/dialog":39,jquery:"HlZQrA",lodash:"K2RcUv","prima/component":428,"prima/events":429,"prima/lib/translate":456}],45:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+=""+(null==(__t=_subview("drawer-content"))?"":__t);return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],46:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("velocity-animate"),n=t("prima/events"),a=t("prima/views/base"),r=t("../templates/drawer-view.tpl"),l=a.extend({template:r,className:"drawer",defaults:{visible:!1},initialize:function(t){t.subviews&&(this.cacheElements({$body:i("body")}),this.bindEvents())},bindEvents:function(){this.listenTo(n,"DOMEventor:keydown:tab",this.disableKey)},afterRender:function(){this.show()},disableKey:function(t){var e=i(t.target).is("input");e||t.preventDefault()},show:function(){this.get("visible")||(this.set("visible",!0),o.animate(this.el,{translateX:["0%","100%"]},{duration:200}))},hide:function(t){this.get("visible")?(this.set("visible",!1),o.animate(this.el,{translateX:["100%","0%"]},{duration:200,complete:t})):t()},animateRemove:function(){return this.hide(s.bind(function(){this.remove()},this)),this}});e.exports=l},{"../templates/drawer-view.tpl":45,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/views/base":497,"velocity-animate":"lWl/mc"}],47:[function(t,e){"use strict";var i=(t("jquery"),t("prima/component")),s=t("./views/flat-select"),o=i.extend({name:"FlatSelect",view:function(t){return new s(t)}});e.exports=o},{"./views/flat-select":48,jquery:"HlZQrA","prima/component":428}],48:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/view"),n=o.extend({el:"body",defaults:{},events:{"change .flat_select select":"__selectChange"},__selectChange:function(t){var e=i(t.currentTarget);this.updateSelect(e)},initialize:function(t){this.options=s.extend({},this.defaults,t)},updateSelect:function(t){var e=t.siblings("label");e.text(t.find(":selected").text())}});e.exports=n},{jquery:"HlZQrA",lodash:"K2RcUv","prima/view":496}],49:[function(t,e){"use strict";var i,s=t("jquery"),o=t("prima/component"),n=t("./views/footer"),a=t("./views/sidebar_footer"),r=o.extend({name:"footer",initialize:function(){this.createFooter()},createFooter:function(){s(".l-footer").length&&(this.footerView=new n({el:".l-footer"})),s(".sidebar_nav").length&&(this.sidebarFooterView=new a({el:".pinned_sidebar_footer"}))}});e.exports=function(){return i||(i=new r),i}},{"./views/footer":50,"./views/sidebar_footer":51,jquery:"HlZQrA","prima/component":428}],50:[function(t,e){"use strict";var i=t("prima/view"),s=i.extend({initialize:function(){}});e.exports=s},{"prima/view":496}],51:[function(t,e){"use strict";var i=t("prima/views/base"),s=t("prima/events"),o=t("prima/utils/bindendevent").transition,n=i.extend({defaults:{fadeScrollDistance:2e3,visible:!0},initialize:function(){this.listenTo(s,"DOMEventor:flatscroll",this.onScroll),this.on("change:visible",this.toggleVisibility),this.$nav=this.$el.find(".sidebar_nav")},onScroll:function(t){t&&(t.windowScrollY>=this.get("fadeScrollDistance")?this.set("visible",!1):this.set("visible",!0))},toggleVisibility:function(t,e){e===!0?(this.showElement(),_.defer(_.bind(function(){this.$nav.toggleClass("visible",e)},this))):(o(this.$nav,_.bind(function(){this.hideElement()},this)),this.$nav.toggleClass("visible",e))},hideElement:function(){this.$el.css({display:"none"})},showElement:function(){this.$el.css({display:"block"})}});e.exports=n},{"prima/events":429,"prima/utils/bindendevent":474,"prima/views/base":497}],52:[function(t,e){"use strict";var i=t("prima/component"),s=t("prima/lib/domeventor"),o=t("prima/events"),n=t("jquery"),a=t("lodash"),r=i.extend({name:"GutterMediaManager",gutteredView:null,gutterMargin:20,gutterWidth:215,maxViewWidth:300,viewportTransitionWidth:900,initialize:function(){this.layoutHasGutter=this.$right_column().length>0,this.layoutHasGutter||(this.gutterMargin=-65)},$right_column:function(){return this._$right_column||(this._$right_column=n(".right_column")),this._$right_column},toggleBackground:function(t){this.layoutHasGutter&&(t?(this.$right_column().addClass("has_docked_post"),this.$right_column().on("click.gutterManager",a.bind(this.handleGutterClick,this))):(this.$right_column().removeClass("has_docked_post"),this.$right_column().off("click.gutterManager")))},putViewInGutter:function(t,e){return e=a.defaults(e||{},{winRect:s.rect(),gutterPosition:this.gutterPosition(),animation:null,dimRadar:!0,removeOnGutterClick:!1,onDock:a.noop,onUndock:a.noop,dockLoggingName:"post:docked",dockLoggingData:null,undockLoggingName:"post:undocked",undockLoggingData:null}),this.isDockable(t,e)?(e.onDock=e.onDock||a.noop,this.gutteredView&&this.removeGutteredView(),this.gutteredView={view:t,options:e},e.onDock.call(t,e),e.dimRadar&&this.toggleBackground(!0),e.dockLoggingName&&e.dockLoggingData&&o.trigger(e.dockLoggingName,{loggingData:e.dockLoggingData}),this.gutteredView):!1},removeGutteredView:function(){if(this.gutteredView){var t=this.gutteredView.options,e=this.gutteredView.view;t.onUndock=t.onUndock||a.noop,t.onUndock.call(e,t),this.gutteredView=null,t.dimRadar&&this.toggleBackground(!1),t.undockLoggingName&&t.undockLoggingData&&o.trigger(t.undockLoggingName,{loggingData:t.undockLoggingData})}},isViewInGutter:function(t){return this.gutteredView&&this.gutteredView.view===t},isDockable:function(t,e){if(!this.gutteredView)return!0;var i=this.gutteredView?this.gutteredView.options.alwaysEvict:!0,s=e.alwaysEvict;return this.gutteredView.view===t||s&&!i?!1:!0},handleGutterClick:function(t){this.gutteredView&&(t.preventDefault(),this.gutteredView.options.removeOnGutterClick&&this.removeGutteredView())},gutterPosition:function(){var t=s.rect(),e=this.viewportTransitionWidth/2-this.gutterMargin-this.gutterWidth,i={width:this.maxViewWidth,left:"50%",bottom:20,translateX:e},o=this.maxViewWidth-this.gutterWidth+this.viewportTransitionWidth;return t.windowWidth<o&&(i.width=o-t.windowWidth),i.width<this.gutterWidth&&(i.width=this.gutterWidth),i}});e.exports=new r},{jquery:"HlZQrA",lodash:"K2RcUv","prima/component":428,"prima/events":429,"prima/lib/domeventor":433}],53:[function(t,e){"use strict";var i,s=(t("lodash"),t("prima/component")),o=(t("prima/lib/flags"),t("./views/header")),n=s.extend({name:"header",autoAppend:!0,append:function(){this.headerView=new o({el:this.container}),this.enableFunctionality()},enableFunctionality:function(){this.headerView.enableCompose()},disableSticky:function(){this.headerView.disableSticky()}});e.exports=function(){return i||(i=new n),i}},{"./views/header":58,lodash:"K2RcUv","prima/component":428,"prima/lib/flags":"f/LVtH"}],54:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<span class="tab_notice tab-notice--outlined ',value>0&&(__p+="tab-notice--active"),__p+='"><span class="tab_notice_value">'+(null==(__t=value)?"":_.escape(__t))+"</span></span>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],55:[function(t,e){"use strict";var i=t("prima/view"),s=t("prima/lib/flags"),o=t("app/components/account-popover"),n=t("app/components/account-tour-guide"),a=t("app/lib/currentuser"),r=t("../templates/tab-notice.tpl"),l=i.extend({events:{click:"openPopover"},addUnreadCount:function(){s.bool("nav_redesign_blog")&&this.$el.append(r({value:this.user.getUnreadCount()}))},initialize:function(){this.popover=null,this.user=a(),this.addUnreadCount(),this.popoverOptions={container:this.$el,viewOptions:{}},s.bool("nav_redesign_account")&&s.bool("nav_redesign_blog")&&!this.user.get("seen_atg")&&this.beginTourGuide()},openPopover:function(t){if(t.preventDefault(),this.popover)this.popover.show();else{var e=this.$el.closest(".l-header-container");e.length&&(this.popoverOptions.viewOptions.isFixedPosition="fixed"==e.css("position")),this.popover=new o(this.popoverOptions).render()}},beginTourGuide:function(){this.tourGuide=new n({container:this.$el}),this.tourGuide.open()}});e.exports=l},{"../templates/tab-notice.tpl":54,"app/components/account-popover":3,"app/components/account-tour-guide":10,"app/lib/currentuser":296,"prima/lib/flags":"f/LVtH","prima/view":496}],56:[function(t,e){"use strict";var i=t("prima/view"),s=(t("prima/lib/flags"),t("app/components/activity-popover")),o=t("app/lib/currentuser"),n=(t("../templates/tab-notice.tpl"),i.extend({events:{click:"openPopover"},addUnreadCount:function(){},initialize:function(){this.popover=null,this.user=o(),this.addUnreadCount(),this.popoverOptions={container:this.$el,viewOptions:{}}},openPopover:function(t){if(t.preventDefault(),this.popover)this.popover.show();else{var e=this.$el.closest(".l-header-container");e.length&&(this.popoverOptions.viewOptions.isFixedPosition="fixed"==e.css("position")),this.popover=new s(this.popoverOptions).render()}}}));e.exports=n},{"../templates/tab-notice.tpl":54,"app/components/activity-popover":13,"app/lib/currentuser":296,"prima/lib/flags":"f/LVtH","prima/view":496}],57:[function(t,e){"use strict";var i=t("prima/lib/flags"),s=t("prima/view"),o=t("prima/events"),n=t("prima/mixins/accessor"),a=s.extend({mixins:[n],el:".compose-button",events:{click:"toggleOpen"},defaults:{open:!1},loggingData:{source:"compose-button"},initialize:function(){this.on("change:open",this.onChangeOpen),i.bool("dashboard_refresh")?(this.listenTo(o,"fastCompose:init:complete",this.open),this.listenTo(o,"fastCompose:dismiss:complete",this.close)):(this.listenTo(o,"fastCompose:init:complete",this.open),this.listenTo(o,"fastCompose:dismiss:complete",this.close))},toggleOpen:function(){this.toggle("open")},open:function(){this.set("open",!0)},close:function(){this.set("open",!1)},onChangeOpen:function(t,e){i.bool("dashboard_refresh")?e?o.trigger("fastCompose:init",{loggingData:this.loggingData}):o.trigger("fastCompose:dismiss",{loggingData:this.loggingData}):o.trigger(e?"fastCompose:init":"fastCompose:dismiss")}});e.exports=a},{"prima/events":429,"prima/lib/flags":"f/LVtH","prima/mixins/accessor":458,"prima/view":496}],58:[function(t,e){"use strict";var i=t("jquery"),s=t("prima/view"),o=t("prima/events"),n=t("prima/mixins/accessor"),a=t("prima/lib/flags"),r=t("./compose_btn"),l=t("app/components/switcher"),h=t("./logo"),d=t("./account-menu"),c=t("./activity-menu"),u=s.extend({mixins:[n],defaults:{headerHeight:52},initialize:function(){var t=a.bool("is_logged_in");this.logo=new h({el:'[prima-component="logo"]'}),t&&(this.accountMenu=new d({el:".tab_nav_account"}),i(".tab_activity").length&&(this.activityMenu=new c({el:".tab_activity"}))),this.listenTo(o,"Header:hide",this.hide),this.listenTo(o,"Header:show",this.show),this.$window=i(window)},enableCompose:function(){this.composeBtn=new r,this.switcher=new l},disableSticky:function(){this.$el.addClass("l-header-container--unstuck")},hide:function(){var t=this.$window.scrollTop(),e=t<this.get("headerHeight")?t:this.get("headerHeight");this.$el.css({position:"absolute",top:t+"px"}),this.$el.velocity({translateY:[-e,0],translateZ:"0px"},150).velocity({translateY:"0px",translateZ:"0px",top:0},0)},show:function(){var t=this.$window.scrollTop(),e=t<this.get("headerHeight")?t:this.get("headerHeight");this.$el.css({position:"absolute",top:t+"px",transform:"translateY("+-e+"px) translateZ(0)"}),this.$el.velocity({translateY:[0,-e],translateZ:"0px"},150).css({position:"fixed",top:0})}});e.exports=u},{"./account-menu":55,"./activity-menu":56,"./compose_btn":57,"./logo":59,"app/components/switcher":259,jquery:"HlZQrA","prima/events":429,"prima/lib/flags":"f/LVtH","prima/mixins/accessor":458,"prima/view":496}],59:[function(t,e){"use strict";var i=t("prima/view"),s=i.extend({initialize:function(){}});e.exports=s},{"prima/view":496}],60:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/component"),o=t("./views/main"),n=s.extend({name:"NetNeutralityC2015Page",defaults:{},initialize:function(t){this.options=i.extend({},this.defaults,t),this.mainView=new o},render:function(){this.mainView.render().$el.appendTo("body")}});e.exports=n},{"./views/main":63,lodash:"K2RcUv","prima/component":428}],61:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="medium-message pane-tem">Thanks! You\'ll be hearing from us soon.</div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],62:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<h1 class="fixed-cta" data-call-to-action><div class="cta-text"><span class="text-white">Net neutrality is official!</span> <span class="text-black">Tell congress you\'re thrilled.</span></div></h1><div class="pane bg-turquoise text-white"><div class="devices-graphic"></div><h2 class="big-message pane-item pane-item-centered">You saved the internet</h2><p class="medium-message pane-item pane-item-centered">You made the call and saved the day.</p></div><div class="pane bg-black text-white"><div class="long-text pane-item pane-item-centered"><p>It happened. Under the stewardship of Chairman Tom Wheeler, the FCC has officially voted to declare internet service providers to be common carriers under Title II of the Communications Act, and issue strong, clear net neutrality rules. That means no traffic discrimination, no paid prioritization, no throttling, and no slow lanes. It\'s a giant leap forward for internet freedom, and it\'ll ensure that future generations have the same opportunities for free speech, innovation, and just-plain-whatever that we\'ve all enjoyed.</p><p>You have yourselves to thank. Tumblr users placed nearly 200,000 calls to their congressional representatives, and our partners in this effort drove hundreds of thousands more. You were up against massive and well-funded lobbying operations, but the FCC chose to listen to you, instead. This is your victory, and your internet. Thanks for being a part of it.</p></div></div><div class="actionable-panes"><div data-action-pane="form" class="pane bg-yellow text-black form-pane"><div class="graphic its-our-internet"></div><h2 class="big-message pane-item pane-item-centered pane-item-normal-spacing">You won!<br>But you weren\'t alone…</h2><div class="long-text pane-item pane-item-centered"><p data-action-anchor>It\'s easy to be cynical about politics, often for good reason. Throughout this whole battle, though, your representatives have taken the time to listen to your concerns and share them with the FCC. Take a moment to let them know you appreciate their efforts. We\'ll help you.</p></div><form data-form class="form pane-item pane-item-narrow"><div class="form-row"><input type="text" class="form-field phone" data-field="phone" name="person[phone]" placeholder="Phone number"> <input type="text" class="form-field zipcode" data-field="postal_code" name="person[postal_code]" placeholder="Zip code"></div><div class="form-row"><button class="chrome big black submit-button full-width"><span class="label">Call my representative</span> <span class="Knight-Rider-loader animate"><span class="Knight-Rider-bar"></span> <span class="Knight-Rider-bar"></span> <span class="Knight-Rider-bar"></span></span></button></div><div class="form-row"><a href="https://www.battleforthenet.com" class="small-link" target="_blank">Send an email instead</a></div><div class="form-row error-message">Something went wrong. Try again?</div></form><div class="long-text pane-item pane-item-centered"><p>(We won\'t keep any of this information, by the way.)</p></div></div><div data-action-pane="call" class="pane bg-yellow text-black call-pane"><div class="graphic its-our-internet"></div><h2 class="big-message pane-item pane-item-centered" data-action-anchor>You\'ll do great</h2><div class="medium-message pane-item pane-item-centered">We\'ll call you in a few moments and connect you to your representative.</div><div class="medium-message compressed uppercase-text pane-item pane-item-centered"><span class="bold-text">HERE\'S WHAT TO SAY:</span></div><div class="long-text pane-item pane-item-centered pane-item-extra-spacing"><p>Hi. This is <span class="bold-text">[your name]</span> from <span class="bold-text">[your state]</span>.<br>I\'m one of your constituents.</p><p>I\'m calling to thank you for supporting the FCC in reclassifying consumer broadband under Title II and issuing strong net neutrality rules. Under pressure from ISPs and lobbyists, you took a stand for internet freedom, and you\'ve help secure an open, non-discriminatory internet for generations to come. Thank you!</p></div><div class="pane-item pane-item-narrow pane-item-centered"><button data-nav-to="success" class="chrome big black submit-button full-width">I did it</button></div><div class="pane-item pane-item-centered"><span data-nav-to="form" class="small-link">Busy signal? Try again.</span></div></div><div data-action-pane="success" class="pane bg-yellow text-black success-pane"><div class="graphic its-our-internet"></div><h2 class="big-message pane-item pane-item-centered" data-action-anchor>Nice work</h2><div class="long-text pane-item pane-item-centered pane-item-extra-spacing pane-item-narrow">Thanks for being such a big part of all this. It wouldn\'t have happened without you. If you\'d like to stay up-to-date about everything worth fighting for, feel free to join our mailing list.</div><div class="form pane-item pane-item-narrow email-signup"><div class="form-row"><input type="text" class="form-field email" placeholder="Email address"> <button data-email-signup class="chrome big black submit-button full-width"><span class="label">COUNT ME IN</span> <span class="Knight-Rider-loader animate"><span class="Knight-Rider-bar"></span> <span class="Knight-Rider-bar"></span> <span class="Knight-Rider-bar"></span></span></button></div><div class="form-row error-message">Something went wrong. Try again?</div></div></div></div><div class="pane bg-brown text-white"><a href="http://www.tumblrmerch.com/products/51204-net-neutrality-enamel-pin" title="Net Neutrality Pin" target="_blank" class="graphic internet-pin"></a><h2 class="big-message pane-item pane-item-centered pane-item-wide">Title II is good<br>for me, you, and everybody<br>on the internet</h2></div><div class="pane bg-beige text-turquoise"><div class="graphic internet-is-open"></div><div class="long-text pane-item pane-item-centered"><p>No one tells you what the internet is for. You get to decide. Whatever you want to make, or do, or say, the internet is there for you. That\'s a powerful thing.</p><p>And now it\'s official. Thanks to you, your representatives, and the FCC, the internet officially belongs to everybody.</p><p>Bravo.</p></div></div><div class="pane bg-blue text-white"><h2 class="big-message pane-item pane-item-centered">Q&A</h2><div class="pane-item pane-item-wide pane-item-extra-spacing"><div class="accordion"><div data-accordion-handle class="accordion-title small-message">What does Title II do? And why do we need it?</div><div class="accordion-text long-text"><p>It\'s a statute that requires any telecommunications companies under the FCC\'s authority to behave as <span class="italic-text">common carriers</span>.</p><p>This concept is nothing new. If you\'ve ever been in a hotel, a taxi, or a hospital, then you\'ve benefitted from common carriage. If you\'ve ever received a package, placed a telephone call, or drank water from a faucet, you\'ve benefitted from common carriage. (You have definitely, definitely drank water from a faucet.)</p><p>To sum it up in a sentence, common carriage ensures that those who provide a service to the general public cannot discriminate against any member of that general public (that means you!). Its provisions can apply to both public utilities and private enterprises.</p><p>For ISPs, being a common carrier means that they have to deliver data from source to destination without any differential treatment, and without discrimination.</p><p>This is how the internet has worked since its beginning. Declaring broadband a Title II service just ensures that it will continue to work this way in the future.</p><p>Unfortunately, and for pretty convoluted reasons, the FCC decided back in 2002 that ISPs could be treated like content providers—the same category TV networks fall into. That means that ISPs can choose which content they want to distribute and which content they want to ignore. For years the FCC attempted to address the problem through some clumsy half-measures that federal courts couldn\'t abide by.</p><p>Luckily, they\'ve decided to do the sensible thing. On February 26th the commissioners voted to reclassify consumer internet service under Title II, and to enact strong, clear net neutrality rules under that statute. It\'s an historic decision that should help keep the internet free and fair for generations to come.</p></div></div><div class="accordion"><div data-accordion-handle class="accordion-title small-message">Is Title II an Orwellian takeover of the internet?</div><div class="accordion-text long-text"><p>What? No.</p><p>We know things can get heated out there, but the debate over a free internet doesn\'t really belong in the normal political fracas. If you hear crazy-sounding claims coming from either side, you can probably ignore them.</p><p>This isn\'t about Barack Obama, or Ted Cruz, or liberals, or conservatives, or any of that.</p><p>This is about whether our online future is shaped by a handful of cable companies, or by everybody on the internet. We favor the second approach.</p></div></div><div class="accordion"><div data-accordion-handle class="accordion-title small-message">Isn\'t this just a fight between Netflix and Comcast? How does it affect us little guys?</div><div class="accordion-text long-text"><p>It affects us little guys because Netflix was once a little guy. They were a little guy who had the same open access to the internet as anyone else. Now they\'re a big guy. A non-discriminatory internet allowed them to grow.</p><p>If you have any entrepreneurial dreams of your own, this fight matters to you.</p><p>If you\'ve ever posted something to Tumblr, sold something on Etsy, flicked through pics on Instagram—really, if you\'ve ever done anything fun or useful on the internet—then you\'ve used the innovations that small entrepreneurs have created. This fight matters to you, too. It matters to everyone on the internet.</p><p>If you\'ve ever been in the position of buying cable TV and found yourself comparing cable packages, or figuring out which data plan you should buy for your phone, well, then you know how unpleasant an experience that can be. Imagine a similar experience for choosing which sites and services you want to use through your internet provider. Will you choose the Entertainment package, featuring Netflix and Hulu? The Sports package, with priority tweets from selected commentators? The Kids package, with premium access to Nickelodeon and one free month of Candy Crush Soda Saga? The Adult package, with, uh, well…</p><p>If you\'d rather not have to make terrible choices like that, then you care about this issue.</p></div></div><div class="accordion"><div data-accordion-handle class="accordion-title small-message">I hate regulation. Isn\'t Title II a form of regulation?</div><div class="accordion-text long-text"><p>Yeah, we get where you\'re coming from, but Title II isn\'t about the government regulating what happens on the internet. It\'s about <span class="italic-text">protecting</span> the internet from <span class="italic-text">corporate</span> regulation. Neither Republicans nor Democrats trust their cable company, <a target="_blank" href="http://www.netfreedom.us/wp-content/uploads/2015/01/Open-Internet-Polling-Memo-2-Jan-2015.pdf">it turns out</a>.</p><p>It\'s like the Bill of Rights. We have freedom of speech because there\'s a legal document saying so.</p><p>Title II says that we have the freedom to use the internet in whatever ways we see fit.</p></div></div><div class="accordion"><div data-accordion-handle class="accordion-title small-message">Won\'t Title II stifle innovation?</div><div class="accordion-text long-text"><p>We\'re living in the midst of innovation. It would be an understatement to describe what the internet has done for us over the last 20 years as merely “innovative.” This ongoing revolution has only been possible because of the hands-off approach ISPs have used in the transmission of data. And now, thanks to the FCC and Title II, you get to decide what the internet is for. Without it, the ISPs would have been able to decide for you.</p><p>Right now, if you have an idea for a site or an app or whatnot, you can build it without worrying whether people will be able to send and receive data from it. Whatever you make, it\'s available to the entire internet—as available as anything else is. If the telephone and cable companies had gotten their way, access to the internet would be prioritized for the highest bidder. Little guys wouldn\'t have stood a chance.</p><p>And sure, both sides claim to be on the side of innovation—who wouldn\'t? But honestly, who do you trust be more innovative? Your cable company, or the entire internet?</p></div></div><div class="accordion"><div data-accordion-handle class="accordion-title small-message">My bandwidth already kind of sucks. Will Title II deter Internet Service Providers from ever improving it?</div><div class="accordion-text long-text"><p>Nope. And sorry your bandwidth sucks. That\'s all too common here in U.S., where the ISPs have gotten away with charging ridiculous prices for disappointing service.</p><p>Charging content providers for special data privileges isn\'t their way of reinvesting in infrastructure. It\'s just their way of exploiting monopoly status: If anything is inhibiting the creation of more bandwidth, it\'s the near-monopoly conditions that most ISPs enjoy.</p><p>We have a somewhat unique situation in this country of private corporations providing public goods in a virtually unchallenged market. This hasn\'t exactly made the United States a standards-bearer of quality internet. We invented the thing, and here we are, ranked 31st in download speeds, and 9th in average connection speeds.</p><p>If the ISPs behave as honest carriers, then a demand for bandwidth will still drive them to increase the supply. Just look at what <a href="http://googleblog.blogspot.com/2015/01/google-fiber-new-metro-areas.html" target="_blank">Google is doing</a>.</p><p>And, honestly, the carriers themselves will <a target="_blank" href="http://www.washingtonpost.com/blogs/the-switch/wp/2014/12/10/verizon-actually-strong-net-neutrality-rules-wont-affect-our-network-investment/">tell you the same</a>.</p></div></div><div class="accordion"><div data-accordion-handle class="accordion-title small-message">Does Title II mean I\'ll have to pay more taxes? I heard it would invalidate the Internet Tax Freedom Act.</div><div class="accordion-text long-text"><p>Let\'s see what the author of the Internet Tax Freedom Act has to say about this:</p><ul><li><span class="bold-text">Net Neutrality is not going to invalidate the Internet Tax Freedom Act (ITFA).</span> My colleagues and I knew people would try to tax the Internet if they could. So in ITFA Congress broadly defined the term "Internet access." It is illegal to tax the internet. Under Title II or otherwise. The FCC could define the Internet as a series of tubes and ITFA would still prohibit taxes.</li><li><span class="bold-text">The "grandfather clause" in ITFA will not allow cities to suddenly open the Internet up to telecom taxes.</span> If the FCC reclassifies broadband Internet, it will not change if states taxed Internet access before 1998. The FCC has broad authority, but it cannot rewrite history.</li><li>— <a target="_blank" href="http://www.wyden.senate.gov/news/blog/post/protecting-net-neutrality-will-not-invalidate-internet-tax-freedom-act">Senator Ron Wyden</a></li></ul><p>In other words: nope.</p></div></div><div class="accordion"><div data-accordion-handle class="accordion-title small-message">Under Title II, will the cost of internet access go up?</div><div class="accordion-text long-text"><p>Given that the ISPs are constantly raising costs anyway (and pushing baffling package "deals"), it\'s hard to offer a definitive no, here. They like raising prices, and they\'ll do so no matter what kind of rules surround them.</p><p>That said, there are a few things about Title II that might help make things cheaper for everybody. Rules written under it could make it easier for people who only want an internet connection to stop paying for their cable company\'s television and telephone services.</p><p>Also, most ISPs currently hold a virtual monopoly over the areas they cover. Title II will empower the FCC to promote competition, which would lead to consumers having more choice over their broadband provider, which would lead to lower prices and better service.</p></div></div><div class="accordion"><div data-accordion-handle class="accordion-title small-message">We won! Now what?</div><div class="accordion-text long-text"><p>First of all—thank you! You\'ve helped keep the internet free, fair, and open for generations to come. Take some time to celebrate using your preferred method of celebration.</p><p>And remember: You couldn\'t have done it without your elected official. One nice thing to do would be to <a data-call-to-action>call them and say thanks</a>. They took a brave stand here, and stood up to intense pressure from cable companies and lobbyists. No mean feat!</p><p>If you didn\'t sign up for our alerts while filling out the phone call form, you can still <a href="#signup">sign up now</a>. We\'ll keep you up to date on all our public policy efforts.</p><p>Great work, everybody. We love ya.</p></div></div></div></div><div class="pane bg-turquoise text-white"><h2 class="big-message pane-item pane-item-wide pane-item-centered pane-item-normal-spacing">There\'s more you can do</h2><div class="medium-message pane-item pane-item-wide pane-item-centered pane-item-normal-spacing"><a target="_blank" href="https://www.battleforthenet.com/scoreboard/">Find out where your elected officials stand</a> on Title II.</div><div class="medium-message pane-item pane-item-wide pane-item-centered pane-item-normal-spacing"><a target="_blank" href="https://openmedia.org/slowlane/letter/us">Write a letter to the editor</a> of your local paper.</div><div class="medium-message pane-item pane-item-wide pane-item-centered pane-item-normal-spacing"><a target="_blank" href="https://cyberlaw.stanford.edu/blog/2015/01/36-leading-scholars-federal-officials-only-fcc-can-protect-open-internet">Read an open letter</a> from an unprecedented array of leading scholars in support of Title II.</div><div class="medium-message pane-item pane-item-wide pane-item-centered pane-item-normal-spacing">Check out the resources available from the <a target="_blank" href="http://www.netfreedom.us/resources/">Internet Freedom Business Alliance</a> and <a target="_blank" href="http://www.freepress.net/">Free Press</a>.</div></div><div class="pane bg-black text-white" id="signup"><h2 class="big-message pane-item pane-item-wide pane-item-centered mailing-title">Everybody on the internet<br>can join our mailing list</h2><div class="form pane-item pane-item-narrow email-signup"><div class="form-row"><input type="text" class="form-field email" placeholder="Email address"> <button data-email-signup class="chrome big yellow submit-button full-width"><span class="label">SIGN ME UP</span> <span class="Knight-Rider-loader animate"><span class="Knight-Rider-bar"></span><span class="Knight-Rider-bar"></span><span class="Knight-Rider-bar"></span></span></button></div><div class="form-row error-message">Something went wrong. Try again?</div></div></div>';
return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],63:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/events"),a=(t("velocity-animate"),t("prima/utils/validation")),r=t("../templates/main.tpl"),l=t("../templates/email-success.tpl"),h="VO0A7B29778140C578DC1EC7BD802DC9D3",d=o.extend({className:"nncampaign",defaults:{},template:{main:r,emailSuccess:l},events:{"submit [data-form]":"onFormSubmit","click [data-accordion-handle]":"onAccordionClick","click [data-call-to-action]":"onCallToActionClick","click [data-nav-to]":"onNavigationButtonClick","click [data-email-signup]":"onEmailSignupClick"},initialize:function(){this.listenTo(n,"DOMEventor:flatscroll",this.onScroll),this.fixedCtaShown=!0},onScroll:function(t){t&&this.topActionBorder&&this.bottomActionBorder&&(t.windowScrollY>=this.topActionBorder&&t.windowScrollY<=this.bottomActionBorder?this.fixedCtaShown&&(this.$fixedHeader.addClass("off-screen"),this.fixedCtaShown=!1):this.fixedCtaShown||(this.$fixedHeader.removeClass("off-screen"),this.fixedCtaShown=!0))},onCallToActionClick:function(){this.scrollToActivePane(!0)},onNavigationButtonClick:function(t){var e=s(t.target);this.showStep(e.data("nav-to"),!0)},onEmailSignupClick:function(t){var e=s(t.currentTarget),o=e.closest(".email-signup").find(".form-field.email"),n=e.closest(".email-signup").find(".error-message"),a=o.val();if(n.removeClass("shown"),a&&this.validateField(a,"email")){e.addClass("loading"),o.removeClass("error");var r=s.ajax({url:"/everybodyontheinternet/newsletter",type:"POST",with_form_key:!0,data:{email:a}});r.done(i.bind(function(){e.closest(".email-signup").replaceWith(this.template.emailSuccess())},this)),r.fail(i.bind(function(){e.removeClass("loading"),n.addClass("shown")},this))}else o.addClass("error")},showStep:function(t,e){var i=this.$paneHolder.find('[data-action-pane="'+t+'"]');this.$actionPanes.removeClass("active-pane"),this.$paneHolder.removeClass("form call success"),this.$paneHolder.addClass(t),i.addClass("active-pane"),this.$paneHolder.height(i.outerHeight()),e&&this.scrollToActivePane(),this.topActionBorder=this.$paneHolder.offset().top-2*this.$fixedHeader.height(),this.bottomActionBorder=this.topActionBorder+this.$paneHolder.height()},validateField:function(t,e){switch(e){case"phone":return a.isPhoneNumber(t);case"postal_code":return a.isPostalCode(t);case"email":return a.isEmail(t)}},prepareInput:function(){var t=[],e={};return this.$formInputFields.removeClass("error"),i.each(this.$formInputFields,function(i){var o=s(i).val().replace(/\D+/g,""),n=s(i).data("field");this.validateField(o,n)?e[n]=o:t.push(i)},this),t.length?(i.each(t,function(t){s(t).addClass("error")},this),!1):e},onFormSubmit:function(t){t.preventDefault();var e=this.prepareInput();if(!e)return!1;this.$formSubmitButton.addClass("loading"),this.$formErrorMessage.removeClass("shown");var o=s.ajax({url:"https://secure.mcommons.com/profiles/join",type:"POST",data:{person:e,mconnect:h}});o.done(i.bind(this.onSubmitSuccess,this)),o.fail(i.bind(this.onSubmitFail,this))},onSubmitSuccess:function(){this.showStep("call",!0),this.$formSubmitButton.removeClass("loading")},onSubmitFail:function(){this.$formErrorMessage.addClass("shown"),this.$formSubmitButton.removeClass("loading")},onAccordionClick:function(t){var e=s(t.target);e.hasClass("opened")?e.removeClass("opened"):e.addClass("opened")},scrollToActivePane:function(t){t=t||!1,s(".active-pane [data-action-anchor]").velocity("scroll",{duration:t?300:0,offset:-14})},render:function(){return this.$el.html(this.template.main()),this.$form=this.$("[data-form]"),this.$formInputFields=this.$form.find("[data-field]"),this.$formSubmitButton=this.$form.find(".submit-button"),this.$formErrorMessage=this.$form.find(".error-message"),this.$fixedHeader=this.$(".fixed-cta"),this.$paneHolder=this.$(".actionable-panes"),this.$actionPanes=this.$paneHolder.find(".pane"),i.defer(i.bind(function(){this.showStep("form",!1)},this)),this}});e.exports=d},{"../templates/email-success.tpl":61,"../templates/main.tpl":62,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/utils/validation":495,"prima/view":496,"velocity-animate":"lWl/mc"}],64:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/component"),o=t("./views/nnc_page"),n=s.extend({name:"NNCPage",defaults:{},initialize:function(t){this.options=i.extend({},this.defaults,t),this.indexView=new o},render:function(){this.indexView.render(),this.indexView.$el.appendTo("body")}});e.exports=n},{"./views/nnc_page":67,lodash:"K2RcUv","prima/component":428}],65:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+="","undefined"!=typeof step&&"initial"==step?__p+='<div class="loader"><div class="nnc-loader"><div class="nloader"></div></div></div><h1 class="title">Stop slow lanes from ruining the internet</h1><div class="description"><p>Here\'s the deal: The FCC is on the verge of allowing internet service providers (like the one you\'re using right now) to build fast lanes for sites that can pay for them, leaving everyone else in the slow lane. This would be disastrous for anyone who uses the internet.</p><p>Luckily, you can do something about it. You can urge the FCC to establish rules for the internet that don’t discriminate by class, and ask Congress to do the same.</p></div><a class="email flat-button blue big button" href="https://www.battleforthenet.com/?skip_call=true&oo=1" target="_blank">Contact my representative</a><div class="footer"><div class="partner"><div class="fine-print alt-button">We know this regulatory stuff sounds unbelievably boring, so pat yourself on the back for recognizing how important it actually is.</div></div></div>':"undefined"!=typeof step&&"final"==step&&(__p+='<div class="success-smiley"><div class="success-shades"></div></div><h1 class="title green">You did it</h1><div class="description"><div class="nnc-video"><iframe src="//player.vimeo.com/video/105741162" width="500" height="281" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe></div><p>Whew! Thanks so much. This’ll go a long way toward ensuring that the internet stays good for all of us. The fight isn’t over yet, though. In between now and when the FCC actually votes, you can help by spreading the word and getting other people involved. We put together a little video to do just that. If you’re into it, go ahead and share it. The more people that we can get on the right side of net neutrality, the better.</p><p>Another thing you can do: vote for candidates who will fight for net neutrality. In case you’re not already registered, there’s a button right there.</p><p>In the meantime, we’ll keep you updated on any developments. Here’s to a brighter internet future.</p></div>',__p+=is_logged_in?'<div class="reblog flat-button green big button"><div class="reblog-button-content"><div class="icon_reblog"></div>Reblog this</div></div>':'<a href="https://vimeo.com/105741162" target="_blank" class="call-representative flat-button blue big button">Share this</a>',__p+=' <a href="http://www.ourtime.org/vote" target="_blank" class="vote flat-button blue big button">Register to vote</a><div class="done alt-button"><a href="#" class="alt-link" title="">No thanks, I\'m done</a></div>'),__p+="";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],66:[function(t,e){"use strict";var i=t("prima/view"),s=t("prima/events"),o=t("prima/lib/flags"),n=t("../templates/nnc_page_confirm.tpl"),a=i.extend({template:n,className:"nnc-confirm",events:{"click .email":"email","click .reblog":"reblog","click .done":"done"},initialize:function(t){this.tmpl_data={step:"initial",is_logged_in:o.bool("is_logged_in")},this.reblogPostData={channel_id:t.tumblelog,reblog_id:t.id,endpoint:t.type,type:t.type,detached:!0,reblog:!0,reblog_key:t.reblog_key}},email:function(){this.tmpl_data={step:"final",is_logged_in:o.bool("is_logged_in")},this.render()},reblog:function(t){o.bool("is_logged_in")&&("/stop"===window.location.pathname?window.location.href="/reblog/"+this.reblogPostData.reblog_id+"/"+this.reblogPostData.reblog_key:(t.preventDefault(),s.trigger("NNC:reblog",this.reblogPostData)))},done:function(t){t.preventDefault(),o.bool("is_logged_in")?"/stop"===window.location.pathname?window.location.href="/dashboard":s.trigger("NNC:close"):window.location.href="/register"},render:function(){return this.$el.html(this.template(this.tmpl_data)),this}});e.exports=a},{"../templates/nnc_page_confirm.tpl":65,"prima/events":429,"prima/lib/flags":"f/LVtH","prima/view":496}],67:[function(t,e){"use strict";var i=t("prima/view"),s=t("prima/events"),o=t("prima/lib/data"),n=t("./confirm"),a=i.extend({className:"nncampaign-page",defaults:{},initialize:function(){var t=o.get("Components/NNCPage");this.confirmView=new n(t.reblog_post),this.currentView=this.confirmView},render:function(){return this.$el.append(this.currentView.render().el),this},remove:function(){s.trigger("NNC:close")}});e.exports=a},{"./confirm":66,"prima/events":429,"prima/lib/data":431,"prima/view":496}],68:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/collection"),o=t("../models/photo"),n=s.extend({model:o,getSubset:function(t){return i.isUndefined(t)?[]:i.map(i.isArray(t)?t:i.toArray(arguments),this.get,this)},getSubCollection:function(){return new n(this.getSubset.apply(this,arguments))},setIdOrder:function(t,e){e||(e={}),this.models=i.map(t,function(t){return this.get(t)},this),e.silent||this.trigger("sort",this,e)}});e.exports=n},{"../models/photo":70,lodash:"K2RcUv","prima/collection":427}],69:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/component"),o=t("./models/photoset"),n=(t("./models/photo"),t("./collections/photos"),t("./utils"),t("./views/photoset")),a=t("./views/photo"),r=s.extend({name:"Photoset",initialize:function(t){(i.isArray(t)||t instanceof o)&&(t={photoset:t}),this.options=t=i.extend({},t),this.model=t.photoset instanceof o?t.photoset:new o(t.photoset);var e=i.keys(n.prototype.defaults);e.push("PhotoView"),e.push("post");var s=i.pick(t,e);s.photoset=this.model,this._PhotosetView=t.PhotosetView||n,this._PhotoView=t.PhotoView||a,this.indexView=new this._PhotosetView(s),this.listenTo(this.model,"all",this._relayModelEvent),this.listenTo(this.model.photos,"all",this._relayModelEvent)},_relayModelEvent:function(){this.trigger.apply(this,arguments)},teardown:function(){return this.indexView.teardown(),this.stopListening(),this},remove:function(){return this.teardown(),this.indexView.remove(),this},render:function(){return this.indexView.render(),this},getElement:function(){return this.indexView.$el}});e.exports=r},{"./collections/photos":68,"./models/photo":70,"./models/photoset":71,"./utils":76,"./views/photo":79,"./views/photoset":80,lodash:"K2RcUv","prima/component":428}],70:[function(t,e){"use strict";var i=t("prima/model"),s=t("../utils/imagelayout"),o=i.extend({defaults:{width:null,height:null,x:"50%",y:"50%",url:"",caption:"",clickthroughUrl:""},getAspectRatio:function(){return s.aspectRatio(this.get("width"),this.get("height"))},getWidthForHeight:function(t){return s.widthForHeight(this.get("width"),this.get("height"),t)},getHeightForWidth:function(t){return s.heightForWidth(this.get("width"),this.get("height"),t)}});e.exports=o},{"../utils/imagelayout":75,"prima/model":471}],71:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/model"),o=t("../collections/photos"),n=t("../utils/imagelayout"),a=["","1","11","12","13","123","133","1232","1323","12223"],r=3,l=s.extend({defaults:{layout:null},initialize:function(t,e){e=i.extend({},e),this.layouts=e.layouts||a,this.maxPerRow=e.maxPerRow||r,(i.isArray(t)||t instanceof o)&&(this.attributes=i.extend({photos:t},this.defaults)),this.photos=this.get("photos")instanceof o?this.get("photos"):new o(this.get("photos")),this.unset("photos"),this.fixLayout()},fixLayout:function(){var t=this.get("layout");return t=t?n.fix(t,this.photos.length,this.layouts,this.maxPerRow):n.calculateDefault(this.photos.length,this.layouts,this.maxPerRow),this.set("layout",t),t},getRows:function(t){return n.toArray(t||this.get("layout"),this.photos,this.layouts,this.maxPerRow)},getPhotoRow:function(t){var e={id:t};return i.findIndex(this.getRows(),function(t){return i.some(t,e)})},removePhoto:function(t){var e=this.getPhotoRow(t),s=this.photos.remove(t),o=i.reduce(this.get("layout").split(""),function(t,s,o){return s=i.parseInt(s),o===e&&s--,t+(s>0?s:"")},"");this.set("layout",o),s&&this.trigger("photo:remove",s,t,o)},toJSON:function(){var t=s.prototype.toJSON.apply(this,arguments);return t.photos=this.photos.toJSON(),t.rows=this.getRows(),t}}),h=["add","remove","reset","push","pop","unshift","shift","slice","where","findWhere","forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];i.forEach(h,function(t){var e=o.prototype[t];l.prototype[t]=function(){return e.apply(this.photos,i.toArray(arguments))}}),e.exports=l},{"../collections/photos":68,"../utils/imagelayout":75,lodash:"K2RcUv","prima/model":471}],72:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div data-js-imagecrop style="width:'+(null==(__t=displayWidth)?"":_.escape(__t))+"px;height:"+(null==(__t=displayHeight)?"":_.escape(__t))+'px" class="photoset--image-crop"><div data-js-imagewrap style="background-image:url('+(null==(__t=url)?"":_.escape(__t))+");background-position:"+(null==(__t=x)?"":_.escape(__t))+" "+(null==(__t=y)?"":_.escape(__t))+'" class="photoset--image-wrap"><img data-js-image src="'+(null==(__t=url)?"":_.escape(__t))+'" alt="'+(null==(__t=caption)?"":_.escape(__t))+'" data-width="'+(null==(__t=width)?"":_.escape(__t))+'" data-height="'+(null==(__t=height)?"":_.escape(__t))+'" class="photoset--image"></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],73:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{}){__p+="";var rows=photoset.rows,cellId=0;__p+='<div data-js-layout class="photoset--layout">',_.forEach(rows,function(t,e){__p+="";var i=e>0?padding:0,s=e<rows.length-1?padding:0,o=_rowSize(t,width,padding),n=o.height;__p+='<div data-photoset-row="'+(null==(__t=e)?"":_.escape(__t))+'" style="height:'+(null==(__t=n+i+s)?"":_.escape(__t))+'px" class="photoset--row">',_.forEach(t,function(e,a){__p+="";var r=o.photos[a],l=r.width,h=r.height,d=n,c=a<t.length-1?padding:0,u=a>0?padding:0,p=l+u+c,m=_.map([i,c,s,u],function(t){return t?t+"px":0}).join(" ");__p+='<div data-photoset-position="'+(null==(__t=cellId)?"":_.escape(__t))+'" data-photo-id="'+(null==(__t=e.id)?"":_.escape(__t))+'" style="width:'+(null==(__t=p)?"":_.escape(__t))+"px;height:"+(null==(__t=n)?"":_.escape(__t))+"px;padding:"+(null==(__t=m)?"":_.escape(__t))+'" class="photoset--cell">'+(null==(__t=photoTemplate(_.defaults({scaledWidth:l,scaledHeight:h,displayWidth:r.width,displayHeight:d},e)))?"":__t)+"</div>",cellId++,__p+=""}),__p+="</div>"}),__p+="</div>"}return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],74:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o={},n=function(t,e,o){var n=t instanceof s?t:s(t),a=e;i.isObject(e)||(a={},a[e]=o),n.attr(a);var r=i.transform(a,function(t,e,s){s.match(/^data\-/i)&&(t[i.camelize(s.replace(/^data\-/,""))]=e)},{});return n.data(r),n},a=function(t,e){var o=t instanceof s?t:s(t);return i.isString(e)&&(e=i.rest(arguments,1)),i.forEach(e,function(t){o.removeAttr(t),t.match(/^data\-/i)&&o.removeData(i.camelize(t.replace(/^data\-/,"")))}),o};o.set=n,o.remove=a,e.exports=o},{jquery:"HlZQrA",lodash:"K2RcUv"}],75:[function(t,e){"use strict";var i=t("lodash"),s=t("../models/photo"),o={},n=function(t,e,s){return t<e.length?e[t]:i.trim(i.pad(t%s||" ",Math.floor(t/s)+1,s+"","right"))},a=function(t,e,s,o){var a=i.isNumber(e)?e:e.length;t?i.isString(t)||(t=t.toString()):t="";var r=a-i.reduce(t.split(""),function(t,e){return t+i.parseInt(e)},0);return r>0?t+=n(r,s,o):0>r&&(t=i(t.split("")).reverse().transform(function(t,e){r?(r+=i.parseInt(e),r>0&&(t.push(r),r=0)):t.push(e)},[]).reverse().value().join("")),t},r=function(t,e,s,o){var n=a(t,e,s,o).split(""),r=0;return i.map(n,function(t){t=i.parseInt(t);var s=i.map(e.slice(r,r+t),function(t){return i.isFunction(t.toJSON)?t.toJSON():t});return r+=t,s})},l=function(t,e){return t&&e?t/e:0},h=function(t,e,i){var s=e?i/e:0;return t*s},d=function(t,e,i){var s=t?i/t:0;return e*s},c=function(t,e){if(!t.length)return 0;var o=i.map(t,function(t){var i,o;return t instanceof s?(i=t.get("width"),o=t.get("height")):(i=t.width,o=t.height),d(i,o,e)});return i.min(o)},u=function(t,e,i){return i||(i=0),(i+e+i)/t-i-i};o.calculateDefault=n,o.fix=a,o.toArray=r,o.aspectRatio=l,o.widthForHeight=h,o.heightForWidth=d,o.rowHeightForWidth=c,o.rowImageWidth=u,e.exports=o},{"../models/photo":70,lodash:"K2RcUv"}],76:[function(t,e){"use strict";var i={ImageLoader:t("prima/utils/image/loader"),ImageLayout:t("./imagelayout")};e.exports=i},{"./imagelayout":75,"prima/utils/image/loader":488}],77:[function(t,e){"use strict";var i=t("lodash"),s=function(t,e){e||(e=t.originalEvent),i.extend(t,i.pick(e,"pageX","pageY"));var s,o,n;return null==t.pageX&&null!=e.clientX&&(s=t.target.ownerDocument||document,o=s.documentElement,n=s.body,t.pageX=e.clientX+(o&&o.scrollLeft||n&&n.scrollLeft||0)-(o&&o.clientLeft||n&&n.clientLeft||0),t.pageY=e.clientY+(o&&o.scrollTop||n&&n.scrollTop||0)-(o&&o.clientTop||n&&n.clientTop||0)),{x:t.pageX,y:t.pageY}};e.exports=s},{lodash:"K2RcUv"}],78:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("when"),n=t("velocity-animate").animate,a=t("prima/events"),r=t("./photoset"),l=150,h=s(window),d=t("../utils/attrdata"),c=t("../utils/page_coords"),u=0,p=1,m=2,g=r.extend({className:"editable-photoset photoset",defaults:i.extend({x:null,y:null,dragId:null,sourceCell:null,targetCell:null,dragOverCell:null,isLocked:!1,isDragging:!1,dragScrollVelocityY:0,dragScrollUpdateMs:50,dragScrollHeight:100,dragSlide:20,ghostWidth:100,ghostMaxHeight:120},r.prototype.defaults),events:i.defaults({'mousedown [data-js-sortable][draggable="true"]':"_onMouseDownSortable","dragstart .photoset--photo-dragger":"_onDragStart"},r.prototype.events),initialize:function(){r.prototype.initialize.apply(this,arguments),this.__updateCursorPosition=i.throttle(i.bind(function(t){this.set(c(t))},this)),i.forEach(["_onDragStart","_onDragEnter","_onDragOver","_onDragLeave","_onDragEnd","_onDrop"],function(t){var e=this[t]||i.noop;this["_"+t]=i.bind(e,this)},this)},_onMouseDownSortable:function(t){if(this.get("isLocked"))return t.preventDefault(),void t.stopPropagation();if(1===t.which&&!t.ctrlKey){if(this.get("isDragging"))return this._onDragEnd(t);if(this.trigger("photoset:predrag",this),!window.DataTransfer||!i.isFunction(window.DataTransfer.prototype.setDragImage)){var e=s(t.target),o=e.closest(".photoset--photo"),n=this.photoset.photos.get(o.data("photoId")),a=n?n.get("url")||"":"";a&&(e.css({backgroundColor:"#ffffff",backgroundImage:"url("+a+")"}),e.one("mouseout mouseup",i.bind(function(){e.css({backgroundColor:"",backgroundImage:""})},this)))}}},_onDragStart:function(t){if(this.get("isLocked"))return t.preventDefault(),void t.stopPropagation();a.trigger("photoset:dragstart");var e=s(t.target),o=e.closest(".photoset--photo"),n=o.data("photoId"),r=t.originalEvent.dataTransfer;if(r){r.effectAllowed="move",r.dropEffect="move";var l=this.$('[data-ghost-id="'+n+'"]');!i.isEmpty(l)&&i.isFunction(r.setDragImage)&&r.setDragImage(l.get(0),.5*l.outerWidth(),.5*l.outerHeight());try{var d=this.photoset.photos.get(n),c=d?d.get("url")||"":"";r.setData("text/uri-list",c),r.setData("text/plain",c)}catch(t){}}var u=o.closest(this.$$cacheKeys.cell),p=u.closest(this.$$cacheKeys.row);this.set({sourceCell:null,targetCell:null,dragOverCell:null,dragId:n}),this.listenTo(this,"change:targetCell",this._onChangeTargetCell),this.$el.on("dragover .photoset--cell",this.__onDragOver),this.$el.on("dragend",this.__onDragEnd),this.$el.on("drop .photoset--cell",this.__onDrop),h.on("dragover",this.__updateCursorPosition),this.startDragScroll(),i.defer(i.bind(function(){var t=this.$$cacheKeys.cell;this.set("isDragging",!0),u.addClass("photoset--placeholder-cell photoset--source-cell"),p.addClass("photoset--source-row"),i.isEmpty(u.siblings(t))&&u.closest(this.$$cacheKeys.row).addClass("photoset--placeholder-row"),e.css({backgroundColor:"",backgroundImage:""}),this.createPlaceholders(),this.set({sourceCell:u.data("placeholderCell"),targetCell:u.data("placeholderCell"),dragOverCell:u.data("dragOverCell")}),this.listenTo(this,"change:dragOverCell change:x change:y",this._onChangeDragTarget)},this))},_onDragOver:function(t){t.preventDefault(),t.stopPropagation(),this.__updateCursorPosition(t);var e=s(t.target),i=e.closest(this.$$cacheKeys.cell);this.set("dragOverCell",i.data("dragOverCell"))},_onDragEnd:function(t){t.preventDefault(),t.stopPropagation(),this.stopListening(this,"change:targetCell",this._onChangeTargetCell),this.stopListening(this,"change:dragOverCell change:x change:y",this._onChangeDragTarget);var e=this.get("dragId");if(null!=e){var s=this.placePhotoInCell(e,this.get("targetCell"));this.set({sourceCell:null,targetCell:null,dragId:null}),s.removeClass("photoset--placeholder-cell"),s.closest(this.$$cacheKeys.row).removeClass("photoset--placeholder-row")}this.removePlaceholders(),this.set("isDragging",!1);var o=this.determineLayout();this.photoset.photos.setIdOrder(o.order),this.photoset.set("layout",o.layout),this.set("isLocked",!0),this.resize().then(i.bind(function(){this.removeTemporary(),this.set("isLocked",!1)},this)),this._ensurePhotoInViewport(e),this.$el.off("dragover .photoset--cell",this.__onDragOver),this.$el.off("dragend",this.__onDragEnd),this.$el.off("drop .photoset--cell",this.__onDrop),h.off("dragover",this.__updateCursorPosition),this.stopDragScroll(),a.trigger("photoset:dragend")},_onDrop:function(t){t.preventDefault(),t.stopPropagation()},_onChangeIsDragging:function(t,e){this.$el.toggleClass("photoset--drag-to-sort",e)},_onChangeIsLocked:function(t,e){this.$el.toggleClass("photoset--locked",e),e||this.$(".photoset--cropped-cell").removeClass("photoset--cropped-cell")},_onUpdate:function(){this.teardown().render(),this.photoset.photos.length>1&&this._ensurePhotoInViewport(this.photoset.photos.last().get("id"))},startDragScroll:function(){this.set({dragScrollTop:this.get("dragScrollHeight"),dragScrollBottom:h.height()-this.get("dragScrollHeight")}),this.listenTo(this,"change:y",this._onChangeDragY)},stopDragScroll:function(){clearInterval(this.dragScrollInterval),delete this.dragScrollInterval,this.stopListening(this,"change:y",this._onChangeDragY)},_onChangeDragY:function(t,e){var s=0,o=e-h.scrollTop();s=o<this.get("dragScrollTop")?Math.ceil(100*(o-this.get("dragScrollTop"))/this.get("dragScrollHeight")):o>this.get("dragScrollBottom")?Math.ceil(100*(o-this.get("dragScrollBottom"))/this.get("dragScrollHeight")):0,this.set("dragScrollVelocityY",s),s?this.dragScrollInterval||(this.dragScrollInterval=setInterval(i.bind(function(){var t=this.get("dragScrollVelocityY");t&&a.trigger("Photoset:dragScroll",t)},this),this.get("dragScrollUpdateMs"))):this.dragScrollInterval&&(clearInterval(this.dragScrollInterval),delete this.dragScrollInterval)},_ensurePhotoInViewport:function(t,e){i.isNumber(e)||(e=l);var s=this._layoutCache||this._updateLayoutCache(),o=this.$el.offset().top||0,n=i.find(s.rows,function(e){return i.find(e.cells,{photo:t})?!0:void(o+=e.height)});n&&a.trigger("Photoset:scrollToRow",o,n.height,e)},createPhotoSubView:function(){var t=r.prototype.createPhotoSubView.apply(this,arguments);return this.options.post&&(t.post=this.options.post),this.listenTo(t,"photoset:hover",function(){var e=i.toArray(arguments);e.unshift("photoset:unhover"),i(this.subViews).omit(t.photo.get("id")).invoke(function(){this.trigger.apply(this,e)})}),t},createPlaceholders:function(){var t=this.photoset.maxPerRow,e=".photoset--placeholder-row",o=".photoset--placeholder-cell",n=".photoset--source-row",a=".photoset--source-cell",r=this.$$cacheKeys.cell,l='<div class="photoset--row photoset--placeholder-row"></div>',h='<div class="photoset--cell photoset--placeholder-cell"></div>';this._createPlaceholders(this.js$("layout"),this.$$rows(),l,e),i.forEach(this.$$rows(!0),function(e){var i=s(e),a=i.children(this.$$cacheKeys.cell);(a.length<t||i.is(n))&&this._createPlaceholders(i,a,h,o)},this),i.forEach(this.$$cells(!0).filter(o),function(t,e){d.set(t,"data-placeholder-cell",e)},this);var c=this.determineLayout(),u=this.get("padding"),p=0;i.forEach(this.$$rows(!0),function(t){var l=s(t),h=l.index(),m=this.get("width"),g=h<=c.topRow||h>c.bottomRow?0:u,f=h>=c.bottomRow||h<c.topRow?0:u,_=l.height()||0;l.height(_);var v=l.children(r),b=l.prev(e).not(n).find(r),y=l.next(e).not(n).find(r),w=b.data("placeholderCell"),x=y.data("placeholderCell");i.forEach(v,function(t){var i=s(t);i.is(o)&&!i.is(a)&&i.css({paddingTop:g,paddingBottom:f,width:l.is(e)?m:0,height:_}),i.data("targetCells",{top:w,left:i.prev(o).data("placeholderCell"),center:i.data("placeholderCell"),right:i.next(o).data("placeholderCell"),bottom:x}),d.set(i,"data-drag-over-cell",p++)},!0)},this)},_createPlaceholders:function(t,e,o,n){e.first().is(n)||t.prepend(o),i.forEach(e.not(n),function(t){var e=s(t);i.isEmpty(e.next(n))&&e.after(o)},this)},removePlaceholders:function(){this.$$rows(!0).removeClass("photoset--source-row"),this.$$cells(!0).removeClass("photoset--source-cell").removeData("targetCells"),this.$$rows().filter(".photoset--placeholder-row").remove(),this.$$cells().filter(".photoset--placeholder-cell").remove(),this.renumberRowsAndCells(),d.remove(this.$$cells(),"data-drag-over-cell","data-placeholder-cell")},removeTemporary:function(){this.$(".photoset--temporary").remove(),this.$$rows(!0),this.$$cells(!0),this.renumberRowsAndCells()},resize:function(t){i.isNumber(t)||(t=l);var e=i.map(this.$$rows(),function(e,i){return this.resizeRow(e,t,i)},this);return this._updateLayoutCache(),o.all(e)},_calculateCellSize:function(t){var e=s(t),o=e.find(".photoset--photo [data-js-imageCrop]"),n={width:0,height:0,$content:o,$el:e},a=this.photoset.photos.get(e.data("photoId"));return a&&i.extend(n,{isCurrentCell:!0,width:a.get("width"),height:a.get("height")}),n},resizeRow:function(t,e,a){i.isNumber(e)||(e=l);var r=t instanceof s?t:s(t),h=this.determineLayout();i.isNumber(a)||(a=r.index());var d=this.get("width"),c=this.get("padding"),u=a<=h.topRow||a>h.bottomRow?0:c,p=a>=h.bottomRow||a<h.topRow?0:c,m=this.$$cacheKeys.cell,g=i.map(r.children(m),this._calculateCellSize,this),f=[],_=0;i.forEach(g,function(t,e){t.index=e,t.isCurrentCell&&(t.position=_++,t.id=f.length,f.push(t))});var v=this.rowSize(f,d),b=v.height,y=b?b+u+p:0,w=i.map(g,function(t){var s={width:t.width,height:b,paddingTop:u,paddingRight:0,paddingBottom:p,paddingLeft:0};null!=t.id&&(s.width=v.photos[t.id].width),null!=t.position&&(s.paddingRight=t.position<_-1?c:0,s.paddingLeft=t.position>0?c:0),i.isEmpty(t.$content)||(n(t.$content,"stop"),n(t.$content,{opacity:1,width:s.width,height:s.height,translateX:0,translateY:0},{duration:e}));var o=this.subViews[t.$el.data("photoId")];return o&&o.set({displayWidth:s.width,displayHeight:s.height}),n(t.$el,"stop"),n(t.$el,i.defaults({width:s.width+s.paddingLeft+s.paddingRight,height:s.height+s.paddingTop+s.paddingBottom},s),{duration:e})},this);n(r,"stop"),w.push(n(r,{height:y},{duration:e})),this.get("isDragging")&&(this._rowHeightCache[r.data("photosetRow")]=y);var x=o.all(w);return x},determineLayout:function(t){if(t&&this._determineLayout)return this._determineLayout;var e="",o=[],n=-1,a=-1,r=this.$$cacheKeys.cell;return i.forEach(this.$$rows(),function(t,l){var h=0;i.forEach(s(t).children(r),function(t){var e=s(t).data("photoId");(e||0===e)&&(o.push(e),h++)},this),h&&(e+=h,0>n&&(n=l),a=l)},this),this._determineLayout={topRow:n,bottomRow:a,order:o,layout:e},this._determineLayout},_onChangeTargetCell:function(t,e){if(null!=e){var o=this.$$cells().filter('[data-placeholder-cell="'+e+'"]'),a=o.closest(this.$$cacheKeys.row),r=o.data("dragOverCell"),h=u;h=o.is(".photoset--source-cell")?u:a.is(".photoset--placeholder-row")?p:m,i.forEach(this.$$cells(),function(t){var e=s(t),o=e.find(".photoset--image-crop");if(!i.isEmpty(o)){var d={translateX:0,translateY:0};switch(h){case p:i.isEmpty(a.find(e))&&(e.data("dragOverCell")<r?d.translateY=-this.get("dragSlide"):e.data("dragOverCell")>r&&(d.translateY=this.get("dragSlide")));break;case m:i.isEmpty(a.find(e))||(e.data("dragOverCell")<r?d.translateX=-this.get("dragSlide"):e.data("dragOverCell")>r&&(d.translateX=this.get("dragSlide")))}n(o,"stop"),n(o,d,l)}},this)}else i.forEach(this.$$cells(),function(t){var e=s(t).find(".photoset--image-crop");i.isEmpty(e)||(n(e,"stop"),n(e,{translateX:0,translateY:0},l))},this)},_onChangeDragTarget:function(){var t=this.get("dragOverCell");if(null!=t){var e=this.$$cells().filter('[data-drag-over-cell="'+t+'"]'),i=e.offset(),s=e.width(),o=e.height(),n=this.get("x")-(i.left+.5*s),a=this.get("y")-(i.top+.5*o),r=e.data("targetCells");null!=r.top&&-o/3>a?this.set("targetCell",r.top):null!=r.bottom&&a>o/3?this.set("targetCell",r.bottom):null!=r.center?null!=r.left&&-s/3>n?this.set("targetCell",r.left):null!=r.right&&n>s/3?this.set("targetCell",r.right):this.set("targetCell",r.center):null!=r.left&&0>n?this.set("targetCell",r.left):null!=r.right&&n>0&&this.set("targetCell",r.right)}},placePhotoInCell:function(t,e){var i=this.subViews[t],s=i.$el.closest(this.$$cacheKeys.cell),o=s.closest(this.$$cacheKeys.row),n=this.$$cells().filter('[data-placeholder-cell="'+e+'"]');return d.set(n,"data-photo-id",t),n.is(s)||(s.removeClass("photoset--placeholder-cell").addClass("photoset--temporary"),d.remove(s,"data-photo-id"),o.is(".photoset--placeholder-row")&&o.removeClass("photoset--placeholder-row").addClass("photoset--temporary"),i.js$("imageCrop").css({opacity:0,width:n.width(),height:n.height()}),i.$el.detach(),n.append(i.$el),n.addClass("photoset--cropped-cell")),n},beforeRender:function(){this.listenTo(this,"update",this._onUpdate),this.listenTo(this,"change:isDragging",this._onChangeIsDragging),this.listenTo(this,"change:isLocked",this._onChangeIsLocked)},afterRender:function(){this.renderSubViews(),this.$el.prepend('<div data-js-ghosts class="photoset--ghosts"></div>'),i.forEach(this.subViews,function(t,e){var i=t.thumbnailDimensions(this.get("ghostWidth"),this.get("ghostMaxHeight"));i["background-image"]="url("+t.photo.get("url")+")";var o=s('<div data-js-ghost class="photoset--ghost"></div>').css(i);d.set(o,"data-ghost-id",e),this.js$("ghosts").append(o)},this),this.js$("ghosts").append('<div class="photoset--ghost-cover"></div>').css({width:this.get("ghostWidth"),height:this.get("ghostMaxHeight")})}});e.exports=g},{"../utils/attrdata":74,"../utils/page_coords":77,"./photoset":80,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"velocity-animate":"lWl/mc",when:"RG2dij"}],79:[function(t,e){"use strict";var i=t("lodash"),s=t("when"),o=t("velocity-animate").animate,n=t("prima/view"),a=150,r=t("prima/mixins/subviewable"),l=t("prima/mixins/selectorcache"),h=t("prima/mixins/accessor"),d=t("../models/photo"),c=t("../templates/photo.tpl"),u=n.extend({className:"photoset--photo",template:c,mixins:[r,l,h],defaults:{scaledWidth:null,scaledHeight:null,displayWidth:null,displayHeight:null},initialize:function(t){t=i.extend({},t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),this.photo=t.photo||new d,this.photos=t.photos,this.photoset=t.photoset,this.$el.attr("data-photo-id",this.photo.get("id")),this.listenTo(this.photo,"change:id",function(t,e){this.$el.attr("data-photo-id",e)
})},thumbnailDimensions:function(t,e){var i=this.photo.getHeightForWidth(100);return e&&i>e&&(i=e,t=this.photo.getWidthForHeight(100)),{width:Math.ceil(t),height:Math.ceil(i)}},resize:function(t){t||(t=a);var e=this.get("displayWidth")||0,i=this.get("displayHeight")||0,n=this.get("scaledWidth")||0,r=this.get("scaledHeight")||0;return o(this.js$("crop"),"stop"),o(this.js$("positioner"),"stop"),o(this.js$("image"),"stop"),s.join(o(this.js$("crop"),{width:e,height:i},{duration:t}),o(this.js$("positioner"),{width:Math.max(0,n-e),height:Math.max(0,r-i)},{duration:t}),o(this.js$("image"),{width:n,height:r},{duration:t}))},serialize:function(){return i.defaults(this.toJSON(),this.photo.toJSON())},beforeTeardown:function(){return this.stopListening(),this},render:function(){var t=this.serialize();return this.$el.html(this.template(t)),this.attachSubViews(),this}});e.exports=u},{"../models/photo":70,"../templates/photo.tpl":72,lodash:"K2RcUv","prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/view":496,"velocity-animate":"lWl/mc",when:"RG2dij"}],80:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("../utils/imagelayout"),a=(t("prima/lib/logger"),t("prima/mixins/subviewable")),r=t("prima/mixins/selectorcache"),l=t("prima/mixins/accessor"),h=t("../models/photo"),d=t("../models/photoset"),c=t("../templates/photoset.tpl"),u=t("./photo"),p=t("../utils/attrdata"),m=t("prima/utils/image/types").getImageType,g=function(t,e,s){i.isNumber(s)||(s=0);var o=0,a=t.length,r=e-2*s*(a-1),l=r/a,d=i.map(t,function(t,e){t instanceof h&&(t=t.toJSON());var i=e%2?Math.ceil(l):Math.floor(l);e>=a-1&&(i=r),r-=i;var s=Math.round(n.heightForWidth(t.width,t.height,i));return(!o||s&&o>s)&&(o=s),{width:i,height:s}});return{width:e,height:o,photos:d}},f=o.extend({className:"photoset",template:c,mixins:[a,r,l],defaults:{dynamic:!1,width:500,height:0,padding:5,minFullWidthSize:300,addMargin:!1},$$cacheKeys:{row:".photoset--row",cell:".photoset--cell"},$$rows:function(t){return this.$$(this.$$cacheKeys.row,t)},$$cells:function(t){return this.$$(this.$$cacheKeys.cell,t)},initialize:function(t){this.options=t=i.extend({},t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),this._PhotoView=t.PhotoView||u,this.photoset=t.photoset||new d},_updateRowCache:function(){return this._rowCache=i.map(this.photoset.getRows(),function(t){return i.pluck(t,"id")}),this._rowCache},_updateLayoutCache:function(){var t=this._updateRowCache(),e=this._layoutCache={rows:[],photos:{}},s=this.get("padding"),o=this.get("width"),n=0;return i.forEach(t,function(a,r){var l=this.photoset.photos.getSubset(a),h=r>0?s:0,d=r<t.length-1?s:0,c=this.rowSize(l,o,s),u=c.height+h+d;e.rows[r]={unpaddedHeight:c.height,paddingTop:h,paddingBottom:d,height:u,cells:[]},n+=u,i.forEach(l,function(t,i){var o=i<l.length-1?s:0,n=i>0?s:0,a=c.photos[i],h=t.get("id");e.photos[h]={scaledWidth:a.width,scaledHeight:a.height,displayWidth:a.width,displayHeight:c.height},e.rows[r].cells[i]={photo:h,unpaddedWidth:a.width,paddingLeft:n,paddingRight:o,width:a.width+n+o,height:u}},this)},this),e.width=o,e.height=n,this.set("height",n),e},rowSize:function(t,e,s){return t||(t=this.photoset.photos),i.isNumber(e)||(e=this.get("width")),i.isNumber(s)||(s=this.get("padding")),g(t,e,s)},createRowElement:function(){return s('<div class="photoset--row"></div>')},createCellElement:function(t){var e=s('<div class="photoset--cell"></div>');return null!=t&&p.set(e,"data-photo-id",t),e},createPhotoSubView:function(t){var e=new this._PhotoView({photoset:this.photoset,photos:this.photoset.photos,photo:t});return t.get("id")&&(this.subViews[t.get("id")]=e),e},createSubViews:function(){this.photoset.photos.forEach(this.createPhotoSubView,this)},createSinglePhotoLayout:function(){this._layoutCache||this._updateLayoutCache();var t=this.photoset.photos.at(0),e=t.get("width"),i=t.get("height"),s=m(t.get("url"))||"gif",o=this.getMinFullWidthSize(s);e>=o&&(i=Math.round(n.heightForWidth(e,i,this.get("width"))),e=this.get("width"));var a=t.get("id"),r=this.subViews[a];r.set({scaledWidth:e,scaledHeight:i,displayWidth:e,displayHeight:i});var l=this.js$("layout"),h=this.createRowElement().height(i),d=this.createCellElement(a),c=this.get("addMargin")?500:o;d.css({width:e,height:i,padding:0}).addClass("photoset--single-cell"),c>e&&d.addClass("photoset--single-cell-margin"),d.append(r.$el),h.append(d),l.append(h),this.renumberRowsAndCells()},createPhotosetLayout:function(){var t=this._layoutCache||this._updateLayoutCache();i.forEach(t.rows,function(e){var s=this.createRowElement();s.height(e.height),i.forEach(e.cells,function(o){var n=o.photo,a=t.photos[n],r=this.subViews[n];r.set(a);var l=this.createCellElement(n);l.css({width:o.width,height:o.height,padding:i.map([e.paddingTop,o.paddingRight,e.paddingBottom,o.paddingLeft],function(t){return t?t+"px":0}).join(" ")}),l.append(r.$el),s.append(l)},this),this.js$("layout").append(s)},this),this.renumberRowsAndCells()},renumberRowsAndCells:function(){i.forEach(this.$$rows(!0),function(t,e){p.set(t,"data-photoset-row",e)},this),i.forEach(this.$$cells(!0),function(t,e){p.set(t,"data-photoset-position",e)},this)},getMinFullWidthSize:function(t){var e=this.get("minFullWidthSize");return i.isNumber(e)?e:i.has(e,t)?e[t]:300},serialize:function(){return i.extend(this.toJSON(),{_rowSize:i.bind(this.rowSize,this),photoTemplate:u.prototype.template,photoset:this.photoset.toJSON()})},afterTeardown:function(){return this.stopListening(),delete this._rowCache,delete this._layoutCache,this.teardownSubViews()},render:function(){return this.get("dynamic")?(this.$el.html('<div class="photoset--layout" data-js-layout></div>'),this.createSubViews(),1===this.photoset.photos.length?this.createSinglePhotoLayout():this.createPhotosetLayout()):this.$el.html(this.template(this.serialize())),this}});e.exports=f},{"../models/photo":70,"../models/photoset":71,"../templates/photoset.tpl":73,"../utils/attrdata":74,"../utils/imagelayout":75,"./photo":79,jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/logger":436,"prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/utils/image/types":489,"prima/view":496}],81:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/component"),o=t("./templates/embed-code.tpl"),n=t("prima/lib/data"),a=s.extend({name:"PostEmbedCodeGenerator",defaults:{embed_host:"//embed.tumblr.com",assets_host:"//assets.tumblr.com",tumblelog_mention_key:"",post_id:"",post_url:"",embed_key:"",embed_did:""},initialize:function(t){this.options=i.extend({},this.defaults,t);var e=n.get("Context/hosts");e&&(e.embed_host&&(this.options.embed_host=e.embed_host),e.assets_host&&(this.options.assets_host=e.assets_host)),this.template=o},getCode:function(){return this.template(this.options)}});e.exports=a},{"./templates/embed-code.tpl":82,lodash:"K2RcUv","prima/component":428,"prima/lib/data":431}],82:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="",__p+="undefined"!=typeof language&&"undefined"!=typeof width?'<div class="tumblr-post" data-href="'+(null==(__t=embed_host)?"":_.escape(__t))+"/embed/post/"+(null==(__t=embed_key)?"":_.escape(__t))+"/"+(null==(__t=post_id)?"":_.escape(__t))+'" data-did="'+(null==(__t=embed_did)?"":_.escape(__t))+'" data-language="'+(null==(__t=language)?"":_.escape(__t))+'" data-width="'+(null==(__t=width)?"":_.escape(__t))+'"><a href="'+(null==(__t=post_url)?"":_.escape(__t))+'">'+(null==(__t=post_url)?"":_.escape(__t))+"</a></div>":"undefined"!=typeof language?'<div class="tumblr-post" data-href="'+(null==(__t=embed_host)?"":_.escape(__t))+"/embed/post/"+(null==(__t=embed_key)?"":_.escape(__t))+"/"+(null==(__t=post_id)?"":_.escape(__t))+'" data-did="'+(null==(__t=embed_did)?"":_.escape(__t))+'" data-language="'+(null==(__t=language)?"":_.escape(__t))+'"><a href="'+(null==(__t=post_url)?"":_.escape(__t))+'">'+(null==(__t=post_url)?"":_.escape(__t))+"</a></div>":"undefined"!=typeof width?'<div class="tumblr-post" data-href="'+(null==(__t=embed_host)?"":_.escape(__t))+"/embed/post/"+(null==(__t=embed_key)?"":_.escape(__t))+"/"+(null==(__t=post_id)?"":_.escape(__t))+'" data-did="'+(null==(__t=embed_did)?"":_.escape(__t))+'" data-width="'+(null==(__t=width)?"":_.escape(__t))+'"><a href="'+(null==(__t=post_url)?"":_.escape(__t))+'">'+(null==(__t=post_url)?"":_.escape(__t))+"</a></div>":'<div class="tumblr-post" data-href="'+(null==(__t=embed_host)?"":_.escape(__t))+"/embed/post/"+(null==(__t=embed_key)?"":_.escape(__t))+"/"+(null==(__t=post_id)?"":_.escape(__t))+'" data-did="'+(null==(__t=embed_did)?"":_.escape(__t))+'"><a href="'+(null==(__t=post_url)?"":_.escape(__t))+'">'+(null==(__t=post_url)?"":_.escape(__t))+"</a></div>",__p+='<script async src="'+(null==(__t=assets_host)?"":_.escape(__t))+'/post.js"></script>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],83:[function(t,e){"use strict";var i=(t("prima/utils/exposer"),t("prima/utils/haspath"),t("lodash")),s=t("jquery"),o=t("when"),n=t("prima/utils/sequence-with-context"),a=t("prima/mixins/promisifyevents"),r=t("prima/component"),l=t("prima/events"),h=t("prima/lib/domeventor"),d=(t("prima/lib/logger"),t("backbone")),c=(t("./utils/transition_speed"),t("./utils/scroll_helper")),u=t("./utils/save_hook"),p=t("./utils/post_form_container_type"),m="/dashboard",g=t("prima/lib/translate"),f=s("body"),_=t("app/components/post-form"),v=t("app/components/dialog"),b=t("app/lib/currentuser"),y=t("app/components/post-form/models/post"),w=t("app/components/post-form/services/embed_data"),x=t("./views/glass"),k=t("./views/modal"),C=t("./views/container"),S=t("./views/post_buttons"),T=r.extend({name:"PostFormBuilder",initialize:function(){var t=this.getOwnData();if(this.user=b(),this.user){var e={baseRoute:void 0,currentChannel:void 0,supportImageSearch:!1,supportImageFlagging:!1,minFullWidthSize:{},fullWidthInlineMedia:!1,fullWidthPosts:!1,redirectTo:!1,reblogActionContext:!1};i.extend(this,e,i.pick(t,i.keys(e))),this._addGlobalEventListeners(),this.user.set(t.limits),this.user.set(t.dashboardSettings),this.user.set("language",t.language||"en_US"),w.setEmbedRegexes(t.embedRegexes),this.glass=new x,this.modal=new k,this.modalContainer=new C({className:"post-form-modal-content",animateHeightWithContent:!0}),this.modal.setContentSubView(this.modalContainer),this.postButtons=new S({el:"#new_post"}),this.postButtonsContainer=new C({el:this.postButtons.$el.parent(),originalContent:this.postButtons,transitionBackground:!0,animateHeightWithContent:!0,useLoader:!1}),this.scrollHelper=new c,this.saveHook=new u(i.extend({$postButtonsContainer:this.postButtonsContainer.$el,$latestPostEl:this.postButtonsContainer.$el.next()},t)),this.legacyEvents(),this._updateData=i.once(this.updateData),this.render()}},updateData:function(){var t=s.ajax({url:"/svc/post/get_post_form_builder_data",type:"POST",with_form_key:!0,data:{}});return t.then(i.bind(function(t){var e=t.response;return i.forEach(e.channels,function(t){var e=t.name?this.user.getChannel(t.name):!1;e&&e.set(i.omit(t,"name"))},this),this.user.set(e.limits),e},this))},legacyEvents:function(){var t={"postForms:closed":["post:form:hide","keycommands:resume"],"postForms:saved":["post:form:success"],"postForms:opened":["post:form:show","keycommands:suspend"]};i.forEach(t,function(t,e){this.listenTo(l,e,function(){var e=i.toArray(arguments);i.each(t,function(t){l.trigger.apply(l,[].concat(t,e))},this)})},this)},_addGlobalEventListeners:function(){this.listenTo(l,"postForms:open",this.createPostForm),this.listenTo(l,"postForms:new",this._createPostFormNew),this.listenTo(l,"postForms:edit",this._createPostFormEdit),this.listenTo(l,"postForms:reblog",this._createPostFormReblog),this.listenTo(l,"postForms:saved",this.destroyPostForm),this._registerDismissListener(),this.listenTo(l,"postForms:dismissListener:suspend",function(){this._toggleDismissListener(!1)}),this.listenTo(l,"postForms:dismissListener:resume",function(){this._toggleDismissListener(!0)})},_toggleDismissListener:function(t){this.stopListening(l,"postForms:close"),t&&this._registerDismissListener()},_registerDismissListener:function(){this.listenTo(l,"postForms:close",this.dismissPostForm)},createInlineContainer:function(t){return t?new C({el:t.parent(),originalContent:t,transitionBackground:!0}):!1},_createPostFormNew:function(t){return this.createPostForm(t)},_createPostFormEdit:function(t){return t.postEl&&(t.containerView=this.createInlineContainer(t.postEl),t.postFormType=p.inline),this.createPostForm(t)},_createPostFormReblog:function(t){return this.createPostForm(t)},createPostForm:function(t){if(this.postForm)return this.destroyPostForm(t).then(i.bind(function(){return this.createPostForm(t)},this));t=i.extend({supportImageSearch:this.supportImageSearch,supportImageFlagging:this.supportImageFlagging,fullWidthInlineMedia:this.fullWidthInlineMedia,minFullWidthSize:this.minFullWidthSize,updateURL:!0,glass:!0,postFormType:p.modal},t),i.defaults(t,{containerView:t.postFormType===p.inline?this.postButtonsContainer:null}),t.post||(t.post=this._createPostModel(t)),t.url||(t.url=this._postFormUrl(t.post)),t.containerView===this.postButtonsContainer&&this.postButtons.setPostType(t.post.get("type")),this._updateData();var e=t.postFormType===p.modal,a=this.postForm=new _(i.extend(i.pick(t,["supportImageSearch","supportImageFlagging","fullWidthInlineMedia","minFullWidthSize","post"]),{fullWidthPosts:this.fullWidthPosts,isModal:e,popoverContainer:e?this.modal.$el:f,redirectTo:this.redirectTo,reblogActionContext:this.reblogActionContext})),r=this.postFormContainer=t.containerView||this.modalContainer;if(!r)throw new Error("No post form container!");this.listenTo(a,"pauseScrollHelper",this.pauseScrollHelper),this.listenTo(a,"resumeScrollHelper",this.resumeScrollHelper),r.isRendered()||r.render(),r.setPostFormComponent(a);var c=i.once(i.bind(function(){return t.glass?this.glass.show():o.resolve()},this)),u=n([function(){return l.trigger("Header:hide"),o.join(r.prepare(c),a.whenRendered(!0))},function(){return a.disable(),r.attach(c)},function(){return t.updateURL&&d.history.navigate(t.url,{replace:!0}),function(){var t=h.rect(),o=t.windowScrollTop,n=t.windowHeight,d=a.getRect(),c=d.offsetHeight,u=r.$el.offset().top,p=u+c,m=20,g=s("[prima-component=header]").height()||0,f=n>c+2*m,_=this.scrollHelper.calculateScrollTop(u-m,p+m+g,n,f),v=400,b=e?this.modal.$el:void 0;r===this.postButtonsContainer&&_>o&&n>c&&(_=o),this.previousScrollPosition=e?!1:o,this.scrollHelper.scrollToPosition(_,v,b),this.listenTo(l,"Photoset:dragScroll",function(t,e){i.isNumber(e)||(e=50);var s=h.rect().windowScrollTop+t;this.scrollHelper.scrollToPosition(s,e,b)}),this.listenTo(l,"Photoset:scrollToRow",function(t,e,s){i.isNumber(s)||(s=50),t+=0,this.scrollHelper.checkScrollBounds(!1,{keepInside:!0,contentPadding:70,contentRect:{offsetTop:t,offsetHeight:e}})})}.call(this),r.showPostForm(c)},function(){return c()},function(){a.enable()}],this).then(i.bind(function(){return l.trigger("postForms:opened"),f.addClass("postforms-open"),a},this),i.bind(function(){this.destroyPostForm()},this));return t.postFormType===p.inline&&u.then(i.bind(function(){this.scrollHelper.start({el:r.$el})},this)),u.catch(function(t){t instanceof Error&&i.defer(function(){throw t})}),u},_postFormStateChanged:function(){if(this.postForm){var t=this.postForm.initialPostState,e=this.postForm.post;return e.deepHasChanged(t)}return!1},dismissPostForm:function(){(!this.postForm||this.postForm.isEnabled())&&(this._postFormStateChanged()?this._buildDismissPrompt():this.destroyPostForm())},_buildDismissPrompt:function(){var t=g("Discard this post?");this.postForm&&this.postForm.post&&"edit"===this.postForm.post.get("mode")&&(t=g("Discard edits to this post?"));var e={text:t,text_ok:g("Discard"),text_cancel:g("Nevermind"),keycommand_maintain:!0};v.confirm(e,i.bind(function(){this.destroyPostForm(),l.trigger("postForms:dismissListener:resume")},this),function(){i.defer(function(){l.trigger("postForms:dismissListener:resume")})}),l.trigger("postForms:dismissListener:suspend")},destroyPostForm:function(t,e){t=i.extend({updateURL:!0,url:this.baseRoute,glass:!0},t),this.scrollHelper.stop();var s=this.postForm,a=this.postFormContainer;this.postForm=null,this.postFormContainer=null,this.stopListening(s),this.stopListening(l,"Photoset:dragScroll");var r=i.once(i.bind(function(){return t.glass?this.glass.hide():o.resolve()},this)),h=s&&!!s.postForm.get("saved"),c=n([function(){h&&this.saveHook.preExecute(e)},function(){s&&s.disable()},function(){return function(){if(this.previousScrollPosition!==!1){var t=this.previousScrollPosition,e=400;this.scrollHelper.scrollToPosition(t,e)}}.call(this),a?a.hidePostForm(r).then(function(){a.teardown()}):void 0},function(){if(s&&s.remove(),t.updateURL){var e=d.history.root||"",i=t.url?t.url.replace(new RegExp("^"+e),""):"";d.history.navigate(i,{replace:!0})}},function(){return r()},function(){h&&e&&(this.saveHook.$inlinePostEl=a.$el,this.saveHook.execute(e))}],this).then(function(){return l.trigger("postForms:closed"),l.trigger("Header:show"),f.removeClass("postforms-open"),s});return c.catch(function(t){t instanceof Error&&i.defer(function(){throw t})}),c},pauseScrollHelper:function(){this.scrollHelper&&this.scrollHelper.pause()},resumeScrollHelper:function(){this.scrollHelper&&this.scrollHelper.resume()},_createPostModel:function(t){return"string"==typeof t&&(t={postType:t}),new y(t.reblogId?{lookupData:{reblog_id:t.reblogId,reblog_key:t.reblogKey},tumblelog:this.currentChannel,mode:"reblog",editorType:this.user.get("defaultEditorType"),pt:t.pt,contextData:{baseRoute:this.baseRoute},reblogSource:t.reblogSource,loggingData:t.loggingData}:t.editId?{lookupData:{post_id:t.editId,channel_id:t.channelId||this.redirectChannel},tumblelog:t.channelId||this.currentChannel,editorType:this.user.get("defaultEditorType"),contextData:{baseRoute:this.baseRoute},mode:"edit",loggingData:t.loggingData}:{type:t.postType||t.type||"text",tumblelog:this.currentChannel,editorType:this.user.get("defaultEditorType"),contextData:{baseRoute:this.baseRoute},mode:"new",loggingData:t.loggingData})},_postFormUrl:function(t){if(t){if(t.has("lookupData")){var e=t.get("lookupData");return e.reblog_id?this._reblogPostUrl(e.reblog_id,e.reblog_key):e.post_id?this._editPostUrl(e.post_id):this._newPostUrl(t.get("type"))}return t.has("reblog_id")?this._reblogPostUrl(t.get("reblog_id"),t.get("reblog_key")):t.has("id")?this._editPostUrl(t.get("id")):this._newPostUrl(t.get("type"))}return this._newPostUrl("text")},_newPostUrl:function(t){var e=this.baseRoute!==m?this.baseRoute:"";return e+"/new/"+t},_editPostUrl:function(t){return"/edit/"+t},_reblogPostUrl:function(t,e){return"/reblog/"+t+"/"+e},render:function(){return this.glass.render().$el.appendTo("body"),this.modal.render().$el.appendTo("body"),this},updateBaseRoute:function(t){var e;t?this.baseRoute=t:(e=d&&d.history?d.history.location.pathname:m,this.baseRoute=e)}},{containerType:function(t){return p[t]}});a.applyTo(T.prototype),e.exports=T},{"./utils/post_form_container_type":88,"./utils/save_hook":89,"./utils/scroll_helper":90,"./utils/transition_speed":91,"./views/container":92,"./views/container_content":93,"./views/glass":94,"./views/modal":96,"./views/post_buttons":97,"app/components/dialog":39,"app/components/post-form":101,"app/components/post-form/models/post":109,"app/components/post-form/services/embed_data":118,"app/lib/currentuser":296,backbone:"5kFNoY",jquery:"HlZQrA",lodash:"K2RcUv","prima/component":428,"prima/events":429,"prima/lib/domeventor":433,"prima/lib/logger":436,"prima/lib/translate":456,"prima/mixins/promisifyevents":466,"prima/utils/exposer":482,"prima/utils/haspath":485,"prima/utils/sequence-with-context":492,when:"RG2dij"}],84:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/model"),o=s.extend({endpoint:"/svc/post/%s/%s/%s",parse:function(t){return{dashboardHTML:t.trim()}},sync:function(t,e,o){if("read"!==t)throw new Error("The DashboardPostFetch model may only READ from server!");if(o=i.defaults(o||{},{pageRoot:!1,direction:!1,refPostID:!1}),!1===(o.pageRoot&&o.direction))throw new Error(i.sprintf("These two fetch params must be passed: pageRoot [%s], direction [%s]",o.pageRoot,o.direction));return i.defaults(o,{dataType:"html",emulateHTTP:!0,url:i.sprintf(this.endpoint,o.pageRoot,o.direction,o.refPostID)}),s.prototype.sync.call(this,t,e,o)}});e.exports=o},{lodash:"K2RcUv","prima/model":471}],85:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+="",transitionBackground&&(__p+='<div class="post-transition-background"></div>'),__p+="",originalContent&&(__p+='<div data-subview="originalContent"></div>'),__p+='<div data-subview="loader"></div><div data-subview="postForm"></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],86:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="Knight-Rider-loader ',loading&&(__p+="animate"),__p+='"><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],87:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="v-center-outer"><div class="v-center-inner"><div class="v-center-content"><div data-subview="content"></div></div></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],88:[function(t,e){"use strict";var i={modal:1,inline:2};e.exports=i},{}],89:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/events"),n=t("../models/dashboard_post_fetch"),a=function(){var t=["dashboard","drafts","inbox"],e={preExecute:function(){return"queue"===this.contextData.contextPage?(s(window).off("beforeunload"),void window.location.replace(this.contextData.baseRoute)):void 0},execute:function(e){if(this.saveResponse=e.responseJSON,-1!==t.indexOf(this.contextData.contextPage)){var o=!this.saveResponse.post.is_edit&&!this.saveResponse.post.is_reblog,n="post_dashboard_html"in this.saveResponse,a=!(!this.saveResponse.post||!this.saveResponse.post.is_edit)&&this.contextData.contextPage!==this.saveResponse.post_context_page&&this.$inlinePostEl.hasClass("post_container");o?this._fetchMorePosts():n&&(a?this._removeInline():this._updateInline()),this._displayNotification(this.saveResponse),this.saveResponse.context_tumblelog&&i.each(this.saveResponse.context_tumblelog.counts,function(t,e){var i=s("#dashboard_controls_open_blog .dashboard_"+e);i.find(".count").text(t);var o=(i.attr("class")||"").match(/(?:\s|^)count_\d+/gi);o&&i.removeClass(o.join("")),i.addClass("count_"+t)})}},_fetchMorePosts:function(){var t=this.contextData.baseRoute.replace(/^\/|\/$/g,""),e="drafts"===this.contextData.contextPage?"after":"before",s=this._findLatestPostId(),o=new n;o.fetch({pageRoot:t,direction:e,refPostID:s,success:i.bind(this._fetchSuccess,this),error:this._fetchFailure})},_fetchSuccess:function(t){var e=s(t.get("dashboardHTML"));e.insertAfter(this.contextData.$postButtonsContainer),s(".no_posts_found").remove(),this.contextData.$latestPostEl=e,o.trigger("posts:load")},_fetchFailure:function(){console.error("Failed loading dashboard HTML after successful post submission.")},_findLatestPostId:function(){var t=this.contextData.$latestPostEl.find(".post").data("post-id")||this.contextData.$postButtonsContainer.nextAll(".post_container").first().find(".post").data("post-id");return t},_updateInline:function(){var t=s(this.saveResponse.post_dashboard_html.trim());this.$inlinePostEl.replaceWith(t.eq(0)),o.trigger("posts:load")},_removeInline:function(){var t=this.contextData.baseRoute.split("/");t.splice(-1,1);var e=this.$inlinePostEl;return e.fadeOut(200,function(){e.remove()}),s("#posts .post").not(".new_post").length<=1?void(window.location=t.join("/")):void 0},_displayNotification:function(t){var e=this.contextData.baseRoute.split("/"),s=e[1]||"",n=t.message,a=i.parseInt(this.contextData.notificationDelay),r={url:t.post_tumblelog.post_url,tumblelog:{name:t.post_tumblelog.name_or_id,url:t.post_tumblelog.url,avatar:t.post_tumblelog.avatar}};(!t.created_post||t.post.is_reblog||t.fastCompose||"tagged"===s.toLowerCase())&&i.delay(function(){o.trigger("postForms:saveHook:toast",n,r)},a)}},a=function(t){this.contextData=i.defaults(t||{},{notificationDelay:250}),i.extend(this,e)};return a}();e.exports=a},{"../models/dashboard_post_fetch":84,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429}],90:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("velocity-animate").animate,n=t("../utils/transition_speed"),a=t("prima/class"),r=t("backbone"),l=t("prima/lib/domeventor"),h=t("prima/events"),d=(t("prima/lib/logger"),s("html")),c=a.extend({defaults:{keepInside:!1,scrollSpeedMs:250,triggerPadding:-50,contentPadding:20,debounceMs:200},start:function(t){return this._running&&this.stop(),this._running=!0,t&&!i.isPlainObject(t)&&(t={el:t}),this.options=t=i.extend({},this.defaults,t),this.$el=s(t.el),this.updateContentRect(),this.listenTo(h,"DOMEventor:flatscroll",this.checkScrollBounds),this},stop:function(){return this._running=!1,this._scrollTop=!1,this.cancelEnforceScrollBounds(),this.stopListening(),this},pause:function(){this._running&&(this._ignoreScroll=!0)},resume:function(){this._running&&this._ignoreScroll&&(this._ignoreScroll=!1,this.checkScrollBounds())},updateContentRect:function(){this.contentRect||(this.contentRect={}),this.lastContentRect&&(this.lastContentRect.offsetTop=this.contentRect.offsetTop,this.lastContentRect.offsetLeft=this.contentRect.offsetLeft,this.lastContentRect.offsetHeight=this.contentRect.offsetHeight,this.lastContentRect.offsetWidth=this.contentRect.offsetWidth);var t=this.$el.offset();return this.contentRect.offsetTop=t.top,this.contentRect.offsetLeft=t.left,this.contentRect.offsetHeight=this.$el.outerHeight(),this.contentRect.offsetWidth=this.$el.outerWidth(),this.lastContentRect||(this.lastContentRect=i.clone(this.contentRect)),this.contentRect},calculateScrollTop:function(t,e,i,s){return s?t:e-i},checkScrollBounds:function(t,e){if(!this._ignoreScroll){e=e?i.extend({},this.defaults,this.options,e):this.options,t||(t=l.rect());var s,o,n=e.contentRect||this.updateContentRect(),a=e.triggerPadding||0,r=e.contentPadding||0,h=n.offsetHeight,d=n.offsetTop,c=d+h,u=t.windowHeight,p=Math.max(0,t.windowScrollTop),m=p+u;return e.keepInside?(s=p-d,o=c-m):(s=p-c,o=d-m),o>a?(this._scrollTop=this.calculateScrollTop(d-r,c+r,u,h+2*r>u),this.enforceScrollBounds(e),!0):s>a?(this._scrollTop=this.calculateScrollTop(d-r,c+r,u,e.bottom||u>h+2*r),this.enforceScrollBounds(e),!0):(this._scrollTop=!1,this.cancelEnforceScrollBounds(),!1)}},enforceScrollBounds:function(t){var e=null!=t.scrollTop?t.scrollTop:this._scrollTop,s=t.scrollSpeedMs,o=t.debounceMs,n=t.container;o?this._enforceTimeout||(this._enforceTimeout=i.delay(i.bind(function(){null==t.scrollTop&&(e=this._scrollTop),this.scrollTop!==!1&&this.scrollToPosition(e,s,n)},this),o)):this.scrollToPosition(e,s,n)},cancelEnforceScrollBounds:function(){this._enforceTimeout,clearTimeout(this._enforceTimeout),this._enforceTimeout=!1},scrollToPosition:function(t,e,s){this._ignoreScroll=!0,o(d,"stop"),o(d,"scroll",{offset:t,container:s,duration:n(e||this.defaults.scrollSpeedMs)}).then(i.bind(function(){this._ignoreScroll=!1},this))}});i.extend(c.prototype,r.Events),e.exports=c},{"../utils/transition_speed":91,backbone:"5kFNoY",jquery:"HlZQrA",lodash:"K2RcUv","prima/class":426,"prima/events":429,"prima/lib/domeventor":433,"prima/lib/logger":436,"velocity-animate":"lWl/mc"}],91:[function(t,e){"use strict";var i=1,s=function(t){return t*i};s.get=function(){return i},s.set=function(t){i=t},e.exports=s},{}],92:[function(t,e){"use strict";var i=t("lodash"),s=t("when"),o=t("velocity-animate").animate,n=t("prima/utils/sequence-with-context"),a=t("../utils/transition_speed"),r=t("prima/mixins/promisifyevents"),l=t("prima/view"),h=(t("prima/lib/logger"),t("prima/mixins/subviewable")),d=t("prima/mixins/selectorcache"),c=t("prima/mixins/accessor"),u=t("./container_content"),p=t("./loader"),m=t("../templates/container.tpl"),g=l.extend({mixins:[h,d,c,r],template:m,defaultOptions:{animateDuringPrepare:!0,animateHeightWithContent:!1,startHeight:null,useLoader:!0,loaderDelay:250,transitionBackground:!1},defaults:{minHeight:!1,pretransition:!1,midtransition:!1},initialize:function(t){t instanceof l&&(t={postForm:t}),this.options=t=i.extend({},this.defaultOptions,t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),t.postForm&&this.setPostForm(t.postForm),this.listenTo(this,"change:minHeight",this._onChangeMinHeight),this.listenTo(this,"change:pretransition",this._onChangePretransition),this.listenTo(this,"change:midtransition",this._onChangeMidtransition)},_onChangeMinHeight:function(t,e){o(this.$el,"stop"),e||i.isNumber(e)?o(this.$el,{"min-height":e},{duration:a(Math.min(Math.max(250,e),750))}):(e=i.parseInt(this.$el.css("min-height"),10)||0,o(this.$el,{"min-height":[0,e]},{duration:a(Math.min(Math.max(250,e),750))}).then(i.bind(function(){this.$el.css("min-height","")},this)))},_onChangePretransition:function(t,e){e?this.$el.addClass("post-form-container-pretransition"):this.$el.removeClass("post-form-container-pretransition")},_onChangeMidtransition:function(t,e){e?this.$el.addClass("post-form-container-transition"):this.$el.removeClass("post-form-container-transition")},setPostFormComponent:function(t){return this._postFormComponent!==t?(this._postFormComponent&&this.stopListening(this._postFormComponent),this._postFormComponent=t,this.postForm=t.postForm,this):void 0},prepare:function(t){return this.isRendered()||this.render(),this.trigger("prepared",this),this.loadingDelay=i.delay(i.bind(function(){this.loader&&this.options.useLoader&&this.loader.set("loading",!0)},this),this.options.loadingDelay),this.options.animateDuringPrepare&&(this._hideOriginalContent=this.hideOriginalContent(t).then(i.bind(function(){return this._hideOriginalContent=!1,this},this))),s.resolve(this)},attach:function(){return this.loader&&(clearTimeout(this.loadingDelay),this.loader.set("loading",!1)),this.set("pretransition",!0),this.postForm.forceHidden(),this.attachSubView(this.postForm,"postForm"),s.resolve(this)},hideOriginalContent:function(t){var e=this.options.startHeight||this.originalContent.measureHeight(),i=this.postForm.measureHeight();return e||this.options.originalContent||(e=i),n([function(){null!=e&&this.$el.css("height",e),this.set("midtransition",!0),this.originalContent.set("enabled",!1)},function(){return s.join(t(),this.originalContent.animateHide(a(100)))}],this)},showPostForm:function(t){var e=this.options.startHeight||this.originalContent.measureHeight(),i=this.postForm.measureHeight();return e||this.options.originalContent||(e=i),n([function(){return this.options.animateHeightWithContent||this.originalContent.get("hidden")?void 0:this._hideOriginalContent||this.hideOriginalContent(t)},function(){var n=[];return this.options.animateHeightWithContent&&!this.originalContent.get("hidden")&&n.push(this._hideOriginalContent||this.hideOriginalContent(t)),null==i||null==e||(i===e?this.$el.height(i):n.push(o(this.$el,{height:[i,e]},{duration:a(150),easing:[.4,1.3,.7,1]}))),s.all(n)},function(){return this.set("placeholder",!1),this.postForm.animateShow(a(100))},function(){this.set("pretransition",!1),this.set("midtransition",!1),this.$el.css("height","")
}],this)},hidePostForm:function(t){var e=this.postForm.measureHeight(),i=this.originalContent.measureHeight();return i||this.options.originalContent||(i=e),n([function(){this.$el.css("height",e),this.set("midtransition",!0)},function(){return this.postForm.animateHide(a(100))},function(){if(this.set("pretransition",!0),null==i||null==e);else{if(i!==e)return o(this.$el,{height:[i,e]},{duration:a(100),easing:[0,0,.6,1]});this.$el.height(i)}},function(){return s.join(t(),this.originalContent.animateShow(a(50)))},function(){this.set("midtransition",!1),this.set("pretransition",!1),this.$el.css("height",""),this.originalContent.set("enabled",!0)}],this)},serialize:function(){return{originalContent:!!this.options.originalContent,transitionBackground:this.options.transitionBackground}},beforeRender:function(){this.loader||(this.loader=new p),this.originalContent||(this.originalContent=this.options.originalContent instanceof u?this.options.originalContent:new u({el:this.options.originalContent})),this.originalContent.$el.detach()},render:function(){return this.$el.html(this.template(this.serialize())),this.subViews.originalContent=this.originalContent,this.subViews.loader=this.loader,this.subViews.postForm=this.postForm,this.attachSubViews(),this},afterRender:function(){return this.$el.addClass("post-forms-above-glass"),this.renderSubViews()},beforeTeardown:function(){return this.subViews.loader=void 0,this},afterTeardown:function(){return this.$el.removeClass("post-forms-above-glass post-form-container-pretransition post-form-container-transition"),this.loader&&(this.loader.remove(),this.loader=void 0),this.$el.children(".post-transition-background").remove(),delete this.postForm,this.trigger("torndown",this),this.teardownSubViews()}});e.exports=g},{"../templates/container.tpl":85,"../utils/transition_speed":91,"./container_content":93,"./loader":95,lodash:"K2RcUv","prima/lib/logger":436,"prima/mixins/accessor":458,"prima/mixins/promisifyevents":466,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/utils/sequence-with-context":492,"prima/view":496,"velocity-animate":"lWl/mc",when:"RG2dij"}],93:[function(t,e){"use strict";var i=t("lodash"),s=t("velocity-animate").animate,o=t("prima/view"),n=t("prima/mixins/subviewable"),a=t("prima/mixins/accessor"),r=o.extend({defaults:{hidden:!1,enabled:!0},mixins:[n,a],initialize:function(t){this.set("hasContent",t&&t.el),this.originalCSS=this._getCSS(["opacity"]),this.listenTo(this,"change:enabled",this._onChangeEnabled),this.listenTo(this,"change:hidden",this._onChangeHidden)},_getCSS:function(t){var e={};return i.forEach(t,function(t){e[t]=this.$el.css(t)},this),e},_onChangeEnabled:function(t,e){this.$el.toggleClass("no-pointer-events",!e)},_onChangeHidden:function(t,e){this.$el.toggleClass("collapse",e)},measureHeight:function(){if(!this.get("hasContent"))return void 0;var t=this.get("hidden");this.set("hidden",!1);var e=this.$el.outerHeight();return this.set("hidden",t),e},animateShow:function(t,e){return t||(t=0),e||(e=0),s(this.$el,{opacity:1},{duration:t,delay:e,begin:i.bind(function(){this.set("hidden",!1)},this)})},animateHide:function(t,e){return t||(t=0),e||(e=0),s(this.$el,{opacity:0},{duration:t,delay:e}).then(i.bind(function(){this.set("hidden",!0)},this))},render:function(){return this},teardown:function(){return this.$el.css(this.originalCSS),this}});e.exports=r},{lodash:"K2RcUv","prima/mixins/accessor":458,"prima/mixins/subviewable":468,"prima/view":496,"velocity-animate":"lWl/mc"}],94:[function(t,e){"use strict";var i=t("lodash"),s=t("velocity-animate").animate,o=t("prima/view"),n=t("../utils/transition_speed"),a=t("prima/mixins/subviewable"),r=t("prima/mixins/selectorcache"),l=t("prima/mixins/accessor"),h=o.extend({className:"post-forms-glass",mixins:[a,r,l],initialize:function(t){this.options=t=i.extend({active:!1,visible:!1},t),this.set({active:!!t.active,visible:!!t.visible}),this.$el.css(this.get("visible")?{opacity:1,display:"block"}:{opacity:0,display:this.get("active")?"block":"none"}),this.listenTo(this,{"change:active":this._changeActive,"change:visible":this._changeVisible})},show:function(t){return this.set("active",!(null!=t&&!t)),this.attributes.visible&&this._showing?this._showing:(this.attributes.visible=!0,this._show())},hide:function(t){return this.set("active",!(null==t&&!t)),!this.attributes.visible&&this._hiding?this._hiding:(this.attributes.visible=!1,this._hide())},_show:function(){var t=this._showing=s(this.$el,{opacity:1},{duration:n(150),display:"block"});return t},_hide:function(){var t=this._hiding=s(this.$el,{opacity:0},{duration:n(150),display:this.get("active")?"block":"none"});return t},_changeActive:function(t,e){e?this.$el.addClass(this.className+"_active active"):(this.$el.removeClass(this.className+"_active active"),!this._changing||i.has(this.changed,"visible")||this.get("visible")||this.$el.css("display","none"))},_changeVisible:function(t,e){e?(this.$el.addClass(this.className+"_visible visible"),this._show()):(this.$el.removeClass(this.className+"_visible visible"),this._hide())},render:function(){return this}});e.exports=h},{"../utils/transition_speed":91,lodash:"K2RcUv","prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/view":496,"velocity-animate":"lWl/mc"}],95:[function(t,e){"use strict";var i=t("prima/view"),s=t("prima/mixins/subviewable"),o=t("prima/mixins/selectorcache"),n=t("prima/mixins/accessor"),a=t("../templates/loader.tpl"),r=i.extend({className:"post-forms-loader",mixins:[s,o,n],template:a,initialize:function(t){this.listenTo(this,"change:loading",this._onChangeLoading),this.set("loading",t&&t.loading)},_onChangeLoading:function(t,e){this.isRendered()&&(e?(this.$el.addClass("loading"),this.$$(".Knight-Rider-loader").addClass("animate")):(this.$el.removeClass("loading"),this.$$(".Knight-Rider-loader").removeClass("animate")))},render:function(){return this.$el.html(this.template(this.attributes)),this}});e.exports=r},{"../templates/loader.tpl":86,"prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/view":496}],96:[function(t,e){"use strict";var i=t("jquery"),s=t("velocity-animate").animate,o=t("prima/view"),n=t("../utils/transition_speed"),a=t("prima/mixins/subviewable"),r=t("prima/mixins/selectorcache"),l=t("prima/mixins/accessor"),h=t("../templates/modal.tpl"),d=o.extend({className:"post-forms-modal",mixins:[a,r,l],template:h,initialize:function(t){this.set("visible",t&&t.visible),this.$el.css(this.get("visible")?{opacity:1,display:"block"}:{opacity:0,display:"none"}),this.$body=i("body"),this.listenTo(this,"change:visible",this._toggleVisible)},show:function(){return this.attributes.visible=!0,this._show()},hide:function(){return this.attributes.visible=!1,this._hide()},setContentSubView:function(t){return this.subViews.content&&(this.stopListening(this.subViews.content),this.subViews.content.remove()),this.subViews.content=t,this.listenTo(t,"prepared",this._onSubViewPrepare),this.listenTo(t,"torndown",this._onSubViewTeardown),this.isRendered()&&this.attachSubView("content"),this},_onSubViewPrepare:function(){this.show()},_onSubViewTeardown:function(){this.hide()},_show:function(){this._disableBodyScroll(),this.$el.css("display","block");var t=s(this.$el,{opacity:1},{duration:n(100),display:"block"});return t},_hide:function(){this._enableBodyScroll();var t=s(this.$el,{opacity:0},{duration:n(100),display:"none"});return t},_toggleVisible:function(t,e){e?(this.$el.addClass(this.className+"_visible visible"),this._show()):(this.$el.removeClass(this.className+"_visible visible"),this._hide())},_disableBodyScroll:function(){this.$body.css("overflow","hidden")},_enableBodyScroll:function(){this.$body.css("overflow","")},render:function(){return this.$el.html(this.template(this.attributes)),this.attachSubViews(),this}});e.exports=d},{"../templates/modal.tpl":87,"../utils/transition_speed":91,jquery:"HlZQrA","prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/view":496,"velocity-animate":"lWl/mc"}],97:[function(t,e){"use strict";var i=t("lodash"),s=t("when"),o=t("velocity-animate").animate,n=t("./container_content"),a=t("prima/mixins/selectorcache"),r=t("prima/mixins/accessor"),l=t("prima/events"),h=t("../utils/post_form_container_type"),d=n.extend({mixins:[a,r],events:{"click [data-js-text]":"_onClickNewPost","click [data-js-photo]":"_onClickNewPost","click [data-js-quote]":"_onClickNewPost","click [data-js-link]":"_onClickNewPost","click [data-js-chat]":"_onClickNewPost","click [data-js-audio]":"_onClickNewPost","click [data-js-video]":"_onClickNewPost"},setPostType:function(t){this.postType=t},animateShow:function(t,e){return t||(t=0),e||(e=0),this.$el.css({display:"block",opacity:1}),function(i){var n=this.js$(i),a=n.children("i"),r=n.children(".new_post_label_text"),l=this.$(".new_post_label").not(n),h=l.children("i"),d=l.children(".new_post_label_text"),c=[o(h,{scale:1,translateY:[0,10],opacity:1},{duration:t,delay:e}),o(d,{translateY:[0,10],opacity:1},{duration:t,delay:e})];return n.length&&a.length&&c.push(o(a,{scale:[1,1.5],translateY:[0,0],opacity:1},{duration:t,delay:e}),o(r,{translateY:[0,0],opacity:1},{duration:t,delay:e})),s.all(c)}.call(this,this.postType)},animateHide:function(t,e){t||(t=0),e||(e=0),function(i){var n=this.js$(i),a=n.children("i"),r=n.children(".new_post_label_text"),l=this.$(".new_post_label").not(n),h=l.children("i"),d=l.children(".new_post_label_text"),c=[o(h,{scale:[1,1],translateY:[10,0],opacity:0},{duration:t,delay:e}),o(d,{translateY:[10,0],opacity:0},{duration:t,delay:e})];return n.length&&a.length&&c.push(o(a,{scale:[1.5,1],translateY:[0,0],opacity:0},{duration:t,delay:.5*t+e}),o(r,{translateY:[0,0],opacity:0},{duration:t,delay:e})),s.all(c)}.call(this,this.postType).then(i.bind(function(){this.$el.css({display:"none",opacity:0})},this))},_onClickNewPost:function(t){if(t.stopPropagation(),t.preventDefault(),this.get("enabled")){var e=t.currentTarget.getAttribute("data-post-endpoint")||t.currentTarget.getAttribute("data-post-type");l.trigger("postForms:open",{postType:e,postFormType:h.inline})}}});e.exports=d},{"../utils/post_form_container_type":88,"./container_content":93,lodash:"K2RcUv","prima/events":429,"prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"velocity-animate":"lWl/mc",when:"RG2dij"}],98:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/collection"),o=t("../models/photo"),n=s.extend({model:o,add:function(t){return t&&!i.isArray(t)&&(t=[t]),i.forEach(t,function(t,e){t.id||(i.isFunction(t.set)?t.set("id",this.generateId(e)):t.id=this.generateId(e))},this),s.prototype.add.apply(this,arguments)},generateId:function(t){var e=1+(t||0),s=i.map(i.range(this.length+1),function(t){return"o"+(e+t)});return i.find(s,function(t){return!this.get(t)},this)},setIdOrder:function(t,e){e||(e={}),this.models=i.map(t,function(t){return this.get(t)},this),e.silent||this.trigger("sort",this,e)}});e.exports=n},{"../models/photo":107,lodash:"K2RcUv","prima/collection":427}],99:[function(t,e){"use strict";var i=t("lodash"),s=t("when"),o=t("prima/collection"),n=t("../models/search-image-query"),a=3e5,r=o.extend({model:n,resultCountForQuery:function(t){t=(t||"").toLowerCase().trim();var e=this.get(t);return e?e.media.length:0},fetchGifs:function(t,e){var o=s.defer();t=(t||"").toLowerCase().trim();var r=this.get(t);return r||(r=new n({query:t}),this.add(r)),!e&&i.now()-r.get("ts")<a?(this.trigger("search",t,!0),o.resolve(r)):(this.trigger("search",t,!1),r.fetch({success:function(){o.resolve(r)},error:function(t){o.reject(t)}})),o.promise},clearCache:function(t){this.remove(t)}});e.exports=r},{"../models/search-image-query":111,lodash:"K2RcUv","prima/collection":427,when:"RG2dij"}],100:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/collection"),o=t("../models/search-image"),n=s.extend({model:o,previousFrom:function(t){return this.rotateFrom(t,-1)},nextFrom:function(t){return this.rotateFrom(t,1)},rotateFrom:function(t,e){for(var s=(i.isNumber(t)?this.at(t):this.findWhere({mediaUrl:t}))||this.sample(),o=this.indexOf(s)+e;0>o;)o+=this.length;return this.at(o%this.length)}});e.exports=n},{"../models/search-image":112,lodash:"K2RcUv","prima/collection":427}],101:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/lib/translate"),o=t("when"),n=t("prima/mixins/promisifyevents"),a=t("prima/events"),r=t("prima/utils/sequence-with-context"),l=t("prima/component"),h=(t("prima/lib/logger"),t("app/lib/avatar-size")),d=t("./models/post"),c=t("app/lib/currentuser"),u=t("app/components/upload/collections/uploads"),p=t("./views/post_form"),m=t("./utils/drag_eventor"),g=new m("body"),f=t("app/components/dialog"),_=l.extend({name:"PostForm",viewOptionKeys:["supportImageSearch","supportImageFlagging","fullWidthInlineMedia","minFullWidthSize","isModal","popoverContainer","dragEvents","redirectTo","reblogActionContext","closeLabel","disableNavigation","disablePhotoFromUrl"],initialize:function(t){t=i.extend({dragEvents:g,autoFetch:!0},t),this.user=t.user||c(),this.post=t.post||new d,this.uploads=new u,this._preloadAvatars(),this.postForm=new p(i.extend(i.pick(t,this.viewOptionKeys),{user:this.user,post:this.post,uploads:this.uploads,model:this.post})),t.autoFetch&&(this.postFetch=this.fetchPostData(this.post))},_preloadAvatars:function(t){t||(t=this.user.channels.pluck("avatar_url")),i.forEach(t,function(t){var e=new Image;e.src=h(t)(128)})},fetchPostData:function(t){if(this.postFetch)return this.postFetch;t||(t=this.post);var e=this.user;return o.promise(function(i,s){t.has("lookupData")?t.fetch(t.get("lookupData")).then(function(){t.unset("lookupData"),e&&"html"===e.get("defaultEditorType")&&"edit"===t.get("mode")&&"rich"===t.get("editorType")&&t.set("editorType","html"),i(t)},function(t){403===t.status?s("blocked"):s()}):i(t)})},addEventListeners:function(){this.listenTo(a,"DOMEventor:keydown:escape",function(){this.isEnabled()&&a.trigger("postForms:close")}),this.listenTo(this.postForm,"all",function(){this.trigger.apply(this,arguments)}),this.listenToOnce(this.postForm,"postForms:changePostType",this.reloadPostForm)},enable:function(){this.postForm.set("enabled",!0)},disable:function(){this.postForm.set("enabled",!1)},isEnabled:function(){return this.postForm.get("enabled")||!1},getRect:function(){return this.postForm.getRect()},isRendered:function(){return this.postForm.isRendered()},whenRendered:function(t){return null==t&&(t=!this.isRendered()),o.promise(i.bind(function(e,i){t?(this.listenToOnce(this,"ready",function(){e(this)}),this.listenToOnce(this,"reject",function(){i()}),this.render()):e(this)},this))},_render:function(){var t=this.whenEvent(this.postForm,"media:ready");return this.postForm.render(),this.initialPostState=this.postForm.post.toJSON(),this.postForm.set("initialPostState",this.initialPostState),this.addEventListeners(),this.postForm.get("useMediaReady")?t.then(i.bind(function(){this.trigger("ready")},this)):this.trigger("ready"),delete this.postFetch,this},_reject:function(t){"blocked"===t&&f.alert(s("This post cannot be reblogged.")),this.trigger("reject")},render:function(){return this.fetchPostData(this.post).then(i.bind(this._render,this),i.bind(this._reject,this))},teardown:function(){return this.stopListening(),this},remove:function(){this.stopListening(),this.postForm.remove()},reloadPostForm:function(t){t=t||{};var e=r([function(){return this.postForm.animateHide(200)},function(){this.postForm.teardown();var e={lookupData:this.post.getLookupData(),tumblelog:this.post.get("tumblelog"),mode:this.post.get("mode"),loggingData:this.post.loggingData};i.extend(e,t.postParams||{}),this.post=this.postForm.post=this.postForm.model=new d(e),this.render()},function(){i.isFunction(t.afterReload)&&t.afterReload.call(this,this.postForm)}],this);return e}});n.applyTo(_.prototype),e.exports=_},{"./models/post":109,"./utils/drag_eventor":182,"./views/post_form":213,"app/components/dialog":39,"app/components/upload/collections/uploads":265,"app/lib/avatar-size":293,"app/lib/currentuser":296,lodash:"K2RcUv","prima/component":428,"prima/events":429,"prima/lib/logger":436,"prima/lib/translate":456,"prima/mixins/promisifyevents":466,"prima/utils/sequence-with-context":492,when:"RG2dij"}],102:[function(t,e){"use strict";function i(){}var s=t("lodash"),o=t("prima/lib/translate"),n=t("../utils/string_helpers").truncateLongStrings;i.prototype.genericFieldMap={two:"caption",three:"url"},i.prototype.editorField="two",i.prototype.allowsTypeSwitch=function(){return"new"===this.get("mode")},i.prototype.typeAttributes={service:!1,preuploadUrl:"",trackTitle:"",trackArtist:"",trackAlbum:"",preuploadAlbumArt:!1,albumArt:"",caption:"",confirmTos:!1},i.prototype.generateTweetText=function(t,e){var i=this.getHtmlStripped("caption");return i=i.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi,""),n(i,e)},i.prototype.resetPreserveFields=["caption","tags"],i.prototype.resetAttributes=["service","url","preuploadUrl","trackTitle","trackArtist","trackAlbum","confirmTos","preuploadAlbumArt","albumArt","copyrightFallback"],i.prototype.parseForType=function(t,e,i){i.service&&"direct"!==i.service||(e.url=i.audio_url),delete e.audio_url,e.albumArt=i.audio_artwork,delete e.audio_artwork;var s=i.id3_tags||{};return delete e.id3_tags,e.trackTitle=s.Title||"",e.trackArtist=s.Artist||"",e.trackAlbum=s.Album||"",e},i.prototype.serializeForServer=function(t){var e=t.apply(this,s.rest(arguments)),i={"id3_tags[title]":this.get("trackTitle")||null,"id3_tags[artist]":this.get("trackArtist")||null,"id3_tags[album]":this.get("trackAlbum")||null,preuploaded_url:this.get("preuploadUrl"),confirm_tos:this.get("confirmTos"),artwork_pre_upload:this.get("preuploadAlbumArt"),album_art:this.get("albumArt"),remove_album_art:"edit"===this.get("mode")&&s.isEmpty(this.get("albumArt")),copyright_fallback:this.get("copyrightFallback")};return s.extend(e,s.pick(i,function(t){return!s.isUndefined(t)})),s.isEmpty(e.preuploaded_url)||(e["post[three]"]=null),e},i.prototype.validate=function(t,e){var i=[];return s.isEmpty(e.url)?i.push(o("Please choose an audio source before continuing.")):e.preuploadUrl?e.confirmTos||i.push(o("You must agree that you have permission to share this file.")):s.isEmpty(e.url)&&i.push(o("Please choose an audio source before continuing.")),t.call(this,e,{errors:i})},e.exports=i},{"../utils/string_helpers":187,lodash:"K2RcUv","prima/lib/translate":456}],103:[function(t,e){"use strict";function i(){}var s=t("lodash"),o=t("../utils/string_helpers").truncateLongStrings;i.prototype.genericFieldMap={one:"title",two:"chat"},i.prototype.typeAttributes={title:"",chat:""},i.prototype.generateTweetText=function(t,e){var i,n=this.getHtmlStripped("title"),a=this.getHtmlStripped("chat");return i=n&&a?s.sprintf("%s - %s",n,a):n||a||"",o(i,e)},i.prototype.validate=function(t,e){var i=[];return(!e.chat||e.chat.length<1)&&i.push("No chat."),t.call(this,e,{errors:i})},i.prototype.serializeForServer=function(t){var e=this,i=t.apply(this,s.rest(arguments));return i["post[two]"]=e.get("chat").replace(/\u00A0/gm," "),i},e.exports=i},{"../utils/string_helpers":187,lodash:"K2RcUv"}],104:[function(t,e){"use strict";function i(){}var s=t("lodash"),o=t("prima/utils/url"),n=t("../utils/string_helpers").truncateLongStrings,a=t("../utils/validation");i.prototype.genericFieldMap={one:"title",two:"url",three:"caption",thumbnail:"thumbnail",excerpt:"excerpt",author:"author"},i.prototype.typeAttributes={title:"",url:"",caption:"",excerpt:"",author:""},i.prototype.generateTweetText=function(t,e){var i=this.getHtmlStripped("title"),a=this.getHtmlStripped("url"),r=this.getHtmlStripped("caption");r=r.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi,"");var l;return l=i&&r?s.sprintf("%s - %s",i,r):i||r||o.parseUrl(a).host||"",n(l,e)},i.prototype.editorField="three",i.prototype.typeAttributes={title:"",url:"",excerpt:"",author:""},i.prototype.resetPreserveFields=["caption","tags"],i.prototype.resetAttributes=["title","url","thumbnail","excerpt","author"],i.prototype.softReset=function(t){t.apply(this,s.rest(arguments)),s.isEmpty(this.get("thumbnail"))||"new"===this.get("mode")||this.set("remove_thumbnail",1)},i.prototype.serializeForServer=function(t){var e=t.apply(this,s.rest(arguments));return this.get("remove_thumbnail")&&(e.remove_thumbnail=this.get("remove_thumbnail")),s.extend(e,{author:this.getAttributeFromGeneric("author"),excerpt:this.getAttributeFromGeneric("excerpt")}),e},i.prototype.validate=function(t,e){var i=[];return e.loading&&i.push("Loading OpenGraph data."),(!e.url||e.url.length<1)&&i.push("No url."),a.isUrl(e.url)||i.push("Not a valid URL"),t.call(this,e,{errors:i})},e.exports=i},{"../utils/string_helpers":187,"../utils/validation":188,lodash:"K2RcUv","prima/utils/url":494}],105:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/model"),o=s.extend({defaults:{fetchOptions:{url:"/svc/mention",with_form_key:!0},suggestCache:{},queryHistory:[],maxCacheSize:20,maxSuggests:5,blogSuggestions:{}},fetch:function(t){"query"in t&&"success"in t&&i.isFunction(t.success)||console.error("Mention must be provided a query and a success callback.");var e=t.query;if(i.extend(t,this.get("fetchOptions")),e in this.get("suggestCache")){var o=this.get("suggestCache")[e];return this.set("blogSuggestions",o),t.success.call(this,this,o,t)}return t.data={q:e},s.prototype.fetch.call(this,t)},parse:function(t,e){var i=this._processQueryResults(t,e);return this._cacheQueryResults(i,e),i},_processQueryResults:function(t,e){var s=e.query;return i.extend(t,{queryRegex:this._escapeRegex(s)})},_cacheQueryResults:function(t,e){var s=i.clone(this.get("suggestCache")),o=i.clone(this.get("queryHistory"));s[e.query]=t,o.push(e.query),i.size(s)>this.get("maxCacheSize")&&(delete s[o[0]],o.shift()),this.set("suggestCache",s),this.set("queryHistory",o)},_escapeRegex:function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|\~\`\!\@\#]/g,"\\$&")}});e.exports=o},{lodash:"K2RcUv","prima/model":471}],106:[function(t,e){"use strict";function i(){}var s=t("lodash"),o=t("../utils/string_helpers").truncateLongStrings;i.prototype.genericFieldMap={one:"ask",two:"answer",three:"caption"},i.prototype.editorField="three",i.prototype.typeAttributes={ask:"",answer:"",caption:""},i.prototype.generateTweetText=function(t,e){return o(this.getHtmlStripped("ask"),e)},i.prototype.parseForType=function(t,e){return e.ask=s.escape(e.ask),e},i.prototype.validate=function(t,e){var i=[];return e.ask||i.push("Post question empty."),t.call(this,e,{errors:i})},e.exports=i},{"../utils/string_helpers":187,lodash:"K2RcUv"}],107:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/model"),n=t("prima/utils/image/loader"),a=t("prima/utils/image/filereader"),r=t("prima/utils/image/canvas"),l=1080,h=o.extend({defaults:{url:"",preuploadUrl:"",externalUrl:"",file:null,photoRaw:null,base64:null,isSelfie:!1,isSelfieGif:!1,width:null,height:null,caption:"",id:""},initialize:function(){this.on("change:externalUrl",function(t,e){e&&this.readUrl(e),this.set({preuploadUrl:null,base64:null})},this),this.get("externalUrl")&&!this.get("base64")&&this.trigger("change:file",this,this.get("file")),this.on("change:file",function(t,e){e&&this.readFile(e),this.set({externalUrl:null,base64:null})},this),this.get("file")&&!this.get("base64")&&this.trigger("change:file",this,this.get("file"))},readUrl:function(t,e){e||(e="photo:readUrl"),n.load(t).then(i.bind(function(t){this.set({url:t.src,width:t.width,height:t.height}),this.trigger(e,!0,this)},this),i.bind(function(i){this.set({url:t,width:null,height:null}),this.trigger(e,!1,this)},this))},readFile:function(t){return a.canReadFiles()?void a.read(t).then(i.bind(function(t){if(!t.file.type.match(/image\/(jpg|jpeg|png)/i))return this.readUrl(t.objectUrl||t.base64,"photo:readFile");var e=s("<img/>");e.attr("src",t.objectUrl||t.base64),n.load(t.objectUrl||t.base64).then(i.bind(function(i){var s=r.drawScaledAndRotated(e,i.width,i.height,t.rotation,t.mirrored,l);return this.readUrl(s.toDataURL(t.file.type),"photo:readFile")},this))},this),i.bind(function(){this.trigger("photo:readFile",!1,this)},this)):void this.trigger("photo:readFile",!1,this)},getDisplayUrl:function(){return this.get(this.get("preuploadUrl")?"preuploadUrl":this.get("externalUrl")?"externalUrl":this.get("base64")?"base64":"url")},getUploadUrl:function(){return this.get("preuploadUrl")?this.get("preuploadUrl"):this.get("externalUrl")?this.get("externalUrl"):""},toJSON:function(){var t=o.prototype.toJSON.apply(this,arguments);return t.displayUrl=this.getDisplayUrl(),t.uploadUrl=this.getUploadUrl(),t}});e.exports=h},{jquery:"HlZQrA",lodash:"K2RcUv","prima/model":471,"prima/utils/image/canvas":486,"prima/utils/image/filereader":487,"prima/utils/image/loader":488}],108:[function(t,e){"use strict";function i(){}var s=t("lodash"),o=t("../collections/photos"),n=t("../utils/string_helpers").truncateLongStrings;i.prototype.genericFieldMap={two:"caption",three:"linkthrough"},i.prototype.editorField="two",i.prototype.typeAttributes={caption:"",layout:"",linkthrough:"",photos:[]},i.prototype.generateTweetText=function(t,e){var i=this.getHtmlStripped("caption");return i=i.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi,""),n(i,e)},i.prototype.MAX_IMAGES=10,i.prototype.resetPreserveFields=["caption","tags"],i.prototype.afterDelegate=function(t){t.apply(this,s.rest(arguments)),this.photos=new o(this.attributes.photos,{parse:!0}),this.on("change:photos",function(t,e){this.photos.reset(e,{parse:!0}),delete this.attributes.photos},this),this.trigger("change:photos",this,this.get("photos")),this.listenTo(this.photos,"add remove change:preuploadUrl change:externalUrl",function(){this.trigger("validate")})},i.prototype.parseForType=function(t,e,i){return e.layout=i.photoset_layout,delete e.photoset_layout,e},i.prototype.serializeForServer=function(t){var e=this,i=t.apply(this,s.rest(arguments));return s.forEach(this.photos.toJSON(),function(t){i["images["+t.id+"]"]=t.uploadUrl,i["caption["+t.id+"]"]=(t.caption||"").substr(0,200),t.photoRaw&&(i.photo_raw=t.photoRaw,i.is_selfie_gif=t.isSelfieGif,i.is_selfie=t.isSelfie)}),i["post[photoset_layout]"]=e.get("layout"),i["post[photoset_order]"]=this.photos.pluck("id").join(","),i},i.prototype.canAddPhotos=function(){return this.photos.length<this.MAX_IMAGES},i.prototype.validate=function(t,e){var i=[];0===this.photos.length&&i.push("No photos specified.");var s=this.photos.all(function(t){return t.getUploadUrl()||!t.has("upload")});return s||i.push("Uploads in progress."),t.call(this,e,{errors:i})},e.exports=i},{"../collections/photos":98,"../utils/string_helpers":187,lodash:"K2RcUv"}],109:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/model"),o=t("prima/mixins/delegator"),n=t("./text_post"),a=t("./photo_post"),r=t("./quote_post"),l=t("./link_post"),h=t("./chat_post"),d=t("./audio_post"),c=t("./video_post"),u=t("./note_post"),p=t("../utils/bool_tool"),m=t("../utils/string_helpers"),g=t("prima/utils/url"),f=t("../utils/validation"),_=s.extend({mixins:[o],typeDelegateMap:{text:n,photo:a,quote:r,link:l,chat:h,audio:d,video:c,note:u},_VALID_STATES:{published:"0",draft:"1",queued:"2",scheduled:"on.2","private":"private",unapproved:"0 3",transcoding:"4"},_FORMAT_CODE_TO_EDITOR_TYPE:{0:"rich",1:"html",2:"markdown"},_STATE_CODE_TO_TEXT:{0:"published","0 3":"published",1:"draft",2:"queued",3:"unapproved",4:"transcoding","on.2":"scheduled","private":"private"},defaults:{allow_photo_replies:Boolean(),postDate:String(),customUrl:String(),sourceUrl:String(),state:"published",editorType:"rich",tags:[],publish_on:String(),tumblelog:String(),uploading:!1,mode:"new",contentStats:{},loading:!1},shortUrlLength:29,typeAttributes:{},editorField:!1,resetPreserveFields:[],resetAttributes:[],_syntheticAttributes:{pseudoState:function(){var t=this.get("state"),e=this.get("publish_on");return"published"===t&&1===parseInt(this.get("is_private"),10)&&(t="private"),"queued"===t?i.isEmpty(e)?"queued":"scheduled":t},formattedSourceUrl:function(){var t,e=this.get("sourceUrl");return i.isEmpty(e)?"":(t=g.addProtocolIfMissing(e,"http:"),f.isUrl(t)?t:e)}},initialize:function(t){i.has(t,"tags")||this.set("tags",[]),this._assignPostTypeFunctionality()},_assignPostTypeFunctionality:function(){var t=this.get("type"),e=i.bind(function(t){return t in this.typeDelegateMap?this.typeDelegateMap[t].prototype:!1},this);t?(this.delegateObject(e(t)),this.afterDelegate()):this.listenToOnce(this,"change:type",function(t,i){this.delegateObject(e(i)),this.afterDelegate()})},afterDelegate:function(){i.defaults(this.attributes,this.typeAttributes)},_normalizeType:function(t,e){var s={regular:"text",conversation:"chat"};return e===!1&&(s=i.invert(s)),t in s?s[t]:t},get:function(t){return(this._syntheticAttributes[t]||s.prototype.get).apply(this,arguments)},getHtmlStripped:function(t,e,s){return"undefined"!=typeof e||(e=!0),"undefined"!=typeof s||(s=" "),i.trim(m.stripHtml(this.get(t)||"",e,s))},fetch:function(t){var e={data:t};return s.prototype.fetch.call(this,e)},parse:function(t,e){if(e.parse===!1)return this.attributes;var s=t.post,o=e.data,n={},a=s.id?"edit":"reblog";n.type=this._normalizeType(s.type,!0),n.can_reblog_as=i.map(s.can_reblog_as,i.bind(function(t){return this._normalizeType(t,!0)},this)),this.set("type",n.type),i.forEach(this.genericFieldMap,function(t,e){n[t]=s[e]});var r=["one","two","three","state","publish_on","tags","type","can_reblog_as"];return i.extend(n,i.omit(s,r),{createdPost:!!t.created_post,postTumblelog:t.post_tumblelog||{},postContextPage:t.post_context_page}),"edit"===a?(n["post-id"]=s.id,n.tags=s.tags?s.tags.split(","):[],n.tumblelog=n.postTumblelog.name_or_id||!1):"reblog"===a&&i.extend(n,i.pick(o,["reblog_id","reblog_key"])),"state"in s&&(n.state=this._extractState(s)),s.from_app&&1===i.parseInt(s.format)||(n.editorType=this._FORMAT_CODE_TO_EDITOR_TYPE[i.parseInt(s.format||0)]),n.editorType||(n.editorType=this.get("editorType")||this._FORMAT_CODE_TO_EDITOR_TYPE[0]),i.has(s,"custom_tweet")&&(n.customTweet=s.custom_tweet),i.extend(n,{sourceUrl:n.source_url||"",htmlEdited:"rich"!==n.format&&!(this.editorField&&!s[this.editorField]),postDate:n.date||"",customUrl:n.slug||""},i.mapValues(i.pick(n,["allow_answers","allow_photo_replies","html_mode"]),p)),"edit"!==a||"queued"!==n.state||i.isEmpty(s.publish_on)||(n.state="scheduled",n.publish_on=s.publish_on),this.parseForType(n,s)},parseForType:function(t){return t},sync:function(t,e,o){var n={create:"/svc/post/update",read:"/svc/post/fetch",update:"/svc/post/update"};return i.defaults(o||(o={}),{emulateHTTP:!0,forServer:!0,url:n[t]}),o.parse="read"===t,s.prototype.sync.call(this,t,e,o)},toJSON:function(t){return t=i.defaults(t||{},{forServer:!1}),t.forServer?this.serializeForServer(t):s.prototype.toJSON.call(this,t)},serializeForServer:function(){var t=this,e=t.attributes,s={channel_id:e.tumblelog,post_id:e["post-id"],"post[date]":e.postDate,"post[one]":this.getAttributeFromGeneric("one"),"post[publish_on]":e.publish_on,"post[slug]":e.customUrl,"post[tags]":e.tags.join(),"post[two]":this.getAttributeFromGeneric("two"),"post[three]":this.getAttributeFromGeneric("three"),thumbnail:this.getAttributeFromGeneric("thumbnail"),editor_type:e.editorType,send_to_twitter:e.send_to_twitter,custom_tweet:e.customTweet,send_to_fbog:e.send_to_fbog,loggingData:e.loggingData,allow_photo_replies:e.allow_photo_replies,content_stats:e.contentStats};"edit"===e.mode&&(s.edit_post_id=e["post-id"]),s["post[source_url]"]=t.get("formattedSourceUrl"),s["post[state]"]=t._VALID_STATES[e.state],s["post[type]"]=this._normalizeType(e.type,!1);var o={reblog:e.is_reblog,reblog_key:e.reblog_key,reblog_post_id:e.reblog_id,pt:e.pt,remove_reblog_tree:e.remove_reblog_tree,reblog_source:e.reblogSource};i.extend(s,i.pick(o,function(t){return!i.isUndefined(t)})),e.allow_answers&&(s.allow_answers="on"),this.getAttributeFromGeneric("thumbnail")&&(s.thumbnail_pre_upload="1");var n=this.getContextPage();return i.extend(s,{context_id:e.tumblelog,context_page:n,"is_rich_text[one]":"0","is_rich_text[two]":"0","is_rich_text[three]":"0"}),this.editorField&&(s["is_rich_text["+this.editorField+"]"]="1"),e.reblogActionContext&&(s.reblog_source=e.reblogActionContext),e.shareData&&i.isObject(e.shareData)&&(e.shareData.canonicalUrl=s["post[source_url]"],s.share_data=e.shareData),s
},validate:function(t,e){var s="errors"in e?e.errors:[];return t.state&&(i.has(this._VALID_STATES,t.state)||s.push('Invalid "state" value')),i.each(this.defaults,function(e,i){typeof e!=typeof t[i]&&s.push('Invalid "'+i+'" type. Expected '+typeof e+", got "+typeof t[i]+".")}),s.length?s:void 0},_extractState:function(t){var e=this._STATE_CODE_TO_TEXT[t.state];return 1===parseInt(t.is_private,10)&&(e="private"),e},findBlogChannelByName:function(t){return this.attributes.tumblelog&&this.attributes.tumblelog.collection&&"findWhere"in this.attributes.tumblelog.collection?this.attributes.tumblelog.collection.findWhere({name_or_id:t}):void 0},getPreservedData:function(){return this.resetPreserveFields.some(i.bind(function(t){return this.get(t)&&this.get(t).length>0},this))},softReset:function(){i.forEach(this.resetAttributes,function(t){i.has(this.typeAttributes,t)?this.set(t,this.typeAttributes[t]):i.has(this.defaults,t)?this.set(t,this.defaults[t]):this.unset(t)},this)},getLookupData:function(){return"reblog"===this.get("mode")?{reblog_id:this.get("reblog_id"),reblog_key:this.get("reblog_key"),post_type:this.get("type")}:void 0},getContextPage:function(){var t=this.attributes,e="dashboard";return t.contextData&&"baseRoute"in t.contextData&&(e=t.contextData.baseRoute.split("/").pop()),e},getAttributeFromGeneric:function(t){return this.get(this.genericFieldMap[t])},getTweetText:function(){var t=this.get("customTweet");return i.isString(t)||(t=this.generateTweetText(140-this.shortUrlLength-1),t?t+=" [URL]":t="[URL]"),t},getTweetTextLength:function(t){i.isString(t)||(t=this.getTweetText()),t=i.trim(t).replace(/([^\s])\[URL\]/gi,"$1 [URL]").replace(/\[URL\]([^\s])/gi,"[URL] $1");var e=t.length;return e+=(this.shortUrlLength-5)*(t.match(/\[URL\]/gi)||"").length},generateTweetText:function(){return""},canEditMedia:function(){return!this.get("is_reblog")},isReblog:function(){return!!this.get("is_reblog")},allowsReblogAs:function(){var t=[this.get("type")],e=this.get("can_reblog_as")||t;return"reblog"===this.get("mode")&&i.difference(e,t).length?!0:!1},allowsTypeSwitch:function(){return!1},deepHasChanged:function(t){var e=this.toJSON(),s=this.get("mode"),o=i.keys(t),n=i.keys(e);if(i.isEqual(t,e))return!1;if("new"!==s)return!0;var a=i.difference(n,o),r=i.reduce(a,function(t,s){var o=e[s],n=i.isUndefined(o)||i.isNull(o)?0:o.length;return t+n},0);return r>0?!0:(t=i.omit(t,a),e=i.omit(e,a),!i.isEqual(t,e))}});e.exports=_},{"../utils/bool_tool":179,"../utils/string_helpers":187,"../utils/validation":188,"./audio_post":102,"./chat_post":103,"./link_post":104,"./note_post":106,"./photo_post":108,"./quote_post":110,"./text_post":114,"./video_post":115,lodash:"K2RcUv","prima/mixins/delegator":460,"prima/model":471,"prima/utils/url":494}],110:[function(t,e){"use strict";function i(){}var s=t("lodash"),o=t("../utils/string_helpers").truncateLongStrings;i.prototype.genericFieldMap={one:"quote",two:"source"},i.prototype.typeAttributes={quote:"",source:""},i.prototype.generateTweetText=function(t,e){var i=this.getHtmlStripped("quote"),n=this.getHtmlStripped("source");n=n.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi,"");var a;return a=n&&i.length+(n.length>1?7:6)<=e?a=s.sprintf("“%s” - %s",i,n):i?s.sprintf("“%s”",o(i,e-2)):n,o(a,e)},i.prototype.editorField="two",i.prototype.validate=function(t,e){var i=[];return(!e.quote||e.quote.length<1)&&i.push("No quote."),t.call(this,e,{errors:i})},e.exports=i},{"../utils/string_helpers":187,lodash:"K2RcUv"}],111:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/model"),o=s.prototype,n=t("../collections/search-images"),a=function(t,e,i){this.name="EmbedError",this.message=t,this.input=e,this.data=i,this.stack=(new Error).stack},r=s.extend({idAttribute:"query",url:"/svc/search/inline_gif",initialize:function(){this.media=new n},fetch:function(t){return t=i.extend({type:"POST",with_form_key:!0,data:{q:this.get("query")}},t),o.fetch.call(this,t)},parse:function(t,e){if(e&&e.xhr&&(t=(t||{}).response),i.isEmpty(t))throw new a("Invalid GIF search response",this.get("query"),t);return this.media.reset(t.media),delete t.media,t.ts=i.now(),t},toJSON:function(){var t=o.toJSON.apply(this,arguments);return t.media=this.media?this.media.toJSON():[],t}});e.exports=r},{"../collections/search-images":100,lodash:"K2RcUv","prima/model":471}],112:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/model"),o=t("../utils/camelize_keys"),n=s.extend({defaults:{mediaUrl:"",postUrl:"",rootPostUrl:"",rootPostUrlHash:"",rootBlog:"",rootBlogUrl:"",rootBlogKey:"",width:0,height:0},initialize:function(t){this.attributes={},this.set(i.defaults(o(t||{}),this.defaults))}});e.exports=n},{"../utils/camelize_keys":180,lodash:"K2RcUv","prima/model":471}],113:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/model"),o=s.extend({defaults:{fetchOptions:{url:"/svc/tag_suggest",with_form_key:!0},suggestCache:{},queryHistory:[],maxCacheSize:20,maxSuggests:5,tagSuggestions:{}},initialize:function(t){if(!1==("user"in t&&"post"in t))throw new Error("Tag Suggestions must be provided user and post models.")},fetch:function(t){return"query"in t&&"success"in t&&i.isFunction(t.success)||console.error("TagSuggestion must be provided a query and a success callback."),i.extend(t,this.get("fetchOptions")),t.query in this.get("suggestCache")?(this.set("tagSuggestions",this.get("suggestCache")[t.query]),t.success.call(this,this,"suggestCache",t)):(t.data={q:t.query},s.prototype.fetch.call(this,t))},parse:function(t,e){var i=this.get("user"),s=this.get("post").get("tumblelog"),o={suggestions:"tags"in t?t.tags:[],userTags:s?i.getChannelProperty(s,"tags"):[]};return o.userTags||(o.userTags=[]),o=this._processQueryResults(o,e),this._cacheQueryResults(o,e),{tagSuggestions:o}},_processQueryResults:function(t,e){var s=new RegExp(this._escapeRegex(e.query),"i");return t.suggestions=i.compact(i.map(t.suggestions,function(t){return t.tag})).slice(0,this.get("maxSuggests")),t.userTags=i.compact(i.filter(t.userTags,function(t){return s.test(t)})).slice(0,this.get("maxSuggests")),t},_cacheQueryResults:function(t,e){var s=i.clone(this.get("suggestCache")),o=i.clone(this.get("queryHistory"));s[e.query]=t,o.push(e.query),i.size(s)>this.get("maxCacheSize")&&(delete s[o[0]],o.shift()),this.set("suggestCache",s),this.set("queryHistory",o)},_escapeRegex:function(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}});e.exports=o},{lodash:"K2RcUv","prima/model":471}],114:[function(t,e){"use strict";function i(){}var s=t("lodash"),o=t("../utils/string_helpers").truncateLongStrings;i.prototype.genericFieldMap={one:"title",two:"body"},i.prototype.editorField="two",i.prototype.typeAttributes={title:"",body:""},i.prototype.generateTweetText=function(t,e){var i=this.getHtmlStripped("title"),n=this.getHtmlStripped("body");n=n.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi,"");var a;return a=i&&n?s.sprintf("%s - %s",i,n):i||n||"",o(a,e)},i.prototype.validate=function(t,e){var i=[],o=!s.isUndefined(e.reblog_tree)&&e.reblog_tree!==!1&&""!==e.reblog_tree,n=o&&e.remove_reblog_tree===!0;return(!e.body||e.body.length<1)&&(!e.title||e.title.length<1)&&(!o||o&&n)&&i.push("Post body empty."),t.call(this,e,{errors:i})},e.exports=i},{"../utils/string_helpers":187,lodash:"K2RcUv"}],115:[function(t,e){"use strict";function i(){}var s=t("lodash"),o=t("prima/lib/translate"),n=t("../utils/remap_keys"),a=t("../utils/camelize_keys"),r=t("../utils/string_helpers").truncateLongStrings;i.prototype.genericFieldMap={one:"embedCode",two:"caption"},i.prototype.editorField="two",i.prototype.resetPreserveFields=["caption","tags"],i.prototype.resetAttributes=["preuploadUrl","preuploadKey","embedCode","confirmTos","copyrightFallback"],i.prototype.typeAttributes={caption:"",confirmTos:!1},i.prototype.generateTweetText=function(t,e){var i=this.getHtmlStripped("caption");return i=i.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi,""),r(i,e)},i.prototype.validate=function(t,e){var i=[];return e.embedCode?0===e.embedCode.length&&i.push("No embed specified."):e.preuploadUrl?e.confirmTos||i.push(o("You must agree that you have permission to share this file.")):e.video?0===e.video.embed_code.length&&i.push("Direct embed missing."):i.push("No video specified."),t.call(this,e,{errors:i})},i.prototype.serializeForServer=function(t){var e=t.apply(this,s.rest(arguments)),i=s.omit({preuploaded_url:this.get("preuploadUrl"),preuploaded_ch:this.get("preuploadKey"),confirm_tos:this.get("confirmTos"),copyright_fallback:this.get("copyrightFallback")},s.isUndefined);return s.extend(e,i),e=n(e,"snake",["embedCode"])},i.prototype.getEmbedData=function(){var t=!1;return this.has("video")?(t=a(this.get("video")),t={isNativeVideo:!0,embedRenderContext:"inline",width:t.dimensions.width,height:t.dimensions.height,previewIframe:t.previewIframe,embedCode:t.embedCode}):this.has("video_embed")&&(t=a(this.get("video_embed"))),t},e.exports=i},{"../utils/camelize_keys":180,"../utils/remap_keys":185,"../utils/string_helpers":187,lodash:"K2RcUv","prima/lib/translate":456}],116:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("backbone"),n=function(){var t=4,e=["spotify","soundcloud","bandcamp"],n=["spotify","soundcloud"],a={},r=[],l=10,h={normalizeResults:function(t,e,s){var o={service:t};switch(t){case"spotify":return i.extend(o,{tracks:i.map(i.first(e.tracks.items,s),function(t){return{primary:t.name,secondary:i.first(t.artists).name,info:t.album.name,href:t.uri,id:t.uri}})});case"soundcloud":return i.extend(o,{tracks:i.map(i.first(e,s),function(t){return{primary:t.title,secondary:t.user.username,info:null,href:t.permalink_url,id:t.id}})});case"youtube":return i.extend(o,{tracks:i.map(i.first(e.items,s),function(t){return{primary:t.snippet.title,secondary:t.snippet.channelTitle,info:null,href:"https://www.youtube.com/watch?v="+t.id.videoId,id:t.id.videoId}})});default:throw"Invalid service: "+t}},getServiceByUrl:function(t){var e={spotify:/(open\.spotify\.com|spotify)[\/|:](track|album|artist|playlist|user)[\/|:](.*)?([\d\w]{22})$/,soundcloud:/(http|https):\/\/soundcloud\.com\/[^\/]+\/(sets\/)?[^\/]+\/?$/,bandcamp:/(http|https):\/\/(?:([^\/]+\.)\.bandcamp\.com|[^\/]+\.[^\/]+)\/(track|album)\/[^\/]+$/,direct:/[.](mp3)$/i};for(var i in e)if(e[i].test(t))return i;return!1},getData:function(t,o){if(!i.contains(e,o))return!1;if(t in a){var n=a[t];this._notifyOnDataLookup(t,o,n.data,n.isOK)}else{if("spotify"!==o||!t.match(new RegExp(/[\/:]playlist[\/:]/))){var r=s.ajax({url:"/svc/post/get_"+o+"_data",type:"POST",with_form_key:!0,data:{url:t,service:o}});return r.then(i.bind(function(e){e&&!e.error?this._notifyOnDataLookup(t,o,e,!0):this._notifyOnDataLookup(t,o,e,!1)},this),i.bind(function(e){this._notifyOnDataLookup(t,o,e,!1)},this))}this._notifyOnDataLookup(t,o,{},!0)}},_notifyOnDataLookup:function(t,e,i,s){var o=s?"audioEmbedData:fetched":"audioEmbedData:error";this.trigger(o,t,e,i,s)},_cacheDataLookupResults:function(t,e,s,o){a[t]={data:s,isOK:o},r.push(t),i.size(a)>l&&(delete a[r[0]],r.shift())},search:function(e,o,n){var a=n&&n.maxResults&&i.isNumber(n.maxResults)?n.maxResults:t,r=s.ajax({url:"/search_audio",type:"POST",with_form_key:!0,data:{q:o,audio_search_provider:e}});return r.then(i.bind(function(t){this.trigger("searchResults:fetched",this.normalizeResults(e,t,a))},this),i.bind(function(){this.trigger("searchResults:fetched",{service:e,tracks:[]})},this))}};return function(){this.dataServices=e,this.searchServices=n,i.extend(this,o.Events,h),this.listenTo(this,"audioEmbedData:fetched",this._cacheDataLookupResults),this.listenTo(this,"audioEmbedData:error",this._cacheDataLookupResults)}}();e.exports=n},{backbone:"5kFNoY",jquery:"HlZQrA",lodash:"K2RcUv"}],117:[function(t,e){"use strict";function i(t){var e=c.parseUrl(t);return e&&e.path?e.path.replace(/^\/([^\/]+)\/.*/i,"$1"):""}var s=t("lodash"),o=t("jquery"),n=t("prima/component"),a=t("../utils/dom_stats"),r=t("./embed_data"),l=t("remarkable"),h=new l({html:!0}),d=t("prima/utils/dom"),c=t("prima/utils/url"),u=n.extend({name:"ContentStatsSupport",initialize:function(t){t=t||{},this.model=t.model,this.editor=t.editor,this.dateInitialized=new Date,this.mentionStats={},this.gifSearchStats={},this.editor&&this.editor.mentionSupport&&this.listenTo(this.editor.mentionSupport,"mention:set",this._onSetMention),this.editor&&this.editor.imageSearchSupport&&(this.listenTo(this.editor.imageSearchSupport,"gifSearch:query",this._onGifSearchQuery),this.listenTo(this.editor.imageSearchSupport,"gifSearch:prev gifSearch:next",this._onGifSearchSkip),this.listenTo(this.editor.imageSearchSupport,"gifSearch:accept",this._onGifSearchAccept)),this.contentStats=new a({htmlLength:function(t){return t.html().length},textLength:function(t){return t.text().length},textTools:{hr:"hr",h2:"h2",more:function(t){var e;return t&&(e=t.text())?e.match(/\[\[MORE\]\]/gi)||[]:[]},mentions:"a.tumblelog"},embeds:{selector:"figure.tmblr-embed, figure.tmblr-embed-placeholder",attribute:function(t){var e=t.attr("data-provider");return r.isValidEmbedServiceName(e)?e:"unknown"}},images:{selector:"img",attribute:function(t){var e;return t&&t.attr("src")&&(e=t.attr("src").match(/.+[.](jpg|jpeg|png|gif)([?]|$)/i),e&&e.length>1)?e[1].toLowerCase():"unknown"}},mentions:s.bind(this._getPurgedMentionStats,this),gifs:s.bind(this._getConsolidatedGifStats,this),gifSearch:s.bind(this._getGifSearchStats,this)})},_onSetMention:function(t,e){s.has(t,"name")&&s.has(e,"len")&&!s.has(this.mentionStats,t.name)&&(this.mentionStats[t.name]=e.len,this.mentionStats=this._getPurgedMentionStats(this._getWrappedContentDocument()))},_getPurgedMentionStats:function(t){return s.pick(this.mentionStats,s.map(t.find("a.tumblelog"),o.text))},_ensureGifSearchQueryEntry:function(t){return this.gifSearchStats[t]||(this.gifSearchStats[t]={added:[],skipped:0,searches:0}),this.gifSearchStats[t]},_onGifSearchQuery:function(t){var e=this._ensureGifSearchQueryEntry(t);e.searches++},_onGifSearchSkip:function(t){var e=this._ensureGifSearchQueryEntry(t);e.skipped++},_onGifSearchAccept:function(t,e,s){var o=this._ensureGifSearchQueryEntry(t);o.added.push(s+":"+i(e))},_getAttributionImages:function(t){return s.map(t.find("[data-tumblr-attribution]"),function(t){var e=o(t),s=e.find("img");return e.attr("data-tumblr-attribution")+":"+i(s.attr("src"))})},_getConsolidatedGifStats:function(t){var e=this._getAttributionImages(t),i={searches:0,skipped:0,added:0,kept:0};return s.forEach(this.gifSearchStats,function(t){i.searches+=t.searches,i.skipped+=t.skipped,i.added+=t.added.length,i.kept+=s.intersection(e,t.added).length}),i},_getGifSearchStats:function(t){var e=this._getAttributionImages(t);return s.transform(this.gifSearchStats,function(t,i,o){s.forEach(i.added,function(i){s.contains(e,i)&&(t[i]=o)})},{})},_getContentNode:function(){var t="";return this.model&&this.model.editorField&&(t=this.model.getAttributeFromGeneric(this.model.editorField),"markdown"===this.model.get("editorType")&&(t=h.render(t))),d.nodeFromString(t)},_getWrappedContentDocument:function(){return o(this._getContentNode())},getStats:function(){var t={elapsed:parseInt((new Date-this.dateInitialized)/1e3,10)};return s.extend(t,this.contentStats.parse(this._getWrappedContentDocument())),t}});e.exports=u},{"../utils/dom_stats":181,"./embed_data":118,jquery:"HlZQrA",lodash:"K2RcUv","prima/component":428,"prima/utils/dom":480,"prima/utils/url":494,remarkable:"tJkXfs"}],118:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("when"),n=t("prima/utils/dom"),a=2e3,r=t("prima/class"),a=2e3,l=function(t,e,i){this.name="EmbedError",this.message=t,this.input=e,this.data=i,this.stack=(new Error).stack};l.prototype=new Error;var h=r.extend({constructor:function(t){this.setEmbedRegexes(t||[])},setEmbedRegexes:function(t){this.regexes=t,this.services=i.unique(i.values(t))},isValidEmbedService:function(t){return i.any(this.regexes,function(e,i){return new RegExp(i,"mi").test(t)})},isValidEmbedServiceName:function(t){return i.contains(this.services,t)},getUrlFromEmbedCode:function(t){var e=s(n.nodeFromString(t)),i=e.find("iframe[src], embed[src], script[src]").first(),o=e.find("object[data]").first();return i.attr("src")||o.attr("data")||!1},fetchEmbedData:function(t,e,n){var r=s.ajax({url:"/svc/post/get_video_data",type:"POST",with_form_key:!0,data:JSON.stringify({embed_url:t,embed_width:e})});return o(r).then(function(s){if(i.isEmpty(s)||"false"===s)throw new l("Invalid embed response",t,s);if(s.thumbnail||n)return s;var r=i.bind(this.fetchEmbedData,this,t,e,!0);return o.promise(function(){i.delay(function(){r().then(function(t){return t},function(){return s})},a)})}).catch(function(t){return o.reject(t)})},parseEmbedData:function(t,e){if(!i.isString(t))throw"The input is invalid. Expected a string";var s=i.trim(t);if(this.isValidEmbedService(s))return this.fetchEmbedData(s,e);var n=this.getUrlFromEmbedCode(s);return i.isEmpty(n)?o.reject(new l("Invalid embed code",t)):o.resolve({unsupported:!0,thumbnail:!1,embed_render_context:"blank",url:n,preview_iframe:"",embed_code:t})}});e.exports=new h},{jquery:"HlZQrA",lodash:"K2RcUv","prima/class":426,"prima/utils/dom":480,when:"RG2dij"}],119:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/lib/translate"),n=t("prima/events"),a=t("prima/class"),r=t("prima/mixins/accessor"),l=t("../views/image-search-field"),h=t("../templates/image-search-attribution.tpl"),d=t("../templates/image-search-controls.tpl"),c=t("../collections/search-image-queries"),u=t("prima/utils/image/loader"),p=t("components/abuse-form"),m=t("app/models/post"),g=a.extend({constructor:function(){this.initialize.apply(this,arguments)},defaults:{currentMediaKey:!1,currentImageModel:!1,currentQuery:!1},initialize:function(t){this.options=t=i.extend({},t),i.extend(this,i.pick(t,"editorView","editor","supportImageFlagging")),this.searchImageQueries=new c,this.listenTo(this.searchImageQueries,"search",function(t,e){this.trigger("gifSearch:query",t,e),this.set("currentQuery",t)}),this.listenTo(n,"drawer:open",this._onAbuseFormOpen),this.listenTo(n,"drawer:close",this._onAbuseFormClose),this._addToolbarButton(),this._addMediaHolderEvents(),this.editorView.filtersToModel.push(i.bind(function(t,e){e.find("figure div.image-search-controls").remove()},this))},_addToolbarButton:function(){this.$imageSearchButton=s("<div />",{"class":"control add-gif",tabindex:"0",title:this.options.title,"data-enabled-title":this.options.title}),this.imageSearchField=this.editorView.subViews.imageSearchField=new l({fetchGifs:i.bind(this.searchImageQueries.fetchGifs,this.searchImageQueries),calculateWidth:i.bind(this.calculateWidth,this),returnFocus:i.bind(this.returnFocus,this),hintText:o("Press ENTER"),errorMessages:[o("Nothing there"),o("Nope, nothing"),o("None of that"),o("Found nothing"),o("Didn't find nuthin'"),o("That ain't here"),o("Not a thing")]}),this.listenTo(this.imageSearchField,"searchResults",this._onSearchResults);var t=s('<div data-subview="imageSearchField"></div>');this.editor.inlineControls.addToTray(this.$imageSearchButton,this.options.trayOptions),this.editor.inlineControls.addToTray(t),this.$imageSearchButton.on("click",i.bind(function(){this.prompt("")},this))},_addMediaHolderEvents:function(){var t=this.editor.config.mediaHolderEvents;s(this.editor.element).on("click",".media-holder figure .tmblr-attribution a",function(t){t.metaKey||(t.preventDefault(),t.stopPropagation())});var e=t.mouseup;t.mouseup=i.bind(function(t,i,o){if(e.call(this,t,i,o),o===t.target){var n=s(o),a=n.closest(".image-search-previous, .image-search-next, .image-search-flag"),r=i.find("["+this.editor.config.imgKeyAttr+"]").attr(this.editor.config.imgKeyAttr)||this.get("currentMediaKey");a.is(".image-search-controls .image-search-previous")?this.previousResult(r):a.is(".image-search-controls .image-search-next")?this.nextResult(r):a.is(".image-search-controls .image-search-flag")&&this.flagCurrentImage()}},this);var o=t.keydown;t.keydown=i.bind(function(t,e){o.call(this,t,e);var n=this.get("currentMediaKey"),a=s(this.editor.getAsyncImage(n));if(!i.isEmpty(a)){var r,l=t.which||t.keyCode;switch(l){case 37:t.preventDefault(),t.stopPropagation(),this.previousResult(n);break;case 39:t.preventDefault(),t.stopPropagation(),this.nextResult(n);break;case 46:case 8:t.preventDefault(),t.stopPropagation(),r=e.prevAll("p").last().get(0),this.editor.focus(!0),this.editor.setCursorToEnd(r),e.remove(),this.set("currentMediaKey",!1);break;case 27:t.preventDefault(),t.stopPropagation(),this.returnToInput();break;case 38:t.preventDefault(),t.stopPropagation(),r=e.prevAll("p").last().get(0),this.editor.focus(!0),this.editor.setCursorToEnd(r),this.set("currentMediaKey",!1);break;case 40:case 13:t.preventDefault(),t.stopPropagation(),e.blur(),r=e.nextAll("p").first().get(0),this.editor.focus(!0),this.editor.setCursorToStart(r),this.set("currentMediaKey",!1)}}},this)},_onSearchResults:function(t){t.media.length&&this.updateImageMedia(this.get("currentMediaKey"),t.media.sample(),t.get("query"))},previousResult:function(t,e,i){var o=s(this.editor.getAsyncImage(t)),n=o.parent("figure");e||(e=o.attr("src")),i||(i=n.attr("data-tumblr-search")),i&&(this.updateImageMediaWithPreload(t,this.searchImageQueries.get(i).media.previousFrom(e)),this.trigger("gifSearch:prev",i))},nextResult:function(t,e,i){var o=s(this.editor.getAsyncImage(t)),n=o.parent("figure");e||(e=o.attr("src")),i||(i=n.attr("data-tumblr-search")),i&&(this.updateImageMediaWithPreload(t,this.searchImageQueries.get(i).media.nextFrom(e)),this.trigger("gifSearch:next",i))},flagCurrentImage:function(){var t=this.get("currentImageModel");i.isEmpty(t)||(n.trigger("drawer:resume"),n.trigger("abuseform:open",{post:new m({post_id:t.get("postId"),root_id:t.get("rootPostId"),tumblelog_name:t.get("postBlog"),post_url:t.get("postUrl")}),targetPost:s(this.editor.getAsyncImage(this.get("currentMediaKey"))),mode:p.CONTEXTS.IMAGE}),n.trigger("drawer:suspend"))},addTumblrAttribution:function(t,e,s){if(s.is("figure")){var o=s.filter("[data-tumblr-attribution]"),n=o.children("img").first();if(!i.isEmpty(o)&&!i.isEmpty(n)){var a=(o.attr("data-tumblr-attribution")||"").split(":");if(3!==a.length)return;a.push(o.attr("data-tumblr-search")),a.unshift(o),this.updateTumblrAttribution.apply(this,a)}}},addCarouselControls:function(t,e,s,o){if(s.is("figure")){var n=s.filter("[data-tumblr-search]"),a=n.children("img").first(),r=n.attr("data-tumblr-search");i.isEmpty(n)||i.isEmpty(a)||(this.searchImageQueries.resultCountForQuery(r)&&o.children(".media-button").first().before(d({query:r,supportImageFlagging:this.supportImageFlagging})),o.attr("tabindex",-1).focus(),o.on("blur.blurHook",i.bind(function(){this.isDrawerOpen||(this.trigger("gifSearch:accept",n.attr("data-tumblr-search"),a.attr("src"),n.attr("data-tumblr-attribution")),n.removeAttr("data-tumblr-search"),o.find(".image-search-controls").remove(),this.set("currentMediaKey",!1),o.off(".blurHook"))},this)))}},cleanupMarkup:function(t,e){e.find("figure[data-tumblr-search]").removeAttr("data-tumblr-search"),e.find("figure[data-tumblr-attribution]").children(":not(img)").remove()},updateImageMediaWithPreload:function(t,e){var o=s(this.editor.getAsyncImage(t)),n=o.closest("."+this.editor.config.mediaHolderClass),a=n.find("[data-js-loader]");a.addClass("animate");var r=!1,l=u.load(e.get("mediaUrl")).then(i.bind(function(){r||(this.updateImageMedia(t,e),a.removeClass("animate"))},this,t,e),i.bind(function(){r||a.removeClass("animate")},this));return{key:t,image:e,promise:l,cancel:function(){r=!0}}},updateImageMedia:function(t,e,o,n){!i.isUndefined(n)||(n=!0);var a=i.values(e.pick("rootBlog","rootBlogKey","rootPostUrlHash"));if(this.set("currentImageModel",e),t){var r=s(this.editor.getAsyncImage(t)),l=r.parent("figure");a.unshift(l),a.push(o||l.attr("data-tumblr-search")),this.updateTumblrAttribution.apply(this,a),n&&l.addClass("tmblr-full"),this.editorView.updateImageAttributes(t,e.get("mediaUrl"))}else{var h=this.editor.lastSelection?this.editor.lastSelection.anchorNode:null;this.editorView.insertImageFromUrl(e.get("mediaUrl"),"",{targetNode:h,skipSelectionUpdate:!0}).then(i.bind(function(t){this.set("currentMediaKey",t);var e=s(this.editor.getAsyncImage(t)),i=e.parent("figure");a.unshift(i),a.push(o||i.attr("data-tumblr-search")),this.updateTumblrAttribution.apply(this,a),n&&i.addClass("tmblr-full");var r=i.closest("."+this.editor.config.mediaHolderClass);this.addCarouselControls(this.editor,i.get(0),i,r),this.editorView.updateModelFromEditor()},this))}},updateTumblrAttribution:function(t,e,i,s,o){var n=t.children("img").first();t.attr("data-tumblr-attribution",e+":"+i+":"+s),o?t.attr("data-tumblr-search",o):t.removeAttr("data-tumblr-search"),t.children().not(n).remove(),t.append(h({attributionUrl:"http://tmblr.co/"+s,attributionName:e}))},trayOpened:function(){this.imageSearchField.hide(!0),this.set("currentMediaKey",!1)},trayClosed:function(){this.imageSearchField.hide()},getButton:function(){return this.$imageSearchButton},prompt:function(t){i.isString(t)&&this.imageSearchField.set("query",t),this.imageSearchField.show(),this.trigger("prompt")},calculateWidth:function(){var t=s(this.editor.element),e=t.width(),i=t.offset(),o=this.editor.inlineControls.tray,n=o.offset();return e-(n.left-i.left)},returnFocus:function(){if(this.editorView.inlineControlNode){var t=document.createRange(),e=window.getSelection();t.setStart(this.editorView.inlineControlNode,0),t.collapse(!0),e.removeAllRanges(),e.addRange(t)}this.getButton().focus()},_onAbuseFormOpen:function(){var t=s(":focus");this.isDrawerOpen=!0,this.listenToOnce(n,"abuseform:submitted",this._onAbuseFormSubmitted),this.afterAbuseFormClose=function(){t.focus()}},_onAbuseFormClose:function(){this.stopListening(n,"abuseform:submitted"),this.isDrawerOpen=!1,i.isFunction(this.afterAbuseFormClose)&&(this.afterAbuseFormClose.call(this),this.afterAbuseFormClose=null)},_onAbuseFormSubmitted:function(){var t=this.get("currentQuery");i.isEmpty(t)||(this.searchImageQueries.clearCache(t),this.searchImageQueries.fetchGifs(t,!0).then(i.bind(function(t){t.media.length?this.updateImageMediaWithPreload(this.get("currentMediaKey"),t.media.sample()):this.afterAbuseFormClose=this.returnToInput},this)))},returnToInput:function(){var t=this.get("currentMediaKey"),e=this.get("currentQuery"),o=s("<p><br></p>").get(0),n=s(this.editor.getAsyncImage(t)),a=n.closest("."+this.editor.config.mediaHolderClass);a.replaceWith(o),this.editor.focus(!0),this.editor.setCursorToEnd(o),this.set("currentMediaKey",!1),function(t,e,s){i.delay(function(){t.set("query",e),s.callback.call(s.context)},100)}.call(this,this.imageSearchField,e,this.options.trayOptions.keyboard)}});r.applyTo(g.prototype),e.exports=g},{"../collections/search-image-queries":99,"../templates/image-search-attribution.tpl":133,"../templates/image-search-controls.tpl":134,"../views/image-search-field":199,"app/models/post":299,"components/abuse-form":306,jquery:"HlZQrA",lodash:"K2RcUv","prima/class":426,"prima/events":429,"prima/lib/translate":456,"prima/mixins/accessor":458,"prima/utils/image/loader":488}],120:[function(t,e){"use strict";var i=(t("lodash"),t("jquery")),s=function(){return{uploadImageUrl:function(t,e,s,o){var n=i.ajax({url:"/svc/post/upload_image_url",type:"POST",with_form_key:!0,data:{url:t}});return"function"==typeof e&&n.done(function(i){e.call(null,i,t)}),"function"==typeof s&&n.fail(s),"function"==typeof s&&n.always(o),n}}}();e.exports=s},{jquery:"HlZQrA",lodash:"K2RcUv"}],121:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("backbone"),n=t("../views/inline_embed_field"),a=t("../services/embed_data"),r=(t("prima/lib/logger"),t("prima/lib/translate")),l=t("../utils/camelize_keys"),h="tmblr-embed",d="tmblr-embed-placeholder",c="embed_iframe",u=t("prima/utils/dom"),p=function(){var t={trayOpened:function(){this.checkLimit(),this.inlineEmbedField.hide()},trayClosed:function(){this.inlineEmbedField.hide()},disable:function(){var t=this.$inlineEmbedButton.attr("data-disabled-title");this.isDisabled=!0,this.$inlineEmbedButton.addClass("disabled").attr("title",t).attr("tabindex","-1")},enable:function(){var t=this.$inlineEmbedButton.attr("data-enabled-title");this.isDisabled=!1,this.$inlineEmbedButton.removeClass("disabled").attr("title",t).attr("tabindex","0")},checkLimit:function(){this.isAtLimit()?this.disable():this.enable()},isAtLimit:function(){var t=s(this.editor.element).find("figure."+h+", figure."+d);return t.length>=this.inlineEmbedsPerPost},calculateWidth:function(){var t=s(this.editor.element),e=t.width(),i=t.offset(),o=this.editor.inlineControls.tray,n=o.offset();return e-(n.left-i.left)},returnFocus:function(){if(this.editorView.inlineControlNode){var t=document.createRange(),e=window.getSelection();t.setStart(this.editorView.inlineControlNode,0),t.collapse(!0),e.removeAllRanges(),e.addRange(t)}this.getButton().focus()},insertEmbed:function(t){if(this.editor.inlineControls.isTrayOpen){var e={"class":d,"data-provider":encodeURIComponent(t.service),"data-orig-width":encodeURIComponent(t.widthOrig),"data-orig-height":encodeURIComponent(t.heightOrig),"data-embed-code":encodeURIComponent(t.embedCode)};i.isEmpty(t.url)||(e["data-url"]=encodeURIComponent(t.url));var s=this._buildEmbedFigure(e,t.previewIframe),o=s.get(0);this.editor.insertMedia(o,!1,this.editorView.inlineControlNode,0),this.editor.inlineControls.close(),this.checkLimit()}},submitEmbedCode:function(){var t=i.trim(this.inlineEmbedField.getCurrentValue()||"");if(""===t)return void this.inlineEmbedField._set_field_state_default();var e=this.embedCodeParser(t,this.inlineMediaWidthFull);return e?void e.then(i.bind(function(e){return this.inlineEmbedField.set("embedCode",t),e&&e.embed_render_context&&"inline"===e.embed_render_context?(this.inlineEmbedField._set_field_state_default(),e=l(e),void this.insertEmbed(e)):void this.inlineEmbedField._set_field_state_invalid()},this),function(e){this.inlineEmbedField.set("embedCode",t),this.inlineEmbedField._set_field_state_invalid()}):(this.inlineEmbedField._set_field_state_invalid(),void this.inlineEmbedField.set("embedCode",t))},embedCodeParser:function(t,e){if(this._embedCodeParsing&&this._embedCodeParsing.abortEmbedCodeParse(),!i.isEmpty(i.trim(t))){var s=!1,o=this._parseEmbedCode=a.parseEmbedData(t,e).then(i.bind(function(t){return t},this),function(t){return!1});return o.abortEmbedCodeParse=function(){s=!0},o}},removeEmbedPlaceholders:function(t){var e=u.nodeFromString(t),o=function(t){return i.isEmpty(t)?!1:decodeURIComponent(t)};return s(e).find("figure."+d).each(i.bind(function(t,e){var i=s(e),n=o(i.attr("data-embed-code")),a=i.attr("data-url"),r={"class":h,"data-provider":i.attr("data-provider"),"data-orig-width":i.attr("data-orig-width"),"data-orig-height":i.attr("data-orig-height")};if(a&&(r["data-url"]=a),o(r["data-provider"])&&o(r["data-orig-width"])&&o(r["data-orig-height"])&&n){var l=this._buildEmbedFigure(r,n);i.replaceWith(l)}else i.remove()},this)),e.innerHTML},addEmbedPlaceholders:function(t){var e=this.editorView.hosts.safe_host+"/svc/embed/inline/",o=u.nodeFromString(t),n=function(t){return i.isEmpty(t)?!1:decodeURIComponent(t)};return s(o).find("figure."+h).each(i.bind(function(t,i){var o=s(i),a=o.parents(),r=a&&s(a).filter("blockquote").length>0;if(t<this.inlineEmbedsPerPost){var l={code:o.html(),provider:n(o.attr("data-provider")),url:n(o.attr("data-url")),width:n(o.attr("data-orig-width")),height:n(o.attr("data-orig-height"))},h=r?this.inlineMediaWidthReblog:this.inlineMediaWidthFull,p=Math.ceil(l.height*h/l.width),m=e+encodeURIComponent(l.url?l.url:l.code);m+="?w="+h+"&h="+p;var g={"class":c,src:m,scrolling:"no",frameBorder:"0",allowfullscreen:!0,mozallowfullscreen:!0,webkitallowfullscreen:!0},f=s("<iframe/>",g);f.attr("width",h),f.attr("height",p);var _=u.outerHTML(f.get(0)),v={"class":d,"data-provider":o.attr("data-provider"),"data-orig-width":o.attr("data-orig-width"),"data-orig-height":o.attr("data-orig-height"),"data-embed-code":encodeURIComponent(l.code)};o.attr("data-url")&&(v["data-url"]=o.attr("data-url"));
var b=this._buildEmbedFigure(v,_);o.replaceWith(b)}else o.remove()},this)),this.checkLimit(),o.innerHTML},_buildEmbedFigure:function(t,e){var i=s("<figure/>",t);return e&&i.html(e),this.fullWidthInlineMedia&&i.addClass(this.fullWidthClass),i},getButton:function(){return this.$inlineEmbedButton},prompt:function(){this.checkLimit(),this.isDisabled||(this.inlineEmbedField.show(),this.trigger("prompt"))}},e=function(e){var a;e=e||{},i.extend(this,o.Events,t),this.editorView=e.editorView,this.editor=e.editor,this.inlineEmbedsPerPost=e.inlineEmbedsPerPost,this.inlineMediaWidthReblog=e.inlineMediaWidthReblog,this.inlineMediaWidthFull=e.inlineMediaWidthFull,this.fullWidthInlineMedia=e.fullWidthInlineMedia,this.fullWidthClass=e.fullWidthClass,this.editorView&&this.editor&&(this.$inlineEmbedButton=s("<div />",{"class":"control add-inline-embed",tabindex:"0",title:e.title,"data-enabled-title":e.title,"data-disabled-title":e.disabledTitle}),this.inlineEmbedField=this.editorView.subViews.inlineEmbedField=new n({placeholder:r("Paste a video URL"),submitEmbedCode:i.bind(this.submitEmbedCode,this),calculateWidth:i.bind(this.calculateWidth,this),returnFocus:i.bind(this.returnFocus,this)}),this.inlineEmbedsPerPost>0&&(a=s("<div/>",{"data-subview":"inlineEmbedField"}),this.editor.inlineControls.addToTray(this.$inlineEmbedButton,e.trayOptions),this.editor.inlineControls.addToTray(a.get(0))),this.$inlineEmbedButton.on("click",this.prompt.bind(this)),this.isDisabled=this.isAtLimit())};return e}();e.exports=p},{"../services/embed_data":118,"../utils/camelize_keys":180,"../views/inline_embed_field":201,backbone:"5kFNoY",jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/logger":436,"prima/lib/translate":456,"prima/utils/dom":480}],122:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/events"),n=t("ligature").SelectionContext,a=t("backbone"),r=function(){var t=function(){},e={rangeDebounce:10},r={enterMention:function(e){this.currentMention=e,this.inMention=!0,this.renderGhost(e),this.dropdown.setPinnedTarget(this.editor.element),this.updatePopoverPosition(e),this.trigger("mention:enter"),t("MentionSupport:enterMention - querying server for [%s]",e.string),this.queryServer(e.string)},updateMention:function(e){if(this.inMention&&e.string!==this.currentMention.string){if(!this.isSameMention(e))return this.exitMention(e),void this.enterMention(e);this.currentMention=e,this.inMention=!0,this.renderGhost(e),this.trigger("mention:update"),t("MentionSupport:updateMention - querying server for [%s]",e.string),this.queryServer(e.string)}},exitMention:function(){this.currentMention=!1,this.inMention=!1,this.lastTypeahead="",this.teardownGhost(),this.editor.onChange(),this.trigger("mention:exit")},softConfirm:function(t){var e=h();e.caretPosition===e.offsetEnd&&this.confirmMention(t)},spaceConfirm:function(t){var e=h(),i=this.dropdown.getCurrentBlogChoice();i&&i.name===e.string&&this.confirmMention(t,i)},confirmMention:function(t,e){e=e||this.dropdown.getCurrentBlogChoice(),e&&this.setMention(e)},setMention:function(t){var e=this.lastInfo,i=t.name,s=document.createTextNode("​"),o=document.createElement("a"),n=this.lastSelection;o.setAttribute("class","tumblelog"),o.spellcheck=!1,o.innerHTML=i,e.mentionRange.deleteContents(),e.mentionRange.insertNode(s),e.mentionRange.insertNode(o),e.mentionRange.setStartAfter(s),e.mentionRange.setEndAfter(s),n.removeAllRanges(),n.addRange(e.mentionRange),this.exitMention(e),this.trigger("mention:set",t,e)},linkToMention:function(e){var i,o,a,r=n.getSelection(),l=e.range.commonAncestorContainer.parentElement||s(e.range.commonAncestorContainer).parent().get(0);return this.currentMention!==!1&&this.exitMention(e),l.classList.contains("tumblelog")?(i=document.createRange(),i.selectNode(l),i.deleteContents(),o=document.createTextNode("@"+e.string),i.insertNode(o),a=document.createRange(),r.removeAllRanges(),a.setStart(o,e.caretPosition+1),a.setEnd(o,e.caretPosition+1),r.addRange(a),this.cleanupRangeArea(r,a),t("MentionSupport:linkToMention",e.string),void this.onSelection(r)):!1},abortMention:function(){this.escapeMention=h(),this.inMention&&this.exitMention(this.escapeMention)},isSameMention:function(t){return this.currentMention&&this.currentMention.offsetStart===t.offsetStart},isMentionLink:function(t){var e,i=document.createElement("div"),o=this.adjustRange(t);return o?(i.appendChild(o.cloneContents()),e=s(i).find("a:first"),e.length?e.hasClass("tumblelog"):!1):!1},cleanupRangeArea:function(t,e){var i,o,n=document.createElement("span");n.setAttribute("id","mention_cleanup_placeholder"),n.innerHTML="",e.insertNode(n),this.normalize(t,e),i=e.commonAncestorContainer.parentElement,i||(i=s(e.commonAncestorContainer).parent().get(0)),i.normalize(),1===s(i).length&&(o=s(i).html(),o=o.replace(/[\u200B]/g,""),s(i).html(o));var a=s(document).find("#mention_cleanup_placeholder");a.length>0&&(t.removeAllRanges(),e.selectNode(a.get(0)),e.deleteContents(),t.addRange(e),i.normalize())},adjustRange:function(t){var e,s;return i.isUndefined(t)?!1:(t=t.cloneRange(),e=t.commonAncestorContainer,s=3===e.nodeType?e.parentNode:e,s.textContent===t.toString()&&t.selectNode(s),t)},normalize:function(t,e){this.editor.element.normalize(),null===t||i.isUndefined(e)||(t.removeAllRanges(),t.addRange(e))},renderGhost:function(t){if(this.$ghost=s(document).find("#ui_mention_util_ghost"),!(this.$ghost.length>0)){var e=document.createElement("q");e.setAttribute("id","ui_mention_util_ghost"),e.innerHTML="&#8203;",e.className="mention-ghost",t.suffixRange.surroundContents(e),this.$ghost=s(document).find("#ui_mention_util_ghost"),this.trigger("ghost:render",this.$ghost)}},updatePopoverPosition:function(t){if(i.has(t,"range")){var e=this.getMentionRect(t),o=s(this.editor.element).offset(),n=s(window).scrollTop();this.dropdown.setShift({x:e.left-o.left-10,y:-(e.bottom-o.top+n+10)})}},teardownGhost:function(t){if(t&&t.range||(t=this.lastInfo),this.$ghost=s(document).find("#ui_mention_util_ghost"),0!==this.$ghost.length){var e=this.$ghost.parent().get(0),i=t.caretRange.commonAncestorContainer,o=n.getSelection(0),a=o?o.getRangeAt(0):!1;o&&"ui_mention_util_ghost"===s(i).attr("id")&&(a.selectNode(i),a.deleteContents(),a.collapse(!1)),this.$ghost=s(document).find("#ui_mention_util_ghost"),1===this.$ghost.length&&(this.$ghost.remove(),this.trigger("ghost:teardown")),e&&e.normalize(),o&&a&&(o.removeAllRanges(),o.addRange(a))}},insertGhost:function(t){var e=n.getSelection(0),o=e.getRangeAt(0);this.$ghost=s(document).find("#ui_mention_util_ghost"),0!==this.$ghost.length&&(this.$ghost.html(t),null===e||i.isUndefined(o)||(e.removeAllRanges(),e.addRange(o)))},maintainTypeaheadGhost:function(e,i){var s=this.dropdown.getBlogChoice(0),o=s?s.name:this.lastTypeahead;if(t("MentionSupport:maintainGhost - topSuggestion = %s, typeahead = %s, lastChar = %s",s,o,i),i&&this.lastTypeahead.length&&i===this.$ghost.text().substr(0,1))this.$ghost.text(this.$ghost.text().substr(1));else if(e&&8===e.keyCode){var n=o.substr(this.lastTypeahead.length-this.$ghost.text().length-1);t("MentionSupport:maintainGhost BACKSPACE"),this.$ghost.text(n)}else this.updateTypeahead(o);this.updatePopoverPosition(h())},stripGhost:function(t){if(!t)return t;var e=s("<span>"+t+"</span>");return e.find("#ui_mention_util_ghost").remove(),e.html()},updateTypeahead:function(e){var i=this.currentMention;if(t("MentionSupport:updateTypeahead - typeahead = [%s]",e),this.lastTypeahead=e,!i||!this.inMention||!e)return void this.teardownGhost();var s="";i=i.string;var o=i.toUpperCase(),n=e.toUpperCase();e.length>i.length&&o===n.substr(0,o.length)&&(s=e.substr(i.length,e.length-i.length)),this.insertGhost(s)},updateForInteractive:function(t){var e=this.dropdown.getCurrentBlogChoice();t&&e&&this.updateTypeahead(e.name)},bindEditorCallbacks:function(){this.editor.config.onSelection=i.bind(this.onSelection,this);var t=this.editor.config.onClientEvent||i.noop;this.editor.config.onClientEvent=i.bind(function(e){t(e),this.onClientEvent(e)},this)},setupListeners:function(){this.dropdown.listenTo(this,"editor:cycleUp",this.dropdown.cycleUp),this.dropdown.listenTo(this,"editor:cycleDown",this.dropdown.cycleDown),this.listenTo(this,"editor:abortMention",this.abortMention),this.listenTo(this,"editor:softConfirm",this.softConfirm),this.listenTo(this,"editor:spaceConfirm",this.spaceConfirm),this.listenTo(this,"editor:confirm",this.confirmMention),this.listenTo(this.dropdown,"dropdown:confirm",this.confirmMention),this.dropdown.listenTo(this,"ghost:render",this.dropdown.setPinnedTarget),this.dropdown.listenTo(this,"mention:exit",this.dropdown.teardown),this.listenTo(this.dropdown,"dropdown:render",this.maintainTypeaheadGhost),this.listenTo(this.dropdown,"dropdown:empty",this.exitMention),this.listenTo(this.dropdown,"dropdown:menuInteraction",this.updateForInteractive)},queryServer:function(t){var e={query:t,success:i.bind(this.dropdown.updateMentionDropdown,this.dropdown)};this.mentionModel.fetch(e)},getMentionRect:function(t){if(!(t&&t.range&&"getClientRects"in t.range))return!1;var e=t.range.getClientRects();return i.isUndefined(e[0])?!1:e[0]}},l=function(e,s){i.extend(this,a.Events,r),this.editor=e,this.dropdown=s,this.mentionModel=s.model,this.inMention=!1,this.currentMention=!1,this.escapeMention=!1,this.lastInfo=!1,this.lastSelection=!1,this.$ghost=!1,this.lastTypeahead="",this.debugMode=!1,this.bindEditorCallbacks(),this.setupListeners(),t=i.bind(t,this)},h=function(t){t=t||n.getSelection();var e=function(t){return/[^\-a-z0-9]/i.test(t)},s={isMention:!1,len:0,string:"",stringBefore:"",stringAfter:"",range:!1,mentionRange:!1,suffixRange:!1,caretRange:!1,offsetStart:!1,offsetEnd:!1,caretPosition:!1,caretNode:!1};if(s.caretRange=t&&t.rangeCount>0?t.getRangeAt(0):!1,s.caretRange===!1||s.caretRange.startOffset!==s.caretRange.endOffset)return!1;var o=s.caretRange.commonAncestorContainer;o.normalize(),s.caretNode=1===o.nodeType?o.firstChild:o;var a=null==s.caretNode?"":s.caretNode.nodeValue;if(s.caretPosition=s.caretRange.startOffset,null==a||0===a.length)return!1;for(var r=0,l=0;l<s.caretPosition;l++)e(a.charAt(l))?r=0:r++;s.stringBefore=a.substr(s.caretPosition-r,r);var h=!1;if(s.caretPosition-(r+2)>=0){h=a.substr(s.caretPosition-r-1,1);var d=a.substr(s.caretPosition-r-2,1);i.contains([32,160],d.charCodeAt(0))||(h=!1)}else s.caretPosition-(r+1)>=0&&(h=a.substr(s.caretPosition-r-1,1));for(s.isMention="@"===h,r=0,l=s.caretPosition;l<a.length&&!e(a.charAt(l));l++)r++;return s.stringAfter=a.substr(s.caretPosition,r),s.string=s.stringBefore+s.stringAfter,s.len=s.string.length,s.isMention||0!==s.len&&""!==s.string?(s.range=document.createRange(),s.offsetStart=s.caretRange.startOffset-s.stringBefore.length,s.offsetEnd=s.caretRange.startOffset+s.stringAfter.length,s.range.setStart(s.caretNode,s.offsetStart),s.range.setEnd(s.caretNode,s.offsetEnd),s.isMention?(s.mentionRange=document.createRange(),s.mentionRange.setStart(s.caretNode,s.offsetStart-1),s.mentionRange.setEnd(s.caretNode,s.offsetEnd),s.suffixRange=document.createRange(),s.suffixRange.setStart(s.caretNode,s.caretRange.startOffset+s.stringAfter.length),s.suffixRange.setEnd(s.caretNode,s.caretRange.startOffset+s.stringAfter.length),s):s):!1},d={keydown:{27:"editor:abortMention",38:"editor:cycleUp",40:"editor:cycleDown",39:"editor:softConfirm",32:"editor:spaceConfirm",9:"editor:confirm",13:"editor:confirm"}};return l.prototype.onClientEvent=function(t){o.trigger("richTextEditor:onClientEvent",t,this.editor);var e,i=["keyup","keydown","keypress"];if(this.inMention&&-1!==i.indexOf(t.type)){if(t=t||window.event,e=t.which||t.keyCode,"keydown"===t.type)e in d[t.type]?(this.trigger(d[t.type][e],t),39!==e&&32!==e&&(t.preventDefault(),t.stopImmediatePropagation())):8===e&&this.maintainTypeaheadGhost(t);else if("keyup"===t.type){if(e in d.keydown)return!1}else this.maintainTypeaheadGhost(t,String.fromCharCode(e));var s=h();s&&(this.lastInfo=s)}},l.prototype.onSelection=i.debounce(function(t){var e=h(t);e?(this.escapeMention&&(this.escapeMention.string===e.string?e.isMention=!1:this.escapeMention=!1),this.lastInfo=e,this.lastSelection=t):this.escapeMention=!1,e&&e.isMention===!0?this.inMention&&this.isSameMention(e)?this.updateMention(e):this.enterMention(e):this.inMention?this.exitMention(e):e&&this.isMentionLink(e.range)&&this.linkToMention(e)},e.rangeDebounce),l}();e.exports=r},{backbone:"5kFNoY",jquery:"HlZQrA",ligature:511,lodash:"K2RcUv","prima/events":429}],123:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/class"),n=o.extend({fetchOpenGraphData:function(t){var e=s.ajax({url:"/svc/post/fetch_og",type:"POST",with_form_key:!0,data:{url:t}});return this.xhr=e,e.then(function(t){var e=s.parseJSON(t)||{};return e.response}).always(i.bind(function(){this.xhr=null},this))},abort:function(){this.xhr&&this.xhr.abort()}});e.exports=n},{jquery:"HlZQrA",lodash:"K2RcUv","prima/class":426}],124:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=function(){var t=function(t){if(!i.trim(t.html||""))return i.isFunction(t.done)&&t.done(""),void(i.isFunction(t.always)&&t.always(""));var e=s.ajax({url:"/svc/filter_html_for_dash_preview",type:"POST",with_form_key:!0,data:{html:t.html||"",markdown:t.isMarkdown?1:0}});return i.isFunction(t.done)&&e.done(t.done),i.isFunction(t.fail)&&e.fail(t.fail),i.isFunction(t.always)&&e.always(t.always),e};return{filterForDash:function(e,i,s,o,n){return t({html:e,isMarkdown:i,done:s,fail:o,always:n})},filterHtmlForDash:function(e,i,s,o){return t({html:e,isMarkdown:!1,done:i,fail:s,always:o})},filterMarkdownForDash:function(e,i,s,o){return t({html:e,isMarkdown:!0,done:i,fail:s,always:o})}}};e.exports=o},{jquery:"HlZQrA",lodash:"K2RcUv"}],125:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="album-art--container"><div data-js-albumart class="album-art" style="'+(null==(__t=url?"background-image:url("+url+");":"")?"":_.escape(__t))+'"></div><div data-js-removebutton class="album-art--remove-button"><div class="v-center-outer"><div class="v-center-inner"><span data-js-removebuttontext>'+(null==(__t=__("Remove image"))?"":_.escape(__t))+'</span></div></div></div></div><div data-js-dropzone class="media-dropzone"><div data-js-mediaupload class="media-upload-button"><div class="v-center-outer"><div class="v-center-inner"><div class="dropzone-title"><span data-js-mediauploadtext class="dropzone-text">'+(null==(__t=dropzoneText)?"":_.escape(__t))+'</span></div></div></div><div class="media-upload"><div data-subview="upload"></div></div></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],126:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<label class="binary_switch"><input type="checkbox" id="allowAnswers" type="checkbox" data-js-allowanswerscheckbox> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></label><label class="allow-answers-label" for="allowAnswers">'+(null==(__t=__("Let people answer this"))?"":_.escape(__t))+"</label>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],127:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="note_wrapper" data-name="askField"><div class="note_item"><div class="text"><p class="asker"><span class="name">'+(null==(__t=post.asking_tumblelog.name.toLowerCase())?"":_.escape(__t))+"</span> <span>"+(null==(__t=__("asked"))?"":_.escape(__t))+':</span></p><p class="note_text">'+(null==(__t=post.ask)?"":__t)+'</p></div><div class="nipple"></div></div><div class="avatar"><img src="'+(null==(__t=post.asking_tumblelog.avatar)?"":_.escape(__t))+'" alt="" width="40" height="40"></div></div>',showAnswerField&&(__p+='<div class="note_wrapper" data-name="answerField"><div class="note_item"><div class="text"><p class="answerer"><span class="name">'+(null==(__t=post.answering_tumblelog.name.toLowerCase())?"":_.escape(__t))+"</span> <span>"+(null==(__t=__("answered"))?"":_.escape(__t))+":</span></p>"+(null==(__t=post.answer)?"":__t)+'</div><div class="nipple"></div></div><div class="avatar"><img src="'+(null==(__t=post.answering_tumblelog.avatar)?"":_.escape(__t))+'" alt="" width="40" height="40"></div></div>'),__p+="";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],128:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="media-dropzone" data-js-dropzone><div class="media-upload-button" data-js-mediaupload><div class="v-center-outer"><div class="v-center-inner"><div class="dropzone-icon '+(null==(__t=uploadIcon)?"":_.escape(__t))+'"></div></div></div><div class="media-upload"><div data-subview="upload"></div></div></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],129:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="channel-avatar avatar-container"><a class="avatar-link" href="'+(null==(__t=channel.url)?"":_.escape(__t))+'" target="_blank" title="'+(null==(__t=channel.directory_safe_title)?"":__t)+'" style="background-image: url(\''+(null==(__t=avatarUrl)?"":_.escape(__t))+'\')"><img class="avatar-image" src="'+(null==(__t=avatarUrl)?"":_.escape(__t))+'" alt="'+(null==(__t=channel.name)?"":_.escape(__t))+'"></a></div><div class="primary-avatar avatar-container"><a class="avatar-link" href="'+(null==(__t=primary.url)?"":_.escape(__t))+'" target="_blank" title="'+(null==(__t=primary.directory_safe_title)?"":__t)+'" style="background-image: url(\''+(null==(__t=subavatarUrl)?"":_.escape(__t))+'\')"><img class="avatar-image" src="'+(null==(__t=subavatarUrl)?"":_.escape(__t))+'" alt="'+(null==(__t=primary.name)?"":_.escape(__t))+'"></a></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],130:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<label class="confirm-tos--label" data-name="confirm-tos"><div class="binary_switch"><input class="confirm-tos--checkbox" type="checkbox" name="confirm_tos" data-js-confirmtos> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></div><span class="confirm-tos--text">'+(null==(__t=__("This is my original work, or I %1$shave permission%2$s to post this.",'<a href="/terms-of-service" target="_blank">',"</a>"))?"":__t)+"</span></label>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],131:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="html-mode"><div class="tabs clearfix"><div class="tab src-button" data-js-srcbutton><span class="icon '+(null==(__t=isMarkdown?"markdown":"html")?"":_.escape(__t))+'" data-js-srcicon></span> <span class="tab-label" data-js-srclabel>'+(null==(__t=srcLabel)?"":_.escape(__t))+'</span></div><div class="tab preview-button" data-js-previewbutton><span class="icon"></span> <span class="tab-label" data-js-previewlabel>'+(null==(__t=previewLabel)?"":_.escape(__t))+'</span></div><div class="tab tooltip-container"><span class="icon" data-js-editorhelp></span></div></div><div class="views"><div class="view src-view" data-js-srcview><div data-js-ace></div></div><div class="view preview-view" data-js-previewview><div class="html-preview editor" data-js-htmlpreview></div></div></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],132:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="",_.forEach(id3Fields,function(t,e){__p+='<div class="id3-editor--container '+(null==(__t=id3FieldLabel[e]?"id3-editor--"+id3FieldLabel[e].toLowerCase():"")?"":_.escape(__t))+'"><input name="'+(null==(__t=e)?"":_.escape(__t))+'" value="'+(null==(__t=t)?"":_.escape(__t))+'" class="id3-editor--input" type="text"><label class="id3-editor--label">'+(null==(__t=id3FieldLabel[e]||__(_.capitalize(e)))?"":_.escape(__t))+"</label></div>"}),__p+="";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],133:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<p class="tmblr-attribution"><a href="'+(null==(__t=attributionUrl)?"":_.escape(__t))+'" target="_blank">'+(null==(__t=__("Originally posted by %1$s",attributionName))?"":_.escape(__t))+"</a></p>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],134:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="image-search-controls"><nav><div class="overlay-button image-search-previous"><span class="icon"></span></div><div class="overlay-button image-search-next"><span class="icon"></span></div>',supportImageFlagging&&(__p+='<div class="overlay-button image-search-flag">'+(null==(__t=__("Flag this"))?"":_.escape(__t))+"</div>"),__p+='</nav><div data-js-loader class="Knight-Rider-loader centered"><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],135:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="image-search-input-container"><span class="icon"></span><div data-subview="searchInput"></div><div data-js-searchkeyhint class="image-search-key-hint editor-placeholder '+(null==(__t=query?"image-search-key-hint--visible":"")?"":_.escape(__t))+'">'+(null==(__t=__("Press ENTER"))?"":_.escape(__t))+'</div><div data-subview="loader"></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],136:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="inline-embed-field" data-name="inlineEmbedField"><div data-subview="inlineEmbedInput"></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],137:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="","spotify"===service&&(__p+='<iframe data-js-audioembed src="https://embed.spotify.com/?uri='+(null==(__t=encodeURIComponent(url))?"":_.escape(__t))+'&amp;view=coverart" width="500" height="580" frameborder="0" allowtransparency="true" scrolling="no" class="audio-embed--spotify"></iframe>'),__p+="","soundcloud"===service&&(__p+='<iframe data-js-audioembed src="https://w.soundcloud.com/player/?url='+(null==(__t=encodeURIComponent(url))?"":_.escape(__t))+'&amp;visual=true&amp;liking=false&amp;sharing=false&amp;auto_play=false&amp;show_comments=false&amp;continuous_play=false&amp;origin=tumblr" frameborder="0" allowtransparency="true" scrolling="no" width="500" height="500" class="audio-embed--soundcloud"></iframe>'),__p+="","bandcamp"===service&&(__p+='<iframe data-js-audioembed src="https://bandcamp.com/EmbeddedPlayer/size=medium/bgcol=ffffff/linkcol=0687f5/notracklist=true/transparent=true/'+(null==(__t=type)?"":_.escape(__t))+"="+(null==(__t=id)?"":_.escape(__t))+'/" frameborder="0" allowtransparency="true" scrolling="no" width="500" height="120" class="audio-embed--bandcamp"></iframe>'),__p+="","direct"===service&&(__p+='<div data-js-audioembed class="audio-embed--direct '+(null==(__t=canEditMedia?"audio-embed--direct-editable":"")?"":_.escape(__t))+'"><div data-subview="audioPlayer"></div><div data-subview="id3Editor"></div><div data-subview="albumArtUploader"></div></div>'),__p+="",canEditMedia&&(__p+='<div data-subview="removeButton"></div>'),__p+="";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],138:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div data-js-sortable class="photoset--photo-dragger"></div><div data-js-mediaoverlay class="media-overlay"><div data-js-clickthroughurlbutton class="overlay-button '+(null==(__t=hasClickthroughUrl?"active":"")?"":_.escape(__t))+'"><div class="icon icon_editor_link"></div></div><div data-js-captionbutton class="overlay-button '+(null==(__t=hasCaption?"active":"")?"":_.escape(__t))+'"><div class="icon icon_editor_more"></div></div></div><div data-subview="removeButton"></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],139:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="photobooth-container" data-js-photobooth></div><div class="photoset-container" data-js-photoset></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],140:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="video-container" data-js-video></div>',canEditMedia&&(__p+='<div data-subview="removeButton"></div>'),__p+="";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],141:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="","inline"===embedRenderContext?__p+='<div class="video-preview">'+(null==(__t=previewIframe)?"":__t)+"</div>":(__p+='<div class="video-preview video_preview '+(null==(__t=thumbnail&&thumbnail.url?"has_thumbnail":"no_thumbnail")?"":_.escape(__t))+'">',thumbnail&&thumbnail.url&&(__p+='<img src="'+(null==(__t=thumbnail.url)?"":_.escape(__t))+'" alt="" width="'+(null==(__t=thumbnail.width||"")?"":_.escape(__t))+'" height="'+(null==(__t=thumbnail.height||"")?"":_.escape(__t))+'">'),__p+='<div class="video_info_wrapper"><i class="icon_post_video"></i><div class="video_text"><span class="clippable">'+(null==(__t=__("Watch on %s",tumblelogHostname))?"":_.escape(__t))+'</span> <i class="icon_arrow_carrot_right"></i></div></div></div>'),__p+="";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],142:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="video-error"><div class="v-center-outer"><div class="v-center-inner"><span class="icon"></span> <span class="error-message">'+(null==(__t=__("This video embed stopped working. Try another?"))?"":_.escape(__t))+"</span></div></div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],143:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="media-preview"><div class="v-center-outer"><div class="v-center-inner"><div class="icon '+(null==(__t=icon)?"":_.escape(__t))+'" data-js-previewicon></div><p class="media-preview-text" data-js-previewmessage>'+(null==(__t=message)?"":_.escape(__t))+"</p></div></div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],144:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{}){__p+="";var dropzoneClasses=[];showInput&&dropzoneClasses.push("show-input"),splitDropzone&&dropzoneClasses.push("split-dropzone"),toggleDropzone&&dropzoneClasses.push("toggle-dropzone"),defaultBehavior&&dropzoneClasses.push("toggle-dropzone-"+defaultBehavior),__p+='<div class="media-dropzone '+(null==(__t=dropzoneClasses.join(" "))?"":_.escape(__t))+'" data-js-dropzone><div class="split-cells">',enableUpload&&(__p+='<div class="split-cell media-upload-button" data-js-mediaupload><div class="split-cell-inner"><div class="v-center-outer"><div class="v-center-inner">',uploadIcon&&(__p+='<div class="dropzone-icon '+(null==(__t=uploadIcon)?"":_.escape(__t))+'"></div>'),__p+="",uploadText&&(__p+='<div class="dropzone-title"><span class="dropzone-text" data-js-mediauploadtext>'+(null==(__t=toggleDropzone?dropzoneText:uploadText)?"":_.escape(__t))+"</span>",uploadTooltip&&(__p+='<div class="dropzone-tooltip" data-js-uploadtooltip><span class="icon icon_help" data-show-tooltip="uploadTooltip"></span></div>'),__p+="</div>"),__p+='</div></div></div><div class="media-upload"><div data-subview="upload"></div></div></div>'),__p+="",enableUrl&&(__p+='<div class="split-cell media-url-button" data-js-mediaurl><div class="split-cell-inner"><div class="v-center-outer"><div class="v-center-inner">',urlIcon&&(__p+='<div class="dropzone-icon '+(null==(__t=urlIcon)?"":_.escape(__t))+'"></div>'),__p+="",urlText&&(__p+='<div class="dropzone-title"><span class="dropzone-text" data-js-mediaurltext>'+(null==(__t=toggleDropzone?dropzoneText:urlText)?"":_.escape(__t))+"</span>",urlTooltip&&(__p+='<div class="dropzone-tooltip" data-js-urltooltip><span class="icon icon_help" data-show-tooltip="urlTooltip"></span></div>'),__p+="</div>"),__p+='</div></div></div><div class="media-url-cropper media-dropzone-cropper"><div class="media-url"><div class="v-center-outer"><div class="v-center-inner"><div data-subview="urlInput"></div></div></div></div></div><div data-subview="removeButton"></div></div>'),__p+="</div></div>"}return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],145:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="pop-menu"><div class="inner">',_.each(blogs,function(t,e){__p+="";var i=t.name.replace(queryRegex,"<u>$&</u>");__p+='<div id="mention_'+(null==(__t=e)?"":_.escape(__t))+'" class="item-option" data-tumblelog="'+(null==(__t=t.name)?"":_.escape(__t))+'"><div class="blog-info"><span class="blog-name">'+(null==(__t=i)?"":__t)+'</span> <span class="blog-title">'+(null==(__t=t.title)?"":_.escape(__t))+'</span></div><span class="blog-thumb" style="background-image:url(\''+(null==(__t=t.avatar_url)?"":_.escape(__t))+"')\"></span></div>"
}),__p+="</div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],146:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="overlay-button-popover" data-js-popover><input data-js-input type="text" value="'+(null==(__t=value)?"":_.escape(__t))+'" placeholder="'+(null==(__t=placeholder)?"":_.escape(__t))+'" aria-label="'+(null==(__t=ariaLabel)?"":_.escape(__t))+'" maxlength="'+(null==(__t=maxLength)?"":_.escape(__t))+'" class="input-field"><div data-js-confirm class="input-confirm">'+(null==(__t=confirmText)?"":_.escape(__t))+"</div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],147:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="editor editor-plaintext" aria-label="'+(null==(__t=ariaLabel)?"":_.escape(__t))+'" contenteditable="true" data-js-plaintexteditor></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],148:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="post-margin" data-js-margin><div data-subview="avatar"></div></div><div class="post-container" data-js-container-outer><div class="post-container-inner post" data-js-container-inner><div class="post-form--header post-header clearfix" data-js-header><div class="controls-container"><div class="control left"><div data-subview="tumblelogSelect"></div></div><div class="control right"><div data-subview="uploadingIndicator"></div>',showReblogAs&&(__p+='<div data-subview="reblogAsButton"></div>'),__p+='<div data-subview="postSettings"></div></div></div></div><div class="post-form--form post-content"><div data-subview="postTypeForm"></div></div><div class="post-form--footer post-footer" data-js-footer><div data-subview="tagEditor"></div><div data-subview="editorButtons"></div></div><div class="post-form--guard"></div><div class="post-form--bottom" data-js-bottom><div class="post-form--controls" data-js-postformcontrols><div class="controls-container"><div class="control left"><button class="flat-button post-form--close" data-js-clickableclose="">'+(null==(__t=closeLabel)?"":_.escape(__t))+'</button></div><div class="control right"><div data-subview="socialButtons"></div></div><div class="control right"><div data-subview="savePostButton"></div></div></div></div><div data-subview="errorBar"></div></div><div data-subview="allowAnswers"></div><div data-subview="richTextEditorTutorial"></div></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],149:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<form method="POST" target="_blank" action="'+(null==(__t=action)?"":_.escape(__t))+'">',_.each(inputs,function(t,e){__p+='<input type="hidden" name="'+(null==(__t=e)?"":_.escape(__t))+'" value="'+(null==(__t=t)?"":_.escape(__t))+'">'}),__p+="</form>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],150:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<button class="post-settings" data-js-clickablepostsettingscog><span class="dropdown icon_settings" data-js-postsettingscog></span></button>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],151:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="pop-menu"><div class="inner"><div class="form-horizontal"><div class="form-group"><div class="group-label"><label for="customUrl_input">'+(null==(__t=__("Custom URL"))?"":_.escape(__t))+'</label></div><div class="group-content"><div class="adjacent-content"><label for="customUrl_input" class="prefix" data-js-customurllabel>/post/123/</label><input name="customUrl" id="customUrl_input" class="field crystal" type="text" autocomplete="off" data-js-customurl value="'+(null==(__t=customUrl)?"":_.escape(__t))+'"></div></div></div><div class="form-group"><div class="group-label"><label for="sourceUrl_input">'+(null==(__t=__("Content source"))?"":_.escape(__t))+'</label></div><div class="group-content"><input id="sourceUrl_input" name="sourceUrl" class="field crystal" type="text" placeholder="http://..." autocomplete="off" data-js-sourceurl value="'+(null==(__t=sourceUrl)?"":_.escape(__t))+'"></div></div><div class="form-group"><div class="group-label"><label for="postDate_input">'+(null==(__t=__("Post date"))?"":_.escape(__t))+'</label></div><div class="group-content"><input id="postDate_input" name="postDate" class="field crystal" type="text" placeholder="'+(null==(__t=__("Now"))?"":_.escape(__t))+'" autocomplete="off" data-js-postdate value="'+(null==(__t=postDate)?"":_.escape(__t))+'"></div></div><div class="form-group"><div class="group-label">'+(null==(__t=__("Replies"))?"":_.escape(__t))+'</div><div class="group-content"><div class="checkbox field row"><label class="binary_switch"><input name="allow_photo_replies" type="checkbox" id="allowPhotoReplies" type="checkbox" data-js-allowphotoreplies> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></label><label for="allowPhotoReplies">'+(null==(__t=__("Let people photo reply"))?"":_.escape(__t))+"</label></div></div></div>",showEditorSelection&&(__p+='<div class="form-group"><div class="group-label">'+(null==(__t=__("Text editor"))?"":_.escape(__t))+'</div><div class="group-content"><div class="flat_select field row"><select name="editorType" id="editorType" data-js-editortype><option value="rich">'+(null==(__t=__("Rich text"))?"":_.escape(__t))+'</option><option value="html">'+(null==(__t=__("HTML"))?"":_.escape(__t))+'</option><option value="markdown">'+(null==(__t=__("Markdown"))?"":_.escape(__t))+'</option></select><label for="editorType" class="current_selection">'+(null==(__t=__("Rich text"))?"":_.escape(__t))+'</label><i class="icon"></i></div></div></div>'),__p+="</div></div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],152:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="clear-results icon_close '+(null==(__t=0===resultCount?"inactive":"")?"":_.escape(__t))+'"></div><div class="copyright-warning '+(null==(__t=showCopyrightWarning===!1?"inactive":"")?"":_.escape(__t))+'">'+(null==(__t=copyrightWarningMessage)?"":__t)+"</div>",_.each(serviceResults,function(t,e){__p+='<div class="audio-result-set" data-service="'+(null==(__t=e)?"":__t)+'">',_.each(t,function(t){__p+='<div class="result '+(null==(__t="youtube"===e?"video-result":"audio-result")?"":_.escape(__t))+'" data-href="'+(null==(__t=t.href)?"":__t)+'"><span class="primary">'+(null==(__t=t.primary)?"":__t)+'</span><span class="secondary">'+(null==(__t=t.secondary)?"":__t)+'</span> <span class="info">'+(null==(__t=t.info)?"":__t)+"</span></div>"}),__p+="</div>"}),__p+="";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],153:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="media-wrapper" data-js-media><div data-subview="mediaPreview"></div><div data-js-mediacomposer class="audio-search-container"><div data-subview="searchField"></div><div data-subview="audioUploader"></div><div data-subview="searchResultList"></div></div></div><div class="caption-wrapper" data-js-tos><div data-subview="confirmTos"></div></div><div class="caption-wrapper" data-js-caption><div data-subview="reblogTree"></div><div data-subview="caption"></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],154:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div data-subview="title"></div><div data-subview="chat"></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],155:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="media-wrapper"><div class="media-container link-media-container"><div class="link-editor"><div data-subview="url"></div><section class="link-media-body" data-js-media><div class="thumbnail" data-js-image data-js-removable="false"></div><article data-js-article data-js-removable="true"><div data-subview="title"></div><div data-subview="excerpt"></div><footer><address><a href="#" data-js-publisher target="_blank" rel="bookmark"></a><p data-js-author class="author"></p></address></footer></article></section></div>',canEditMedia&&(__p+='<div data-subview="removeButton"></div>'),__p+='</div></div><div class="caption-wrapper" data-js-caption><div data-subview="reblogTree"></div><div data-subview="caption"></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],156:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="media-wrapper" data-js-media><div class="media-container link-media-container"><div class="link-editor" data-js-linkeditor><div class="link-fields"><div data-subview="title"></div><div data-subview="url"></div></div><div class="thumb" data-js-urlimage></div></div>',canEditMedia&&(__p+='<div data-subview="removeButton"></div>'),__p+='</div></div><div class="caption-wrapper" data-js-caption><div data-subview="reblogTree"></div><div data-subview="caption"></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],157:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div data-subview="askField"></div><div data-subview="answerField"></div><div data-subview="reblogTree"></div><div data-subview="caption"></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],158:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="media-wrapper" data-js-media><div data-subview="mediaPreview"></div><div data-subview="mediaComposer"></div></div><div class="caption-wrapper" data-js-caption><div data-subview="reblogTree"></div><div data-subview="caption"></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],159:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div data-subview="quote"></div><div data-subview="source"></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],160:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div data-subview="title"></div><div data-subview="reblogTree"></div><div data-subview="body"></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],161:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="media-wrapper" data-js-media><div data-subview="mediaPreview"></div><div data-subview="mediaComposer"></div></div><div class="caption-wrapper" data-js-tos><div data-subview="confirmTos"></div></div><div class="caption-wrapper" data-js-caption><div data-subview="reblogTree"></div><div data-subview="caption"></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],162:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="reblog-as-type '+(null==(__t=post.get("type"))?"":_.escape(__t))+'" data-js-reblogselectpin data-js-clickablereblogselect></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],163:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="pop-menu"><div class="inner select-center"><div class="item-option-wrapper"><div class="header-item">'+(null==(__t=__("Reblog as"))?"":_.escape(__t))+"</div>",_.forEach(postReblogAsTypes,function(t,e){__p+='<div class="item-option '+(null==(__t=postType===e?"icon_checkmark":"")?"":_.escape(__t))+'" data-reblog-as-type="'+(null==(__t=e)?"":_.escape(__t))+'">'+(null==(__t=t)?"":_.escape(__t))+"</div>"}),__p+="</div></div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],164:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="",showReblogTree&&(__p+='<div class="control-reblog-tree post"><div class="reblog-tree post_content">'+(null==(__t=post.get("reblog_tree"))?"":__t)+'</div><div data-subview="removeButton"></div><div class="btn-show-tree btn-toggle-reblog">'+(null==(__t=__("Include reblogs"))?"":_.escape(__t))+"</div></div>"),__p+="";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],165:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="editor editor-richtext" aria-label="'+(null==(__t=ariaLabel)?"":_.escape(__t))+'" contenteditable="true" data-js-richtexteditor></div><div data-subview="htmlField"></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],166:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<h3 class="title">'+(null==(__t=__("Want to style your text?"))?"":_.escape(__t))+'</h3><p class="content">'+(null==(__t=__("Just select it. You'll see."))?"":_.escape(__t))+'</p><button class="blue ok_button flat-button" type="button">'+(null==(__t=__("I see"))?"":_.escape(__t))+"</button>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],167:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="split chrome blue"><div data-subview="loader"></div><button class="flat-button blue caption create_post_button" data-js-clickablesave></button><div class="flat-button blue dropdown options icon_arrow_carrot_down" data-js-clickablesavedropdown></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],168:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="pop-menu"><ul class="inner select-left" data-js-options><li class="item-option '+(null==(__t="published"===state?"icon_checkmark":"")?"":__t)+'" data-js-publish><span class="">'+(null==(__t=__("Post now"))?"":_.escape(__t))+'</span></li><li class="item-option '+(null==(__t="queued"===state?"icon_checkmark":"")?"":__t)+" "+(null==(__t=-1===activeOptions.indexOf("queued")?"hidden":"")?"":__t)+'" data-js-queue><span class="">'+(null==(__t=__("Add to queue"))?"":_.escape(__t))+'</span></li><li class="item-option '+(null==(__t="draft"===state?"icon_checkmark":"")?"":__t)+" "+(null==(__t=-1===activeOptions.indexOf("draft")?"hidden":"")?"":__t)+'" data-js-draft><span class="">'+(null==(__t=__("Save as draft"))?"":_.escape(__t))+'</span></li><li class="item-option '+(null==(__t="private"===state?"icon_checkmark":"")?"":__t)+'" data-js-private><span class="">'+(null==(__t=__("Post privately"))?"":_.escape(__t))+'</span></li><li class="item-option '+(null==(__t="scheduled"===state?"icon_checkmark":"")?"":__t)+" "+(null==(__t=-1===activeOptions.indexOf("scheduled")?"hidden":"")?"":__t)+'" data-js-schedule><span class="">'+(null==(__t=__("Schedule"))?"":_.escape(__t))+'</span><br><input class="field square solid" type="text" autocomplete="off" placeholder="Next Tuesday, 10am" data-js-scheduletext></li>',showPreview&&(__p+='<li class="item-option full" data-js-preview><button class="button flat-button">'+(null==(__t=__("Preview on blog"))?"":_.escape(__t))+"</button></li>"),__p+="</ul></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],169:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<ul class="social-buttons"><li data-js-twitter data-service="twitter" data-js-tweetdropdownpin class="social-button twitter '+(null==(__t=twitter?"":"hidden")?"":_.escape(__t))+" "+(null==(__t=twitterOn?"checked":"")?"":_.escape(__t))+'"><label class="social-button--label social-button--twitter" data-js-shareicon data-js-twittericon></label></li><li data-js-facebook data-service="facebook" class="social-button facebook '+(null==(__t=facebook?"":"hidden")?"":_.escape(__t))+" "+(null==(__t=facebookOn?"checked":"")?"":_.escape(__t))+'"><label class="social-button--label social-button--facebook" data-js-shareicon data-js-facebookicon></label></li></ul>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],170:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="tag-input-wrapper" data-js-taginputfieldwrapper><div data-subview="tagInputField"></div><div class="ghost" data-js-taginputghost></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],171:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="pop-menu"><div class="inner select-center"><div class="item-option-wrapper" data-js-tagsuggestwrapper>',_.each(results.userTags,function(t){__p+="";var e=_.escape(t).replace(queryRegex,"<u>$&</u>");__p+='<div class="item-option user-tags" data-tag="'+(null==(__t=_.escape(t))?"":__t)+'"><span class="tag-suggest-tag">'+(null==(__t=e)?"":__t)+"</span></div>"}),__p+='<div class="header-item">Popular</div>',_.each(results.suggestions,function(t){__p+="";var e=_.escape(t).replace(queryRegex,"<u>$&</u>");__p+='<div class="item-option suggest-tags" data-tag="'+(null==(__t=_.escape(t))?"":__t)+'"><span class="tag-suggest-tag">'+(null==(__t=e)?"":__t)+"</span></div>"}),__p+="</div></div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],172:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="tooltip-inner">',__p+=sanitize?""+(null==(__t=text)?"":_.escape(__t)):""+(null==(__t=text)?"":__t),__p+="</div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],173:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<button class="tumblelog-select '+(null==(__t="edit"===post.get("mode")?"inactive":"")?"":_.escape(__t))+'" data-js-clickabletumbleloglabel><span class="caption" data-js-tumbleloglabel></span>',"edit"!==post.get("mode")&&(__p+=' <span class="dropdown icon_arrow_carrot_down" data-js-tumblelogselectpin></span>'),__p+="","reblog"===post.get("mode")&&(__p+=' <span class="reblog_source"><i class="icon icon_reblog"></i> <span class="reblog_name">'+(null==(__t=post.get("reblog_name"))?"":_.escape(__t))+"</span></span>"),__p+="</button>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],174:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="pop-menu"><ul class="inner select-right">',_.forEach(channels,function(t){__p+='<li class="item-option '+(null==(__t=t.name===tumblelog?"select":"")?"":_.escape(__t))+'" data-js-tumblelogchoice><img class="ts-avatar" src="'+(null==(__t=t.avatarUrl)?"":_.escape(__t))+'" alt="'+(null==(__t=t.name)?"":_.escape(__t))+'"><div class="ts-info"><p class="ts-name">'+(null==(__t=t.displayName)?"":_.escape(__t))+'</p><p class="ts-title">'+(null==(__t=t.directory_safe_title)?"":__t)+"</p></div></li>"}),__p+="</ul></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],175:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div data-js-tweetpopover><div class="tweet-container"><textarea aria-label="'+(null==(__t=__("Custom tweet"))?"":_.escape(__t))+'" data-js-customtweet class="tweet-textarea">'+(null==(__t=tweetText)?"":_.escape(__t))+'</textarea><div data-js-tweetremaining class="tweet-remaining">'+(null==(__t=tweetRemaining)?"":_.escape(__t))+'</div></div><button data-js-dismisstweet type="button" class="chrome small dismiss">'+(null==(__t=__("Done"))?"":_.escape(__t))+"</button></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],176:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div data-subview="loader"></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],177:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div data-js-webcambutton class="webcam-button"><span data-js-smiley class="icon icon_postforms_selfie"></span> <span data-js-text class="dropzone-text">'+(null==(__t=__("Take a selfie"))?"":_.escape(__t))+"</span></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],178:[function(t,e){"use strict";var i=t("lodash"),s=function(t,e){return e||(e=this),function(){var s=i.toArray(arguments);return i.map(t,function(t){return t.apply(e,s)},e)}};e.exports=s},{lodash:"K2RcUv"}],179:[function(t,e){"use strict";var i=t("lodash"),s=function(t){if(i.isString(t)){if(t=t.toLowerCase(),"true"===t||"1"===t||"on"===t)return!0;if("false"===t||""===t||"off"===t)return!1;if(t=i.parseInt(t),i.isNaN(t))return!0}return!!t};e.exports=s},{lodash:"K2RcUv"}],180:[function(t,e){"use strict";var i=t("lodash"),s=function(t,e){return null==e?e=5:i.isNumber(e)||(e=0),i.transform(t,function(t,o,n){e&&i.isObject(o)&&(o=s(o,e-1)),t[i.camelize(n)]=o},{})};e.exports=s},{lodash:"K2RcUv"}],181:[function(t,e){"use strict";function i(t,e){return"function"==typeof e?e(t):t.find(e)}function s(t,e){return"function"==typeof e?e(t):t.attr(e)}function o(t,e){var s=i(t,e);return!r.isNumber(s)&&r.has(s,"length")?s.length:s}function n(t,e){var o=i(t,e.selector);return r.countBy(o,function(t){return s(l(t),e.attribute)})}function a(t,e){return r.isFunction(e)||r.isString(e)?o(t,e):r.has(e,"attribute")?n(t,e):null}var r=t("lodash"),l=t("jquery"),h=function(t){this.lookups=t||{}};h.prototype.parse=function(t){var e={},i=l(t),s=function(t,e){r.each(t,function(t,o){var n=a(i,t);null!==n?e[o]=n:r.isObject(t)?(e[o]={},s(t,e[o])):e[o]=t})};return s(this.lookups,e),e},e.exports=h},{jquery:"HlZQrA",lodash:"K2RcUv"}],182:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("backbone"),n=t("prima/class"),a=0,r=function(t){t=null==t||i.isPlainObject(t)?i.extend({target:"body",autostart:!1},t):{target:t,autostart:!1};var e=".drag_eventor_"+a++,r=s(t.target),l=!1,h=0,d=new n;i.extend(d,o.Events);var c=["dragenter","dragover","dragleave","dragend","drop"],u=function(t){d.trigger(t.type,t)};return d.start=function(){h++,l||(l=!0,i.forEach(c,function(t){r.on(t+e,u)}))},d.stop=function(){h--,0>=h&&(l=!1,i.forEach(c,function(t){r.off(t+e,u)}))},t.autostart&&d.start(),d};e.exports=r},{backbone:"5kFNoY",jquery:"HlZQrA",lodash:"K2RcUv","prima/class":426}],183:[function(t,e){"use strict";function i(t,e){var i=n.nodeFromString(t),a=o(i);return s.isFunction(e)&&(e=s.rest(arguments)),s.each(e,function(t){t(i,a)}),a.html()}var s=t("lodash"),o=t("jquery"),n=t("prima/utils/dom");e.exports=i},{jquery:"HlZQrA",lodash:"K2RcUv","prima/utils/dom":480}],184:[function(t,e){"use strict";function i(t){var e,i=[];for(var s in t)e=t[s],i.push([new RegExp("(</?)("+s+")([>\\s])","gi"),"$1"+e+"$3"]);return i}function s(t,e){for(var i=0;i<e.length;i++)t=t.replace.apply(t,e[i]);return t}function o(t,e){for(var o,n=i(e||d),a=t.split(h),c=!1,u="",p=0;p<a.length;p++)o=a[p],u?o===u&&(u=""):c&&(">"===o?c=!1:o.match(l)&&(u=o)),!u&&o.match(r)&&(">"!==o.slice(-1)&&(c=!0),a[p]=s(o,n));return a.join("")}var n="<\\/?\\w+[\\s>]",a="['\"]",r=new RegExp(n,"g"),l=new RegExp(a,"g"),h=new RegExp("("+n+"|"+a+"|>)","g"),d={strong:"b",em:"i"};e.exports=o},{}],185:[function(t,e){"use strict";var i=t("lodash"),s={camel:i.camelize,snake:i.underscored,kebab:i.dasherize},o=function(t,e){return i.isString(e)&&(e=i.result(s,e)),i.isFunction(e)?i.map(t,e):t},n=function(t,e,s){return i.isString(e)&&(e=o(s||i.keys(t),e)),i.transform(t,function(t,s,o){t[i.result(e,o)||o]=s},{})};e.exports=n},{lodash:"K2RcUv"}],186:[function(t,e){var i=function(t,e,i){var s={};_.isPlainObject(t)&&(i=e,_.extend(s,t),t=s.width,e=s.height);var o=Math.round(e/t*i);return s.width=i,s.height=o,s};e.exports=i},{}],187:[function(t,e){"use strict";var i=t("lodash"),s={normalizeSpace:function(t){return t.trim().replace(" "," ").replace(/\s\s+/," ")},stripScripts:function(t){return t.replace(new RegExp("<script[^>]*>([\\S\\s]*?)</script\\s*>","img"),"")},stripTags:function(t){return t.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")},truncateLongStrings:function(t,e,s){return i.isString(t)||(t=""),s||(s="…"),t.length<=e?t:i.truncate(t,e-s.length,s)},stripHtml:function(t,e,s){if(!t)return"";"undefined"==typeof e&&(e=!0);var o=t;"string"==typeof s&&(o=i.trim(o.replace(/(<br\s*\/?>)/gi,"$1"+s).replace(/(<\/(?:p|figure|h[1-6])\s*>)/gi,"$1"+s)));try{var n=document.implementation.createHTMLDocument("");n.body.innerHTML=this.stripScripts(o),o=n.body.textContent||n.body.innerText||"",o=o.trim()}catch(a){o=this.stripScripts(this.stripTags(o)).trim()}return e&&(o=this.normalizeSpace(o)),o}};e.exports=s},{lodash:"K2RcUv"}],188:[function(t,e){"use strict";var i={isUrl:function(t){var e="%[0-9a-fA-F]{2}",i="(http|https):\\/\\/",s='([a-zA-Z0-9$\\-_.+!*"(),;:&=]|'+e+")+@",o="(25[0-5]|2[0-4][0-9]|[0-1][0-9][0-9]|[1-9][0-9]|[0-9])",n="("+o+"(\\."+o+"){3})",a="([a-zA-Z0-9\\-\\u00C0-\\u017F]+\\.)+([a-zA-Z]{2,})",r="[0-9]+",l="("+n+"|localhost|"+a+")(:"+r+")?",h='a-zA-Z0-9$\\-_.+!*"(),;:@&=',d="(["+h+"]|"+e+")*",c=d+"(\\/"+d+")*",u="\\?(["+h+"/?]|"+e+")*",p="\\#(["+h+"/?]|"+e+")*",m=new RegExp("^"+i+"("+s+")?"+l+"(\\/?("+c+")?("+u+")?("+p+")?)?$");return m.test(t)===!0},isImageUrl:function(t){var e=i.isUrl(t),s=/.+[.](jpg|jpeg|png|gif)([?]|$)/.test(t)===!0;return e&&s}};e.exports=i},{}],189:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/lib/translate"),o=t("../templates/album_art_uploader.tpl"),n=t("./media_dropzone"),a=n.extend({className:"media-dropzone-container album-art-uploader",defaultOptions:i.defaults({enableUrl:!1,dropzoneText:s("Select album art"),uploadText:s("Select album art"),uploadOptions:{name:"album_art",maxUploadSize:10485760,uploadPattern:/^image\/(?:.*)$/i,accept:"image/*",url:"/svc/post/upload_album_art"}},n.prototype.defaultOptions),template:o,events:i.extend({"click [data-js-removeButton]":"_onClickRemoveButton"},n.prototype.events),_onClickRemoveButton:function(){this.set("url","")},_onUploadUrlChange:function(t,e){this.set("url",e)},_onUrlChange:function(t,e){this.model.set({preuploadAlbumArt:!i.isEmpty(e),albumArt:e}),this.js$("albumArt").css("background-image",e?"url("+e+")":""),this.$el.toggleClass("can-upload-album-art",i.isEmpty(e))},afterRender:function(){this.listenTo(this.upload,"change:url",this._onUploadUrlChange),this.listenTo(this,"change:url",this._onUrlChange),this.$el.toggleClass("can-upload-album-art",i.isEmpty(this.get("url"))),n.prototype.afterRender.apply(this,arguments)}});e.exports=a},{"../templates/album_art_uploader.tpl":125,"./media_dropzone":208,lodash:"K2RcUv","prima/lib/translate":456}],190:[function(t,e){"use strict";var i=t("prima/view"),s=t("lodash"),o=t("../utils/string_helpers"),n=t("prima/mixins/selectorcache"),a=t("../templates/allow_answers.tpl"),r=i.extend({mixins:[n],template:a,className:"post-form--allow-answers",events:{"click [data-js-allowAnswersCheckbox]":"updateModel"},initialize:function(t){this.model=t.model},_onModelChange:function(){var t=!1;s.each(this.model.genericFieldMap,function(e){return this.endsWithQuestionMark(this.model.get(e))?(t=!0,!1):void 0},this),t?this.$el.slideDown():(this.js$("allowAnswersCheckbox").removeAttr("checked"),this.updateModel(),this.$el.slideUp())},endsWithQuestionMark:function(t){return t=o.stripHtml(t,!1),-1!==t.indexOf("?",t.length-1)},updateModel:function(){this.model.set("allow_answers",this.js$("allowAnswersCheckbox").is(":checked"))},render:function(){return this.addStateListeners(),this.$el.html(this.template()),this},addStateListeners:function(){"new"===this.model.get("mode")&&"chat"!==this.model.get("type")&&this.listenTo(this.model,"change",this._onModelChange)},teardown:function(){return this.stopListening(),this}});e.exports=r},{"../templates/allow_answers.tpl":126,"../utils/string_helpers":187,lodash:"K2RcUv","prima/mixins/selectorcache":467,"prima/view":496}],191:[function(t,e){"use strict";
var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/accessor"),n=t("prima/mixins/subviewable"),a=t("../templates/ask_field.tpl"),r=s.extend({template:a,mixins:[o,n],serialize:function(){return i.extend({post:this.model.toJSON(),showAnswerField:this.model.isReblog()},this.toJSON())},render:function(){return this.$el.html(this.template(this.serialize())),this}});e.exports=r},{"../templates/ask_field.tpl":127,lodash:"K2RcUv","prima/mixins/accessor":458,"prima/mixins/subviewable":468,"prima/view":496}],192:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("../templates/audio_uploader.tpl"),n=t("./media_dropzone"),a=n.extend({className:"audio-direct-upload-button",defaultOptions:i.defaults({enableUrl:!1,dropzoneText:"",uploadIcon:"dropzone-add-audio-icon",uploadText:"",uploadOptions:{name:"audio",mediaType:"audio",maxUploadSize:10485760,uploadPattern:s.browser.mozilla?/^audio\/(?:.*)$/i:/^(?:audio\/mp3|audio\/mpeg)$/i,accept:"audio/mp3",url:"/svc/post/upload_audio"}},n.prototype.defaultOptions),template:o});e.exports=a},{"../templates/audio_uploader.tpl":128,"./media_dropzone":208,jquery:"HlZQrA",lodash:"K2RcUv"}],193:[function(t,e){"use strict";var i=t("lodash"),s=t("when"),o=t("velocity-animate").animate,n=t("prima/utils/sequence-with-context"),a=t("app/components/post-form-builder/utils/transition_speed"),r=t("prima/view"),l=t("app/lib/avatar-size"),h=t("prima/mixins/subviewable"),d=t("prima/mixins/selectorcache"),c=t("prima/mixins/accessor"),u=t("app/lib/currentuser"),p=t("../templates/avatar.tpl"),m=r.extend({className:"post-form--avatar",mixins:[h,d,c],template:p,defaultOptions:{size:128,determineViewState:!0},defaults:{flipQueued:!1,showSubavatar:!1,avatarUrl:""},initialize:function(t){if(this.options=t=i.extend({},this.defaultOptions,t),this.user=t.user||u(),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),t.post&&(this.post=t.post,this.tumblelog=t.tumblelog||this.user.getChannel(this.post.get("tumblelog")),this.listenTo(this.post,"change:tumblelog",this._onChangePostTumblelog)),!this.tumblelog)throw new Error("AvatarView requires a Tumblelog model!");this.options.determineViewState?this.updateViewState():this.get("avatarUrl")||this.set("avatarUrl",this.tumblelog.get("avatar_url")),this.listenTo(this,"change:showSubavatar",this._onChangeShowSubavatar),this.listenTo(this,"change:avatarUrl",this._onChangeAvatarUrl)},_onChangeShowSubavatar:function(t,e){e?this.showSubavatar():this.hideSubavatar()},_onChangeAvatarUrl:function(){return this.queueFlipAvatar()},updateViewState:function(){this.set({showSubavatar:this.tumblelog.get("show_author_avatar"),avatarUrl:this.tumblelog.get("avatar_url")})},_onChangePostTumblelog:function(t,e){this.tumblelog=this.user.getChannel(e),this.updateViewState()},showSubavatar:function(t,e){return null!=t||(t=a(150)),null!=e||(e=a(300)),o(this.$$(".primary-avatar"),{scale:1},{display:"block",duration:t,delay:e,easing:[.25,1.5,.75,1]})},hideSubavatar:function(t,e){return null!=t||(t=a(100)),null!=e||(e=0),o(this.$$(".primary-avatar"),{scale:0},{display:"none",duration:t,delay:e,easing:[0,0,.6,1]})},queueFlipAvatar:function(){if(this._avatarFlipping)return void this.set("flipQueued",!0);var t=this.flipAvatar();t.then(i.bind(function(){this.get("flipQueued")&&(this.set("flipQueued",!1),this.flipAvatar())},this))},flipAvatar:function(t,e){null!=t||(t=a(300)),null!=e||(e=a(50));var i=l(this.get("avatarUrl"),this.options.size),r=this.tumblelog.get("name"),h=this.$$(".channel-avatar"),d=h.clone();return this._avatarFlipping=!0,n([function(){return d.children(".avatar-link").css("background-image","url('"+i+"')"),d.children(".avatar-image").attr({src:i,alt:r}),o(d,{rotateY:[180,180]},{duration:0}).then(function(){d.insertAfter(h)})},function(){return s.join(o(h,{rotateY:[180,0]},{duration:t}),o(d,{rotateY:[360,180]},{duration:t}))},function(){return h.remove(),this.$$.remove(".channel-avatar"),o(d,{rotateY:[0,0]},{duration:0})},function(){this._avatarFlipping=!1}],this)},resetAvatar:function(){return this.set(i.defaults(i.pick(this.options,["showSubavatar","avatarUrl"]),i.pick(this.attributes,["showSubavatar","avatarUrl"]))),this},serialize:function(){return i.extend(this.toJSON(),{avatarUrl:l(this.get("avatarUrl"),this.options.size),subavatarUrl:l(this.user.getChannel().get("avatar_url"),this.options.size),primary:this.user.getChannel().toJSON(),channel:this.tumblelog.toJSON()})},render:function(){return this.$el.html(this.template(this.serialize())),this.get("showSubavatar")||(this.$$(".primary-avatar").css("display","none"),this.hideSubavatar(0)),this}});e.exports=m},{"../templates/avatar.tpl":129,"app/components/post-form-builder/utils/transition_speed":91,"app/lib/avatar-size":293,"app/lib/currentuser":296,lodash:"K2RcUv","prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/utils/sequence-with-context":492,"prima/view":496,"velocity-animate":"lWl/mc",when:"RG2dij"}],194:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/lib/translate"),a=t("prima/mixins/subviewable"),r=t("prima/mixins/selectorcache"),l=t("prima/mixins/accessor"),h=t("../templates/confirm_tos.tpl"),d=o.extend({className:"confirm-tos",events:{"change [data-js-confirmTos]":"_onChangeConfirmTos"},mixins:[a,r,l],template:h,initialize:function(t){this.options=t=i.extend({},t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),this.user=t.user,this.post=t.post},_onChangeConfirmTos:function(t){this.post.set("confirmTos",s(t.currentTarget).is(":checked"))},serialize:function(){return{__:n,confirmTos:this.post.get("confirmTos")}},render:function(){return this.$el.html(this.template(this.serialize())),this.js$("confirmTos").attr("checked",!!this.post.get("confirmTos")),this},teardown:function(){return this.$el.empty(),this}});e.exports=d},{"../templates/confirm_tos.tpl":130,jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/translate":456,"prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/view":496}],195:[function(t,e){"use strict";var i=t("prima/view"),s=t("prima/mixins/subviewable"),o=t("prima/mixins/selectorcache"),n=i.extend({mixins:[s,o],initialize:function(){},render:function(){return this}});e.exports=n},{"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/view":496}],196:[function(t,e){"use strict";var i=t("prima/view"),s=i.extend({className:"post-form--error-bar",showErrorBar:function(t){this.$el.html(t).slideDown()},hideErrorBar:function(){this.$el.hide()}});e.exports=s},{"prima/view":496}],197:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/view"),n=t("prima/lib/translate"),a=t("../services/preview_service"),r=t("./tooltip"),l=t("prima/mixins/subviewable"),h=t("prima/mixins/selectorcache"),d=t("prima/mixins/accessor"),c=t("../templates/html_field.tpl"),u=t("app/vendor/ace"),p=u.require("ace/mode/html").Mode,m=u.require("ace/mode/markdown").Mode,g=t("app/components/code-editor/theme/post_form"),f=o.extend({mixins:[d,l,h],className:"html-field",events:{"click [data-js-editorHelp]":"_onClickEditorHelp","click [data-js-srcButton]":"_onClickSrcButton","click [data-js-previewButton]":"_onClickPreviewButton"},template:c,defaults:{name:"",editedSincePreview:!1,currentValue:"",htmlPreviewValue:null,markdownPreviewValue:null,isResizable:!1,isMarkdown:!1,wasFocused:!1,textareaClass:""},initialize:function(t){this.set(t),this.updateValueFromModel(),this.previewService=new a,this.tooltip=new r({className:"dropzone-tooltip-popover",text:n("Note that the dashboard doesn't display all HTML elements, but you're free to put them in your posts anyway.")}),this._renderPreview=s.bind(this.renderPreview,this)},_onClickEditorHelp:function(){this.tooltip.isRendered()?this.tooltip.remove():this.tooltip.render()},_onClickSrcButton:function(){this.showSource(!0)},_onClickPreviewButton:function(){this.showPreview()},renderPreview:function(t,e){!s.isUndefined(t)||(t=this.get("currentValue")),!s.isUndefined(e)||(e=this.get("isMarkdown"));var i=this.get("htmlPreviewValue");this.get("editedSincePreview")||null==i?(this.js$("htmlPreview").html('<p style="text-align:center;"><b>'+n("Loading preview...")+"</b></p>"),this.previewService.filterForDash(t,e,s.bind(function(t){this.set(e?"markdownPreviewValue":"htmlPreviewValue",t),this.set("editedSincePreview",!1),this.js$("htmlPreview").html(t)},this),s.bind(function(){this.js$("htmlPreview").html('<p style="text-align:center;"><i>'+n("Failed to load preview :(")+"</i></p>")},this))):this.js$("htmlPreview").html(i)},teardown:function(){return this.stopListening(),this.$el.empty(),this.tooltip&&this.tooltip.remove(),this},serialize:function(){return{isMarkdown:this.get("isMarkdown"),srcLabel:n(this.get("isMarkdown")?"Markdown":"HTML"),previewLabel:n("Preview")}},beforeRender:function(){this.listenTo(this,"change:isMarkdown",function(t,e){this.js$("srcIcon").toggleClass("markdown",e).toggleClass("html",!e),this.js$("srcLabel").text(n(e?"Markdown":"HTML"));var i=e?m:p;this.editor.getSession().setMode(new i),this.setAriaLabel()})},setAriaLabel:function(){var t;this.editor&&this.editor.textInput&&(t=this.editor.textInput.getElement(),t&&i(t).attr("aria-label",n(this.get("isMarkdown")?"Markdown content":"HTML content")))},render:function(){return this.$el.html(this.template(this.serialize())),this.$el.attr("data-name",this.get("name")),this.tooltip.setPinnedTarget(this.js$("editorHelp")),this._initAce(this.js$("ace").get(0)),this.showSource(),this.updateEditor(),this.setAriaLabel(),this},hide:function(){this.$el.hide()},show:function(){this.$el.show(),this.updateEditor(),this.updatePreview()},focus:function(){this.editor&&i(this.editor.container).is(":visible")&&(this.get("wasFocused")||!function(t){s.defer(function(){t.blur(),s.defer(function(){t.focus()})}),t.blur()}(this.editor),this.editor.focus())},blur:function(){this.editor&&this.editor.blur()},updateValueFromModel:function(){this.set("currentValue",this.model.get(this.get("name"))||"")},showSource:function(t){this.js$("previewButton").removeClass("active"),this.js$("srcButton").addClass("active"),this.js$("previewView").hide(),this.js$("srcView").show(),t&&s.defer(s.bind(function(){this.focus()},this))},showPreview:function(){this.js$("srcButton").removeClass("active"),this.js$("previewButton").addClass("active"),this.updatePreview(),this.js$("srcView").hide(),this.js$("previewView").show()},updateEditor:function(){this.editor&&(this._ignoreAceChange=!0,this.editor.setValue(this.get("currentValue"),1),this._ignoreAceChange=!1)},updatePreview:function(){var t=this.get("currentValue");this._renderPreview(t)},_updateValueFromAce:function(t){var e=this.get("name"),i=this.model.get(e);this.set("editedSincePreview",!0),this.set("currentValue",t),this.model.set(e,t),this.model.set("htmlEdited",t&&i!==t)},_initAce:function(t){var e=this.editor=u.edit(t),i=e.getSession();i.setUseWorker(!1),i.setUseWrapMode(!0),i.setFoldStyle("manual"),i.on("change",s.bind(function(){this._ignoreAceChange||this._updateValueFromAce(i.getValue())},this)),i.setUseSoftTabs(!0),i.setTabSize(2);var o=this.get("isMarkdown")?m:p;i.setMode(new o),e.setTheme(g),e.setShowPrintMargin(!1),e.renderer.setShowGutter(!1),e.renderer.setPadding(20),e.renderer.setScrollMargin(20,20),e.setHighlightActiveLine(!1),e.setHighlightSelectedWord(!1),e.setBehavioursEnabled(!1),e.commands.removeCommands(["showSettingsMenu","goToNextError","goToPreviousError","centerselection","gotoline","fold","unfold","toggleFoldWidget","toggleParentFoldWidget","foldall","foldOther","unfoldall","findnext"," findprevious","selectOrFindNext","selectOrFindPrevious","find","overwrite","togglerecording","replaymacro","jumptomatching","selecttomatching","removeline","duplicateSelection","sortlines","togglecomment","toggleBlockComment","modifyNumberUp","modifyNumberDown","replace","copylinesup","movelinesup","copylinesdown","movelinesdown","cut_or_delete","blockoutdent","blockindent","splitline","transposeletters","touppercase","tolowercase","expandtoline","joinlines","inverSelection"]),e.commands.addCommand({name:"uncommand",bindKey:{win:"",mac:"Ctrl-A|Ctrl-B|Ctrl-D|Ctrl-E|Ctrl-F|Ctrl-H|Ctrl-K|Ctrl-N|Ctrl-P|Ctrl-V"},exec:function(){return!0},readOnly:!0});var n=s.bind(function(){this.set("wasFocused",!0),e.off("focus",n)},this);e.on("focus",n)}});e.exports=f},{"../services/preview_service":124,"../templates/html_field.tpl":131,"./tooltip":240,"app/components/code-editor/theme/post_form":36,"app/vendor/ace":"4e8++S",jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/translate":456,"prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/view":496}],198:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/lib/translate"),a=t("../templates/id3_editor.tpl"),r=o.extend({className:"id3-editor",events:{"input .id3-editor--input":"_onChangeInput","change .id3-editor--input":"_onChangeInput"},template:a,initialize:function(t){this.options=t=i.extend({},t),i.extend(this,i.pick(t,["post","user"]))},_onChangeInput:function(t){var e=s(t.currentTarget);this.post.set(e.attr("name"),e.val())},serialize:function(){var t={id3Fields:i.pick(this.post.toJSON(),"trackTitle","trackArtist","trackAlbum"),id3FieldLabel:{trackTitle:n("Track"),trackArtist:n("Artist"),trackAlbum:n("Album")}};return t},render:function(){return this.$el.html(this.template(this.serialize())),this}});e.exports=r},{"../templates/id3_editor.tpl":132,jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/translate":456,"prima/view":496}],199:[function(t,e){"use strict";function i(t,e,i){var o=!1,n=function(){o||t.apply(this,arguments)},a=s.debounce(n,e,i),r=function(){o=!1,a.apply(this,arguments)};return r.cancel=function(){o=!0},r}var s=t("lodash"),o=t("prima/view"),n=t("prima/lib/translate"),a=t("prima/mixins/accessor"),r=t("prima/mixins/subviewable"),l=t("prima/mixins/selectorcache"),h=t("app/components/dialog"),d=t("./plaintext_editor"),c=t("components/knight-rider-loader"),u=t("../templates/image-search-field.tpl"),p=o.extend({className:"post-form-image-search",template:u,mixins:[a,r,l],events:{click:"_onClickOutsideInput"},defaults:{query:"",pendingQuery:"",hintText:"",triggerImage:!1,hasResults:!1,loading:!1,enabled:!1,showHint:!1,hintVisibleClass:"image-search-key-hint--visible",errorMessages:null},initialize:function(t){this.options=t=s.extend({},t),s.extend(this.attributes,s.pick(t,s.keys(this.defaults))),this.debouncedSearchQuery=i(this.searchQuery,750),s.isEmpty(this.attributes.errorMessages)&&s.extend(this.attributes,{errorMessages:n("Found nothing")}),this.fetchGifs=t.fetchGifs},_onClickOutsideInput:function(t){this.searchInput&&s.isEmpty(this.searchInput.$el.find(t.target))&&this.focusSearchInput()},show:function(){this.set({hasResults:!1,triggerImage:!1,loading:!1,enabled:!0,image:!1}),this.$el.addClass("open"),this.searchInput.setEditorValue(this.get("query")),this.focusSearchInput(this.get("query"))},hide:function(t){this.set({triggerImage:!1,loading:!1,enabled:!1,pendingQuery:""}),t||this.set("query",""),this.$el.removeClass("open"),delete this.searchResults,delete this.pendingSearch},getCurrentValue:function(){return this.searchInput?this.searchInput.getEditorValue():""},focusSearchInput:function(){this.searchInput.focus()},updateQuery:function(){this.set({triggerImage:!1,query:this.getCurrentValue()})},setHintText:function(t){this.set("hintText",t)},resetHintText:function(){this.set("hintText",this.options.hintText||this.defaults.hintText)},showNoImagesFoundMessage:function(){var t=function(){this.set("showHint",!0)};this.get("loading")?this.listenToOnce(this,"change:loading",t):t.call(this),this.listenToOnce(this,"change:query",this.resetHintText),this.setHintText(this.getNextErrorMessage())},getNextErrorMessage:function(){var t,e=this.get("errorMessages");return s.isArray(e)?(s.isEmpty(this.unseenErrorMessages)&&(this.unseenErrorMessages=e),t=s.sample(this.unseenErrorMessages),this.unseenErrorMessages=s.without(this.unseenErrorMessages,t),t):e},_onInputClientEvent:function(t){if("keydown"===t.type)switch(t.which||t.keyCode){case 27:t.preventDefault(),t.stopImmediatePropagation(),this.options.returnFocus(),this.hide();break;case 13:t.preventDefault(),t.stopImmediatePropagation(),this.debouncedSearchQuery.cancel(),this.searchQuery(!0)}},createSubViews:function(){var t=s.extend({placeholder:n("Search for a GIF"),forceSingleLine:!0,syncWithModel:!1,onChange:s.bind(this.updateQuery,this),onClientEvent:s.bind(this._onInputClientEvent,this),className:"image-search-input"},this.options);this.searchInput=this.subViews.searchInput=new d(t),this.loader=this.subViews.loader=new c({loading:this.get("loading"),variation:"small"})},addEventListeners:function(){this.listenTo(this,"change:loading change:triggerImage",function(){var t=this.get("loading")&&this.get("triggerImage");t&&this.set("showHint",!1),this.loader&&this.loader.set("loading",t)}),this.listenTo(this,"change:query",function(t,e){this.set("showHint",!!e),this.debouncedSearchQuery()}),this.listenTo(this,"change:hintText",function(t,e){this.js$("searchKeyHint").text(e)}),this.listenTo(this,"change:showHint",function(t,e){this.js$("searchKeyHint").toggleClass(this.get("hintVisibleClass"),e)}),this.listenTo(this,"change:hasResults change:triggerImage",function(){this.get("hasResults")&&this.get("triggerImage")&&this.searchResults&&(this.searchResults.media.length>0?this.trigger("searchResults",this.searchResults):this.showNoImagesFoundMessage())})},searchQuery:function(t){var e=s.trim(this.get("query")||"");if(e&&this.get("enabled")&&(this.set({loading:!0,hasResults:!1}),t&&this.set("triggerImage",!0),!this.pendingSearch||this.get("pendingQuery")!==e)){this.set("pendingQuery",e);var i=this.pendingSearch=this.fetchGifs(e);i.then(s.bind(function(t){i===this.pendingSearch&&(this.searchResults=t,this.set("hasResults",!0),s.delay(s.bind(function(){this.set("loading",!1)},this),1e3),this.set("pendingQuery",""))},this),s.bind(function(){i===this.pendingSearch&&(this.set("loading",!1),this.set("pendingQuery",""),this.get("triggerImage")&&h.alert("<p>"+n("¯\\_(ツ)_/¯")+"</p>"))},this))}},serialize:function(){return this.toJSON()},beforeRender:function(){this.$el.html(this.template(this.serialize())),this.createSubViews(),this.addEventListeners()},render:function(){return this.attachSubViews(),this}});e.exports=p},{"../templates/image-search-field.tpl":135,"./plaintext_editor":212,"app/components/dialog":39,"components/knight-rider-loader":353,lodash:"K2RcUv","prima/lib/translate":456,"prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/view":496}],200:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/lib/translate"),n=t("prima/component"),a=t("components/popover").FeatureHelpPopoverView,r=n.extend({name:"InlineControlsTutorial",initialize:function(t){this.options=t=s.extend({},t),this.editor=this.options.richTextEditor,this.popover=new a,this.animationDelay=500,this.config={name:"inline-controls",template:"standard",glass:!1,title:o("But wait, there's more"),content:o("Click the plus sign to insert photos, videos, horizontal lines, or read-more links."),position:a.POSITION.BOTTOM|a.POSITION.LEFT},this.listenTo(this.editor,"controls:show",this._onInlineControlsShow)},show:function(){this.editor.toggleInlineControlsTray(!0),this.listenToOnce(this.editor,"controls:hide controls:embed:prompt controls:gif:prompt",this._onInlineControlsHide),this.listenToOnce(this.editor,"controls:close",this._onInlineControlsClose),this.popover.setHighlighted(i(".post-form .inline-controls .opener")),this.popover.show(this.config),setTimeout(function(){i("body").addClass("animate-inline-controls-tutorial")},this.animationDelay)},showWithDelay:function(){setTimeout(this.show.bind(this),this.animationDelay)},hide:function(){i("body").removeClass("animate-inline-controls-tutorial"),this.stopListening(this.editor,"controls:hide controls:close controls:embed:prompt controls:gif:prompt"),this.popover.hide(),this.trigger("hide",this)},hideWithDelay:function(){setTimeout(this.hide.bind(this),this.animationDelay)},_onInlineControlsShow:function(){this.showWithDelay()},_onInlineControlsClose:function(){this.hideWithDelay()},_onInlineControlsHide:function(){this.hide()},remove:function(){this.hide(),n.prototype.remove.apply(this,arguments)}});e.exports=r},{"components/popover":361,jquery:"HlZQrA",lodash:"K2RcUv","prima/component":428,"prima/lib/translate":456}],201:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/mixins/accessor"),a=t("prima/mixins/subviewable"),r=t("prima/mixins/selectorcache"),l=t("./plaintext_editor"),h=t("../templates/inline_embed_field.tpl"),d=o.extend({className:"post-form--inline-embed-field",template:h,mixins:[n,a,r],initialize:function(t){this.options=i.extend({},this.defaults,t)},show:function(){this.inlineEmbedInput.setEditorValue(""),i.defer(i.bind(function(){this.inlineEmbedInput.focus()},this));var t=this.options.calculateWidth();this.$el.add(this.inlineEmbedInput.element).width(t),this.$el.addClass("open")},hide:function(){this.$el.removeClass("open")},getCurrentValue:function(){return this.inlineEmbedInput?this.inlineEmbedInput.getEditorValue():""},createSubViews:function(){var t=i.extend({placeholder:this.options.placeholder,ariaLabel:this.options.placeholder,name:"inlineEmbedInput",forceSingleLine:!0,syncWithModel:!1,pasteHook:i.bind(this._onInputPaste,this),onChange:i.bind(this._onInputChange,this),onClientEvent:i.bind(this._onInputClientEvent,this)});this.inlineEmbedInput=this.subViews.inlineEmbedInput=new l(t)},_set_field_state_default:function(){s(this.inlineEmbedInput.editor.element).removeClass("invalid")},_set_field_state_invalid:function(){s(this.inlineEmbedInput.editor.element).addClass("invalid")},_onInputChange:function(){this.getCurrentValue()!==this.get("embedCode")&&this._set_field_state_default()},_onInputPaste:function(){i.defer(i.bind(this.options.submitEmbedCode,this))},_onInputClientEvent:function(t){if("keydown"===t.type)switch(t.which||t.keyCode){case 27:t.preventDefault(),t.stopImmediatePropagation(),this.options.returnFocus(),this.hide();break;case 13:t.preventDefault(),t.stopImmediatePropagation(),this.options.submitEmbedCode()}},beforeRender:function(){this.$el.html(this.template()),this.createSubViews()},render:function(){return this.attachSubViews(),this}});e.exports=d},{"../templates/inline_embed_field.tpl":136,"./plaintext_editor":212,jquery:"HlZQrA",lodash:"K2RcUv","prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/view":496}],202:[function(t,e){"use strict";var i=t("lodash"),s=t("./base"),o=t("../id3_editor"),n=t("../album_art_uploader"),a=t("app/components/remove-button"),r=t("./audio_player_shim"),l=t("../../templates/media/audio.tpl"),h=s.extend({className:"audio-media-container media-container",defaults:i.defaults({url:"",service:"",albumArt:"",type:"",id:""},s.prototype.defaults),events:{mouseenter:"_onHoverRemoveButton",mouseleave:"_onHoverRemoveButton"},template:l,beforeTeardown:function(){return delete this.audioPlayer,this.$el.removeClass(this.post.get("service")),this.$el.empty(),this},_onHoverRemoveButton:function(t){var e="mouseover"===t.type||"mouseenter"===t.type;this.js$("removeButton").toggleClass("active",e)},beforeRender:function(){this.removeButton=this.subViews.removeButton=new a({onClick:i.bind(function(){this.trigger("media:remove",this)},this),buttonClass:"top-right"}),this.$el.addClass(this.post.get("service")),"direct"===this.post.get("service")&&(this.post.canEditMedia()&&(this.id3Editor=this.subViews.id3Editor=new o(this.options),this.albumArtUploader=this.subViews.albumArtUploader=new n(i.defaults({url:this.post.get("albumArt")||""},this.options))),this.audioPlayer=this.subViews.audioPlayer=new r({extra_classes:null,post_id:"",service:"upload",lightbox:!1,preview:this.post.canEditMedia(),cover:this.post.get("albumArt"),tracks:[{stream_url:this.post.get("url"),cover:this.post.get("albumArt"),track:this.post.get("trackTitle"),artist:this.post.get("trackArtist"),album:this.post.get("trackAlbum")}]}))},afterRender:function(){this.listenTo(this.post,"change:url change:service",function(t){this.$el.removeClass(t.previous("service")),this.teardown().render()}),this.renderSubViews(),this.trigger("media:ready",this)}});e.exports=h},{"../../templates/media/audio.tpl":137,"../album_art_uploader":189,"../id3_editor":198,"./audio_player_shim":203,"./base":204,"app/components/remove-button":256,lodash:"K2RcUv"}],203:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/subviewable"),n=t("prima/utils/getpath"),a=n("window.Tumblr.AudioPlayer"),r=s.extend({mixins:[o],initialize:function(t){this.options=i.extend({},t)},teardown:function(){return this.audioPlayer.unbind_events(),this.$el.empty(),delete this.audioPlayer,this},render:function(){a||(a=n("window.Tumblr.AudioPlayer"));var t=i.defaults({replace:null,append_to:null,prepend_to:this.$el},this.options);return this.audioPlayer=new a(t),this.options.preview&&this.audioPlayer.$container.addClass("has_art"),this.$el.toggleClass("audio-player--preview-player",this.options.preview),this}});e.exports=r},{lodash:"K2RcUv","prima/mixins/subviewable":468,"prima/utils/getpath":484,"prima/view":496}],204:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/accessor"),n=t("prima/mixins/subviewable"),a=t("prima/mixins/selectorcache"),r=i.template(""),l=s.extend({className:"media-container",template:r,mixins:[o,n,a],defaults:{canEditMedia:!0},defaultOptions:{},initialize:function(t){this.options=t=i.extend({},this.defaultOptions,t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),i.extend(this,i.pick(t,["post","user","uploads","dragEvents"])),i.isFunction(this.afterInitialize)&&this.afterInitialize.apply(this,arguments)},serialize:function(){return this.toJSON()},teardown:function(){return this.stopListening(),this},render:function(){return this.$el.html(this.template(this.serialize())),this.attachSubViews(),this}});e.exports=l},{lodash:"K2RcUv","prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/view":496}],205:[function(t,e){"use strict";var i=t("lodash"),s=t("app/components/photoset/views/photo"),o=t("app/components/remove-button"),n=s.prototype.template,a=t("../../templates/media/edit_photo.tpl"),r=s.extend({className:"photoset--photo media-container",events:i.extend({mouseenter:"_onHoverMediaContainer",mouseleave:"_onHoverMediaContainer","click [data-js-clickthroughUrlButton]":"_onClickClickthroughUrlButton","click [data-js-captionButton]":"_onClickCaptionButton"},s.prototype.events),defaults:i.extend({enableClickthroughUrl:!1,hasClickthroughUrl:!1,enableCaption:!1,hasCaption:!1,isActive:!1},s.prototype.defaults),template:function(t){return n(t)+a(t)},_onHoverMediaContainer:function(t){clearTimeout(this._removeButtonActive);var e="mouseover"===t.type||"mouseenter"===t.type;e?(this.set("isActive",!0),this.trigger("photoset:hover",this,this.photo)):this._removeButtonActive=i.delay(i.bind(function(){this.set("isActive",!1)},this),500)},_onClickClickthroughUrlButton:function(t){this.photo.trigger("photo:editClickthroughUrl",this.photo,t.currentTarget)},_onClickCaptionButton:function(t){this.photo.trigger("photo:editCaption",this.photo,t.currentTarget)},_updateOverlayButtons:function(){this.js$("clickthroughUrlButton").css("display",this.get("enableClickthroughUrl")?"block":"none"),this.js$("captionButton").css("display",this.get("enableCaption")?"block":"none"),this.js$("clickthroughUrlButton").toggleClass("active",this.get("hasClickthroughUrl")),this.js$("captionButton").toggleClass("active",this.get("hasCaption"))},addStateListeners:function(){this.listenTo(this,"change:isActive",function(t,e){this.js$("removeButton").toggleClass("active",e),this.js$("mediaOverlay").toggleClass("active",e)}),this.listenTo(this,"photoset:unhover",function(){this.set("isActive",!1)}),this.listenTo(this,"change:enableClickthroughUrl change:enableCaption",this._updateOverlayButtons),this.listenTo(this,"change:hasClickthroughUrl change:hasCaption",this._updateOverlayButtons),this.listenTo(this.photos,"add remove",function(){this.photos.length>1?this.js$("sortable").attr("draggable",!0):this.js$("sortable").removeAttr("draggable")}),this.post&&this.listenTo(this.post,"change:linkthrough",function(t,e){this.set("hasClickthroughUrl",!!e)}),this.listenTo(this.photo,"change:caption",function(t,e){this.set("hasCaption",!!e)})},beforeRender:function(){var t=this.photos.length>1;this.set("enableClickthroughUrl",!t),this.set("enableCaption",t),this.set("hasClickthroughUrl",this.post?!!this.post.get("linkthrough"):!1),this.set("hasCaption",!!this.photo.get("caption")),this.removeButton=this.subViews.removeButton=new o({onClick:i.bind(function(){this.photoset.removePhoto(this.photo.id)},this),buttonClass:"top-right"}),this.addStateListeners()},afterRender:function(){s.prototype.afterRender.apply(this,arguments),this.photos.length>1&&this.js$("sortable").attr("draggable",!0),this._updateOverlayButtons()}});e.exports=r},{"../../templates/media/edit_photo.tpl":138,"app/components/photoset/views/photo":79,"app/components/remove-button":256,lodash:"K2RcUv"}],206:[function(t,e){"use strict";var i=t("lodash"),s=t("./base"),o=t("prima/lib/translate"),n=t("app/components/photoset"),a=t("app/components/photoset/models/photo"),r=t("app/components/photoset/views/editable_photoset"),l=t("app/components/webcam"),h=t("./edit_photo"),d=t("prima/mixins/promisifyevents"),c=t("../overlay_input"),u=t("../../templates/media/photo.tpl"),p=s.extend({className:"media-container photo-media-container",template:u,mixins:[d],defaults:i.defaults({canPreview:!0,showPhotoBooth:!1,minFullWidthSize:{}},s.prototype.defaults),afterInitialize:function(){this.addStateListeners(),this._updatePhotosetView=i.debounce(this.updatePhotosetView,50)},addStateListeners:function(){this.listenTo(this.post.photos,"add",this._onPhotosAdd),this.listenTo(this.post.photos,"remove",this._onPhotosRemove),this.listenTo(this,"change:showPhotoBooth",function(t,e){e?(this._createPhotoBooth(),this.js$("photoset").css("display","none")):(this.stopListening(this.photobooth),this.photobooth.remove(),this.js$("photoset").css("display",""))})},updatePhotosetView:function(){this.photoset.model.fixLayout(),this.photoset.indexView.trigger("update",this.photoset.model.photos,this.photoset.model.get("layout"))},_onPhotosAdd:function(t){this.post.set("linkthrough",""),t=this._preparePhotosetPhotoModel(t),this.photoset.model.add(t),this._updatePhotosetView()},_onPhotosRemove:function(t){this.post.set("linkthrough",""),this.photoset.model.remove(t.id),this.updatePhotosetView()},_preparePhotosetPhotoModel:function(t){i.isFunction(t.toJSON)&&(t=t.toJSON()),t.url=t.displayUrl;var e=i.keys(a.prototype.defaults);return e.unshift("id"),i.pick(t,e)},_syncPostToPhotoset:function(t){t||(t=this.photoset.model);var e=this.post.photos.map(this._preparePhotosetPhotoModel,this);t.photos.reset(e),t.set("layout",this.post.get("layout"))},_createPhotoBooth:function(){var t=this.photobooth=new l;t.render(),this.listenTo(t,"webcam:image",function(t){t&&t.base64&&this.post.photos.unshift({photoRaw:t.base64.split("base64,")[1],base64:t.base64,isSelfie:!0,isSelfieGif:t.isGif||!1,height:t.height,width:t.width})}),this.listenTo(t,"webcam:error",function(t){this.trigger("webcam:error",t)}),this.listenTo(t,"webcam:reset",function(){this.post.photos.shift()}),this.listenTo(t,"webcam:close",function(){this.post.photos.shift(),this.trigger("webcam:close")}),this.js$("photobooth").append(t.getElement())},_createPhotoset:function(){var t={dynamic:!0,padding:2,width:540,minFullWidthSize:this.options.fullWidthInlineMedia?this.get("minFullWidthSize"):300,addMargin:this.options.fullWidthInlineMedia};this.get("canEditMedia")&&(t.PhotosetView=r,t.PhotoView=h,t.post=this.post);
var e=this.photoset=new n(t);return this._syncPostToPhotoset(e.model),this.get("canEditMedia")&&(this.listenTo(this.photoset,"change:layout",function(t,e){this.post.set("layout",e)}),this.listenTo(this.photoset,"sort",function(t){this.post.photos.setIdOrder(t.pluck("id"))}),this.listenTo(this.photoset,"photo:remove",function(t,e,i){this.set("layout",i),this.post.photos.remove(e)}),this.listenTo(this.photoset.indexView,"photoset:predrag",function(){this.overlayPopover&&this.overlayPopover.teardown()}),this.listenTo(this.photoset,"photo:editClickthroughUrl",this._createClickthroughUrlPopover),this.listenTo(this.photoset,"photo:editCaption",this._createCaptionPopover),this.listenTo(this.photoset,"change:caption",function(t,e){var i=this.post.photos.get(t.id);i&&i.set("caption",e)})),this.photoset.model.fixLayout(),e.render(),this.js$("photoset").append(e.getElement()),this.get("canEditMedia")&&this.listenTo(this.dragEvents,"drop",this._onDrop),e},_createClickthroughUrlPopover:function(t,e){this.overlayPopover&&(this.overlayPopover=this.overlayPopover.remove());var s=this.overlayPopover=new c({pinnedTarget:e,pinnedTargetContainer:this.photoset.getElement(),value:this.post.get("linkthrough"),ariaLabel:o("Clickthrough URL"),placeholder:"http://"});s.render(),this.listenTo(s,"change:value",function(t,e){e=i.trim(e||""),this.post.set("linkthrough",e)}),this.listenToOnce(s,"close",function(){this.stopListening(s),delete this.overlayPopover})},_createCaptionPopover:function(t,e){this.overlayPopover&&(this.overlayPopover=this.overlayPopover.remove());var s=this.overlayPopover=new c({pinnedTarget:e,pinnedTargetContainer:this.photoset.getElement(),maxLength:200,value:t.get("caption"),placeholder:o("Caption this photo"),updateShift:!1});s.render(),this.listenTo(s,"change:value",function(e,s){t.set("caption",i.trim(s||""))}),this.listenToOnce(s,"close",function(){this.stopListening(s),delete this.overlayPopover})},_onDrop:function(t){if(!i.isEmpty(this.$el.find(t.target))){t.preventDefault();var e=i.result(t.originalEvent.dataTransfer,"files");e&&this.trigger("media:addFiles",e)}},beforeTeardown:function(){this.photobooth&&(this.stopListening(this.photobooth),this.photobooth.remove()),delete this.photobooth,this.photoset&&(this.stopListening(this.photoset),this.photoset.remove()),delete this.photoset,this.overlayPopover&&(this.overlayPopover.remove(),this.stopListening(this.overlayPopover)),delete this.overlayPopover},afterRender:function(){this.js$("photobooth",!0),this.js$("photoset",!0),this._createPhotoset(),this.photobooth=!1,this.trigger("media:ready",this),this.renderSubViews()}});e.exports=p},{"../../templates/media/photo.tpl":139,"../overlay_input":210,"./base":204,"./edit_photo":205,"app/components/photoset":69,"app/components/photoset/models/photo":70,"app/components/photoset/views/editable_photoset":78,"app/components/webcam":269,lodash:"K2RcUv","prima/lib/translate":456,"prima/mixins/promisifyevents":466}],207:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("when"),n=t("prima/utils/delayed"),a=t("./base"),r=t("prima/mixins/promisifyevents"),l=t("components/crt/player"),h=t("prima/lib/translate"),d=t("../../utils/scale_to_width"),c=t("app/components/remove-button"),u=t("../../templates/media/video.tpl"),p=t("../../templates/media/video_upload.tpl"),m=t("../../templates/media/video_embed.tpl"),g=t("../../templates/media/video_error.tpl"),f=a.extend({className:"media-container video-media-container",events:{mouseenter:"_onHoverRemoveButton",mouseleave:"_onHoverRemoveButton"},template:u,mixins:[r],defaults:i.defaults({canPreview:!0,file:!1,embed:!1,width:!1,height:!1},a.prototype.defaults),afterInitialize:function(){this.addStateListeners()},addStateListeners:function(){this.listenTo(this,"change",this._onChangeVideo),this.listenTo(this.post,"change:preuploadUrl",this._onChangePreuploadUrl)},_onHoverRemoveButton:function(t){var e="mouseover"===t.type||"mouseenter"===t.type;this.js$("removeButton").toggleClass("active",e)},_onChangeVideo:function(){(this.hasChanged("file")||this.hasChanged("embed")||this.hasChanged("canPreview"))&&(this.hasChanged("file")?this.attributes.embed=!1:this.hasChanged("embed")&&(this.attributes.file=!1),this.hasChanged("canPreview")||this.set("canPreview",!0),this.isRendered()&&(this.teardown(),this.render(),this.addStateListeners()))},_onChangePreuploadUrl:function(t,e){this._updateUploadPreview(e,this.get("file"))},_updateUploadPreview:function(t,e){var i=e&&e.name?'"'+e.name+'"':"";t?(this.js$("previewIcon").removeClass("video-uploading").addClass("video-check"),this.js$("previewMessage").html(h("Your video %1$s has been uploaded",i))):(this.js$("previewIcon").removeClass("video-check").addClass("video-uploading"),this.js$("previewMessage").html(h("Uploading your video %1$s",i)))},_createVideoPlayer:function(t){if(!this.get("canPreview"))return this.js$("video").html(p({icon:"",message:""})),void this._updateUploadPreview(this.post.get("preuploadUrl"),t);var e=540,s=this.get("width"),n=this.get("height"),a=s&&n?d(s,n,e):{width:e};i.extend(a,{file:t,techOrder:["html5"]});var r=this.player=new l(document.createElement("video"),{attributes:{watch:!1},vjsOptions:a}),h=!1,c=this.whenEvent(r,"ready");return c.then(function(){r.player.on("error",function(){h=!0,i.defer(function(){this.set("canPreview",!1),this.trigger("media:ready",this)}.bind(this))}.bind(this))}.bind(this)),o.join(this.whenEvent(r,"change:loaded"),c).then(function(){if(!h){this.js$("video").append(r.$el);var t={width:"auto",height:"auto"},i=r.$video.prop("videoWidth"),s=r.$video.prop("videoHeight");i&&s&&(t=d(i,s,e)),r.$el.css(t),this.trigger("media:ready",this)}}.bind(this)),r.render(),r},_createVideoEmbed:function(){var t=function(t){return s('<a href="'+t.get("blog_url")+'"></a>').prop("hostname")}(this.user.getChannel(this.post.get("tumblelog"))),e=this.get("embed"),o=i.extend({tumblelogHostname:t},e);this.js$("video").html(m(o)),"inline"===e.embedRenderContext?n(function(){this.trigger("media:ready",this)},250,this)():this.trigger("media:ready",this)},beforeTeardown:function(){this.player&&this.player.teardown(),delete this.player},beforeRender:function(){this.removeButton=this.subViews.removeButton=new c({onClick:function(){this.trigger("media:remove",this)}.bind(this),buttonClass:"top-right"})},afterRender:function(){this.js$("video",!0),this.renderSubViews(),this.player=!1,this.get("file")?this._createVideoPlayer(this.get("file")):this.get("embed")?i.isEmpty(this.get("embed"))?(this.js$("video").html(g()),this.trigger("media:ready",this)):this._createVideoEmbed(this.get("embed")):this.trigger("media:ready",this)}});e.exports=f},{"../../templates/media/video.tpl":140,"../../templates/media/video_embed.tpl":141,"../../templates/media/video_error.tpl":142,"../../templates/media/video_upload.tpl":143,"../../utils/scale_to_width":186,"./base":204,"app/components/remove-button":256,"components/crt/player":324,jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/translate":456,"prima/mixins/promisifyevents":466,"prima/utils/delayed":479,when:"RG2dij"}],208:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/lib/translate"),a=(t("prima/lib/logger"),t("app/components/upload")),r=t("./plaintext_editor"),l=t("app/components/remove-button"),h=t("./tooltip"),d=t("prima/mixins/accessor"),c=t("prima/mixins/subviewable"),u=t("prima/mixins/selectorcache"),p=t("../templates/media_dropzone.tpl"),m=s(document),g=o.extend({className:"media-dropzone-container media-container",template:p,mixins:[d,c,u],defaults:{droppable:!1,showInput:!1,toggleDropzone:!1,dropzoneText:"",enableUpload:!0,enableUrl:!0,uploadIcon:"",uploadText:"",uploadTooltip:"",urlIcon:!1,urlText:"",urlTooltip:"",url:"",urlPlaceholder:"http://",urlAriaLabel:n("Paste a URL")},defaultOptions:{uploadOptions:{},modelKey:!1,urlParser:!1,documentDrag:!0,parseOnUpload:!1,parseOnInput:!1,parseOnEnter:!0,parseOnPaste:!0,inputDebounceTime:250},events:{mouseenter:"_onHoverMediaContainer",mouseleave:"_onHoverMediaContainer","click [data-show-tooltip]":"_onClickShowTooltip","click [data-js-mediaUrl]":"_focusUrlInput"},initialize:function(t){this.options=t=i.extend({},this.defaultOptions,t),i.isString(t.dropzoneFineprint)&&(t.dropzoneFineprint=[t.dropzoneFineprint]),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),i.defaults(this.attributes,{defaultBehavior:this.get("enableUpload")?"upload":"url",dropzoneBehavior:this.get("enableUpload")?"upload":"url",splitDropzone:this.get("enableUpload")&&this.get("enableUrl")}),this.upload=new a(t.uploadOptions),t.modelKey&&this.listenTo(this.upload,"change:url",this._onUploadUrlChange),this.listenTo(this.upload,"add",function(t){this.trigger("upload:start",t)}),this.listenTo(this.upload,"complete",function(t,e){this.trigger("upload:complete",e)}),this.listenTo(this.upload,"error",function(t,e){this.trigger("upload:error",e)}),this.listenTo(this.upload,"invalid",function(t,e){this.trigger("upload:invalid",e)}),this.listenTo(this.upload,"allComplete",function(t){this.trigger("uploads:allComplete",t)}),this.listenTo(this,"change:droppable",function(t,e){this.js$("dropzone").toggleClass("droppable",e)}),this.listenTo(this,"change:showInput",function(t,e){e?(this.js$("dropzone").addClass("show-input"),this._onUrlInputChange()):(this.js$("dropzone").removeClass("show-input"),this.js$("dropzone").height(""),this.get("defaultBehavior")!==this.get("dropzoneBehavior")&&this.set("dropzoneBehavior",this.get("defaultBehavior")))}),this.listenTo(this,"change:toggleDropzone",function(t,e){e?(this.js$("dropzone").addClass("toggle-dropzone"),this.js$("mediaUploadText").text(this.get("dropzoneText")),this.js$("mediaUrlText").text(this.get("dropzoneText"))):(this.js$("dropzone").removeClass("toggle-dropzone"),this.js$("mediaUploadText").text(this.get("uploadText")),this.js$("mediaUrlText").text(this.get("urlText")))}),this.listenTo(this,"change:dropzoneBehavior",function(t,e){this.js$("dropzone").removeClass("toggle-dropzone-upload toggle-dropzone-url").addClass("toggle-dropzone-"+e)}),this.__updateUrlFromInput=i.debounce(this._updateUrlFromInput,this.options.inputDebounceTime),this.__onDragOver=i.bind(this._onDragOver,this),this.__onDragLeave=i.bind(this._onDragLeave,this)},urlParser:function(t,e){return i.isFunction(this.options.urlParser)?this.options.urlParser(t,this,e):void 0},addFiles:function(t){return this.upload.addFiles(t)},_addDragStartListener:function(){s(document).on("dragover.dropzone dragenter.dropzone",this.__onDragOver)},_removeDragStartListener:function(){s(document).off("dragover.dropzone dragenter.dropzone",this.__onDragOver)},_addDragEndListener:function(){s(document).on("mouseout.dropzone",this.__onDragLeave)},_removeDragEndListener:function(){s(document).off("mouseout.dropzone",this.__onDragLeave)},_onDragOver:function(){this._dragging=!0,this.set("droppable",!0),this._removeDragStartListener(),this._addDragEndListener()},_onDragLeave:function(){this._dragging=!1,this.set("droppable",!1),this._addDragStartListener(),this._removeDragEndListener()},_onClickShowTooltip:function(t){var e=this.$(t.currentTarget).data("showTooltip"),s=i.result(this,e);s&&s instanceof h&&!s.isOrWasRecentlyRendered()&&s.render()},_focusUrlInput:function(t){return this.js$("removeButton").is(t.target)||this.js$("removeButton").find(t.target).length?!0:(this.set("showInput",!0),void(this.urlInput&&this.urlInput.focus()))},_onUploadUrlChange:function(t,e){this.model&&(this.model.set(this.options.modelKey,e),this.options.parseOnUpload&&this.urlParser(e,"upload"))},_updateUrlFromInput:function(){var t=this.urlInput?i.trim(this.urlInput.getEditorValue()||""):"";this.set("url",t)},_onUrlInputChange:function(){this.urlInput&&this.get("showInput")&&(this.js$("dropzone").height(this.urlInput.$el.height()),this.__updateUrlFromInput())},_onUrlInputClientEvent:function(t){if("keydown"===t.type)switch(t.which||t.keyCode){case 27:t.preventDefault(),t.stopImmediatePropagation(),this.set("showInput",!1),this.urlInput.setEditorValue(""),this.urlInput.blur();break;case 13:this.options.parseOnEnter&&!t.shiftKey?(t.preventDefault(),t.stopImmediatePropagation(),this._updateUrlFromInput(),this.urlParser(this.get("url"),"enter")):this.options.parseOnInput&&(this.urlParser(this.get("url")),this.listenToOnce(this,"change:url",function(t,e){this.urlParser(e,"input")}));break;default:this.options.parseOnInput&&(this.urlParser(this.get("url")),this.listenToOnce(this,"change:url",function(t,e){this.urlParser(e,"input")}))}},_onUrlInputPasteEvent:function(){i.delay(i.bind(function(){this.options.parseOnPaste&&(this._updateUrlFromInput(),this.urlParser(this.get("url"),"paste"))},this),0)},_onHoverMediaContainer:function(t){clearTimeout(this._removeButtonActive);var e="mouseover"===t.type||"mouseenter"===t.type;e?this.js$("removeButton").addClass("active"):this._removeButtonActive=i.delay(i.bind(function(){this.js$("removeButton").removeClass("active")},this),500)},serialize:function(){return i.mapValues(this.toJSON(),function(t,e){return i.isFunction(t)&&e.match(/^(upload|url)(Icon|Text|Tooltip)$/)?t():t},this)},beforeTeardown:function(){this.upload.getElement().detach(),this.subViews.upload=void 0,m.off("keydown.postForm.dropzone keyup.postForm.dropzone")},afterTeardown:function(){this.uploadTooltip&&this.uploadTooltip.remove(),this.urlTooltip&&this.urlTooltip.remove(),delete this.uploadTooltip,delete this.urlTooltip,delete this.urlInput,delete this.urlInput,delete this.removeButton,this._removeDragStartListener(),this._removeDragEndListener()},beforeRender:function(){if(this.subViews.upload=this.upload.indexView,this.get("enableUrl")){var t={placeholder:this.get("urlPlaceholder"),name:"url",ariaLabel:this.get("urlAriaLabel"),syncWithModel:!1,onChange:i.bind(this._onUrlInputChange,this),onClientEvent:i.bind(this._onUrlInputClientEvent,this),pasteHook:i.bind(this._onUrlInputPasteEvent,this)};i.defaults(t,i.pick(this.options,i.keys(t))),this.urlInput=this.subViews.urlInput=new r(t),this.removeButton=this.subViews.removeButton=new l({onClick:i.bind(function(){this.set("showInput",!1),this.urlInput.setEditorValue("")},this),buttonClass:"top-right"})}m.on("keydown.postForm.dropzone keyup.postForm.dropzone",i.bind(function(t){switch(t.which||t.keyCode){case 18:var e=this.get("defaultBehavior"),i="url"===e?"upload":"url";"keydown"===t.type?this.set("dropzoneBehavior",i):this.get("showInput")||this.set("dropzoneBehavior",e)}},this)),this.options.documentDrag&&this._addDragStartListener()},afterRender:function(){this.get("enableUrl")&&this.urlInput.setEditorValue(this.get("url")||""),this.get("enableUpload")&&this.get("uploadTooltip")&&(this.uploadTooltip=new h({className:"dropzone-tooltip-popover",sanitize:!1,text:i.result(this.attributes,"uploadTooltip")}),this.uploadTooltip.setPinnedTarget(this.js$("uploadTooltip"))),this.get("enableUrl")&&this.get("urlTooltip")&&(this.urlTooltip=new h({className:"dropzone-tooltip-popover",sanitize:!1,text:i.result(this.attributes,"urlTooltip")}),this.urlTooltip.setPinnedTarget(this.js$("urlTooltip"))),this.renderSubViews()},render:function(){return this.$el.html(this.template(this.serialize())),this.attachSubViews(),this}});e.exports=g},{"../templates/media_dropzone.tpl":144,"./plaintext_editor":212,"./tooltip":240,"app/components/remove-button":256,"app/components/upload":266,jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/logger":436,"prima/lib/translate":456,"prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/view":496}],209:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/events"),a=t("../models/mention"),r=t("prima/mixins/accessor"),l=t("prima/mixins/popoverbase"),h=t("prima/mixins/selectorcache"),d=t("../templates/mention_dropdown.tpl"),c=function(){},u=o.extend({className:"popover--mention-dropdown",defaults:{currentKeyedChoice:-1,currentMousedChoice:-1,interactive:!1,lastResults:{},debugMode:!1},mixins:[r,h,l],template:d,initialize:function(){this.model=new a,this.listenTo(this,"change:lastResults",this.preRender),c=i.bind(c,this)},preRender:function(t,e){var i=(e.blogs||[]).length;c("MentionDropdown - PreRender with %d results.",i),this.set({currentKeyedChoice:-1,currentMousedChoice:-1,interactive:!1}),i?(this._rendered&&this.teardown(!0),this.set("numSuggestions",i),this.render(e)):this.trigger("dropdown:empty")},render:function(t){return c("MentionDropdown - Render"),this.$el.html(this.template(t)),this.trigger("dropdown:render"),n.trigger("postForms:dismissListener:suspend"),this},afterRender:function(){s(".item-option",this.$el).on("mousedown",i.bind(this.handleMouseClick,this)),s(".item-option",this.$el).on("mouseover",i.bind(this.handleMouseOver,this)),this.$el.on("mouseout",i.bind(this.handleMouseOut,this))},teardown:function(t){return this.$el.remove(),t||this.set({interactive:!1,lastResults:{}}),n.trigger("postForms:dismissListener:resume"),this},updateMentionDropdown:function(t,e){c("MentionDropdown - fetch callback",e),this.set("lastResults",e)},cycleUp:function(){this._cycle(-1)},cycleDown:function(){this._cycle(1)},_cycle:function(t){var e=this.get("currentKeyedChoice"),s=this.get("currentMousedChoice"),o=i.isNumber(s)&&-1!==s,n=o?s:e,a=this.get("numSuggestions"),r=(n+t)%a;a&&(this.set({currentKeyedChoice:0>r?a-1:r,currentMousedChoice:-1}),this.styleMenuItems(),this.set("interactive",this.get("currentKeyedChoice")>=0),this.trigger("dropdown:menuInteraction",!0))},styleMenuItems:function(t){var e,o=t&&"mouseout"!==t.type,n=this.get("currentKeyedChoice");i.each(s(".item-option",this.$el),function(i,a){o?s(i).toggleClass("cycled",t.currentTarget===i):(s(i).toggleClass("cycled",a===n),a===n&&(e=s(i)))},this)},handleMouseOver:function(t){var e=s(t.currentTarget).index(".item-option");this.styleMenuItems(t),this.set({interactive:!0,currentMousedChoice:e}),this.trigger("dropdown:menuInteraction",!0)},handleMouseOut:function(t){var e=-1!==this.get("currentKeyedChoice");this.styleMenuItems(t),this.set({interactive:e,currentMousedChoice:-1}),this.trigger("dropdown:menuInteraction",e)},handleMouseClick:function(t){this.set("interactive",!0),s(t.currentTarget).addClass("cycled"),this.trigger("dropdown:confirm")},getCurrentBlogChoice:function(){var t=this.get("lastResults");if(!this._rendered||i.isEmpty(t)||!("blogs"in t))return!1;var e=this.get("currentMousedChoice"),s=this.get("currentKeyedChoice"),o=0;return e>=0?o=e:s>=0&&(o=s),t.blogs[o]},getBlogChoice:function(t){var e=this.get("lastResults");return!1===i.isEmpty(e)&&"blogs"in e&&e.blogs[t]?e.blogs[t]:!1}});e.exports=u},{"../models/mention":105,"../templates/mention_dropdown.tpl":145,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/mixins/accessor":458,"prima/mixins/popoverbase":465,"prima/mixins/selectorcache":467,"prima/view":496}],210:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("when"),n=t("velocity-animate").animate,a=t("app/components/post-form-builder/utils/transition_speed"),r=t("prima/lib/translate"),l=t("prima/view"),h=t("prima/mixins/selectorcache"),d=t("prima/mixins/accessor"),c=t("prima/mixins/popoverbase"),u=t("../templates/overlay_input.tpl"),p=l.extend({className:"overlay-input-popover",mixins:[h,d,c],template:u,events:{"keydown [data-js-input]":"_onKeyDown","input [data-js-input]":"_onInput","keyup [data-js-input]":"_onInput","change [data-js-input]":"_onInput","click [data-js-confirm]":"_onClickConfirm"},defaultOptions:{updateValueOnInput:!1,updateValueOnClose:!0,updateShift:!0},defaults:{value:"",placeholder:"",ariaLabel:"",maxLength:2048,confirmText:r("Done")},initialize:function(t){this.options=t=i.extend({},this.defaultOptions,t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),this.$pinnedContainer=s(t.pinnedTargetContainer)},_onKeyDown:function(t){switch(t.which||t.keyCode){case 13:this._onClickConfirm();break;case 27:t.stopPropagation(),this.teardown()}},_onInput:function(){this.options.updateValueOnInput&&this._updateValueFromInput()},_onClickConfirm:function(){this._updateValueFromInput(),this.teardown()},_updateValueFromInput:function(){var t=this.js$("input").val();this.set("value",t)},openAnimation:function(t){i.isNumber(t)||(t=a(100)),this._startWidth=this.$pinned.outerWidth(),this.js$("popover").width(this._startWidth);var e=this.$pinned.position().left;return this._offsetLeft=i.isEmpty(this.$pinnedContainer)?0:this.$pinnedContainer.offset().left-this.$pinned.offset().left+e||0,this.options.updateShift&&this.setShift(i.defaults({x:this._offsetLeft},this.getShift())),o.all([n(this.$pinned,{opacity:0},{display:"none",duration:t}),n(this.js$("confirm"),{opacity:1},{duration:t}),n(this.js$("popover"),{marginLeft:this._offsetLeft,width:this._targetWidth},{duration:t})])},pinnedRect:function(){var t=this.$pinned.css("display");this.$pinned.css("display","block");var e=c.properties.defaults.pinnedRect.apply(this,arguments);return this.$pinned.css("display",t),e},closeAnimation:function(t){return i.isNumber(t)||(t=a(100)),o.all([n(this.$pinned,{opacity:1},{display:"block",duration:t}),n(this.js$("confirm"),{opacity:0},{duration:t}),n(this.js$("popover"),{marginLeft:0,width:this._startWidth},{duration:t})])},serialize:function(){return this.toJSON()},render:function(){return this.$el.html(this.template(this.serialize())),this._targetWidth=i.isEmpty(this.$pinnedContainer)?520:this.$pinnedContainer.outerWidth()-20,this.setPinnedSide(!1),i.defer(i.bind(function(){this.openAnimation().then(i.bind(function(){this.js$("input").focus()},this))},this)),this},teardown:function(){return this.options.updateValueOnClose&&this._updateValueFromInput(),this.stopListening(),this.closeAnimation().then(i.bind(function(){this.remove()},this)),this}});e.exports=p},{"../templates/overlay_input.tpl":146,"app/components/post-form-builder/utils/transition_speed":91,jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/translate":456,"prima/mixins/accessor":458,"prima/mixins/popoverbase":465,"prima/mixins/selectorcache":467,"prima/view":496,"velocity-animate":"lWl/mc",when:"RG2dij"}],211:[function(t,e){"use strict";var i=t("lodash"),s=t("./media_dropzone"),o=t("./webcam_button"),n=t("app/components/webcam/utils/get_user_media"),a=s.extend({defaults:i.extend({enableSelfie:n},s.prototype.defaults),events:i.extend({"click [data-js-webcamButton]":"_onClickWebcamButton"},s.prototype.events),_onClickWebcamButton:function(){this.trigger("webcam:show")},afterRender:function(){if(s.prototype.afterRender.apply(this,arguments),this.get("enableSelfie")){var t=this.subViews.webcamButton=new o;t.render().$el.appendTo(this.js$("mediaUpload").children(".split-cell-inner")),this.listenTo(this,"change:enableSelfie",function(e,i){i||(t.teardown().remove(),this.subViews.webcamButton=null,this.stopListening(this,"change:enableSelfie"))})}}});e.exports=a},{"./media_dropzone":208,"./webcam_button":245,"app/components/webcam/utils/get_user_media":274,lodash:"K2RcUv"}],212:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/events"),a=t("ligature"),r=t("prima/mixins/subviewable"),l=t("prima/mixins/selectorcache"),h=t("prima/mixins/accessor"),d=t("../templates/plaintext_editor.tpl"),c=o.extend({defaults:{placeholder:"",name:"",syncWithModel:!0,forceSingleLine:!1,smartQuotesEnabled:!1},events:{},mixins:[h,r,l],template:d,initialize:function(t){this.set(t),this.onChange=t.onChange||i.noop,this.onClientEvent=t.onClientEvent||i.noop,this.pasteHook=t.pasteHook||i.noop,this.smartQuotesEnabled=t.smartQuotesEnabled;var e=this.get("name");e&&this.get("syncWithModel")&&this.$el.attr("data-name",e)},_initializeEditor:function(t,e){var i={placeholder:e,onChange:this._composeOnChange(),onClientEvent:this._composeOnClientEvent(),pasteHook:this.pasteHook,runIFrameSanitization:!0,forceSingleLine:this.get("forceSingleLine"),filterRules:{elements:["p","br"],attributes:{},remove_contents:["style","noscript","script","meta"],protocols:{}},smartQuotes:{enabled:this.smartQuotesEnabled}};this.editor=new a.PlainTextEditor(t,i)},_composeOnChange:function(){var t=[this.onChange],e=this;return this.get("syncWithModel")&&t.unshift(this.updateModelFromEditor),function(s){i.each(t,function(t){t.call(e,s)})}},_composeOnClientEvent:function(){var t=this.onClientEvent,e=this;return function(i){n.trigger("plainTextEditor:onClientEvent",i,e.editor),t.call(this,i)}},render:function(){this.$el.html(this.template({ariaLabel:this.get("ariaLabel")}));var t=this.js$("plainTextEditor").get(0);if(this._initializeEditor(t,this.get("placeholder")),this.get("syncWithModel")){var e=this._modelValue().length>0;e&&this.set("placeholder",!1),this.updateEditorFromModel()}return this},teardown:function(){return this.$el.empty(),delete this.editor,this},serialize:function(){return this.toJSON()},getEditorValue:function(t){return"undefined"!=typeof t||(t=!0),this.editor?this.editor.getData(t):null},setEditorValue:function(t){this.editor&&this.editor.setData(t)},updateModelFromEditor:function(){if(!this.editor)return!1;var t=this.get("name"),e=this.getEditorValue();""!==e?s(this.editor.element).addClass("has-text"):s(this.editor.element).removeClass("has-text"),this.model.get(t)!==e&&this.model.set(t,e)},updateEditorFromModel:function(){var t=this.getEditorValue(),e=this._modelValue();e.trim()&&e.trim()!==t.trim()&&this.setEditorValue(e)},_modelValue:function(){return this.model.get(this.get("name"))||""},focus:function(t){this.editor&&this.editor.focus(t)},blur:function(){this.editor&&this.editor.element.blur()},setCursorToEnd:function(){this.editor&&i.isFunction(this.editor.setCursorToEnd)&&this.editor.setCursorToEnd()},enable:function(){s(this.editor.element).attr("contenteditable",!0)},disable:function(){s(this.editor.element).removeAttr("contenteditable")}});e.exports=c},{"../templates/plaintext_editor.tpl":147,jquery:"HlZQrA",ligature:511,lodash:"K2RcUv","prima/events":429,"prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/view":496}],213:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("when"),n=t("velocity-animate").animate,a=t("prima/utils/sequence-with-context"),r=t("prima/utils/bindendevent"),l=t("prima/lib/translate"),h=t("prima/view"),d=t("prima/events"),c=t("prima/mixins/subviewable"),u=t("prima/mixins/selectorcache"),p=t("prima/mixins/accessor"),m=t("./avatar"),g=t("./tumblelog_select"),f=t("./post_settings"),_=t("./tag_editor"),v=t("./editor_buttons"),b=t("./social_buttons"),y=t("./save_post_button"),w=t("./reblog_as_button"),x=t("./allow_answers"),k=t("./error_bar"),C=t("./uploading_indicator"),S=t("./richtext_editor_tutorial"),T=t("./inline-controls-tutorial"),$=t("../services/content_stats_support"),E=t("./post_type_form/_create"),R=t("../templates/post_form.tpl"),F=h.extend({className:"post-form",defaults:{useMediaReady:!1,showFooter:!0,hideControlsLine:!1,enabled:!0,locked:!1,saving:!1,hasRichTextTutorial:!1,showRichTextTutorial:!1,hasInlineControlsTutorial:!1,showInlineControlsTutorial:!1,disablePhotoFromUrl:!1,closeLabel:l("Close")},events:{"click [data-js-clickableClose]":"_onClickClose","click [data-js-clickableSave]":"_onClickSave","mousedown [data-js-clickableClose]":"cancelEditorBlur","mousedown [data-js-clickableSave]":"cancelEditorBlur",keydown:"_onKeyDown"},mixins:[c,u,p],template:R,initialize:function(t){this.options=t=i.extend({},t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),i.extend(this,i.pick(t,"post","user","uploads","dragEvents")),i.extend(this.attributes,i.pick(this.post.attributes,["mode"])),this.__onBeforeUnload=i.bind(this._onBeforeUnload,this)},_targetHandlesDrag:function(t){var e=s(t);return i.isEmpty(e.closest(".editable-photoset"))&&i.isEmpty(e.closest(".media-dropzone"))&&i.isEmpty(e.closest("input"))&&i.isEmpty(e.closest('[contenteditable="true"]'))?!1:!0},_onDragOver:function(t){this._targetHandlesDrag(t.target)&&!i.isEmpty(t.originalEvent.dataTransfer.files)&&(t.originalEvent.dataTransfer.dropEffect="copy"),t.preventDefault()},_onDrop:function(t){this._targetHandlesDrag(t.target)||t.preventDefault()},_onModelChange:function(){this.subViews.errorBar.hideErrorBar()},_onChangeHideControlsLine:function(t,e){this.$el.toggleClass("no-controls-line",e)},_onChangeShowFooter:function(t,e){this.isRendered()&&this.js$("footer").css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},_onChangeEnabled:function(t,e){e?this.$el.removeClass("no-pointer-events"):this.$el.addClass("no-pointer-events")},_onChangeLocked:function(t,e){e?this.$$(".post-form--guard").addClass("visible"):this.$$(".post-form--guard").removeClass("visible")},_onClickClose:function(){this.options.redirectTo?(s(window).off("beforeunload",this.__onBeforeUnload),window.location=this.options.redirectTo):(this.resumeEditorBlur(),d.trigger("postForms:close"))},_onClickSave:function(){this.resumeEditorBlur(i.bind(this.save,this))},_onTypeSwitch:function(t,e){this.post.set("type",t),this.trigger("postForms:changePostType",e)},_getCurrentRichTextEditor:function(){return this.postTypeForm?this.postTypeForm.getRichTextEditor():void 0},_getEditorType:function(){return this.model.get("editorType")||"rich"},_setHasTutorialStates:function(){var t=i.contains(["text","photo","audio","video","link"],this.post.get("type"));this.set("hasRichTextTutorial",t&&this.user.get("hasRichTextTutorial")),this.set("hasInlineControlsTutorial",t&&this.user.get("hasInlineControlsTutorial"))},_setShowRichTextTutorialState:function(){this.set("showRichTextTutorial",this.get("hasRichTextTutorial")&&"rich"===this._getEditorType()&&this.get("showFooter"))},_setShowInlineControlsTutorialState:function(){this.set("showInlineControlsTutorial",this.get("hasInlineControlsTutorial")&&"rich"===this._getEditorType()&&!this.get("hasRichTextTutorial"))},_onChangeHasRichTextTutorial:function(t,e){this.$el.toggleClass("has-richtext-tutorial",e)},_onChangeShowRichTextTutorial:function(t,e){this.$el.toggleClass("show-richtext-tutorial",e),e&&this.user.get("hasRichTextTutorial")&&(s.ajax({url:"/svc/post/set_seen_rte",type:"POST",with_form_key:!0}),this.user.set("hasRichTextTutorial",!1))},_onRichTextTutorialRemoved:function(t){var e,s=function(){this.set("hasRichTextTutorial",!1),this.$el.removeClass("closing-richtext-tutorial")};this.stopListening(t),this.stopListening(this,"change:showFooter",this._setShowRichTextTutorialState),this.stopListening(this.model,"change:editorType",this._setShowRichTextTutorialState),this.options.isModal?i.defer(function(){r.animation(this.$el,s.bind(this)),this.$el.addClass("closing-richtext-tutorial")}.bind(this)):s.call(this),e=this._getCurrentRichTextEditor(),e&&e.focus(),this.set("showRichTextTutorial",!1)},_onInlineControlsTutorialHide:function(t){this.stopListening(t),this.stopListening(this,"change:hasRichTextTutorial",this._setShowInlineControlsTutorialState),this.stopListening(this.model,"change:editorType",this._setShowInlineControlsTutorialState),this.user.set("hasInlineControlsTutorial",!1),t.remove()},_onChangeShowInlineControlsTutorial:function(t,e){var i=this._getCurrentRichTextEditor();e&&i?(this.inlineControlsTutorial=new T({richTextEditor:i}),this.listenToOnce(this.inlineControlsTutorial,"hide",this._onInlineControlsTutorialHide)):this.inlineControlsTutorial&&(this.inlineControlsTutorial.remove(),this.inlineControlsTutorial=null)},_createContentStatsSupport:function(){this.contentStatsSupport&&this.contentStatsSupport.remove(),this.contentStatsSupport=new $({model:this.model,editor:this._getCurrentRichTextEditor()})},getRect:function(){var t=this.$el.css("display");this.$el.css("display","block");var e=this.$el.offset(),i={};return i.offsetTop=e.top,i.offsetLeft=e.left,i.offsetHeight=this.$el.outerHeight(),i.offsetWidth=this.$el.outerWidth(),this.$el.css("display",t),i},measureHeight:function(){if(!this.isRendered())return void 0;var t=this.$el.css("display");this.$el.css("display","block");var e=this.$el.outerHeight();return this.$el.css("display",t),e},animateShow:function(t,e){t||(t=0),e||(e=0),t||this.js$("container-outer").css("opacity",1);
var i=[n(this.js$("container-outer"),{opacity:[1,0]},{duration:t}),n(this.js$("container-inner"),{translateY:[0,10]},{duration:t,delay:e,complete:function(t){s(t).removeAttr("style")}})];return this.options.isModal&&i.push(n(this.js$("margin"),{opacity:[1,0]},{duration:t})),this.avatar&&this.avatar.updateViewState(),o.all(i)},animateHide:function(t,e){t||(t=0),e||(e=0),t||this.js$("container-outer").css("opacity",0),this.options.isModal||this.avatar.resetAvatar();var i=[];return this.js$("container-outer").length&&this.js$("container-inner").length&&(i.push(n(this.js$("container-outer"),{opacity:[0,1]},{duration:t})),i.push(n(this.js$("container-inner"),{translateY:[10,0]},{duration:t,delay:e}))),this.options.isModal&&this.js$("margin").length&&i.push(n(this.js$("margin"),{opacity:[0,1]},{duration:t})),o.all(i)},forceHidden:function(){return this.js$("container-outer").css("opacity",0),this.options.isModal&&this.js$("margin").css("opacity",0),n(this.js$("container-inner"),{translateY:[10,10]},{duration:0}),this},save:function(t){if(!this.get("saving")||t){var e;d.trigger("postForms:saving"),this.subViews.errorBar.hideErrorBar();var o=a([function(){!1===this.model.isValid()},function(){this.set({enabled:!1,locked:!0,saving:!0})},function(){},function(){try{this.model.set("contentStats",this.contentStatsSupport.getStats())}catch(t){}return e=this.model.save(this.options)},function(){this.set({enabled:!1,locked:!0,saving:!1,saved:!0})}],this).then(i.bind(function(t){if(t=t.filter(function(t){return t}),t.length&&(t=t[0]),i.isEmpty(t.errors)){if(this.options.redirectTo)s(window).off("beforeunload",this.__onBeforeUnload),window.location=this.options.redirectTo;else if(d.trigger("postForms:saved",{},e),"reblog"===this.model.get("mode")){var o=this.model.get("reblog_id"),n=window.Tumblr.Posts.find({id:o});n&&n.updateReblogControl()}}else{var a=[];for(var r in t.errors)a.push(i.escape(t.errors[r]));this.set({enabled:!0,locked:!1,saving:!1,saved:!1});var l=a.join("<br>");this.subViews.errorBar.showErrorBar(l),d.trigger("postForms:error")}},this));return o["catch"](i.bind(function(t){this.set({enabled:!0,locked:!1,saving:!1,saved:!1}),d.trigger("postForms:error")},this)),o}},createSubViews:function(){var t,e=["supportImageSearch","supportImageFlagging","fullWidthInlineMedia","minFullWidthSize","popoverContainer","dragEvents"],s=i.extend({user:this.user,post:this.post,uploads:this.uploads,model:this.model},i.pick(this.options,e),this.attributes),o=this.post.get("tumblelog");this.avatar=this.subViews.avatar=new m(i.extend(this.options.isModal?{}:{determineViewState:!1,showSubavatar:this.user.getChannel(o).get("show_author_avatar"),avatarUrl:this.user.getChannel(o).get("avatar_url")},s)),this.tumblelogSelect=this.subViews.tumblelogSelect=new g(s),this.postSettings=this.subViews.postSettings=new f(s),this.tagEditor=this.subViews.tagEditor=new _(s),this.editorButtons=this.subViews.editorButtons=new v(s),this.socialButtons=this.subViews.socialButtons=new b(s),this.savePostButton=this.subViews.savePostButton=new y(s),this.uploadIndicator=this.subViews.uploadingIndicator=new C(s),t=i.extend({},s,{tagEditor:this.tagEditor}),this.postTypeForm=this.subViews.postTypeForm=E(t),this.set("useMediaReady",this.postTypeForm.get("hasMediaView")),this.listenTo(this.postTypeForm,"media:ready",function(){var t=i.toArray(arguments);t.unshift("media:ready"),this.trigger.apply(this,t)}),this.set("hideControlsLine",this.postTypeForm.get("hideControlsLine")),this.listenTo(this.postTypeForm,"change:hideControlsLine",function(t,e){this.set("hideControlsLine",e)}),this.postTypeForm.has("showCaption")&&(this.set("showFooter",this.postTypeForm.get("showCaption")),this.listenTo(this.postTypeForm,"change:showCaption",function(t,e){this.set("showFooter",e)})),this.listenTo(d,"postForms:tumblelogSelectDropdown:open",function(){this.trigger("checkScrollSize"),this.trigger("pauseScrollHelper")}),this.listenTo(d,"postForms:tumblelogSelectDropdown:close",function(){this.trigger("checkScrollSize",!0),this.trigger("resumeScrollHelper")}),this.listenTo(this.savePostButton,"dropdown:intent",this.cancelEditorBlur),this.post.allowsReblogAs()&&(this.reblogAsButton=this.subViews.reblogAsButton=new w(s),this.listenTo(this.reblogAsButton,"reblogAs:type",this._onTypeSwitch)),this.post.allowsTypeSwitch()&&this.listenTo(this.postTypeForm,"switchPostType",this._onTypeSwitch),this.subViews.allowAnswers=new x(s),this.subViews.errorBar=new k,this._setHasTutorialStates(),this._setShowRichTextTutorialState(),this._setShowInlineControlsTutorialState(),this.get("hasRichTextTutorial")&&(this.richTextEditorTutorial=this.subViews.richTextEditorTutorial=new S,this.listenToOnce(this.richTextEditorTutorial,"removed",this._onRichTextTutorialRemoved),this.listenTo(this,"change:showFooter",this._setShowRichTextTutorialState),this.listenTo(this.model,"change:editorType",this._setShowRichTextTutorialState)),this.get("hasInlineControlsTutorial")&&(this.listenTo(this,"change:hasRichTextTutorial",this._setShowInlineControlsTutorialState),this.listenTo(this.model,"change:editorType",this._setShowInlineControlsTutorialState))},addStateListeners:function(){this.listenTo(this,"change:hideControlsLine",this._onChangeHideControlsLine),this.listenTo(this,"change:showFooter",this._onChangeShowFooter),this.listenTo(this,"change:enabled",this._onChangeEnabled),this.listenTo(this,"change:locked",this._onChangeLocked),this.listenTo(this.model,"change",this._onModelChange),this.listenTo(this.dragEvents,"dragover",this._onDragOver),this.listenTo(this.dragEvents,"drop",this._onDrop),this.listenTo(this.tagEditor,"postForms:focusOnNextEditor",this.focusOnNextEditor),this.listenTo(this," change:showRichTextTutorial",this._onChangeShowRichTextTutorial),this.listenTo(this," change:hasRichTextTutorial",this._onChangeHasRichTextTutorial),this.listenTo(this," change:showInlineControlsTutorial",this._onChangeShowInlineControlsTutorial)},serialize:function(){return i.extend({showReblogAs:this.post.allowsReblogAs()},this.toJSON())},beforeRender:function(){this.dragEvents.start(),this.createSubViews(),this.addStateListeners(),s(window).on("beforeunload",this.__onBeforeUnload)},render:function(){return this.$el.html(this.template(this.serialize())),this.attachSubViews(),this.post.get("type")&&this.$el.addClass("post-form--"+this.post.get("type")),this},afterRender:function(){this.$el.toggleClass("no-controls-line",this.get("hideControlsLine")),this.get("showFooter")||this.js$("footer").css({display:"none",opacity:0}),this.renderSubViews(),this._onChangeHasRichTextTutorial(this,this.get("hasRichTextTutorial")),this._onChangeShowRichTextTutorial(this,this.get("showRichTextTutorial")),this._onChangeShowInlineControlsTutorial(this,this.get("showInlineControlsTutorial")),this._createContentStatsSupport()},teardown:function(){return this.dragEvents.stop(),this.stopListening(),this.contentStatsSupport&&this.contentStatsSupport.remove(),this.inlineControlsTutorial&&this.inlineControlsTutorial.remove(),s(window).off("beforeunload",this.__onBeforeUnload),this},remove:function(){return this.teardown(),h.prototype.remove.apply(this,arguments)},_onKeyDown:function(t){this.focusOnNextEditor(t),this.keyboardSave(t)},focusOnNextEditor:function(t){if(9===t.keyCode){var e=this.$el.find(".editor[contenteditable]:visible, .post-form--close, .post-form--save-button .create_post_button:enabled"),i=s.inArray(t.target,e);if(-1!==i){t.preventDefault();var o=(i+(t.shiftKey?-1:1))%e.length;0>o&&(o+=e.length),s(e[o]).focus()}}},keyboardSave:function(t){var e=/Mac/.test(navigator.platform)?t.metaKey:t.ctrlKey;13===t.keyCode&&e&&this.post.isValid()&&(t.preventDefault(),t.stopPropagation(),this.save())},_onBeforeUnload:function(){if(this.model.deepHasChanged(this.get("initialPostState"))){var t=l("Sure you want to leave this page without saving? Your post will be discarded.");return"edit"===this.model.get("mode")&&(t=l("Sure you want to leave this page without saving? All your edits will be lost.")),t}},cancelEditorBlur:function(){var t=this._getCurrentRichTextEditor();t&&t.cancelBlur()},resumeEditorBlur:function(t){var e=this._getCurrentRichTextEditor();e&&i.isFunction(e.resumeBlur)?e.resumeBlur(t):i.isFunction(t)&&t()}});e.exports=F},{"../services/content_stats_support":117,"../templates/post_form.tpl":148,"./allow_answers":190,"./avatar":193,"./editor_buttons":195,"./error_bar":196,"./inline-controls-tutorial":200,"./post_settings":215,"./post_type_form/_create":218,"./reblog_as_button":229,"./richtext_editor_tutorial":233,"./save_post_button":234,"./social_buttons":236,"./tag_editor":237,"./tumblelog_select":241,"./uploading_indicator":244,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/lib/translate":456,"prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/utils/bindendevent":474,"prima/utils/sequence-with-context":492,"prima/view":496,"velocity-animate":"lWl/mc",when:"RG2dij"}],214:[function(t,e){"use strict";var i=t("prima/view"),s=t("../templates/post_preview.tpl"),o=i.extend({template:s,initialize:function(t){this.options=t},render:function(){return this.$el.html(this.template(this.options)),this}});e.exports=o},{"../templates/post_preview.tpl":149,"prima/view":496}],215:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/subviewable"),n=t("prima/mixins/selectorcache"),a=t("../templates/post_settings.tpl"),r=t("./post_settings_dropdown"),l=s.extend({className:"post-form--post-settings-button",events:{"click [data-js-clickablePostSettingsCog]":"togglePostSettingsDropdown"},mixins:[o,n],template:a,initialize:function(t){t=i.extend({},t,{shift:{x:0,y:10},identifier:"postForms:postSettingsDropdown"}),this.postSettingsDropdown=new r(t)},render:function(){return this.$el.html(this.template()),this.postSettingsDropdown.setPinnedTarget(this.js$("postSettingsCog")),this},togglePostSettingsDropdown:function(){this.postSettingsDropdown.isOrWasRecentlyRendered()||this.postSettingsDropdown.render()}});e.exports=l},{"../templates/post_settings.tpl":150,"./post_settings_dropdown":216,lodash:"K2RcUv","prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/view":496}],216:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/lib/translate"),n=t("prima/events"),a=t("app/components/dialog"),r=t("prima/mixins/accessor"),l=t("prima/mixins/selectorcache"),h=t("prima/mixins/popoverbase"),d=t("app/mixins/tumblrselect"),c=t("../templates/post_settings_dropdown.tpl"),u=s.extend({className:"popover--post-settings-dropdown",defaults:{textFields:["customUrl","sourceUrl","postDate"],checkboxFields:["allowPhotoReplies"],selectFields:["editorType"]},mixins:[r,l,h,d],template:c,initialize:function(t){this.options=t=i.extend({},t),i.extend(this,i.pick(t,["post","user","uploads"]))},render:function(){return this.$el.html(this.template(this.serialize())),this.setupTextInputFields(),this.setupCheckboxInputFields(),this.setupSelectFields(),this.delegateEvents(),n.trigger("postForms:dismissListener:suspend"),this},teardown:function(){return this.$el.remove(),n.trigger("postForms:dismissListener:resume"),this},serialize:function(){return i.extend({showEditorSelection:"chat"!==this.post.get("type")},this.model.toJSON())},setupTextInputFields:function(){i.each(this.get("textFields"),function(t){var e=this["$"+t]=this.js$(t);return"sourceUrl"===t&&this.model.isReblog()?void e.attr("readonly",!0):(e.on("input",i.bind(function(){this.model.set(e.attr("name"),e.val())},this)),void e.on("keydown",i.bind(function(t){var e=t.which||t.keyCode;13===e&&this.teardown()},this)))},this)},setupCheckboxInputFields:function(){i.each(this.get("checkboxFields"),function(t){var e=this["$"+t]=this.js$(t),s=e.attr("name");e.prop("checked",!!this.model.get(s)),e.on("change",i.bind(function(){var o="_onChange"+i.camelize("-"+t);i.isFunction(this[o])?this[o]():this.model.set(s,e.prop("checked"))},this))},this)},setupSelectFields:function(){i.each(this.get("selectFields"),function(t){var e=this["$"+t]=this.js$(t),s=e.attr("name");this.setUpSelector(e),e.children('[value="'+this.model.get(s)+'"]').attr("selected",!0),e.trigger("change"),e.on("change",i.bind(function(){var o="_onChange"+i.camelize("-"+t);i.isFunction(this[o])?this[o]():this.model.set(s,e.val())},this))},this)},setupInputListeners:function(){var t=this.get("checkboxFields");i.each(this.get("inputSelectorNames"),function(e){var s=this["$"+e];s.on("change",i.bind(function(){var i=-1!==t.indexOf(e)?s.prop("checked"):s.val();this.model.set(s.attr("name"),i)},this))},this)},_onChangeEditorType:function(){var t=this.model.get("editorType"),e=this.js$("editorType").val();if(!t)return void this.model.set("editorType",this.user.get("defaultEditorType")||"rich");if(t!==e)if("rich"!==t&&"rich"===e&&this.model.get("htmlEdited")){var s={text:o("%1$sGoing back to normal?%2$sYou might lose any code that doesn't get along with our text editor.%3$s","<h3>","</h3><small>","</small>"),keycommand_maintain:!0};a.confirm(s,i.bind(function(){this.js$("editorType").blur(),this.model.set({htmlEdited:!1,editorType:e}),this._delayedClose()},this))}else i.defer(i.bind(function(){this.model.set("editorType",e)},this)),this._delayedClose()},_delayedClose:function(t){i.isNumber(t)||(t=50),i.delay(i.bind(function(){this.teardown()},this),t)}});e.exports=u},{"../templates/post_settings_dropdown.tpl":151,"app/components/dialog":39,"app/mixins/tumblrselect":298,lodash:"K2RcUv","prima/events":429,"prima/lib/translate":456,"prima/mixins/accessor":458,"prima/mixins/popoverbase":465,"prima/mixins/selectorcache":467,"prima/view":496}],217:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/mixins/accessor"),a=t("prima/mixins/subviewable"),r=t("../../templates/post_type_form/_audio_search_results.tpl"),l=o.extend({defaults:{currentChoice:-1,serviceResults:{},showCopyrightWarning:!1},events:{"click .clear-results":"clearResults","click .result":"_clickedChoice","mouseover .result":"resetCurrentChoice"},mixins:[n,a],template:r,initialize:function(){this.listenTo(this,"change:serviceResults",function(t){t.trigger("searchResults:updated",t._getResultCount())}),this.listenTo(this,"change:currentChoice",this._styleResults)},updateResultsForService:function(t){var e=this.get("serviceResults"),s=i.clone(e);s[t.service]=t.tracks,this.set("serviceResults",s),!1===i.isEqual(e,t)&&(this.resetCurrentChoice(),this.teardown(),this.render())},handleMenuCommand:function(t){var e=s(".result",this.$el),i=this.get("currentChoice");if("confirm"===t){if(-1!==i){var o=s(e[this.get("currentChoice")]),n=o.attr("data-href"),a=o.hasClass("audio-result")?"searchResults:selectAudio":"searchResults:selectVideo";this.trigger(a,n)}}else{var r="cycleUp"===t?-1:1,l=(this.get("currentChoice")+r+e.length)%e.length;this.set("currentChoice",l)}},render:function(){var t=i.extend(i.pick(this.attributes,"serviceResults"),{resultCount:this._getResultCount(),copyrightWarningMessage:this.get("copyrightWarningMessage")||"",showCopyrightWarning:!!this.get("showCopyrightWarning")});return this.$el.html(this.template(t)),this},teardown:function(){return this.$el.empty(),this},reset:function(){this.set("serviceResults",{})},resetCurrentChoice:function(){this.set("currentChoice",-1)},clearResults:function(){this.trigger("searchResults:clear")},hasResults:function(){return this._getResultCount()>0},setCopyrightWarningMessage:function(t){this.set("copyrightWarningMessage",t)},_clickedChoice:function(t){var e=s(t.currentTarget).attr("data-href"),i=t.currentTarget.classList.contains("audio-result")?"searchResults:selectAudio":"searchResults:selectVideo";this.trigger(i,e)},_getResultCount:function(){return i.reduce(this.get("serviceResults"),function(t,e){return t+(i.isArray(e)?e.length:0)},0)},_styleResults:function(t,e){i.each(s(".result",t.$el),function(t,i){s(t).toggleClass("cycled",i===e)})}});e.exports=l},{"../../templates/post_type_form/_audio_search_results.tpl":152,jquery:"HlZQrA",lodash:"K2RcUv","prima/mixins/accessor":458,"prima/mixins/subviewable":468,"prima/view":496}],218:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/lib/flags"),o={text:t("./text"),photo:t("./photo"),link:t("./link"),quote:t("./quote"),chat:t("./chat"),audio:t("./audio"),video:t("./video"),note:t("./note"),link_new:t("./link-new")},n=t("./text"),a=function(t){var e,a,r;return i.isPlainObject(t)?e=t.model:(e=t,t={model:e}),a=e.get("type"),"link"===a&&s.bool("new_link_posts")&&(a="link_new"),new(r=o[a]||n)(t)};e.exports=a},{"./audio":219,"./chat":221,"./link":223,"./link-new":222,"./note":224,"./photo":225,"./quote":226,"./text":227,"./video":228,lodash:"K2RcUv","prima/lib/flags":"f/LVtH"}],219:[function(t,e){"use strict";var i=t("lodash"),s=t("./base"),o=t("prima/lib/translate"),n=(t("prima/lib/logger"),t("prima/utils/getpath")),a=t("../../templates/post_type_form/audio.tpl"),r=t("../plaintext_editor"),l=t("./_audio_search_results"),h=t("../audio_uploader"),d=t("../media/audio"),c=t("../confirm_tos"),u=t("../richtext_editor"),p=t("../reblog_tree"),m=t("../../services/audio_search_service"),g=t("app/components/dialog"),f=s.extend({defaults:i.defaults({maxSearchResults:4,showSearchField:!0,showAudioUploader:!0,showSearchResultList:!1,showCopyrightWarning:!1,hasMediaView:!0,hasMedia:!1,showTos:!1,showCaption:!1},s.prototype.defaults),template:a,afterInitialize:function(){this.searchService=new m,(this.post.get("url")||"new"!==this.post.get("mode"))&&this.set({hasMedia:!0,showCaption:!0,showSearchField:!1,showAudioUploader:!1,showSearchResultList:!1,showCopyrightWarning:!1})},createSubViews:function(){var t=this.subViewOptions(),e=i.extend({className:"audio-search-field",placeholder:o("Search for a song or paste a URL"),ariaLabel:o("Search for a song or paste a URL"),name:"search",forceSingleLine:!0,onClientEvent:i.bind(this.handleSearchMenuKeys,this)},t),s=i.extend({},t),n={className:"audio-search-results-field"},a=i.extend({url:this.post.get("url"),service:this.post.get("service"),albumArt:this.post.get("albumArt"),canEditMedia:this.post.canEditMedia()},t);this.post.get("bandcamp")&&i.extend(a,this.post.get("bandcamp"));var m=i.extend({},t),g=i.extend({className:"caption-field",name:"caption",placeholder:o("Add a description, if you like"),ariaLabel:o("Description")},t),f=i.extend({is_removable:!0},t);this.searchField=this.subViews.searchField=new r(e),this.audioUploader=this.subViews.audioUploader=new h(s),this.searchResultList=this.subViews.searchResultList=new l(n),this.mediaPreview=this.subViews.mediaPreview=new d(a),this.confirmTos=this.subViews.confirmTos=new c(m),this.caption=this.subViews.caption=new u(g),this.post.isReblog()&&(this.reblogTree=this.subViews.reblogTree=new p(f))},addStateListeners:function(){this.listenTo(this.audioUploader,"upload:start",this._onFileUploadStart),this.listenTo(this.audioUploader,"upload:complete",this._onFileUploadComplete),this.listenTo(this.audioUploader,"upload:error upload:invalid",this._onFileUploadError),this.searchResultList.listenTo(this.searchService,"searchResults:fetched",this.searchResultList.updateResultsForService),this.listenTo(this.searchService,"audioEmbedData:fetched",this._onAudioEmbedDataFetched),this.searchResultList.listenTo(this.searchField,"searchField:menuKey",this.searchResultList.handleMenuCommand),this.listenTo(this.searchResultList,"searchResults:updated",function(t){var e=i.isEmpty(this.post.get("url"))&&t>0;this.set("showSearchResultList",e)}),this.listenTo(this.searchResultList,"searchResults:selectAudio",this.setAudioContentFromUrl),this.listenTo(this.searchResultList,"searchResults:selectVideo",this.switchToVideoPost),this.listenTo(this.searchResultList,"searchResults:clear",function(){this.set("showCopyrightWarning",!1),this.post.unset("copyrightFallback")}),this.searchField.listenTo(this.searchResultList,"searchResults:clear",function(){this.setEditorValue(""),this.focus()}),this.listenTo(this.mediaPreview,"media:ready",function(){var t=i.toArray(arguments);t.unshift("media:ready"),this.trigger.apply(this,t)}),this.post.canEditMedia()&&this.listenTo(this.mediaPreview,"media:remove",this.removeMedia),this.listenTo(this.post,"change:search",i.debounce(this._onChangeSearchInput,200)),this.listenTo(this,"change:showSearchField",this._onChangeShowSearchField),this.listenTo(this,"change:showAudioUploader",this._onChangeShowAudioUploader),this.listenTo(this,"change:showSearchResultList",this._onChangeShowSearchResultList),this.listenTo(this,"change:hasMedia",this._onChangeHasMedia),this.listenTo(this,"change:showTos",this._onChangeShowTos),this.listenTo(this,"change:showCaption",this._onChangeShowCaption),this.listenTo(this,"change:showCopyrightWarning",this._onChangeShowCopyrightWarning)},removeMedia:function(){this.searchResultList.hasResults()||this.searchField.setEditorValue(""),this.post.softReset();var t=i.isEmpty(this.post.get("search"));this.set({hasMedia:!1,showSearchField:!0,showSearchResultList:!t,showAudioUploader:t,showTos:!1}),this.mediaPreview.set({url:"",service:""}),this.js$("confirmTos").attr("checked",!!this.post.get("confirmTos")),i.isEmpty(this.post.get("caption"))&&i.isEmpty(this.post.get("tags"))&&this.set("showCaption",!1),this.searchField.focus()},_onChangeShowSearchField:function(t,e){this.searchField.$el.css({display:e?"block":"none",opacity:e?1:0})},_onChangeShowAudioUploader:function(t,e){this.audioUploader.$el.css({display:e?"block":"none",opacity:e?1:0})},_onChangeShowSearchResultList:function(t,e){this.searchResultList.$el.css({display:e?"block":"none",opacity:e?1:0})},_onChangeShowCopyrightWarning:function(t,e){this.searchResultList.set("showCopyrightWarning",e)},_onChangeHasMedia:function(t,e){this.isRendered()&&this.mediaPreview.$el.css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},_onChangeShowTos:function(t,e){this.isRendered()&&this.js$("tos").css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},_onChangeShowCaption:function(t,e){this.isRendered()&&this.js$("caption").css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},setAudioContent:function(t,e,s){i.isObject(t)&&(s=t,t=""),s=i.extend({preuploadUrl:"",url:(t||"").replace(/\u200B/g,""),service:e},s),("bandcamp"!==e||s.id&&s.type)&&(this.mediaPreview.set(s),this.post.set(i.pick(s,["url","preuploadUrl","service","albumArt","preuploadAlbumArt","trackTitle","trackArtist","trackAlbum"])))},setAudioContentFromUrl:function(t,e,s){e||(e=this.searchService.getServiceByUrl(t)),s||(s={}),this.setAudioContent(t,e,s),this.set({hasMedia:!0,showCaption:!0,showSearchField:!1,showSearchResultList:!1,showAudioUploader:!1,showTos:!i.isEmpty(s.preuploadUrl)}),this.caption.focus()},_onChangeSearchInput:function(t,e){e||(e="");var s=i.isEmpty(e)?!1:this.searchService.getServiceByUrl(e);if(s)"direct"===s?this.setAudioContentFromUrl(e,s):this.searchService.getData(e,s),this.post.unset("search");else if(i.isEmpty(e))this.searchResultList.reset(),this.set("showAudioUploader",this.get("showSearchField"));else{if(this.set("showAudioUploader",!1),this.get("showCopyrightWarning")){if(e===this.post.get("copyrightFallback"))return;this.set("showCopyrightWarning",!1),this.post.unset("copyrightFallback"),this.searchResultList.reset()}this._executeAudioSearches(e)}},_executeAudioSearches:function(t,e,s){e=i.isArray(e)?e:this.searchService.searchServices,i.forEach(e,function(e){this.searchService.search(e,t,s)},this)},_onAudioEmbedDataFetched:function(t,e,s){i.isObject(t)&&(s=t,t=s.url),this.setAudioContentFromUrl(t,e,s)},handleSearchMenuKeys:function(t){var e,i=["keyup","keydown"],s={13:"confirm",38:"cycleUp",40:"cycleDown"};return t=t||window.event,-1!==i.indexOf(t.type)&&(e=t.which||t.keyCode,e in s)?("keydown"===t.type&&13===e&&t.stopImmediatePropagation(),this.searchResultList.isRendered()&&"keyup"!==t.type&&(this.searchField.trigger("searchField:menuKey",s[e]),t.preventDefault()),!1):void 0},_onFileUploadStart:function(t){this.uploads.add(t)},_onFileUploadComplete:function(t){var e={preuploadUrl:t.get("url")},s=t.get("album_art_url");s&&(e.preuploadAlbumArt=!0,e.albumArt=s);var o=t.get("id3");i.isObject(o)&&(e.trackTitle=o.Title,e.trackArtist=o.Artist,e.trackAlbum=o.Album),this.setAudioContentFromUrl(e.preuploadUrl,"direct",e)},_onFileUploadError:function(t){var e=t.get("responseJSON");if(e){var s=parseInt(n(e,"meta.status"),10),a=n(e,"response.is_copyright");if(403===s&&a)return void this.uploadFailedCopyright(n(e,"response"))}var r=t.get("error")||o("Error uploading audio");i.isArray(r)&&(r=r.join("</p><p>")),g.alert("<p>"+r+"</p>")},afterRender:function(){this.renderSubViews(),i.forEach({showSearchField:this.searchField,showAudioUploader:this.audioUploader,showSearchResultList:this.searchResultList,hasMedia:this.mediaPreview},function(t,e){this.get(e)||t.$el.css({display:"none",opacity:0})},this),this.get("showTos")||this.js$("tos").css({display:"none",opacity:0}),this.get("showCaption")?this.delayedFocus(this.caption):(this.delayedFocus(this.searchField),this.js$("caption").css({display:"none",opacity:0}))},uploadFailedCopyright:function(t){var e="new"===this.post.get("mode")?["spotify","soundcloud","youtube"]:["spotify","soundcloud"],i={maxResults:3};this.searchResultList.setCopyrightWarningMessage(t.message),this.set({showCopyrightWarning:!0,showAudioUploader:!1}),this.subViews.searchField.setEditorValue(t.search_string),this.post.set("copyrightFallback",t.search_string),this._executeAudioSearches(t.search_string,e,i),this.searchField.focus()},switchToVideoPost:function(t){var e={postParams:{type:"video",copyrightFallback:this.post.get("copyrightFallback")},afterReload:function(e){e.postTypeForm.executeUrlParser(t)}};this.trigger("switchPostType","video",e)},getRichTextEditor:function(){return this.caption}});e.exports=f},{"../../services/audio_search_service":116,"../../templates/post_type_form/audio.tpl":153,"../audio_uploader":192,"../confirm_tos":194,"../media/audio":202,"../plaintext_editor":212,"../reblog_tree":231,"../richtext_editor":232,"./_audio_search_results":217,"./base":220,"app/components/dialog":39,lodash:"K2RcUv","prima/lib/logger":436,"prima/lib/translate":456,"prima/utils/getpath":484}],220:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/accessor"),n=t("prima/mixins/subviewable"),a=t("prima/mixins/selectorcache"),r=t("prima/events"),l=t("prima/utils/image/types"),h=i.template(""),d=s.extend({template:h,mixins:[o,n,a],defaults:{hasMediaView:!1,hideControlsLine:!1},defaultOptions:{supportImageSearch:!1,supportImageFlagging:!1,fullWidthInlineMedia:!1,minFullWidthSize:{}},initialize:function(t){if(this.options=t=i.extend({},this.defaultOptions,t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),!t.post)throw new Error("PostFormView requires a Post model!");if(!t.user)throw new Error("PostFormView requires a User model");i.extend(this,i.pick(t,["post","user","uploads"])),i.isFunction(this.afterInitialize)&&this.afterInitialize.apply(this,arguments)},createSubViews:function(){},subViewOptions:function(){return i.extend({},i.pick(this.options,"supportImageSearch","supportImageFlagging","fullWidthInlineMedia","minFullWidthSize","dragEvents"),i.pick(this,"model","uploads","user","post"))},addStateListeners:function(){},getRichTextEditor:function(){},serialize:function(){return i.extend({canEditMedia:this.post.canEditMedia()},this.post.toJSON(),this.toJSON())},teardown:function(){return this.stopListening(),this.$el.empty(),this},beforeRender:function(){this.createSubViews(),this.addStateListeners()},render:function(){return this.$el.html(this.template(this.serialize())),this.attachSubViews(),this},registerTitleKeyboardShortcut:function(t){var e=/Mac/.test(navigator.platform)?"meta":"ctrl";return this.listenTo(r,"DOMEventor:keydown:"+e+"+shift+1",function(){t.focus()}),t},delayedFocus:function(t,e,s){"undefined"!=typeof s||(s=!0),"number"==typeof e||(e=200),i.delay(i.bind(function(){t.focus(s),s&&t.setCursorToEnd()},this),e||0)},getMinFullWidthSize:function(t){var e=this.options.minFullWidthSize||{};return i.isEmpty(e)?null:i.isNumber(e)?e:(t=l.convertToNormalizedType(t),i.has(e,t)?e[t]:null)}});e.exports=d},{lodash:"K2RcUv","prima/events":429,"prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/utils/image/types":489,"prima/view":496}],221:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/lib/translate"),n=t("./base"),a=t("ligature").SelectionPersistence,r=t("../plaintext_editor"),l=t("../../templates/post_type_form/chat.tpl"),h=/^([^(:|\n)]+:)/,d=n.extend({template:l,placeholders:["%1$sFirefighter:%2$s That's the way the cookie crumbles.%3$s%1$sButler:%2$s It falls on me to reassemble the cookie.","%1$sStockbroker:%2$s I need a vacation.%3$s%1$sTourist:%2$s I'm already on one.%3$s%1$sStockbroker:%2$s Get out of my office.","%1$sAbbott:%2$s Who is the man on first base?%3$s%1$sCostello:%2$s That's what I'm telling you!%3$s%1$sAbbott:%2$s I'm unqualified to manage a baseball team.","%1$sRick:%2$s Our problems don't amount to a hill of beans in this crazy world.%3$s%1$sIlsa:%2$s Great, now I'm hungry for beans.","%1$sAlbert Einstein:%2$s Energy equals mass times the speed of light squared.%3$s%1$sCop:%2$s Tell it to the judge.","%1$sAxl:%2$s Welcome to the jungle.%3$s%1$sCustomer:%2$s We'd like a table for two, please.%3$s%1$sAxl:%2$s Your table is right this way.","%1$sTourist:%2$s Could you give us directions to Olive Garden?%3$s%1$sNew Yorker:%2$s No, but I could give you directions to an actual Italian restaurant.","%1$sPangloss:%2$s Could you give me directions to the Olive Garden?%3$s%1$sCandide:%2$s No, but we can cultivate our own garden.%3$s%1$sPangloss:%2$s That sounds rational to me.","%1$sCharles Dickens:%2$s It was the best of mimes, it was the worst of mimes.%3$s%1$sMime:%2$s ...","%1$sJuliet:%2$s Romeo, Romeo, wherefore art thou, Romeo?%3$s%1$sRomeo:%2$s I'm right here, Juliet.?%3$s%1$sJuliet:%2$s “Wherefore” means “why” not “where.”%3$s%1$sRomeo:%2$s Misunderstandings like these are what define our relationship.","%1$sSeal:%2$s Did you know that when it snows my eyes become larger?%3$s%1$sOptometrist:%2$s That's highly abnormal. I'm going to refer you to a specialist.%3$s%1$sSeal:%2$s BABAAAAAAAYYYY!","%1$sSeal:%2$s There's so much a man can tell you, so much he can say.%3$s%1$sMan:%2$s I've just been waiting for someone to ask!","%1$sUsher:%2$s These are my confessions.%3$s%1$sTheater-goer:%2$s These are my tickets.%3$s%1$sUsher:%2$s Right this way."],afterInitialize:function(){this.user.get("language")&&"en_US"!==this.user.get("language")?(this._placeholders=i.filter(this.placeholders,function(t){return o(t)!==t}),i.isEmpty(this._placeholders)&&(this._placeholders=this.placeholders)):this._placeholders=this.placeholders},randomPlaceholder:function(){var t=i.sample(this._placeholders||this.placeholders);return o(t,"<b>","</b>","<br>")},createSubViews:function(){var t=this.subViewOptions(),e=i.extend({className:"title-field",name:"title",isResizable:!0,placeholder:o("Title"),ariaLabel:o("Post title"),allowLinebreaks:!1},t),s=i.extend({className:"chat-field normal",name:"chat",placeholder:this.randomPlaceholder(),onChange:i.bind(function(){this.formatText()},this),ariaLabel:o("Post body"),convertNewlinesToLinebreaks:!0},t);this.title=this.subViews.title=new r(e),this.chat=this.subViews.chat=new r(s),this.registerTitleKeyboardShortcut(this.title)},afterRender:function(){this.renderSubViews(),this.model.get("chat")&&this.formatText(),this.delayedFocus(this.chat)},formatText:function(){this.chat.getEditorValue()&&this.formatTextNode(this.chat.editor.element)},formatTextNode:function(t){if(t){if(t.nodeType!==Node.TEXT_NODE)return void i.each(t.childNodes,i.bind(function(t){this.formatTextNode(t)},this));if(this.stripZeroWidthSpaceFromNode(t),"B"===t.parentNode.tagName)return void this.cleanBoldNode(t.parentNode);if(!(s(t).prev().length>0&&"BR"!==s(t).prev()[0].tagName)){var e=t.nodeValue.match(h);
if(e){var o=a.saveSelection(this.chat.editor.element),n=t.parentNode;if(i.isObject(n)){var r=e[0];t.nodeValue=t.nodeValue.replace(h,"");var l=document.createElement("b");l.innerHTML=r,n.insertBefore(l,t)}a.restoreSelection(o)}}}},cleanBoldNode:function(t){if("B"===t.tagName)if(t.childNodes.length>1)for(;t.childNodes.length>1&&t.innerHTML.match(/<br\s*[\/]?>/);)t.parentNode.insertBefore(t.firstChild,t);else{var e=t.firstChild;if(-1===e.nodeValue.indexOf(":"))return void this.unwrapNode(t);var i=/:(.+)$/,s=e.nodeValue.match(i);if(s){var o=a.saveSelection(this.chat.editor.element),n=s[1],r=document.createTextNode(n);e.nodeValue=e.nodeValue.replace(/:(.+)$/,":"),t.parentNode.insertBefore(r,t.nextSibling),a.restoreSelection(o)}}},unwrapNode:function(t){var e=a.saveSelection(this.chat.editor.element),i=t.parentNode,s=t.firstChild,o=s.nodeValue;o&&(i.insertBefore(s,t.nextSibling),i.normalize()),t.remove(),this.formatTextNode(i),a.restoreSelection(e)},stripZeroWidthSpaceFromNode:function(t){var e=/\u200B/g;if(t&&t.nodeType===Node.TEXT_NODE&&t.nodeValue.match(e)){var i=a.saveSelection(this.chat.editor.element);t.nodeValue=t.nodeValue.replace(e,""),Math.max(i.start,i.end)>t.nodeValue.length&&(i.start=i.end=t.nodeValue.length),a.restoreSelection(i)}}});e.exports=d},{"../../templates/post_type_form/chat.tpl":154,"../plaintext_editor":212,"./base":220,jquery:"HlZQrA",ligature:511,lodash:"K2RcUv","prima/lib/translate":456}],222:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/lib/translate"),n=t("./base"),a=t("../../templates/post_type_form/link-new.tpl"),r=t("../plaintext_editor"),l=t("../richtext_editor"),h=t("../reblog_tree"),d=t("app/components/remove-button"),c=t("../../services/open_graph_service"),u=t("../../utils/validation"),p=t("prima/utils/url"),m=t("prima/utils/image/loader"),g=t("prima/utils/filename").getExtension,f=n.extend({events:{"mouseenter [data-js-removable=true]":"_onHoverRemoveButton","mouseleave [data-js-removable=true]":"_onHoverRemoveButton","mouseleave .media-container":"_onHoverRemoveButton"},template:a,defaults:s.defaults({hasMedia:!1,showCaption:!1,ogFetchPending:!1,tagEditor:null,hasCustomTags:!1,numOgTags:5},n.prototype.defaults),afterInitialize:function(){this._ogService=new c,"new"!==this.model.get("mode")&&this.set({hasMedia:!0,hasCustomTags:!0}),this.model.has("caption")&&this.set("showCaption",!0),this.set("hideControlsLine",!this.get("showCaption")),this.tagEditor=this.get("tagEditor")},afterRender:function(){this.renderSubViews(),this.model.canEditMedia()||(this.title.disable(),this.excerpt.disable(),this.url.disable(),this._hideEmptyFields()),this._onChangeThumbnail(this.model,this.model.get("thumbnail")),this._onChangeAuthor(this.model,this.model.get("author")),this._onChangeHasMedia(this,this.get("hasMedia")),this._onChangeShowCaption(this,this.get("showCaption")),this._onChangeShortUrl(this.model,this.model.get("url")),"new"!==this.model.get("mode")||s.isEmpty(this.model.get("url"))||(this.url.setEditorValue(this.model.get("url")),this._onChangeUrl(this.model,this.model.get("url"))),this.trigger("media:ready"),this.delayedFocus(this.get("showCaption")?this.caption:this.url)},createSubViews:function(){var t=this.subViewOptions(),e=s.extend({className:"link-title-field",name:"title",isResizable:!1,placeholder:o("Enter a title"),ariaLabel:o("Link title"),forceSingleLine:!0},t),i=s.extend({className:"link-summary-field",name:"excerpt",isResizable:!1,placeholder:o("Enter a summary"),ariaLabel:o("Link summary"),forceSingleLine:!1},t),n=s.extend({className:"url-field",isResizable:!1,placeholder:o("Paste a link"),ariaLabel:o("Paste a link"),forceSingleLine:!0,pasteHook:s.bind(this._onPaste,this),onClientEvent:s.bind(this._onUrlClientEvent,this),onChange:s.bind(s.debounce(this._onUrlEditorChange,500),this)},t),a=s.extend({className:"caption-field",name:"caption",placeholder:o("Add a description, if you like"),ariaLabel:o("Description")},t),c=s.extend({is_removable:!0},t);this.url=this.subViews.url=new r(n),this.title=this.subViews.title=new r(e),this.excerpt=this.subViews.excerpt=new r(i),this.caption=this.subViews.caption=new l(a),this.removeButton=this.subViews.removeButton=new d({buttonClass:"top-right"}),this.model.isReblog()&&(this.reblogTree=this.subViews.reblogTree=new h(c))},addStateListeners:function(){"reblog"!==this.model.get("mode")&&this.listenTo(this.model,"change:url",this._onChangeUrl),this.listenTo(this,"change:ogFetchPending",this._onChangeFetchPending),this.listenTo(this,"change:hasMedia",this._onChangeHasMedia),this.listenTo(this,"change:showCaption",this._onChangeShowCaption),this.listenTo(this.model,"change:thumbnail",this._onChangeThumbnail),this.listenTo(this.model,"change:url",this._onChangeShortUrl),this.listenTo(this.model,"change:author",this._onChangeAuthor),this.listenTo(this.model,"change:tagInput",this._onTagInputChange),this.listenTo(this.removeButton,"remove",this._onRemoveClick)},removeThumbnail:function(){this.model.unset("thumbnail")},removeMedia:function(){this.model.softReset(),this.title.setEditorValue(""),this.excerpt.setEditorValue(""),this.url.setEditorValue(""),this.tagEditor&&!this.get("hasCustomTags")&&this.tagEditor.removeTags(),s.isEmpty(this.model.get("caption"))&&(this.caption.setEditorValue(""),s.isEmpty(this.model.get("tags"))&&this.set("showCaption",!1)),this.set("hasMedia",!1),this.url.focus()},getRichTextEditor:function(){return this.caption},_onHoverRemoveButton:function(t){var e=i(t.relatedTarget||t.toElement),s="mouseover"===t.type||"mouseenter"===t.type;(s||0===e.parents('[data-subview="removeButton"]').length&&0===e.parents("[data-js-removable=true]").length)&&this.js$("removeButton").toggleClass("active",s)},_onChangeThumbnail:function(t,e){var o=this.js$("image"),n=!s.isEmpty(e);this.js$("media").toggleClass("has-thumbnail",n),this.js$("article").attr("data-js-removable",!n),o.attr("data-js-removable",n),o.empty(),n&&o.append(i("<img />").attr("src",e)),"reblog"!==this.model.get("mode")&&(n?this.model.unset("remove_thumbnail"):this.model.set("remove_thumbnail",!0))},_onUrlClientEvent:function(t){this.get("ogFetchPending")&&"keydown"===t.type&&27===t.keyCode&&(this._cancelOpenGraphFetch(),t.stopPropagation(),t.preventDefault())},_onUrlEditorChange:function(){var t=this.url.getEditorValue(),e=this._normalizeUrl(t);s.isEmpty(e)||e===this.model.get("url")||this.model.set("url",e)},_onPaste:function(t){var e,i;s.isEmpty(this.url.getEditorValue())&&(e=t.getData("text/plain"),i=this._normalizeUrl(e),s.isEmpty(i)||this.model.set("url",i))},_shouldShowThumbnail:function(t){var e=this.getMinFullWidthSize(g(t.src));return s.isNumber(e)&&s.has(t,"width")&&t.width>=e},_onChangeFetchPending:function(t,e){this.model.set("loading",e)},setPostData:function(t){t=t||{},s.has(t,"title")&&this.title.setEditorValue(t.title),s.has(t,"excerpt")&&this.excerpt.setEditorValue(t.excerpt),s.has(t,"thumbnail")&&this.model.set("thumbnail",t.thumbnail),s.has(t,"author")&&this.model.set("author",t.author),s.has(t,"tags")&&(s.each(t.tags,function(t){this.tagEditor.addTag(t.toLowerCase())},this),s.isEmpty(t.tags)||this.tagEditor.removePlaceholder())},_normalizeUrl:function(t){return s.isString(t)?(t=t.trim(),t=p.addProtocolIfMissing(t,"http:"),u.isUrl(t)?t:null):null},_onChangeUrl:function(t,e){this.get("ogFetchPending")||u.isUrl(e)&&(this.set("ogFetchPending",!0),this._ogService.fetchOpenGraphData(e).then(s.bind(this._updateWithGraphInfo,this),s.bind(this._onOpenGraphFail,this)))},_onChangeShortUrl:function(t,e){if(u.isUrl(e))try{var i,o=p.parseUrl(e);o&&s.has(o,"host")&&(i=o.host.replace(/^www\./i,""),this.js$("publisher").attr("href",e).text(i))}catch(n){}},_onChangeAuthor:function(t,e){var i=s.isEmpty(e)?"":o("By %1$s",e);this.js$("author").text(i)},_onTagInputChange:function(t,e){e&&this.set("hasCustomTags",!0)},_updateWithGraphInfo:function(t){var e=t.image,i=function(e){var i,o={title:t.title,excerpt:t.description,author:t.author,thumbnail:e?"":t.image};!this.get("hasCustomTags")&&s.has(t,"tags")&&(i=this._parseOpenGraphTags(t.tags),s.extend(o,{tags:i.slice(0,this.get("numOgTags"))})),this.setPostData(o),this.set({hasMedia:!0,showCaption:!0,ogFetchPending:!1}),this.delayedFocus(this.caption)};s.isEmpty(e)?i.call(this,!1):m.load(e).then(s.bind(function(t){i.call(this,!this._shouldShowThumbnail(t))},this),s.bind(function(){i.call(this,!0)},this))},_onOpenGraphFail:function(){this.set({hasMedia:!0,showCaption:!0,ogFetchPending:!1}),this.delayedFocus(this.caption)},_cancelOpenGraphFetch:function(){this._ogService.abort()},_parseOpenGraphTags:function(t){return t=s.isString(t)?t.split(","):t,s.isArray(t)?t:[]},_onRemoveClick:function(){this.model.get("thumbnail")?this.removeThumbnail():this.removeMedia()},_onChangeHasMedia:function(t,e){this.$el.toggleClass("has-media",e),this.js$("media").toggle(e),this.url.$el.toggle(!e),this.removeButton.$el.toggle(e&&this.model.canEditMedia())},_onChangeShowCaption:function(t,e){this.set("hideControlsLine",!e),this.js$("caption").toggle(e)},_hideEmptyFields:function(){this.title.$el.toggle(!s.isEmpty(this.model.get("title"))),this.excerpt.$el.toggle(!s.isEmpty(this.model.get("excerpt")))}});e.exports=f},{"../../services/open_graph_service":123,"../../templates/post_type_form/link-new.tpl":155,"../../utils/validation":188,"../plaintext_editor":212,"../reblog_tree":231,"../richtext_editor":232,"./base":220,"app/components/remove-button":256,jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/translate":456,"prima/utils/filename":483,"prima/utils/image/loader":488,"prima/utils/url":494}],223:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/lib/translate"),o=t("./base"),n=t("../../templates/post_type_form/link.tpl"),a=t("../plaintext_editor"),r=t("../richtext_editor"),l=t("../reblog_tree"),h=t("app/components/remove-button"),d=t("../../services/open_graph_service"),c=t("../../utils/validation"),u=t("prima/utils/url"),p=o.extend({className:"post-composer_link-post",events:{"mouseenter .media-container":"_onHoverRemoveButton","mouseleave .media-container":"_onHoverRemoveButton"},template:n,defaults:i.defaults({hasMediaView:!0,hasMedia:!1,showUrl:!0,showTitle:!1,showCaption:!1,ogFetchPending:!1,isUserTitle:!1,isUserCaption:!1,linkDescriptionClass:"link_og_blockquote"},o.prototype.defaults),afterInitialize:function(){this._ogService=new d,"new"!==this.model.get("mode")?this.set({showTitle:!0,showCaption:!0}):this.model.has("caption")&&this.set("showCaption",!0),this.set("hideControlsLine",!this.get("showCaption"))},createSubViews:function(){var t=this.subViewOptions(),e=i.extend({className:"link-title-field",name:"title",isResizable:!1,placeholder:s("Enter a title"),ariaLabel:s("Link title"),forceSingleLine:!0,onChange:i.bind(this._onChangeTitle,this)},t),o=i.extend({className:"url-field",name:"url",isResizable:!1,placeholder:s("Paste a link"),ariaLabel:s("Paste a link"),forceSingleLine:!0},t),n=i.extend({className:"caption-field",name:"caption",placeholder:s("Add a description, if you like"),ariaLabel:s("Description")},t),d=i.extend({is_removable:!0},t);this.title=this.subViews.title=new a(e),this.url=this.subViews.url=new a(o),this.caption=this.subViews.caption=new r(n),this.removeButton=this.subViews.removeButton=new h({buttonClass:"top-right"}),this.post.isReblog()&&(this.reblogTree=this.subViews.reblogTree=new l(d))},addStateListeners:function(){this.post.canEditMedia()&&this.listenTo(this.removeButton,"remove",this.removeThumbnail),"reblog"!==this.model.get("mode")&&(this.listenTo(this.post,"change:url",i.debounce(this._onChangeUrl,350)),this.listenTo(this.post,"change:caption",this._onChangeCaption)),"new"!==this.model.get("mode")&&(this._onChangeTitle(),this._onChangeCaption()),this.listenTo(this,"change:showTitle",this._onChangeShowTitle),this.listenTo(this,"change:hasMedia",this._onChangeHasMedia),this.listenTo(this,"change:showCaption",this._onChangeShowCaption),this.listenTo(this.model,"change:thumbnail",this._onChangeThumbnail)},_onChangeTitle:function(){this.get("ogFetchPending")||this.set("isUserTitle",!0)},_onChangeCaption:function(){this.get("ogFetchPending")||this.set("isUserCaption",!i.isEmpty(this.post.get("caption")))},_onHoverRemoveButton:function(t){var e="mouseover"===t.type||"mouseenter"===t.type;this.js$("removeButton").toggleClass("active",e)},_onChangeThumbnail:function(t,e){var s=this.js$("urlimage"),o=!i.isEmpty(e);o?s.css("background-image","url("+e+")"):s.css("background-image",""),"reblog"!==this.model.get("mode")&&(o?this.model.unset("remove_thumbnail"):this.model.set("remove_thumbnail",!0)),this.set("hasMedia",o)},afterRender:function(){if(this.renderSubViews(),"new"===this.model.get("mode")&&this.model.get("url")){var t=this.model.toJSON();t.title&&t.thumbnail?this._updateWithGraphInfo({url:t.url,image:t.thumbnail,title:t.title,description:t.description}):this._onChangeUrl(this.model,this.model.get("url"))}this.post.canEditMedia()?this.get("showCaption")||this.delayedFocus(this.url):(this.title.disable(),this.url.disable()),this.get("showTitle")||this.title.$el.css({display:"none",opacity:0}),this.get("hasMedia")||this.removeButton.$el.css({display:"none",opacity:0}),this.get("showCaption")?this.delayedFocus(this.caption):this.js$("caption").css({display:"none",opacity:0}),"new"!==this.model.get("mode")&&this._updateWithGraphInfo({url:this.model.get("url"),image:this.model.get("thumbnail")}),this._onChangeThumbnail(this.model,this.model.get("thumbnail")),this._onChangeHasMedia(this,this.get("hasMedia")),this.trigger("media:ready")},_onChangeUrl:function(t,e){if(!this.get("ogFetchPending")){if(i.isEmpty(e))return void this.removeMedia();e=e.trim();var s=u.addProtocolIfMissing(e,"http:");if(c.isUrl(s)){if(this.set("ogFetchPending",!0),e!==s){var o=this.model._previousAttributes.url;this.url.setEditorValue(s),this.url.setCursorToEnd(),this.model._previousAttributes.url=o}this._ogService.fetchOpenGraphData(s).then(i.bind(this._updateWithGraphInfo,this),i.bind(this._onOpenGraphFail,this))}}},_updateWithGraphInfo:function(t){var e=t.url||this.post.previous("url"),s=function(t){return t.replace(/^https?:\/\/(www.)?/,"")},o=this.model.hasChanged("url")?this.model.previous("url"):"",n=s(o)!==s(e);this.$el.addClass("loaded"),this.set({showTitle:!0,showCaption:!0}),n&&(this.get("isUserTitle")||(t.title?this.title.setEditorValue(t.title,!0):this.title.setEditorValue("")),(!this.get("isUserCaption")||i.isEmpty(this.post.get("caption")))&&(t.description?this.caption.setEditorValue('<blockquote class="'+this.get("linkDescriptionClass")+'">'+t.description+"</blockquote>",!0):this.caption.setEditorValue(""))),t.image?this.model.set("thumbnail",t.image):this.model.unset("thumbnail"),this.set("ogFetchPending",!1)},_onOpenGraphFail:function(){this.set("ogFetchPending",!1)},removeThumbnail:function(){this.model.unset("thumbnail")},removeMedia:function(){this.stopListening(),this.post.softReset(),this.get("isUserCaption")||(this.post.set("caption",""),this.caption.setEditorValue("")),i.forEach({title:this.title,url:this.url,caption:this.caption},function(t){t.updateEditorFromModel()},this),this.addStateListeners(),this.title.setEditorValue(""),this.set({hasMedia:!1,showTitle:!1,isUserTitle:!1}),i.isEmpty(this.post.get("caption"))&&(this.set("isUserCaption",!1),i.isEmpty(this.post.get("tags"))&&this.set("showCaption",!1)),this.$el.removeClass("loaded"),this.url.setEditorValue(""),this.url.focus()},_onChangeShowTitle:function(t,e){this.title.$el.css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},_onChangeHasMedia:function(t,e){this.js$("linkeditor").toggleClass("has-image",e),this.removeButton.$el.css(e&&"reblog"!==this.model.get("mode")?{display:"block",opacity:1}:{display:"none",opacity:0})},_onChangeShowCaption:function(t,e){this.set("hideControlsLine",!e),this.isRendered()&&this.js$("caption").css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},getRichTextEditor:function(){return this.caption}});e.exports=p},{"../../services/open_graph_service":123,"../../templates/post_type_form/link.tpl":156,"../../utils/validation":188,"../plaintext_editor":212,"../reblog_tree":231,"../richtext_editor":232,"./base":220,"app/components/remove-button":256,lodash:"K2RcUv","prima/lib/translate":456,"prima/utils/url":494}],224:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/lib/translate"),o=t("./base"),n=t("../ask_field"),a=t("../richtext_editor"),r=t("../reblog_tree"),l=t("../../templates/post_type_form/note.tpl"),h=o.extend({template:l,className:"post-composer_note-post",createSubViews:function(){var t=this.subViewOptions(),e=i.extend({className:"answer-field",name:"answer",placeholder:s("Your answer here"),ariaLabel:s("Answer")},t),o=i.extend({className:"caption-field",name:"caption",placeholder:s("Add your own text, if you like"),ariaLabel:s("Caption")},t),l=i.extend({is_removable:!0},t);this.askField=this.subViews.askField=new n(t),this.post.isReblog()?(this.reblogTree=this.subViews.reblogTree=new r(l),this.caption=this.subViews.caption=new a(o)):this.answerField=this.subViews.answerField=new a(e)},afterRender:function(){this.renderSubViews(),this.delayedFocus(this.post.isReblog()?this.caption:this.answerField)},getRichTextEditor:function(){return this.model.get("is_reblog")?this.caption:this.answerField}});e.exports=h},{"../../templates/post_type_form/note.tpl":157,"../ask_field":191,"../reblog_tree":231,"../richtext_editor":232,"./base":220,lodash:"K2RcUv","prima/lib/translate":456}],225:[function(t,e){"use strict";var i=t("lodash"),s=t("./base"),o=t("app/components/dialog"),n=(t("prima/lib/logger"),t("prima/lib/translate")),a=t("prima/utils/url"),r=t("prima/lib/data"),l="FileReader"in window&&"readAsDataURL"in FileReader.prototype,h=t("../../utils/validation"),d=t("../../models/photo"),c=t("../media/photo"),u=t("../photo_media_dropzone"),p=t("../richtext_editor"),m=t("../reblog_tree"),g=t("../../templates/post_type_form/photo.tpl"),f=2048,_=s.extend({template:g,defaults:i.defaults({hasMediaView:!0,hasMedia:!1,canAddMedia:!0,showPhotoBooth:!1,showCaption:!1,disablePhotoFromUrl:!1},s.prototype.defaults),afterInitialize:function(){this._urlParser=i.debounce(i.bind(this._photoUrlParser,this),100),(!this.post.photos.isEmpty()||this.post.isReblog())&&this.set({hasMedia:!0,showCaption:!0}),this.set("canAddMedia",this.post.canEditMedia()&&this.post.canAddPhotos()),this.set("hideControlsLine",!this.get("showCaption"))},_photoUrlParser:function(t,e){if(t=i.trim(t),t&&t.length<f&&h.isUrl(t)){var s=new d;this.listenTo(s,"photo:readUrl",function(t,i){t&&this.post.canAddPhotos()&&(this.post.photos.push(i),e.urlInput.setEditorValue(""),e.urlInput.blur(),e.set({showInput:!1,dropzoneBehavior:"url",defaultBehavior:"url"}))}),s.set("externalUrl",t)}},createSubViews:function(){var t=this.subViewOptions(),e=i.extend({canEditMedia:this.post.canEditMedia()},t),s=i.extend({toggleDropzone:this.get("hasMedia"),dropzoneText:n("Add another"),uploadIcon:"dropzone-add-photo-icon",uploadText:n("Upload photos"),urlIcon:"dropzone-add-url-icon",urlText:n("Add photo from web"),urlParser:this._urlParser,uploadOptions:{}},t);i.extend(s.uploadOptions,{name:"photo",maxUploadSize:10485760,uploadPattern:/^image\/(?:.*)$/i,accept:"image/*",url:"/svc/post/upload_photo",fileUpload:{multiple:!0}});var o=i.extend({className:"caption-field",name:"caption",placeholder:n("Add a caption, if you like"),ariaLabel:n("Caption")},t),a=i.extend({is_removable:!0},t);this.mediaPreview=this.subViews.mediaPreview=new c(e),this.mediaComposer=this.subViews.mediaComposer=new u(s),this.caption=this.subViews.caption=new p(o),this.post.isReblog()&&(this.reblogTree=this.subViews.reblogTree=new m(a))},addStateListeners:function(){this.listenTo(this.mediaComposer,"upload:start",this._onFileUploadStart),this.listenTo(this.mediaComposer,"upload:complete",this._onFileUploadComplete),this.listenTo(this.mediaComposer,"upload:error upload:invalid",this._onFileUploadError),this.listenTo(this.mediaComposer,"webcam:show",function(){this.set("showPhotoBooth",!0)}),this.listenTo(this.post.photos,"add",this._onAddPhotos),this.listenTo(this.post.photos,"remove",this._onRemovePhotos),this.listenTo(this.mediaPreview,"media:ready",function(){var t=i.toArray(arguments);t.unshift("media:ready"),this.trigger.apply(this,t)}),this.listenTo(this.mediaPreview,"media:addFiles",function(t){this.mediaComposer.addFiles(t)}),this.listenTo(this.mediaPreview,"webcam:close",function(){this.set("showPhotoBooth",!1)}),this.listenTo(this.mediaPreview,"webcam:error",function(t){"NO_DEVICES_FOUND"===t&&(o.alert({text_ok:n("Aw, alright"),text:"<p>"+n("Sorry, beautiful. If you wanna take a selfie, you're gonna need a webcam.")+"</p>"}),this.mediaComposer.set("enableSelfie",!1))}),this.listenTo(this,"change:hasMedia",this._onChangeHasMedia),this.listenTo(this,"change:canAddMedia",this._onChangeCanAddMedia),this.listenTo(this,"change:showPhotoBooth",this._onChangeShowPhotoBooth),this.listenTo(this,"change:showCaption",this._onChangeShowCaption)},_onAddPhotos:function(){this.set({hasMedia:!this.post.photos.isEmpty(),canAddMedia:this.post.canAddPhotos()}),i.isEmpty(this.post.get("caption"))&&i.isEmpty(this.post.get("tags"))?this.set("showCaption",this.get("hasMedia")):this.set("showCaption",!0),this.get("showCaption")&&this.caption.focus(),this.mediaComposer.set({toggleDropzone:!this.post.photos.isEmpty()})},_onRemovePhotos:function(){this.set({hasMedia:!this.post.photos.isEmpty()||this.get("showPhotoBooth"),canAddMedia:this.post.canAddPhotos()}),this.mediaComposer.set({toggleDropzone:!this.post.photos.isEmpty()})},_onChangeHasMedia:function(t,e){this.isRendered()&&this.mediaPreview.$el.css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},_onChangeCanAddMedia:function(t,e){this.isRendered()&&(this.mediaPreview.$el.toggleClass("photo-media-container--can-add",e),this.mediaComposer.$el.css(e?{display:"block",opacity:1}:{display:"none",opacity:0}))},_onChangeShowPhotoBooth:function(t,e){this.isRendered()&&(this.mediaPreview.set("showPhotoBooth",e),this.mediaPreview.$el.toggleClass("photo-media-container--show-photobooth",e),e?(this.mediaPreview.$el.css({display:"block",opacity:1}),this.mediaComposer.$el.css({display:"none",opacity:0})):(this._onChangeHasMedia(this,this.get("hasMedia")),this._onChangeCanAddMedia(this,this.get("canAddMedia"))))},_onChangeShowCaption:function(t,e){this.set("hideControlsLine",!e),this.isRendered()&&this.js$("caption").css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},_onFileUploadStart:function(t){if(!i.isEmpty(t.get("error")))return this._onFileUploadError(t);this.uploads.add(t);var e=t.get("file");this.mediaPreview.set({file:e,canEditMedia:!0});var s=new d;l?this.listenTo(s,"photo:readFile",function(t,e){t&&this.post.canAddPhotos()&&(this.post.photos.push(e),this.mediaComposer.set({dropzoneBehavior:"upload",defaultBehavior:"upload"}))}):this.listenTo(s,"change:preuploadUrl",function(t,e){e&&(this.stopListening(t,"change:preuploadUrl"),this.post.canAddPhotos()&&(this.post.photos.push(t),this.mediaComposer.set({dropzoneBehavior:"upload",defaultBehavior:"upload"})))}),t.set("postPhoto",s),s.set("upload",t),s.set("file",e)},_onFileUploadComplete:function(t){var e=t.get("postPhoto");e&&(t.get("url")?e.set("preuploadUrl",t.get("url")):(o.alert("<p>"+[t.get("original_filename"),n(t.get("error"))].join("</p><p>")+"</p>"),this.post.photos.remove(e)))},_onFileUploadError:function(t){var e=t.get("error");i.isString(e)&&(e=[e]),i.isArray(e)||(e=[n("Woops :(")]),t.get("file")&&t.get("file").name&&e.unshift(t.get("file").name),o.alert("<p>"+e.join("</p><p>")+"</p>");var s=t.get("postPhoto");this.post.photos.remove(s),this.uploads.remove(t)},afterRender:function(){this.get("disablePhotoFromUrl")||this.checkUrl(),this.renderSubViews(),this.get("canAddMedia")?this.mediaPreview.$el.addClass("photo-media-container--can-add"):this.mediaComposer.$el.css({display:"none",opacity:0}),this.get("hasMedia")||this.mediaPreview.$el.css({display:"none",opacity:0}),this.get("showCaption")?this.delayedFocus(this.caption):this.js$("caption").css({display:"none",opacity:0})},checkUrl:function(){var t=a.getParameter("src"),e=a.getParameter("caption"),i=a.getParameter("tags");a.isAbsoluteUrl(t)||(t=r.get("Context.hosts.assets_host")+t),"edit"!==this.model.get("mode")&&t&&e&&i&&(this._photoUrlParser(t,this.mediaComposer),this.model.set("caption",e),this.model.set("tags",i.split(",")),this.get("disablePhotoFromUrl")||window.Backbone.history.navigate("/new/photo",{replace:!0}))},getRichTextEditor:function(){return this.caption}});e.exports=_},{"../../models/photo":107,"../../templates/post_type_form/photo.tpl":158,"../../utils/validation":188,"../media/photo":206,"../photo_media_dropzone":211,"../reblog_tree":231,"../richtext_editor":232,"./base":220,"app/components/dialog":39,lodash:"K2RcUv","prima/lib/data":431,"prima/lib/logger":436,"prima/lib/translate":456,"prima/utils/url":494}],226:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/lib/translate"),o=t("../../utils/string_helpers"),n=t("./base"),a=t("../plaintext_editor"),r=t("../richtext_editor"),l=t("../../templates/post_type_form/quote.tpl"),h=n.extend({defaults:i.defaults({fontSizes:["extra_large","large","medium","small"]},n.prototype.defaults),template:l,afterInitialize:function(){this.listenTo(this.model,"change:quote",this.updateQuoteSize),this.wrapSource()},createSubViews:function(){var t=this.subViewOptions(),e=i.extend({className:"quote-field",name:"quote",placeholder:"&ldquo;"+s("Quote")+"&rdquo;",ariaLabel:s("Quote")},t),o=i.extend({className:"source-field",name:"source",placeholder:s("Source"),ariaLabel:s("Source")},t);i.extend(o,{fullWidthInlineMedia:!1}),this.quote=this.subViews.quote=new a(e),this.source=this.subViews.source=new r(o)},afterRender:function(){return this.renderSubViews(),this.updateQuoteSize(this.model,this.model.get("quote")||""),this.delayedFocus(i.isEmpty(this.model.get("source"))?this.quote:this.source),this.quote.editor.isEmpty()&&this.quote.editor.setData(""),this.cleanQuote(),this},teardown:function(){return this.$el.empty(),this},updateQuoteSize:function(t,e){if("string"==typeof e){var i=e.length;this._setQuoteSize(20>i?"extra_large":81>i?"large":300>i?"medium":"small")}},_setQuoteSize:function(t){var e=this.quote.$el;e.hasClass(t)||(e.removeClass(this.get("fontSizes").join(" ")),e.addClass(t))},cleanQuote:function(){var t=this.model.get("quote");t&&this.model.set("quote",o.stripHtml(t,!1))},getRichTextEditor:function(){return this.source},wrapSource:function(){var t=this.model.get("source");!t||t.indexOf("<p>")>-1||this.model.set("source","<p>"+t+"</p>")}});e.exports=h},{"../../templates/post_type_form/quote.tpl":159,"../../utils/string_helpers":187,"../plaintext_editor":212,"../richtext_editor":232,"./base":220,lodash:"K2RcUv","prima/lib/translate":456}],227:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/lib/translate"),o=t("./base"),n=t("../plaintext_editor"),a=t("../reblog_tree"),r=t("../richtext_editor"),l=t("../../templates/post_type_form/text.tpl"),h=o.extend({events:{},template:l,createSubViews:function(){var t=this.subViewOptions(),e=i.extend({className:"title-field",name:"title",placeholder:s("Title"),ariaLabel:s("Post title"),smartQuotesEnabled:!0},t),o=i.extend({className:"caption-field",name:"body",placeholder:s("Your text here"),ariaLabel:s("Post body")},t),l=i.extend({is_removable:!0},t);this.title=this.subViews.title=new n(e),this.body=this.subViews.body=new r(o),this.post.isReblog()&&(this.reblogTree=this.subViews.reblogTree=new a(l)),this.registerTitleKeyboardShortcut(this.title)},afterRender:function(){this.renderSubViews(),this.delayedFocus(this.body)},getRichTextEditor:function(){return this.body}});e.exports=h},{"../../templates/post_type_form/text.tpl":160,"../plaintext_editor":212,"../reblog_tree":231,"../richtext_editor":232,"./base":220,lodash:"K2RcUv","prima/lib/translate":456}],228:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("moment"),n=t("./base"),a=t("app/components/dialog"),r=(t("prima/lib/logger"),t("prima/lib/flags")),l=t("prima/lib/translate"),h=t("../../services/embed_data"),d=t("../../utils/camelize_keys"),c=function(){return s.browser.chrome?".mp4,.mov,.wmv,video/*":s.browser.mozilla?"video/*":""}(),u=t("../media/video"),p=t("../media_dropzone"),m=t("../confirm_tos"),g=t("../richtext_editor"),f=t("../reblog_tree"),_=t("../../templates/post_type_form/video.tpl"),v=n.extend({template:_,defaults:i.defaults({hasMediaView:!0,hasMedia:!1,showTos:!1,showCaption:!1},n.prototype.defaults),afterInitialize:function(){this._urlParser=i.debounce(i.bind(this._embedCodeParser,this),100),this.post.getEmbedData()&&this.set({hasMedia:!0,showCaption:!0}),this.post.get("copyrightFallback")&&this.set({hasMedia:!0}),this.set("hideControlsLine",!this.get("showCaption"))},createSubViews:function(){var t=this.subViewOptions(),e=i.extend({embed:this.post.getEmbedData(),canEditMedia:this.post.canEditMedia()},t),s=i.extend({url:this.post.get("embedCode"),showInput:!i.isEmpty(this.post.get("embedCode")),embed:this.post.getEmbedData(),uploadIcon:"dropzone-add-video-icon",uploadText:l("Upload a video"),uploadTooltip:function(){var e=1e3*t.user.get("videoSecondsRemaining");return"<p>"+["<strong>"+l("Upload a video")+"</strong>",l("%1$s minutes of video remaining today.",o.utc(e).format("m:ss")),l("%1$s max per file.","100MB")].join("</p><p>")+"</p>"},urlIcon:"dropzone-add-url-icon",urlText:l("Add video from web"),urlParser:this._urlParser,uploadOptions:{}},t);i.extend(s.uploadOptions,{name:"video",maxUploadSize:r.bool("ignore_video_upload_limits")?!1:104857600,uploadPattern:/^video\/(?:.*)$/i,accept:c,url:"/svc/post/upload_video"});var n=i.extend({},t),a=i.extend({className:"caption-field",name:"caption",placeholder:l("Add a caption, if you like"),ariaLabel:l("Caption")},t),h=i.extend({is_removable:!0},t);this.mediaPreview=this.subViews.mediaPreview=new u(e),this.mediaComposer=this.subViews.mediaComposer=new p(s),this.confirmTos=this.subViews.confirmTos=new m(n),this.caption=this.subViews.caption=new g(a),this.post.isReblog()&&(this.reblogTree=this.subViews.reblogTree=new f(h))},addStateListeners:function(){this.listenTo(this.mediaComposer,"upload:start",this._onFileUploadStart),this.listenTo(this.mediaComposer,"upload:complete",this._onFileUploadComplete),this.listenTo(this.mediaComposer,"upload:error upload:invalid",this._onFileUploadError),this.listenTo(this.mediaPreview,"media:ready",function(){var t=i.toArray(arguments);t.unshift("media:ready"),this.trigger.apply(this,t)}),this.post.canEditMedia()&&this.listenTo(this.mediaPreview,"media:remove",this.removeMedia),this.listenTo(this,"change:hasMedia",this._onChangeHasMedia),this.listenTo(this,"change:showTos",this._onChangeShowTos),this.listenTo(this,"change:showCaption",this._onChangeShowCaption)},removeMedia:function(){this.post.softReset(),this.set({hasMedia:!1,showTos:!1}),this.mediaPreview.set({file:!1,embed:!1}),this.js$("confirmTos").attr("checked",!!this.post.get("confirmTos")),i.isEmpty(this.post.get("caption"))&&i.isEmpty(this.post.get("tags"))&&this.set("showCaption",!1)},_onChangeHasMedia:function(t,e){this.isRendered()&&(e?(this.mediaComposer.$el.css({display:"none",opacity:0}),this.mediaPreview.$el.css({display:"block",opacity:1})):(this.mediaPreview.$el.css({display:"none",opacity:0}),this.mediaComposer.$el.css({display:"block",opacity:1})))},_onChangeShowTos:function(t,e){this.isRendered()&&this.js$("tos").css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},_onChangeShowCaption:function(t,e){this.set("hideControlsLine",!e),this.isRendered()&&this.js$("caption").css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},_onFileUploadStart:function(t){this.uploads.add(t);var e=t.get("file");this.mediaPreview.set({file:e,canEditMedia:!0}),this.listenToOnce(this.mediaPreview,"media:ready",function(){this.set({hasMedia:!0,showTos:!0,showCaption:!0}),this.caption.focus()})},_onFileUploadComplete:function(t){var e=t.get("file"),i="portrait"===t.get("orientation");
this.mediaPreview.set({file:e,canEditMedia:!0,width:t.get(i?"height":"width"),height:t.get(i?"width":"height")}),this.post.set({preuploadUrl:t.get("key"),preuploadKey:t.get("ch")})},_onFileUploadError:function(t){var e=t.get("error")||l("Error uploading video");i.isArray(e)&&(e=e.join("</p><p>")),a.alert("<p>"+e+"</p>"),this.removeMedia()},_embedCodeParser:function(t){if(this._embedCodeParsing&&this._embedCodeParsing.abortEmbedCodeParse(),!i.isEmpty(i.trim(t))){var e=!1,s=this._parseEmbedCode=h.parseEmbedData(t,540).then(i.bind(function(s){e||(this._embedCodeParsing=!1),this.listenToOnce(this.mediaPreview,"media:ready",function(){this.set({hasMedia:!0,showCaption:!0}),this.caption.focus()}),this.mediaPreview.set(i.extend({embed:d(s),canEditMedia:!0},i.pick(s,["width","height"]))),this.post.set({embedCode:t})},this),function(t){});return s.abortEmbedCodeParse=function(){e=!0},s}},afterRender:function(){this.renderSubViews(),this.get("hasMedia")?this.mediaComposer.$el.css({display:"none",opacity:0}):this.mediaPreview.$el.css({display:"none",opacity:0}),this.get("showTos")||this.js$("tos").css({display:"none",opacity:0}),this.get("showCaption")?this.delayedFocus(this.caption):this.js$("caption").css({display:"none",opacity:0})},executeUrlParser:function(t){this.subViews.mediaComposer.urlParser(t)},getRichTextEditor:function(){return this.caption}});e.exports=v},{"../../services/embed_data":118,"../../templates/post_type_form/video.tpl":161,"../../utils/camelize_keys":180,"../confirm_tos":194,"../media/video":207,"../media_dropzone":208,"../reblog_tree":231,"../richtext_editor":232,"./base":220,"app/components/dialog":39,jquery:"HlZQrA",lodash:"K2RcUv",moment:"iROhDJ","prima/lib/flags":"f/LVtH","prima/lib/logger":436,"prima/lib/translate":456}],229:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/accessor"),n=t("prima/mixins/subviewable"),a=t("prima/mixins/selectorcache"),r=t("../templates/reblog_as_button.tpl"),l=t("./reblog_as_dropdown"),h=s.extend({className:"post-form--reblog-as-button",events:{"click [data-js-clickableReblogSelect]":"toggleReblogAsDropdown"},mixins:[o,n,a],template:r,initialize:function(t){t=i.extend(t||{},{shift:{x:-5,y:10},identifier:"reblogAsDropdown"}),this.post=t.post,this.reblogAsDropdown=new l(t);var e="reblogAs:type";this.listenToOnce(this.reblogAsDropdown,e,function(){this.trigger.apply(this,i.union([e],arguments))})},render:function(){return"reblog"===this.post.get("mode")&&(this.$el.html(this.template({post:this.post})),this.reblogAsDropdown.setPinnedTarget(this.js$("clickableReblogSelect")),this.attachSubViews()),this},toggleReblogAsDropdown:function(t){var e=i.isBoolean(t)?t:!this.reblogAsDropdown.isOrWasRecentlyRendered();e&&this.reblogAsDropdown.render()}});e.exports=h},{"../templates/reblog_as_button.tpl":162,"./reblog_as_dropdown":230,lodash:"K2RcUv","prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/view":496}],230:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/view"),n=t("prima/events"),a=t("prima/lib/translate"),r=t("prima/mixins/accessor"),l=t("prima/mixins/popoverbase"),h=t("../templates/reblog_as_dropdown.tpl"),d=o.extend({className:"popover--reblog-as-dropdown",events:{"click .item-option":"setReblogType"},mixins:[r,l],template:h,initialize:function(t){this.post=t.post},reblogAsTypes:function(){return s.transform(this.post.get("can_reblog_as"),function(t,e){t[e]=a(s.capitalize(e))},{})},render:function(){return this.delegateEvents(),this.$el.html(this.template(this.serialize())),n.trigger("postForms:dismissListener:suspend"),this},teardown:function(){return this.$el.remove(),n.trigger("postForms:dismissListener:resume"),this},serialize:function(){return{postType:this.post.get("type"),postReblogAsTypes:this.reblogAsTypes()}},setReblogType:function(t){var e=i(t.currentTarget).data("reblogAsType");e!==this.post.get("type")&&this.trigger("reblogAs:type",e),this.teardown()}});e.exports=d},{"../templates/reblog_as_dropdown.tpl":163,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/lib/translate":456,"prima/mixins/accessor":458,"prima/mixins/popoverbase":465,"prima/view":496}],231:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/lib/translate"),n=t("prima/lib/flags"),a=t("prima/mixins/subviewable"),r=t("prima/mixins/selectorcache"),l=t("prima/mixins/accessor"),h=t("../templates/reblog_tree.tpl"),d=t("app/components/remove-button"),c=s.extend({className:"post-reblog-tree",events:{"click .btn-toggle-reblog":"toggleRemoveReblogTree"},mixins:[a,r,l],template:h,render:function(){return this.removeButton=this.subViews.removeButton=new d({tooltip:o("Remove reblogs"),buttonClass:"btn-remove-tree btn-toggle-reblog"}),this.$el.html(this.template(this.serialize())),this.attachSubViews(),this},teardown:function(){return this.$el.empty(),this},serialize:function(){return{showReblogTree:!i.isUndefined(this.model.get("reblog_tree"))&&this.model.get("reblog_tree"),post:this.model}},toggleRemoveReblogTree:function(t){var e=this.$(t.currentTarget),i=e.closest(".control-reblog-tree"),s=this.model.has("remove_reblog_tree")&&this.model.get("remove_reblog_tree")===!0;this.model.set("remove_reblog_tree",!s),i.toggleClass("removed",!s)}});e.exports=n.bool("reblog_ui_refresh")?t("app/components/reblog-trail/views/reblog_trail"):c},{"../templates/reblog_tree.tpl":164,"app/components/reblog-trail/views/reblog_trail":252,"app/components/remove-button":256,lodash:"K2RcUv","prima/lib/flags":"f/LVtH","prima/lib/translate":456,"prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/view":496}],232:[function(t,e){"use strict";function i(t,e){e.find(".velocity-animating").each(function(t,e){h(e).removeClass("velocity-animating").removeAttr("style")}),e.find('[class=""]').removeAttr("class"),e.find('img[src^="data:"]').attr("src","")}function s(t,e,i,s){l.each(t,function(t,i){s.find("["+e+'="'+i+'"]').attr("data-uploading-key",i).removeAttr("src")})}function o(t,e,i,s){l.each(t,function(t,i){s.find("["+e+'="'+i+'"]').remove()})}function n(t,e,i,s){l.each(t,function(t,i){s.find("["+e+'="'+i+'"]').attr("src",t)})}function a(t,e,i,s){s.find("["+t+"]").filter(e?":not([ "+e+"])":"*").removeAttr(t)}function r(t,e,i,s,o,n){n.find("["+s+'="'+t+'"]').removeAttr("data-uploading-key").removeAttr(s).attr("src",e)}var l=t("lodash"),h=t("jquery"),d=t("when"),c=t("prima/view"),u=t("velocity-animate").animate,p=t("velocity-animate").hook,m=t("prima/utils/exposer"),g=t("app/components/dialog"),f=(t("prima/lib/logger"),t("prima/lib/translate")),_=t("remarkable"),v=new _({html:!0}),b=t("to-markdown").toMarkdown,y=t("app/components/upload/collections/uploads"),w=t("ligature"),x=t("ligature").HumanKeys,k=t("../services/mention_support"),C=t("../services/inline_embed_support"),S=t("../services/image-search-support"),T=t("./mention_dropdown"),$=t("./html_field"),E=t("app/components/upload"),R=t("prima/mixins/subviewable"),F=t("prima/mixins/selectorcache"),j=t("prima/mixins/accessor"),P=t("prima/mixins/tablimiter"),A=t("../templates/richtext_editor.tpl"),I=t("prima/lib/data"),U=t("../utils/validation"),L=t("prima/utils/url"),D=t("prima/utils/image/loader"),M=t("prima/utils/image/filereader"),O=t("prima/utils/image/canvas"),q=t("../services/image_url_upload"),N=t("../utils/remap-html-tags"),B=t("../utils/filter-html-by-dom"),H=t("prima/utils/dom"),z=t("../utils/apply-all"),V=t("prima/utils/filename").getExtension,K=t("prima/utils/image/types").convertToNormalizedType,W=1080,G=1,Q=2,J=c.extend({defaults:{placeholder:"",ariaLabel:"",name:"",syncWithModel:!0,supportImages:!0,supportImageSearch:!1,supportImageFlagging:!1,supportInlineEmbeds:!0,supportMentions:!0,fullWidthInlineMedia:!1,inlineMediaWidthReblog:250,inlineEmbedsPerPost:10,minFullWidthSize:{jpg:300,png:300,gif:300},fullWidthClass:"tmblr-full",animateInlineControls:!0},events:{},mixins:[j,R,F,P],template:A,pendingMedia:{},filtersToModel:[],filtersToEditor:[],initialize:function(t){t||(t=l.extend({},t)),l.extend(this.attributes,{inlineMediaWidthFull:t.fullWidthInlineMedia?540:500},l.pick(t,l.keys(this.defaults))),this.hosts=I.get("Context/hosts"),this.uploads=t.uploads||new y,this.editor=null,this.humanKeys=new x,this.keyCommands=J.KEYCOMMANDS,l.forEach(["onChange","onClientEvent","onImageAdded","pasteHook"],function(e){var i=t[e]||this[e];this[e]=l.isFunction(i)?l.bind(i,this):l.noop},this);var e=this.get("name");e&&this.get("syncWithModel")&&(this.$el.attr("data-name",e),this.listenTo(this.model,"change:editorType",this._onChangeEditorType)),l.has(t,"user")&&t.user.has("inlineEmbedsPerPost")&&this.set("inlineEmbedsPerPost",t.user.get("inlineEmbedsPerPost"))},_onChangeEditorType:function(t,e){var i=t.previous("editorType");"rich"===i?this.updateModelFromEditor("markdown"!==e?Q:G):"markdown"===i&&this.convertModelFromMarkdown(),"markdown"===e&&this.convertModelToMarkdown(),this.updateEditorType(e,!0),this.focus()},_initializeEditor:function(t,e){var i=l.bind(this.humanKeys.pretty,this.humanKeys),s={placeholder:e,flattenBlocks:!0,onChange:this._composeOnChange(),onAsyncImageAdded:l.bind(this.onAsyncImageAdded,this),onFileAdded:l.bind(this.insertImageFromFile,this),inlineControlsConfig:{openTray:l.bind(this.openInlineControlsTray,this),closeTray:l.bind(this.closeInlineControlsTray,this),onTrayOpened:l.bind(this.onInlineControlsTrayOpened,this),onTrayClosed:l.bind(this.onInlineControlsTrayClosed,this),onShow:l.bind(this.onInlineControlsShow,this),onHide:l.bind(this.onInlineControlsHide,this),customOffset:{x:0,y:0}},addImgAttrs:{toImg:!0,toImgParent:!0},formattingControlsConfig:{controls:{bold:{el:"b",className:"bold",command:"bold",type:"inline",title:f("Bold (%1$s)",i(this.keyCommands.BOLD)),keyboard:this.keyCommands.BOLD},italic:{el:"i",className:"italic",command:"italic",type:"inline",title:f("Italic (%1$s)",i(this.keyCommands.ITALIC)),keyboard:this.keyCommands.ITALIC},headline:{el:"h2",className:"headline",command:"formatBlock",type:"block",title:f("Headline (%1$s)",i(this.keyCommands.HEADLINE)),keyboard:this.keyCommands.HEADLINE},link:{el:"a",className:"link",command:"createLink",type:"inline",title:f("Link (%1$s)",i(this.keyCommands.LINK)),keyboard:this.keyCommands.LINK},strikethrough:{el:"strike",className:"strikethrough",command:"strikethrough",type:"inline",title:f("Strikethrough (%1$s)",i(this.keyCommands.STRIKETHROUGH)),keyboard:this.keyCommands.STRIKETHROUGH},orderedList:{el:"ol",className:"ordered-list",command:"insertOrderedList",type:"list",title:f("Ordered list (%1$s)",i(this.keyCommands.ORDEREDLIST)),keyboard:this.keyCommands.ORDEREDLIST},unorderedList:{el:"ul",className:"unordered-list",command:"insertUnorderedList",type:"list",title:f("Unordered list (%1$s)",i(this.keyCommands.UNORDEREDLIST)),keyboard:this.keyCommands.UNORDEREDLIST},blockquote:{el:"blockquote",className:"quote",command:"formatBlock",type:"block",title:f("Blockquote (%1$s)",i(this.keyCommands.BLOCKQUOTE)),keyboard:this.keyCommands.BLOCKQUOTE},clear:{el:"",command:"removeFormat",type:"inline",keyboard:this.keyCommands.REMOVEFORMAT},pre:{el:"pre",command:"formatBlock",type:"block",keyboard:this.keyCommands.PRE},superscript:{el:"sup",command:"superscript",type:"inline",keyboard:this.keyCommands.SUPERSCRIPT},subscript:{el:"sub",command:"subscript",type:"inline",keyboard:this.keyCommands.SUBSCRIPT},small:{el:"small",command:"insertHTML",type:"inline",keyboard:this.keyCommands.SMALL,keyboardInverse:this.keyCommands.SMALLINVERSE}},controlsOrder:["bold","italic","headline","link","strikethrough","orderedList","unorderedList","blockquote"]},pasteHook:this.pasteHook,blurHook:l.bind(this.blurHook,this),runIFrameSanitization:!1,mediaHolderCallback:l.bind(this._mediaHolderCallback,this),filterRules:{elements:["a","b","i","strike","h2","blockquote","p","ul","ol","li","iframe","figure","img","br","hr","pre","code","small","sup","sub"],attributes:{a:["href","title"],img:["src","alt","data-img-key","data-orig-width","data-orig-height"],iframe:["src","width","height"],figure:["data-provider","data-url","data-orig-width","data-orig-height","data-embed-code","data-tumblr-attribution"],hr:["data-label"]},classnames:{a:["tumblr_blog"],hr:["tmblr-truncated"],blockquote:["link_og_blockquote"],figure:["tmblr-embed","tmblr-embed-placeholder","tmblr-full"]},remove_contents:["style","noscript","script","meta"],protocols:{a:!1}},animateShowControls:function(t){t.element.show();var e=60,i=8;l.forEach(t.buttons,function(t,s){var o=h(t);u(o,"stop"),p(o,"translateY",i),o.css("opacity",0),u(o,{translateY:[0,i],opacity:[1,0]},{delay:.25*s*e,duration:e,complete:function(){o.attr("style","")}})},this)},animateHideControls:function(t){var e=100,i=8;l.forEach(t.buttons,function(s,o){var n=h(s);u(n,"stop");var a=u(n,{translateY:i,opacity:0},{duration:e});o===t.buttons.length-1&&a.then(function(){t.element.hide()})},this)},mediaKillerMarkup:'<div class="media-button icon_close"></div>',mediaMoverMarkup:'<div class="media-button icon_drag"></div>',showStaticControls:!1,smartQuotes:{enabled:!0}};this._setupEditorFilters(),this.editor=new w.RichTextEditor(t,s),this.inlineControlNode=!1,this.get("supportImages")&&this._initializeImageSupport(),this.inlineEmbedSupport=!1,this.get("supportInlineEmbeds")&&this._initializeInlineEmbedSupport(),this.imageSearchSupport=!1,this.get("supportImageSearch")&&this._initializeImageSearchSupport(),this.mentionSupport=!1,this.get("supportMentions")&&this._initializeMentionSupport(),this._initializeReadMoreSupport(),this.editor.config.filterForSetData=l.compose.apply(this,this.editorFilters.preSet),this.editor.config.filterForGetData=l.compose.apply(this,this.editorFilters.preGet),this.updateEditorType(),"markdown"===this.getEditorType()&&(this.model.set(this.get("name"),this._modelValue().replace(/^\s*<p>([\S\s]*)<\/p>\s*$/i,"$1")),this.htmlField.updateValueFromModel(),this.htmlField.updateEditor())},_setupEditorFilters:function(){this.editorFilters={preSet:[],preGet:[]},this.editorFilters.preSet.push(this._tagTranslator)},_tagTranslator:function(t,e){return e||(e={h1:"h2",h3:"b",h4:"b",h5:"b",h6:"b",strong:"b",em:"i"}),N(t,e)},_composeOnChange:function(){var t=[this.onChange],e=this;return this.get("syncWithModel")&&t.unshift(this.updateModelFromEditor),function(){l.each(t,function(t){t.call(e)})}},pasteHook:function(t,e){var i=t.getData("text/plain"),s=i.trim();return U.isImageUrl(s)&&!e?(this.insertImageFromUrl(s,i),!0):U.isUrl(s)&&!e?(this.editor.insertData('<a href="'+s+'">'+s+"</a>"),!0):void 0},cancelBlur:function(){this.cancelNextBlur=!0},resumeBlur:function(t){this.defaultBlur?this.defaultBlur(t):l.isFunction(t)&&t()},blurHook:function(t,e){return this.cancelNextBlur?(this.cancelNextBlur=!1,this.defaultBlur=e,!0):void 0},_mediaHolderCallback:function(){this.mediaHolderCallback.apply(this,arguments)},mediaHolderCallback:function(t,e,i,s){i.is("hr, img, figure")&&l.isEmpty(i.find("iframe"))&&s.addClass("media-holder-draggable"),s.addClass("media-holder-"+i.prop("tagName").toLowerCase())},_initializeImageSupport:function(){this.imageUploader=new E({name:"image",maxUploadSize:10485760,uploadPattern:/^image\/(?:.*)$/i,accept:"image/*",url:"/svc/post/upload_text_image"});var t=h("<div />",{"class":"control add-image",tabindex:"0",title:f("Insert photo (%1$s)",this.humanKeys.pretty(this.keyCommands.PHOTO))});t.on("click",l.bind(function(){this.editor.staticControls.hide()},this)),t.append('<input type="file" accept="image/*" tabindex="-1">'),t.on('change input[type="file"]',l.bind(function(e){var i=h(e.target),s=l.toArray(i.prop("files"));l.forEach(s,function(t){this.insertImageFromFile(t)},this),i.remove(),t.append('<input type="file" accept="image/*">'),this.editor.inlineControls.close()},this)),this.editor.inlineControls.addToTray(t,{keyboard:{shortcut:this.keyCommands.PHOTO,callback:l.bind(function(){this._inlineControlKeyboardFocus(t)},this)}}),this.listenTo(this.imageUploader,"add",this._onFileUploadAdd),this.listenTo(this.imageUploader,"error",this._onFileUploadError)},_initializeImageSearchSupport:function(){var t=function(){this._inlineControlKeyboardFocus(this.imageSearchSupport.getButton(),function(){this.imageSearchSupport.prompt()},this)};this.imageSearchSupport=new S({editorView:this,editor:this.editor,supportImageFlagging:this.get("supportImageFlagging"),title:f("Insert GIF (%1$s)",this.humanKeys.pretty(this.keyCommands.GIF)),trayOptions:{keyboard:{shortcut:this.keyCommands.GIF,callback:t,context:this}}}),this.mediaHolderCallback=z([this.mediaHolderCallback,l.bind(this.imageSearchSupport.addTumblrAttribution,this.imageSearchSupport),l.bind(this.imageSearchSupport.addCarouselControls,this.imageSearchSupport)],this),this.filtersToModel.push(l.bind(this.imageSearchSupport.cleanupMarkup,this)),this.listenTo(this.imageSearchSupport,"prompt",function(){this.trigger("controls:gif:prompt")})},_onFileUploadAdd:function(t){this.uploads.add(t)},_onFileUploadError:function(t,e){var i=e.get("error")||f("Error uploading photo");g.alert("<p>"+i+"</p>")},insertImageFromUrl:function(t,e,i){e===!1||e||(e=t),i||(i={});var s=d.defer(),o=l.bind(function(){s.reject()},this);return D.load(t).then(l.bind(function(t){this.listenToOnce(this,"asyncImageAdded",function(t,e){s.resolve(t,e)}),this.editor.insertAsyncImage(t.src,null,i.targetNode,i.direction,i.skipSelectionUpdate)},this),l.bind(function(){e&&this.editor.insertData(e),o()},this)),s.promise},insertImageFromFile:function(t,e){e||(e={});var i=d.defer(),s=l.bind(function(){i.reject()},this);return t.type.match(/image\/(jpg|jpeg|png)/i)?M.read(t).then(l.bind(function(o){D.load(o.objectUrl||o.base64).then(l.bind(function(s){var n=new Image;n.src=s.src;var a=O.drawScaledAndRotated(n,s.width,s.height,o.rotation,o.mirrored,W);this.listenToOnce(this,"asyncImageAdded",function(t,e){i.resolve(t,e)}),this.editor.insertAsyncImage(a.toDataURL(o.file.type),t,e.targetNode,e.direction,e.skipSelectionUpdate)},this),s)},this),s):t.type.match(/image\/*/i)&&this.editor.insertAsyncImage(null,t,e.targetNode,e.direction,e.skipSelectionUpdate),i.promise},getMinFullWidthSize:function(t){var e=this.get("minFullWidthSize");return l.isNumber(e)?e:(t=K(t),l.has(e,t)?e[t]:null)},shouldBeFullWidth:function(t,e){var i;return this.get("fullWidthInlineMedia")&&(e=l.isNumber(e)?e:parseInt(e,10))?(i=this.getMinFullWidthSize(t),l.isNumber(i)?e>=i:!1):!1},addASyncImageFullWidthAttributes:function(t,e,i){var s;return e&&i&&this.shouldBeFullWidth(e,i)&&(s=this.editor.getAsyncImage(t))?(h(s).parent("figure").addClass(this.get("fullWidthClass")),!0):!1},onAsyncImageAdded:function(t,e,i,s){var o=l.has(s,"width")?s.width:null;if(i instanceof Blob)this.uploadInlineImage(t,i),this.pendingMedia[t]=e,this.addASyncImageFullWidthAttributes(t,i.type,o);else{if(!e||0!==e.lastIndexOf("http",0))return;L.isTumblrMediaUrl(e)||(this.uploadInlineImageUrl(t,e),this.pendingMedia[t]=e),this.addASyncImageFullWidthAttributes(t,V(e),o)}this.trigger("asyncImageAdded",t,e,i)},updateImageAttributes:function(t,e,i){var s=this.model.get("editorType");"html"===s||"markdown"===s?("markdown"===s&&this.convertModelFromMarkdown(),this.model.set(this.get("name"),B(this._modelValue(),l.partial(r,t,e,i,this.editor.config.imgKeyAttr))),"markdown"===s&&this.convertModelToMarkdown(),this.htmlField.updateValueFromModel(),this.htmlField.updateEditor()):(this.editor.updateAsyncImage(t,e,i),this.updateModelFromEditor()),delete this.pendingMedia[t]},uploadInlineImageUrl:function(t,e){q.uploadImageUrl(e,l.bind(function(e){this.updateImageAttributes(t,e.response.url)},this),l.bind(function(){this.updateImageAttributes(t,e)},this))},uploadInlineImage:function(t,e){var i=l.bind(function(t,e){this.listenTo(e,"change:complete change:error",l.bind(function(e){var i,s=e.get("url");e.get("raw_width")&&e.get("raw_height")&&(i={width:e.get("raw_width"),height:e.get("raw_height")}),l.has(e.changed,"error"),D.load(s).then(l.bind(function(){this.updateImageAttributes(t,s,i)},this)),this.stopListening(e,"change:complete change:error")},this))},this),s=function(o){o.get("file")===e&&(i.call(this,t,o),this.stopListening(this.imageUploader,"add",s))},o=function(i,s){if(s.get("file")===e){var o=h(this.editor.getAsyncImage(t)),a=o.closest(".media-holder");a.length?a.remove():o.remove(),this.updateModelFromEditor();var r;r=s.get("error")||f("Error uploading photo"),l.isArray(r)&&(r=r.join("</p><p>")),g.alert("<p>"+r+"</p>",l.bind(this.editor.focus,this.editor)),n.call(this,i,s)}},n=function(t,i){var a=i.files?i.files[0]:i.file;a=a||i.get("file"),a===e&&(this.stopListening(this.imageUploader,"add",s),this.stopListening(this.imageUploader,"invalid",o),this.stopListening(this.imageUploader,"send",n))};this.listenTo(this.imageUploader,"add",s),this.listenTo(this.imageUploader,"invalid",o),this.listenTo(this.imageUploader,"send",n),this.imageUploader.addFiles([e])},toggleInlineControlsTray:function(t){l.has(this.editor,"inlineControls")&&(t=t||!1,this.editor.inlineControls.toggleTrayWithIntent(t))},openInlineControlsTray:function(t){t=t||this.editor.inlineControls.tray||h(),this.editor.inlineControls.isShown||this.editor.inlineControls.show(),u(t,"stop",!0),t.css({opacity:"",left:""}),this.editor.setPlaceholder(!1),this.editor.blur(!0),this.$el.addClass("tray-open"),this.catchTabs(t),t.attr("tabindex",0).focus(),this.catchEsc(t,this.toggleInlineControlsTray),this.get("animateInlineControls")&&l.forEach(t.find(".control"),function(t,e){var i=h(t);u(t,"stop",!0),i.css({opacity:0,left:"-25px"}),u(t,{opacity:1,left:0},{delay:30*e,duration:300,easing:[.175,.885,.32,1.275]})})},closeInlineControlsTray:function(t){t=t||h(),this.releaseTabs(),this.releaseEsc(t);var e=function(){t.css({opacity:"",left:""}),t.length&&t.is(":visible")&&this.editor.focus(!0),this.editor.setPlaceholder(this.get("placeholder")),this.$el.removeClass("tray-open")};u(t,{opacity:0,left:"-=20px"},{duration:150,complete:l.bind(e,this)})},onInlineControlsTrayOpened:function(t){this.inlineControlNode=this.editor.getCurrentElement(),this.inlineEmbedSupport&&(this.inlineEmbedSupport.trayOpened(t),this.trigger("controls:open",t)),this.imageSearchSupport&&this.imageSearchSupport.trayOpened(t)},onInlineControlsTrayClosed:function(t){this.inlineControlNode=!1,this.inlineEmbedSupport&&(this.inlineEmbedSupport.trayClosed(t),this.trigger("controls:close",t)),this.imageSearchSupport&&this.imageSearchSupport.trayClosed(t)},onInlineControlsShow:function(t){t.element.show(),this.$el.addClass("inline-controls-show"),this.trigger("controls:show")},onInlineControlsHide:function(t){t.element.hide(),this.$el.removeClass("inline-controls-show"),this.trigger("controls:hide")},_initializeMentionSupport:function(){var t=["tumblelog"];l.isArray(this.editor.config.linkConfig.bypassClasses||!1)&&(t=l.union(this.editor.config.linkConfig.bypassClasses,t)),this.editor.linkControl.bypassClasses=t,this.mentionPopover=new T({pinnedSide:"none",teardownOnEscape:!1,identifier:"postForms:mentionDropdown"}),this.mentionSupport=new k(this.editor,this.mentionPopover),this.getEditorValue=l.compose(this.mentionSupport.stripGhost,this.getEditorValue)},_getReadMoreMarkup:function(){return'<hr class="tmblr-truncated" data-label="'+f("Keep reading")+'">'},convertReadMoreMagicKey:function(t){var e=t.replace(/\[\[MORE\]\]/g,this._getReadMoreMarkup());return e},convertReadMoreHtml:function(t){var e=h(H.nodeFromString(t));return e.find(".tmblr-truncated").replaceWith("[[MORE]]"),e.html()},_createEmptyParagraph:function(){return this.editor.isCursorAtStart()?this.editor.insertNewParagraphBefore():this.editor.insertNewParagraphAfter()},_inlineControlKeyboardFocus:function(t,e,i){var s;this.editor.hasSelection()||(s=function(){var s=this.get("animateInlineControls");this.set("animateInlineControls",!1),this.toggleInlineControlsTray(!0),t&&h(t).focus(),"function"==typeof e&&e.call(i||this,t),this.set("animateInlineControls",s)},this.editor.isEmptyElement()?s.call(this):(this.listenToOnce(this,"controls:show",function(){setTimeout(l.bind(s,this),50)}),this._createEmptyParagraph()))},_initializeReadMoreSupport:function(){var t=function(t){return t.stopPropagation(),t.preventDefault(),!1},e=l.bind(function(){this.editor.hasSelection()||this.editor.insertMedia("<hr>")},this),i=l.bind(function(){if(!this.editor.hasSelection()){var t=this.$(".media-holder .tmblr-truncated");t.length&&t.closest(".media-holder").remove(),this.editor.insertMedia(this._getReadMoreMarkup())}},this),s=h("<div />",{"class":"control add-hr",tabindex:"0",title:f("Insert horizontal line (%1$s)",this.humanKeys.pretty(this.keyCommands.HR))});s.on("click",e),s.on("mousedown",t);var o=h("<div />",{"class":"control add-read-more",tabindex:"0",title:f("Insert read-more link (%1$s)",this.humanKeys.pretty(this.keyCommands.MORE))});o.on("click",i),o.on("mousedown",t),this.editor.inlineControls.addToTray(s,{keyboard:{shortcut:this.keyCommands.HR,callback:e}}),this.editor.inlineControls.addToTray(o,{keyboard:{shortcut:this.keyCommands.MORE,callback:i}}),this.editorFilters.preSet.push(l.bind(function(t){var e=t;return e=this.convertReadMoreMagicKey(e)},this)),this.editorFilters.preGet.push(l.bind(function(t){var e=t;return e=this.convertReadMoreHtml(e)},this))},_initializeInlineEmbedSupport:function(){var t=function(){this.inlineEmbedSupport&&!this.inlineEmbedSupport.isDisabled&&this._inlineControlKeyboardFocus(this.inlineEmbedSupport.getButton(),function(){this.inlineEmbedSupport.prompt()},this)};this.inlineEmbedSupport=new C({editorView:this,editor:this.editor,inlineEmbedsPerPost:this.get("inlineEmbedsPerPost"),inlineMediaWidthReblog:this.get("inlineMediaWidthReblog"),inlineMediaWidthFull:this.get("inlineMediaWidthFull"),fullWidthInlineMedia:this.get("fullWidthInlineMedia"),fullWidthClass:this.get("fullWidthClass"),title:f("Insert video (%1$s)",this.humanKeys.pretty(this.keyCommands.EMBED)),disabledTitle:f("Sorry, you can't add more than %1$s videos",this.get("inlineEmbedsPerPost")),trayOptions:{keyboard:{shortcut:this.keyCommands.EMBED,callback:t,context:this}}}),this.editorFilters.preSet.push(l.bind(function(t){return this.inlineEmbedSupport?this.inlineEmbedSupport.addEmbedPlaceholders(t):t},this)),this.editorFilters.preGet.push(l.bind(function(t){return this.inlineEmbedSupport?this.inlineEmbedSupport.removeEmbedPlaceholders(t):t},this)),this.listenTo(this.inlineEmbedSupport,"prompt",function(){this.trigger("controls:embed:prompt")})},beforeRender:function(){this.htmlField=this.subViews.htmlField=new $({model:this.model,name:this.get("name")})},render:function(){var t=this._modelValue().length>0;t&&this.set("placeholder",!1),this.$el.html(this.template({ariaLabel:this.get("ariaLabel")}));var e=this.js$("richTextEditor").get(0);return this._initializeEditor(e,this.get("placeholder")),t&&"rich"===this.getEditorType()&&this.updateEditorFromModel(),this.get("fullWidthInlineMedia")&&this.$el.addClass("editor-full-width-inline-media"),this.attachSubViews(),this},teardown:function(){return this.$el.empty(),this.editor.teardown(),this.imageUploader&&(this.stopListening(this.imageUploader),this.imageUploader.teardown(),delete this.imageUploader),delete this.mentionSupport,delete this.inlineEmbedSupport,delete this.imageSearchSupport,this.editorFilters&&delete this.editorFilters,this},serialize:function(){return this.toJSON()},getEditorType:function(){return this.model.get("editorType")},getEditorValue:function(t,e){return"undefined"!=typeof t||(t=!0),"undefined"!=typeof e||(e=!0),this.editor?this.editor.getData(t,e):null},setEditorValue:function(t,e,i){this.editor&&this.editor.setData(t,e,i)},convertModelFromMarkdown:function(){var t=v.render(this._modelValue());return this.model.set(this.get("name"),t),t},convertModelToMarkdown:function(){var t=b(this._modelValue());return t=t.replace(new RegExp(/<figure\b([^>]*)>([\s\S]*?)<\/figure>/gi),"$2"),this.model.set(this.get("name"),t),t},updateModelFromEditor:function(t,e,n){if(!this.editor)return!1;var r=this.get("name"),h=this.getEditorValue(),d=[i];l.isEmpty(this.pendingMedia)||(t===Q?d.push(l.partial(s,this.pendingMedia,this.editor.config.imgKeyAttr)):t===G&&d.push(l.partial(o,this.pendingMedia,this.editor.config.imgKeyAttr))),e||d.push(l.partial(a,this.editor.config.imgKeyAttr,"data-uploading-key")),n||l.isEmpty(this.filtersToModel)||(d=d.concat(this.filtersToModel)),h=B(h,d),this.model.get(r)!==h&&this.model.set(r,h)},updateEditorFromModel:function(){var t=this.getEditorValue(),e=this._modelValue();e.trim()&&e.trim()!==t.trim()&&this.setEditorValue(e,!0)},updateEditorType:function(t,e,i){t||(t=this.model.get("editorType"));var s=h(this.editor.wrapper),o=!!this.model.get("hasSeenHtml");if("rich"===t){this.htmlField.hide();var r=this._modelValue(!0),d=[];l.isEmpty(this.pendingMedia)||d.push(l.partial(n,this.pendingMedia,this.editor.config.imgKeyAttr)),d.push(l.partial(a,this.editor.config.imgKeyAttr,"data-uploading-key")),i||l.isEmpty(this.filtersToEditor)||(d=d.concat(this.filtersToEditor)),r=B(r,d),this.setEditorValue(r,!0,o),s.show()}else s.hide(),this.htmlField.updateValueFromModel(),this.htmlField.set("isMarkdown","markdown"===t),e&&this.htmlField.set("editedSincePreview",!0),this.htmlField.show(),this.htmlField.showSource(o),this.model.set("hasSeenHtml",!0)},_modelValue:function(t){var e=this.model.get(this.get("name"))||"";return e=e.replace(/<!-- +more +-->/gi,"[[MORE]]"),t&&l.result(this.model,"isReblog")&&(e=e.replace(/<p>\s*<br\s*\/?>\s<\/p>$/i,"")+"<p><br></p>"),e},focus:function(t){this.editor&&"rich"===this.getEditorType()?this.editor.focus(t):this.htmlField&&this.htmlField.focus()},blur:function(t){this.editor&&"rich"===this.getEditorType()?this.editor.blur(t):this.htmlField&&this.htmlField.blur()},catchEsc:function(t,e){h(t).on("keydown.rteCatchEsc",l.bind(function(t){27===t.keyCode&&(e.call(this),t.stopPropagation())},this))},releaseEsc:function(t){h(t).off("keydown.rteCatchEsc")},setCursorToEnd:function(){this.editor&&l.isFunction(this.editor.setCursorToEnd)&&this.editor.setCursorToEnd()}},{KEYCOMMANDS:{BOLD:"meta+b",ITALIC:"meta+i",HEADLINE:"meta+shift+2",LINK:"meta+k",STRIKETHROUGH:"meta+shift+6",ORDEREDLIST:"meta+shift+7",UNORDEREDLIST:"meta+shift+8",BLOCKQUOTE:"meta+shift+9",REMOVEFORMAT:"meta+shift+0",PRE:"meta+shift+x",SUPERSCRIPT:"meta+dot",SUBSCRIPT:"meta+comma",SMALL:"meta+shift+minus",SMALLINVERSE:"meta+shift+plus",PHOTO:"meta+shift+p",GIF:"meta+shift+g",EMBED:"meta+shift+m",HR:"meta+shift+l",MORE:"meta+shift+k"}});m({"Tumblr.Prima.RichTextEditorView":J}),e.exports=J},{"../services/image-search-support":119,"../services/image_url_upload":120,"../services/inline_embed_support":121,"../services/mention_support":122,"../templates/richtext_editor.tpl":165,"../utils/apply-all":178,"../utils/filter-html-by-dom":183,"../utils/remap-html-tags":184,"../utils/validation":188,"./html_field":197,"./mention_dropdown":209,"app/components/dialog":39,"app/components/upload":266,"app/components/upload/collections/uploads":265,jquery:"HlZQrA",ligature:511,lodash:"K2RcUv","prima/lib/data":431,"prima/lib/logger":436,"prima/lib/translate":456,"prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/mixins/tablimiter":469,"prima/utils/dom":480,"prima/utils/exposer":482,"prima/utils/filename":483,"prima/utils/image/canvas":486,"prima/utils/image/filereader":487,"prima/utils/image/loader":488,"prima/utils/image/types":489,"prima/utils/url":494,"prima/view":496,remarkable:"tJkXfs","to-markdown":"ArhiFs","velocity-animate":"lWl/mc",when:"RG2dij"}],233:[function(t,e){"use strict";var i=t("prima/view"),s=t("prima/utils/bindendevent").animation,o=t("../templates/richtext_editor_tutorial.tpl"),n=i.extend({className:"post-form--richtext-editor-tutorial popover tutorial",template:o,events:{"click > button":"close"},remove:function(){return this.trigger("removed",this),i.prototype.remove.apply(this,arguments)},close:function(){s(this.$el,this.remove.bind(this)),this.trigger("closing",this),this.$el.addClass("closing")
},render:function(){return this.$el.html(this.template(this.attributes)),this}});e.exports=n},{"../templates/richtext_editor_tutorial.tpl":166,"prima/utils/bindendevent":474,"prima/view":496}],234:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/lib/translate"),n=t("prima/events"),a=t("prima/mixins/accessor"),r=t("prima/mixins/subviewable"),l=t("prima/mixins/selectorcache"),h=t("../templates/save_post_button.tpl"),d=t("./save_post_dropdown"),c=t("components/knight-rider-loader"),u=s.extend({className:"post-form--save-button",events:{"click [data-js-clickableSaveDropdown]":"toggleSavePostDropdown","mousedown [data-js-clickableSaveDropdown]":"savePostDropdownIntent"},mixins:[a,r,l],template:h,initialize:function(t){this.options=t=i.extend({shift:{x:0,y:10},identifier:"postForms:savePostDropdown"},t),i.extend(this,i.pick(t,"post","user","uploads")),this.savePostDropdown=new d(t),this.set("initialPostPseudoState",this.post.get("pseudoState"))},checkCanPost:function(){this.set("canPost",this.post.isValid()&&!this.uploads.anyUploading())},checkIsActive:function(){this.set("isActive",this.get("canPost")&&!this.savePostDropdown.isRendered())},setStateForContext:function(){if("new"===this.post.get("mode")){var t=this.post.getContextPage();"drafts"===t?this.savePostDropdown.setOptionDraft():"queue"===t&&this.savePostDropdown.setOptionQueue()}},render:function(){return this.$el.html(this.template()),this.loader=this.subViews.loader=new c({variation:"centered small"}),this.savePostDropdown.setPinnedTarget(this.js$("clickableSaveDropdown")),this.attachSubViews(),this.loader.render(),this.setStateForContext(),this.checkCanPost(),this.checkIsActive(),this.set("buttonLabel",this.buttonLabelForPseudoState()),this.updateButtonLabel(),this.updateButtonEnabledState(),this},afterRender:function(){this.listenTo(this.post,"change validate",this.checkCanPost),this.listenTo(this.uploads,"change:uploading",this.checkCanPost),this.listenTo(this.savePostDropdown,"open close",this.checkIsActive),this.listenTo(this.post,"change:state",function(t){this.set("buttonLabel",this.buttonLabelForPseudoState(t.get("pseudoState")))}),this.listenTo(n,"postForms:saving",this.showLoader),this.listenTo(n,"postForms:error",this.hideLoader),this.listenTo(this,"change:canPost",this.checkIsActive),this.listenTo(this,"change:isActive",this.updateButtonEnabledState),this.listenTo(this,"change:buttonLabel",this.updateButtonLabel)},updateButtonEnabledState:function(t,e){!i.isUndefined(e)||(e=this.get("isActive")),this.js$("clickableSave").toggleClass("disabled",!e).prop("disabled",!e)},updateButtonLabel:function(t,e){e||(e=this.get("buttonLabel")),this.js$("clickableSave").text(e)},showLoader:function(){this.toggleLoader(!0)},hideLoader:function(){this.toggleLoader(!1)},toggleLoader:function(t){var e=!!t;this.$el.css({width:e?this.$el.width():"",height:e?this.$el.height():""}),this.loader.set("loading",e),this.js$("clickableSaveDropdown").toggle(!e),this.js$("clickableSave").toggle(!e)},buttonLabelForPseudoState:function(t,e,i){switch(t||(t=this.post.get("pseudoState")),e||(e=this.get("initialPostPseudoState")),i||(i=this.post.get("mode")),t){case"published":return o("reblog"===i?"Reblog":"edit"===i&&"published"===e?"Save":"Post");case"queued":return o("Queue");case"scheduled":return o("Schedule");case"draft":return o("Save draft");case"private":return o("edit"===i&&"private"===e?"Save":"Post privately");default:return o("Post")}},toggleSavePostDropdown:function(t){i.isBoolean(t)||(t=!this.savePostDropdown.isOrWasRecentlyRendered()),t?this.savePostDropdown.render():this.savePostDropdown.remove()},savePostDropdownIntent:function(){this.trigger("dropdown:intent")}});e.exports=u},{"../templates/save_post_button.tpl":167,"./save_post_dropdown":235,"components/knight-rider-loader":353,lodash:"K2RcUv","prima/events":429,"prima/lib/translate":456,"prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/view":496}],235:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/view"),n=t("prima/lib/translate"),a=t("prima/events"),r=t("prima/mixins/accessor"),l=t("prima/mixins/subviewable"),h=t("prima/mixins/selectorcache"),d=t("prima/mixins/popoverbase"),c=t("./post_preview"),u=t("../templates/save_post_dropdown.tpl"),p=o.extend({className:"popover--save-post-dropdown",events:{"click [data-js-preview]":"triggerPostPreview","click [data-js-publish]":"setOptionPublish","click [data-js-draft]":"setOptionDraft","click [data-js-private]":"setOptionPrivate","click [data-js-queue]":"setOptionQueue","click [data-js-schedule]":"setOptionSchedule","input [data-js-scheduleText]":"scheduleInputUpdated","keypress [data-js-scheduleText]":"checkScheduleComplete"},mixins:[r,l,h,d],postStateOptions:["published","queued","scheduled","draft","private"],template:u,initialize:function(t){this.user=t.user},render:function(){return this.delegateEvents(),this._updateViewAttributes(),this.$el.html(this.template(this.serialize())),this._updateViewElements(),a.trigger("postForms:dismissListener:suspend"),this},teardown:function(){return this.$el.remove(),a.trigger("postForms:dismissListener:resume"),this},serialize:function(){var t=s.extend({__:n},this.attributes);return t},_updateViewAttributes:function(){this.set({showPreview:!0,state:this.model.get("pseudoState"),activeOptions:"edit"===this.model.get("mode")&&this.model.get("createdPost")?["published","private"]:this.postStateOptions})},_updateViewElements:function(){"scheduled"===this.model.get("state")?this.js$("scheduleText").val(this.model.get("publish_on")):i("[data-js-scheduleText]",this.$el).hide(),this.js$("preview").toggleClass("disabled",!this.model.isValid())},triggerPostPreview:function(){this.model.isValid()&&(this._previewPost(),this.teardown())},setOptionPublish:function(){this._unSchedule(),this.model.set({state:"published",is_private:!1}),this.teardown()},setOptionDraft:function(){this._unSchedule(),this.model.set("state","draft"),this.teardown()},setOptionPrivate:function(){this._unSchedule(),this.model.set({state:"private",is_private:!0}),this.teardown()},setOptionQueue:function(){this._unSchedule(),this.model.set("state","queued"),this.teardown()},setOptionSchedule:function(){if(!this.scheduling){this.scheduling=!0,this._selectOption(this.js$("schedule")),this.model.set("state","scheduled");var t=this.js$("scheduleText");if(!t.value){var e=t.attr("placeholder");t.val(e),this.model.set("publish_on",e)}this.js$("scheduleText").show()}},scheduleInputUpdated:function(t){this.model.set("publish_on",t.target.value)},checkScheduleComplete:function(t){13===t.which&&this.teardown()},_selectOption:function(t){this.js$("options").children().removeClass("icon_checkmark"),t.addClass("icon_checkmark")},_unSchedule:function(){this.scheduling=!1,this.model.set("publish_on","")},_previewPost:function(){var t=this.model.get("tumblelog"),e=new c({action:this.user.getChannel(t).get("blog_url")+"post/preview",inputs:this.model.toJSON({url:"/svc/post/update",forServer:!0})}),i=e.render().$el.find("form");i.css({"pointer-events":"none",overflow:"hidden",position:"absolute",bottom:0,right:0,width:1,height:1,opacity:0}).appendTo("body").submit().remove()}});e.exports=p},{"../templates/save_post_dropdown.tpl":168,"./post_preview":214,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/lib/translate":456,"prima/mixins/accessor":458,"prima/mixins/popoverbase":465,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/view":496}],236:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/subviewable"),n=t("prima/mixins/selectorcache"),a=t("prima/mixins/accessor"),r=t("../templates/social_buttons.tpl"),l=t("./tweet_dropdown"),h=s.extend({className:"post-forms--social-buttons",events:{"click [data-js-shareIcon]":"_onClickShareIcon","mouseenter [data-js-twitterIcon]":"_onMouseEnterTwitterIcon"},mixins:[o,n,a],services:["facebook","twitter"],template:r,defaults:{facebook:!1,twitter:!1,facebookOn:!1,twitterOn:!1},initialize:function(t){this.options=t=i.extend({},t,{shift:{x:90,y:10},identifier:"postForms:tweetDropdown"}),i.extend(this,i.pick(t,"post","user","uploads","dragEvents")),this.updateStateFromPost(),this.shouldShowSocialIcons()||this.set({twitter:!1,facebook:!1}),this.updatePostFromState()},_onClickShareIcon:function(t){t.preventDefault();var e=this.$(t.currentTarget),i=e.parent(),s=i.data("service");switch(s){case"twitter":this.post.set("send_to_twitter",!this.get("twitterOn")),this.toggleTweetDropdown(this.post.get("send_to_twitter"));break;case"facebook":this.post.set("send_to_fbog",!this.get("facebookOn"))}},_onMouseEnterTwitterIcon:function(t){this.get("twitterOn")&&(t.preventDefault(),this.toggleTweetDropdown(!0))},_onChangeTumblelog:function(){this.teardown(),this.updateStateFromPost(),this.updatePostFromState(),this.render()},_onChangePostState:function(){"private"===this.post.get("pseudoState")&&this.post.changed.is_private?(this.lastSettings=i.clone(this.attributes),this.set({twitter:!1,facebook:!1})):this.set(this.lastSettings)},shouldShowSocialIcons:function(){return"new"===this.post.get("mode")||"reblog"===this.post.get("mode")||"published"!==this.post.get("state")&&"private"!==this.post.get("state")},updateStateFromPost:function(){var t=this.post.get("tumblelog"),e=this.user.getChannel(t),s=e.get("can_send_to_twitter"),o=e.get("can_send_to_facebook");this.shouldShowSocialIcons()||(s=o=!1);var n=this.post.get("send_to_twitter"),a=this.post.get("send_to_fbog");"edit"!==this.post.get("mode")&&(n=e.get("twitter_send_posts"),a=e.get("facebook_opengraph_send_posts")),this.set({twitter:s,facebook:o,twitterOn:!!n,facebookOn:!!a}),this.lastSettings=i.clone(this.attributes)},updatePostFromState:function(){this.post.set({send_to_twitter:this.get("twitterOn"),send_to_fbog:this.get("facebookOn")})},toggleTweetDropdown:function(t){t?!1===this.tweetDropdown.isRendered()&&this.tweetDropdown.render():this.tweetDropdown.teardown()},serialize:function(){return this.toJSON()},beforeRender:function(){this.tweetDropdown=new l(this.options),this.listenTo(this.post,"change:send_to_fbog",function(t,e){this.set("facebookOn",!!e)}),this.listenTo(this.post,"change:send_to_twitter",function(t,e){this.set("twitterOn",!!e)}),this.listenTo(this,"change:twitterOn",function(t,e){this.js$("twitter").toggleClass("hidden",!this.get("twitter")).toggleClass("checked",e)}),this.listenTo(this,"change:facebookOn",function(t,e){this.js$("facebook").toggleClass("hidden",!this.get("facebook")).toggleClass("checked",e)})},render:function(){return this.$el.html(this.template(this.toJSON())),this.tweetDropdown.setPinnedTarget(this.js$("tweetDropdownPin")),this},afterRender:function(){this.listenTo(this.post,"change:state",this._onChangePostState),this.listenTo(this.post,"change:tumblelog",this._onChangeTumblelog),this.listenTo(this.post,"change:send_to_twitter",function(t,e){e||this.post.unset("customTweet")})},teardown:function(){return this.stopListening(),this.tweetDropdown.teardown(),this}});e.exports=h},{"../templates/social_buttons.tpl":169,"./tweet_dropdown":243,lodash:"K2RcUv","prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/view":496}],237:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/lib/translate"),a=t("prima/mixins/accessor"),r=t("prima/mixins/subviewable"),l=t("prima/mixins/selectorcache"),h=t("./plaintext_editor"),d=t("./tag_suggest"),c=t("../templates/tag_editor.tpl"),u=t("./tag_label"),p=o.extend({className:"post-form--tag-editor",defaults:{maxTagLength:140,suggestMinLength:2,showSuggestPopover:!1,editorHistory:[]},mixins:[a,r,l],template:c,events:{click:"onClick"},initialize:function(t){this.options=t=i.pick(t,"post","user","model"),i.extend(this,i.pick(t,"post","user")),this.placeholder=n("#tags")},createSubViews:function(){var t=i.extend({placeholder:this.model.get("tags").length>0?!1:this.placeholder,name:"tagInput",forceSingleLine:!0,onClientEvent:i.bind(this.handleInputKeys,this),ariaLabel:n("Post tags")},this.options),e={post:this.post,user:this.user,shift:{x:0,y:15},identifier:"postForms:tagSuggest"};this.tagInput=this.subViews.tagInputField=new h(t),this.tagSuggest=new d(e),this.tagLabelViews=[],i.forEach(this.post.get("tags"),function(t){var e=new u({label:t});this.subViews["tagLabel_"+t]=e,this.tagLabelViews.push(e),this.listenToOnce(e,"tagLabel:delete",this.removeTag)},this)},attachSubViews:function(){return this.attachSubView(this.tagInput,"tagInputField"),i.forEach(this.tagLabelViews,function(t){this.js$("tagInputFieldWrapper").before(t.$el)},this),this},beforeRender:function(){this.createSubViews(),this.addTagEditorListeners()},render:function(){return this.$el.html(this.template()),this.attachSubViews(),this},afterRender:function(){this.renderSubViews(),this.tagSuggest.setPinnedTarget(this.js$("tagInputGhost")),s(this.tagInput.editor.element).on("blur",i.bind(this.submitTag,this))},teardown:function(){return this.stopListening(),this.tagLabelViews=[],this},addTagEditorListeners:function(){this.listenTo(this.model,"change:tagInput",this.handleTagInput),this.listenTo(this.tagInput,"tagInput:submitTag",this.submitTag),this.listenTo(this.tagSuggest,"tagSuggest:submitTag",this.submitTag),this.listenTo(this.tagInput,"tagInput:backspace",this.handleBackspace),this.tagSuggest.listenTo(this,"tagEditor:fetchSuggestions",this.tagSuggest.fetchSuggestions),this.tagSuggest.listenTo(this.tagInput,"tagInput:cycleUp",this.tagSuggest.cycleUp),this.tagSuggest.listenTo(this.tagInput,"tagInput:cycleDown",this.tagSuggest.cycleDown),this.tagSuggest.listenTo(this.tagInput,"tagInput:dismissSuggestions",this.tagSuggest.dismiss)},handleInputKeys:function(t){var e,i=["keyup","keydown","keypress"],s={keydown:{38:"tagInput:cycleUp",40:"tagInput:cycleDown",8:"tagInput:backspace",9:"tagInput:submitTag",13:"tagInput:submitTag"},keypress:{44:"tagInput:submitTag"}};if(-1!==i.indexOf(t.type))if(t=t||window.event,e=t.which||t.keyCode,"keydown"===t.type||"keypress"===t.type)if(e in s[t.type]){this.tagInput.trigger(s[t.type][e],t);var o=/Mac/.test(navigator.platform)?t.metaKey:t.ctrlKey;8===e||13===e&&o||(t.preventDefault(),t.stopImmediatePropagation())}else this.tagInput.getEditorValue().length>=this.get("maxTagLength")&&(t.preventDefault(),t.stopImmediatePropagation());else if(e in s.keypress||e in s.keydown&&8!==e)return!1},handleTagInput:function(t,e){var i=e&&e.length>=this.get("suggestMinLength");i?this.trigger("tagEditor:fetchSuggestions",e,this._postTags()):this.tagInput.trigger("tagInput:dismissSuggestions"),this.js$("tagInputGhost").text(e)},handleBackspace:function(){0===this.tagInput.getEditorValue().length&&this._postTags().length&&this.removeTag()},submitTag:function(t){if(t&&"blur"===t.type){if(this._postTags().length||this.tagInput.editor.setPlaceholder(this.placeholder),this.tagSuggest.get("interactive"))return}else this.tagInput.editor.setPlaceholder(!1);var e=this.tagSuggest.get("interactive")?this.tagSuggest.getCycledTag():this.tagInput.getEditorValue();if(""===e)return void this.trigger("postForms:focusOnNextEditor",t);e=e.toString().replace(/[,#]/g,""),e.match(/<.*>/)&&(e=e.replace(/[<>]/g,function(t){return i.escape(t)}));var s=e.match(/"/g),o=s?s.length:0;if(o%2===1){var n=e.lastIndexOf('"');e=e.replace(/"/g,function(t,e){return e===n?'"':""})}else o>0&&(e=e.replace(/"/g,""));e=e.trim().substr(0,this.get("maxTagLength")),this.clearInput();var a=this.addTag(e);if(a){var r=t?t.which||t.keyCode:!1;if(r===!1||"focusout"!==t.type&&(9!==r||!t.shiftKey))return this.tagInput.focus(),!1}},addTag:function(t){if(!t||i.contains(this._postTags(!0),t.toLowerCase()))return!1;this.post.get("tags").push(t);var e=new u({label:t});return this.subViews["tagLabel_"+t]=e,this.tagLabelViews.push(e),this.js$("tagInputFieldWrapper").before(e.render().$el),this.listenToOnce(e,"tagLabel:delete",this.removeTag),!0},removeTag:function(t){if(t||(t=i.last(this.post.get("tags"))),!t)return!1;var e=i.without(this._postTags(),t);i.isEmpty(e)&&this.tagInput.editor.setPlaceholder(this.placeholder),this.model.set("tags",e);var s=this.subViews["tagLabel_"+t];return s&&(s.remove(),this.subViews["tagLabel_"+t]=null,i.remove(this.tagLabelViews,function(t){return s===t})),!0},removeTags:function(){i.each(this.model.get("tags"),function(t){this.removeTag(t)},this),this.setPlaceholder(this.placeholder)},clearInput:function(){this.tagInput.trigger("tagInput:dismissSuggestions"),this.tagInput.setEditorValue("")},removePlaceholder:function(){this.setPlaceholder(null)},setPlaceholder:function(t){this.tagInput.editor.setPlaceholder(t)},_postTags:function(t){return t?i.map(this.model.get("tags"),function(t){return t.toLowerCase()}):i.clone(this.model.get("tags"))},onClick:function(t){s(t.target).hasClass(this.className)&&(t.preventDefault(),this.subViews.tagInputField.focus())}});e.exports=p},{"../templates/tag_editor.tpl":170,"./plaintext_editor":212,"./tag_label":238,"./tag_suggest":239,jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/translate":456,"prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/view":496}],238:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/accessor"),n=t("prima/mixins/subviewable"),a=t("prima/mixins/selectorcache"),r=s.extend({className:"tag-label",defaults:{label:""},mixins:[o,n,a],events:{click:"triggerDelete"},tagName:"span",initialize:function(t){t=i.extend({},t),this.set(i.pick(t,i.keys(this.defaults)))},render:function(){return this.$el.text(this.get("label")),this},triggerDelete:function(){this.trigger("tagLabel:delete",this.get("label"))}});e.exports=r},{lodash:"K2RcUv","prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/view":496}],239:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/events"),a=t("../models/tag_suggestion"),r=t("prima/mixins/accessor"),l=t("prima/mixins/popoverbase"),h=t("prima/mixins/selectorcache"),d=t("../templates/tag_suggest.tpl"),c=o.extend({className:"popover--tag-suggest",defaults:{currentKeyedChoice:-1,currentMousedChoice:-1,interactive:!1,numSuggestions:0,suggestPending:!1,lastResults:{}},mixins:[r,h,l],template:d,initialize:function(t){this.model=new a(t),this.post=t.post,this.listenTo(this.model,"error",this._fetchSuggestionsError),this.listenTo(this,"change:lastResults",this.preRender)},preRender:function(t,e){var s=i.reduce(e.results,function(t,e){return t+(i.isArray(e)?e.length:0)},0);this.set({currentKeyedChoice:-1,interactive:!1});var o=this.get("suggestPending");s>0&&o!==!1&&-1===this.post.get("tags").indexOf(o)&&this.render()},render:function(){return this.$el.html(this.template(this.get("lastResults"))),n.trigger("postForms:dismissListener:suspend"),this},afterRender:function(){this.$tagSuggestWrapper=this.js$("tagSuggestWrapper"),s(".item-option",this.$el).on("click",i.bind(this.selectCurrentCycledChoice,this)),s(".item-option",this.$el).on("mouseover",i.bind(this.handleMouseOver,this)),this.$el.on("mouseout",i.bind(this.handleMouseOut,this))},teardown:function(){return this.$el.remove(),n.trigger("postForms:dismissListener:resume"),this},cycleUp:function(){this._cycle(-1)},cycleDown:function(){this._cycle(1)},_cycle:function(t){var e=this.get("currentKeyedChoice"),s=this.get("currentMousedChoice"),o=i.isNumber(s)&&-1!==s,n=o?s:e,a=(n+t)%this.get("numSuggestions");this.get("numSuggestions")&&(this.set({currentKeyedChoice:a>=0?a:-1,currentMousedChoice:-1}),this.styleMenuItems(),this.set("interactive",this.get("currentKeyedChoice")>=0))},getCycledTag:function(){return s(".item-option.cycled",this.$el).data("tag")},selectCurrentCycledChoice:function(t){this.set("interactive",!0),s(t.currentTarget).addClass("cycled"),this.trigger("tagSuggest:submitTag")},styleMenuItems:function(t){var e,o=t&&"mouseout"!==t.type,n=this.get("currentKeyedChoice");i.each(s(".item-option",this.$el),function(i,a){o?s(i).toggleClass("cycled",t.currentTarget===i):(s(i).toggleClass("cycled",a===n),a===n&&(e=s(i)))},this),o||-1===n||this.cycleScroll(e)},cycleScroll:function(t){var e=parseInt(t.position().top,10),i=e+parseInt(t.height(),10),s=parseInt(t.outerHeight(),10),o=parseInt(this.$tagSuggestWrapper.height(),10),n=parseInt(this.$tagSuggestWrapper.scrollTop(),10);i>o?this.$tagSuggestWrapper.scrollTop(n+s):0>e&&this.$tagSuggestWrapper.scrollTop(e+n)},handleMouseOver:function(t){this.styleMenuItems(t),this.set({interactive:!0,currentMousedChoice:s(t.currentTarget).index(".item-option")})},handleMouseOut:function(t){this.styleMenuItems(t),this.set({interactive:-1!==this.get("currentKeyedChoice"),currentMousedChoice:-1})},fetchSuggestions:i.debounce(function(t,e){var s={query:t,success:i.bind(this.renderQueryResults,this),existing:e};this.set("suggestPending",t),this.model.fetch(s)},100),_fetchSuggestionsError:i.noop,renderQueryResults:function(t,e,i){var s=this.finalResultsFilter(t.attributes.tagSuggestions,i.existing);this.set("numSuggestions",s.userTags.length+s.suggestions.length),this._rendered&&this.teardown(),this.set("lastResults",{results:s,queryRegex:new RegExp(this.model._escapeRegex(i.query),"i")})},finalResultsFilter:function(t,e){return i.mapValues(t,function(t){return i.difference(t,e)})},dismiss:function(){this.teardown(),this.set({interactive:!1,suggestPending:!1,lastResults:{}})}});e.exports=c},{"../models/tag_suggestion":113,"../templates/tag_suggest.tpl":171,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/mixins/accessor":458,"prima/mixins/popoverbase":465,"prima/mixins/selectorcache":467,"prima/view":496}],240:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/accessor"),n=t("prima/mixins/subviewable"),a=t("prima/mixins/selectorcache"),r=t("prima/mixins/popoverbase"),l=t("../templates/tooltip.tpl"),h=s.extend({className:"tooltip-popover",mixins:[o,n,a,r],template:l,defaults:{sanitize:!0,text:""},initialize:function(t){t=i.extend({},t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults)))},serialize:function(){return this.toJSON()},render:function(){return this.$el.html(this.template(this.serialize())),this._popoverBase.pinnedSide="none",this._popoverBase.shift.x=4+this.$pinned.width(),this._popoverBase.shift.y=8,this},teardown:function(){return this.$el.remove(),this}});e.exports=h},{"../templates/tooltip.tpl":172,lodash:"K2RcUv","prima/mixins/accessor":458,"prima/mixins/popoverbase":465,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/view":496}],241:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/accessor"),n=t("prima/mixins/subviewable"),a=t("prima/mixins/selectorcache"),r=t("../templates/tumblelog_select.tpl"),l=t("./tumblelog_select_dropdown"),h=s.extend({defaults:{modeRequiresDropdown:!0},events:{"click [data-js-clickableTumblelogLabel]":"toggleTumblelogSelectDropdown"},mixins:[o,n,a],template:r,initialize:function(t){this.options=t||{},this.user=t.user,this.listenTo(this.model,"change:tumblelog",this.adjustLabel),this.set("modeRequiresDropdown","edit"!==this.model.get("mode"))},render:function(){return this.$el.html(this.template({post:this.model})),this.adjustLabel(),this.createDropdown(),this},createDropdown:function(){var t=i.extend(this.options,{shift:{x:0,y:10},identifier:"postForms:tumblelogSelectDropdown"});this.get("modeRequiresDropdown")&&(this.tumblelogSelectDropdown=new l(t),this.tumblelogSelectDropdown.setPinnedTarget(this.js$("tumblelogSelectPin")))},toggleTumblelogSelectDropdown:function(){this.get("modeRequiresDropdown")&&(this.tumblelogSelectDropdown.isOrWasRecentlyRendered()||this.tumblelogSelectDropdown.render())},adjustLabel:function(){var t,e;this.user&&this.model&&(t=this.model.get("tumblelog"),e=this.user.getChannel(t),this.js$("tumblelogLabel").text(e?e.getDisplayName():t))}});e.exports=h},{"../templates/tumblelog_select.tpl":173,"./tumblelog_select_dropdown":242,lodash:"K2RcUv","prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/view":496}],242:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/events"),n=t("app/lib/avatar-size"),a=t("prima/mixins/accessor"),r=t("prima/mixins/selectorcache"),l=t("prima/mixins/popoverbase"),h=t("app/lib/currentuser"),d=t("../templates/tumblelog_select_dropdown.tpl"),c=s.extend({className:"popover--tumblelog-select-dropdown",events:{"click [data-js-tumblelogChoice]":"selectBlog"},mixins:[a,r,l],template:d,defaultOptions:{size:128},defaults:{tumblelog:!1},initialize:function(t){this.options=t=i.extend({},this.defaultOptions,t),this.user=t.user||h(),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),this.get("tumblelog")||this.set("tumblelog",this.user.getChannel().get("name"))},render:function(){return this.delegateEvents(),this.$el.html(this.template(this.serialize())),o.trigger("postForms:dismissListener:suspend"),this},teardown:function(){return this.$el.remove(),o.trigger("postForms:dismissListener:resume"),this},serialize:function(){var t=this.toJSON();return t.channels=this.user.channels.map(function(t){return i.extend({avatarUrl:n(t.get("avatar_url"),this.options.size),displayName:t.getDisplayName()},t.toJSON())},this),t},selectBlog:function(t){var e=this.$(t.currentTarget).index();this.model.set("tumblelog",this.user.channels.at(e).get("name")),this.teardown()}});e.exports=c},{"../templates/tumblelog_select_dropdown.tpl":174,"app/lib/avatar-size":293,"app/lib/currentuser":296,lodash:"K2RcUv","prima/events":429,"prima/mixins/accessor":458,"prima/mixins/popoverbase":465,"prima/mixins/selectorcache":467,"prima/view":496}],243:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/events"),n=t("prima/mixins/accessor"),a=t("prima/mixins/subviewable"),r=t("prima/mixins/selectorcache"),l=t("prima/mixins/popoverbase"),h=t("../templates/tweet_dropdown.tpl"),d=t("../utils/string_helpers").truncateLongStrings,c=s.extend({className:"popover--tweet-dropdown",defaults:{focused:!1},events:{"input [data-js-customTweet]":"_onCustomTweetInput","keyup [data-js-customTweet]":"_onCustomTweetInput","change [data-js-customTweet]":"_onCustomTweetInput","click [data-js-dismissTweet]":"_onClickDismissTweet",keydown:"_onKeyDown"},mixins:[n,a,r,l],template:h,_onCustomTweetInput:function(){var t=i.trim(this.js$("customTweet").val());this.model.set("customTweet",t),this.truncateTweet()},_onClickDismissTweet:function(){this.teardown()},_onKeyDown:function(t){27===t.keyCode&&(t.stopPropagation(),this.teardown())},_onChangePost:function(){i.isString(this.model.get("customTweet"))||this.js$("customTweet").val(this.model.getTweetText()),this.updateTweetLengthCount()},updateTweetLengthCount:function(){var t=this.model.getTweetTextLength();this.js$("tweetRemaining").text(140-t)},truncateTweet:function(){var t=this.js$("customTweet"),e=t.get(0),i=t.val(),s=i;if(!(this.model.getTweetTextLength(i)<=140)){var o=this.model.shortUrlLength,n=i.match(/\[URL\]/gi),a=!0;if(n&&1===n.length){var r=i.toLowerCase().indexOf("[url]");140-o-1>r?(i=d(i,140-o+5),a=!1):r&&(i=d(i.split(/\[URL\]/i).join(""),140-o-1)+" [URL]")}else i=d(i,140);if(this.model.set("customTweet",i),s!==i){var l=e.selectionEnd||0,h=t.scrollTop();if(a){var c=i.toLowerCase().lastIndexOf("… [url]");0>c&&(c=i.toLowerCase().lastIndexOf("…[url]")),0>c&&(c=i.toLowerCase().lastIndexOf(" [url]")),0>c&&(c=i.toLowerCase().lastIndexOf("[url]")),c>=0&&l>c&&(l=c)}if(l=Math.max(0,Math.min(l,i.length)),t.val(i).focus(),e.setSelectionRange)e.setSelectionRange(l,l);else if(e.createRange){var u=e.createRange();u.setStart("character",l),u.setEnd("character",l),u.select()}t.scrollTop(h)}}},setCaret:function(t){var e=this.js$("customTweet"),i=e.get(0),s=e.val(),o=s.toLowerCase().lastIndexOf(" [url]");if(0>o&&(o=s.toLowerCase().lastIndexOf("[url]"),t&&o>=0&&(s=s.slice(0,o)+" "+s.slice(o),this.js$("customTweet").val(s))),0>o&&(o=s.length),e.focus(),i.setSelectionRange)i.setSelectionRange(o,o);else if(i.createRange){var n=i.createRange();n.setStart("character",o),n.setEnd("character",o),n.select()}},serialize:function(){return i.extend({tweetText:this.model.getTweetText(),tweetRemaining:140-this.model.getTweetTextLength()},this.toJSON())},afterRender:function(){this.listenTo(this.model,"change",this._onChangePost),i.defer(i.bind(function(){this.setCaret(!0)},this))},render:function(){return this.delegateEvents(),this.$el.html(this.template(this.serialize())),this.model.get("customTweet")&&this.js$("customTweet").val(this.model.get("customTweet")),o.trigger("postForms:dismissListener:suspend"),this},teardown:function(){return""===this.model.get("customTweet")&&this.model.set("send_to_twitter",!1),this.remove(),o.trigger("postForms:dismissListener:resume"),this}});e.exports=c},{"../templates/tweet_dropdown.tpl":175,"../utils/string_helpers":187,lodash:"K2RcUv","prima/events":429,"prima/mixins/accessor":458,"prima/mixins/popoverbase":465,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/view":496}],244:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/accessor"),n=t("prima/mixins/subviewable"),a=t("prima/mixins/selectorcache"),r=t("../templates/uploading_indicator.tpl"),l=t("components/knight-rider-loader"),h=s.extend({className:"post-form--uploading-indicator",mixins:[o,n,a],template:r,defaults:{isUploading:!0,isVisible:!0,delay:200},initialize:function(t){this.options=t=i.extend({},t),i.extend(this,i.pick(t,"post","user","uploads")),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),this.updateIsUploading(),this.set("isVisible",this.get("isUploading"))},_onChangeIsUploading:function(t,e){e?(clearTimeout(this._changeIsVisibleTimeout),this._changeIsVisibleTimeout=!1,this.set("isVisible",e)):this._changeIsVisibleTimeout||(this._changeIsVisibleTimeout=i.delay(i.bind(function(){this._changeIsVisibleTimeout=!1,this.set("isVisible",e)},this),this.get("delay")))},_onChangeIsVisible:function(t,e){this.loader.set("loading",e)},updateIsUploading:function(){this.set("isUploading",this.uploads.anyUploading()||this.post.get("loading"))},serialize:function(){return this.toJSON()},beforeRender:function(){this.loader=this.subViews.loader=new l({variation:"small"}),this.listenTo(this.uploads,"change:uploading",this.updateIsUploading),this.listenTo(this.post,"change:loading",this.updateIsUploading),this.listenTo(this,"change:isUploading",this._onChangeIsUploading),this.listenTo(this,"change:isVisible",this._onChangeIsVisible)},render:function(){return this.$el.html(this.template(this.serialize())),this.updateIsUploading(),this.loader.set("loading",this.get("isVisible")),this.attachSubViews(),this}});e.exports=h},{"../templates/uploading_indicator.tpl":176,"components/knight-rider-loader":353,lodash:"K2RcUv","prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/view":496}],245:[function(t,e){"use strict";var i=t("lodash"),s=t("velocity-animate").animate,o=t("prima/view"),n=t("prima/mixins/accessor"),a=t("prima/mixins/subviewable"),r=t("prima/mixins/selectorcache"),l=t("../templates/webcam_button.tpl"),h=o.extend({className:"webcam-button-container",template:l,events:{mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave"},mixins:[n,a,r],wink:function(t){!i.isUndefined(t)||(t=!this.js$("smiley").hasClass("icon_postforms_selfie_wink")),this.js$("smiley").toggleClass("icon_postforms_selfie_wink",t),this.js$("smiley").toggleClass("icon_postforms_selfie",!t)},_onMouseEnter:function(){var t=100;s(this.js$("text"),"stop"),s(this.js$("text"),{opacity:1},{duration:t});var e=this.js$("smiley").outerWidth()+this.js$("text").outerWidth();s(this.$el,"stop"),s(this.$el,{marginLeft:-Math.round(.5*e),width:e},{duration:t}).then(i.bind(function(){this._winkTimeout=i.delay(i.bind(function(){this.wink(!0),this._winkTimeout=i.delay(i.bind(function(){this.wink(!1)},this),100)},this),400)},this))},_onMouseLeave:function(){var t=100;
clearTimeout(this._winkTimeout),this.wink(!1),s(this.js$("text"),"stop"),s(this.js$("text"),{opacity:0},{duration:t});var e=this.js$("smiley").outerWidth();s(this.$el,"stop"),s(this.$el,{marginLeft:-Math.round(.5*e),width:e},{duration:t}).then(i.bind(function(){}))},render:function(){return this.$el.html(this.template()),this},teardown:function(){return clearTimeout(this._winkTimeout),this}});e.exports=h},{"../templates/webcam_button.tpl":177,lodash:"K2RcUv","prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/view":496,"velocity-animate":"lWl/mc"}],246:[function(t,e){var i=t("prima/collection"),s=t("../models/reblog_entry"),o=i.extend({model:s});e.exports=o},{"../models/reblog_entry":247,"prima/collection":427}],247:[function(t,e){var i=t("prima/model"),s=i.extend({defaults:{pid:null,name:null,permalink:null,content:null}});e.exports=s},{"prima/model":471}],248:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="reblog-trail-entry-content-original">'+(null==(__t=content)?"":__t)+'</div><a class="reblog-trail-entry-avatar"><div class="reblog-trail-entry-avatar-image"></div></a><div class="reblog-trail-entry-name"><a class="reblog-trail-tumblelog-link" href="'+(null==(__t=permalink)?"":__t)+'">'+(null==(__t=name)?"":__t)+"</a></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],249:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<a class="reblog-trail-entry-avatar"><div class="reblog-trail-entry-avatar-image"></div></a><div class="reblog-trail-entry-body"><div class="reblog-trail-entry-name"><a class="reblog-trail-tumblelog-link" href="'+(null==(__t=permalink)?"":__t)+'">'+(null==(__t=name)?"":__t)+'</a></div><div class="reblog-trail-entry-content">'+(null==(__t=content)?"":__t)+"</div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],250:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="control-reblog-trail post"><div class="reblog-trail-post-content"><div data-subview="reblogEntries" class="reblog-trail-post-content"></div></div>',isRemovable&&(__p+='<div data-subview="removeButton"></div><div class="btn-show-trail btn-toggle-reblog">'+(null==(__t=__("Include reblogs"))?"":_.escape(__t))+"</div>"),__p+="</div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],251:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="reblog-unconverted">'+(null==(__t=unconvertedReblog)?"":__t)+"</div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],252:[function(t,e){"use strict";var i=(t("jquery"),t("lodash")),s=t("prima/lib/translate"),o=t("prima/views/base"),n=t("app/components/remove-button"),a={ReblogTrailEntriesView:t("./reblog_trail_entries"),ReblogUnconvertedView:t("./reblog_unconverted")},r=t("../templates/reblog-trail.tpl"),l=o.extend({template:r,defaults:{is_removable:!1},subviews:{},events:{"click .btn-toggle-reblog":"toggleRemoveReblogTree"},initialize:function(t){this.options=i.merge({},this.defaults,t)},serialize:function(){return{isRemovable:this.options.is_removable}},render:function(){var t=this.model.get("reblog_tree_ui_data"),e=a.ReblogTrailEntriesView;return this.reblogEntries=this.subviews.reblogEntries=new e({model:t}),this.options.is_removable&&(this.removeButton=this.subviews.removeButton=new n({tooltip:s("Remove reblogs"),buttonClass:"btn-remove-trail btn-toggle-reblog"})),this.$el.html(this.template(this.serialize())),this},toggleRemoveReblogTree:function(t){var e=this.$(t.currentTarget),i=e.closest(".control-reblog-trail"),s=this.model.has("remove_reblog_tree")&&this.model.get("remove_reblog_tree")===!0;this.model.set("remove_reblog_tree",!s),i.toggleClass("removed",!s)},teardown:function(){return this.reblogEntries.teardown(),this.removeButton.remove(),this.$el.remove(),this}});e.exports=l},{"../templates/reblog-trail.tpl":250,"./reblog_trail_entries":253,"./reblog_unconverted":255,"app/components/remove-button":256,jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/translate":456,"prima/views/base":497}],253:[function(t,e){"use strict";var i=(t("jquery"),t("lodash")),s=t("prima/views/base"),o=t("../collections/reblog_entries"),n=t("../models/reblog_entry"),a=t("./reblog_trail_entry"),r=s.extend({className:"reblog-trail",subviews:{},initialize:function(t){this.options=i.merge({},this.defaults,t);var e=this.model,s=i.collect(e,function(t,e){var i=new n(t);return 0==e&&i.set({is_original:!0}),this.subviews[e]=new a({model:i}),i},this);this.collection=new o(s)},render:function(){return i.each(this.subviews,i.bind(function(t){this.$el.append(t.render().$el)},this)),this},teardown:function(){return i.each(this.subviews,function(t){t.remove()}),this}});e.exports=r},{"../collections/reblog_entries":246,"../models/reblog_entry":247,"./reblog_trail_entry":254,jquery:"HlZQrA",lodash:"K2RcUv","prima/views/base":497}],254:[function(t,e){"use strict";var i=(t("jquery"),t("lodash"),t("prima/views/base")),s={original:t("../templates/reblog-trail-entry-original.tpl"),generic:t("../templates/reblog-trail-entry.tpl")},o=i.extend({className:"reblog-trail-entry",initialize:function(){var t=this.model.get("is_original");t?(this.template=s.original,this.$el.attr("class","reblog-trail-entry--original")):this.template=s.generic},serialize:function(){return this.model.toJSON()},render:function(){return this.$el.html(this.template(this.serialize())),this}});e.exports=o},{"../templates/reblog-trail-entry-original.tpl":248,"../templates/reblog-trail-entry.tpl":249,jquery:"HlZQrA",lodash:"K2RcUv","prima/views/base":497}],255:[function(t,e){"use strict";var i=(t("jquery"),t("prima/views/base")),s=t("../templates/reblog-unconverted.tpl"),o=i.extend({className:"reblog-trail-entry",template:s,initialize:function(){},serialize:function(){return{unconvertedReblog:this.model}},render:function(){return this.$el.html(this.template(this.serialize())),this},teardown:function(){return this.remove(),this}});e.exports=o},{"../templates/reblog-unconverted.tpl":251,jquery:"HlZQrA","prima/views/base":497}],256:[function(t,e){"use strict";var i=t("./views/remove-button.js");e.exports=i},{"./views/remove-button.js":258}],257:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="remove-button '+(null==(__t=buttonClass)?"":_.escape(__t))+'"><span class="icon"></span></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],258:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/accessor"),n=t("prima/mixins/subviewable"),a=t("prima/mixins/selectorcache"),r=t("../templates/remove-button.tpl"),l=s.extend({events:{click:"_onClick"},template:r,mixins:[o,n,a],defaults:{dataJsName:"removeButton",buttonClass:""},initialize:function(t){t=i.extend({},t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),this.onClick=t.onClick},serialize:function(){return this.toJSON()},render:function(){return this.$el.html(this.template(this.serialize())),this.get("dataJsName")&&this.$$(".remove-button").attr("data-js-"+this.get("dataJsName"),""),this},_onClick:function(){i.isFunction(this.onClick)?this.onClick(this):this.trigger("remove")}});e.exports=l},{"../templates/remove-button.tpl":257,lodash:"K2RcUv","prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/view":496}],259:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/component"),n=t("prima/events"),a=(t("prima/lib/flags"),t("prima/mixins/keycommands")),r=t("./views/fast_compose"),l=o.extend({name:"switcher",mixins:[a],keycommands:{"keydown:alt+c":"macFastCompose","keydown:z+c":"winFastCompose"},loggingData:{},initialize:function(){this.$body=i("body"),this.$glass=null,this.suspended=!1,this.bindEvents()},bindEvents:function(){this.listenTo(n,"keycommands:suspend",this.suspend),this.listenTo(n,"keycommands:resume",this.resume),this.listenTo(n,"fastCompose:close:complete",this.dismissFastCompose),this.listenTo(n,"fastCompose:dismiss",this.dismissFastCompose),this.listenTo(n,"fastCompose:init",this.initFastCompose)},suspend:function(){this.suspended=!0},resume:function(){this.suspended=!1},macFastCompose:function(t){"MacIntel"===navigator.platform&&this.initFastCompose(t)},winFastCompose:function(t){"Win32"===navigator.platform&&this.initFastCompose(t)},initFastCompose:function(t){this.suspended||this.fastCompose||(this.determineSource(t),this.fastCompose=new r({loggingData:this.loggingData}),this.$body.append(this.fastCompose.render().el),this.showPlexi(),this.fastCompose.open(),n.trigger("fastCompose:init:complete"))},dismissFastCompose:function(){this.fastCompose&&(this.hidePlexi(),this.fastCompose.teardown(),this.fastCompose=null),n.trigger("fastCompose:dismiss:complete")},showPlexi:function(){this.$glass=i("<div>",{"class":"glass show"}).appendTo(this.$body),s.defer(s.bind(function(){this.$glass.addClass("blue")},this)),n.trigger("drawer:suspend")},hidePlexi:function(){this.$glass.remove(),this.$glass=null,n.trigger("drawer:resume")},determineSource:function(t){this.loggingData.source="fast-compose",t&&(t.originalEvent instanceof KeyboardEvent?this.loggingData.source="keycommand":t.loggingData&&t.loggingData.source&&(this.loggingData.source=t.loggingData.source))}});e.exports=l},{"./views/fast_compose":261,jquery:"HlZQrA",lodash:"K2RcUv","prima/component":428,"prima/events":429,"prima/lib/flags":"f/LVtH","prima/mixins/keycommands":462}],260:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="post-tab-switching"><div class="tab-post-types count-'+(null==(__t=icons.length)?"":_.escape(__t))+'">',_.forEach(icons,function(t,e){__p+='<div class="tab-post-type item" data-index="'+(null==(__t=e)?"":_.escape(__t))+'" data-post-type="'+(null==(__t=t.name)?"":_.escape(__t))+'"><div class="post-type-icon icon-'+(null==(__t=t.name)?"":_.escape(__t))+'"><i class="post-type-icon-overlay"></i></div><div class="post-type-name"><span class="post-type-name-span">'+(null==(__t=t.label)?"":_.escape(__t))+"</span></div></div>"}),__p+="</div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],261:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("velocity-animate"),n=t("prima/lib/data"),a=t("prima/lib/translate"),r=t("when"),l=t("prima/view"),h=t("prima/events"),d=t("prima/lib/flags"),c=t("prima/mixins/keycommands"),u=t("prima/mixins/accessor"),p=t("app/components/post-form-builder"),m=t("../templates/fast_compose.tpl"),g=l.extend({template:m,className:"fast-compose",defaults:{tabIndex:-1,icons:[{name:"text",label:"Text"},{name:"photo",label:"Photo"},{name:"quote",label:"Quote"},{name:"link",label:"Link"},{name:"chat",label:"Chat"},{name:"audio",label:"Audio"},{name:"video",label:"Video"}]},events:{"click .post-tab-switching .tab-post-type":"clickCreate","mouseover .post-tab-switching .tab-post-type":"mouseoverIcon","click .post-tab-switching":"close"},mixins:[u,c],keycommands:{"keydown:c":"nextIcon","keydown:shift+c":"previousIcon","keydown:tab":"nextIcon","keydown:shift+tab":"previousIcon","keydown:right":"nextIcon","keydown:left":"previousIcon","keydown:enter":"enterCreate","keydown:escape":"close"},initialize:function(t){this.loggingData=t?t.loggingData:{},s.forEach(this.get("icons"),function(t){t.label=a(t.label)}),this.$body=i("body"),this.$glass=null,this.$plexiInstance=i('.plexi[data-token="body-plexi"]'),this.resumeKeycommandsOnClose=!0},bindEvents:function(){this.listenTo(h,"DOMEventor:keydown:tab",this.disableKey),this.listenTo(h,"DOMEventor:keydown:shift+tab",this.disableKey),this.listenTo(this,"change:tabIndex",function(t,e){this.$(".selected").removeClass("selected"),this.$('[data-index="'+e+'"]').addClass("selected")})},render:function(){return this.$el.append(this.template(this.toJSON())),this.bindEvents(),this},open:function(){s.defer(s.bind(this.show,this))},show:function(){h.trigger("keycommands:suspend");var t=50;s.forEach(this.$(".tab-post-type"),function(e,s){var n=i(e),a=n.find(".post-type-icon"),r=n.find(".post-type-name");o.animate(a,{opacity:["1","0"],translateY:["0px","15px"]},{duration:150,delay:s*t}),o.animate(r,{opacity:["1","0"],translateY:["0px","-15px"]},{duration:150,delay:s*t})},this),i(".post-tab-switching").addClass("finish-animating")},enterCreate:function(){var t=this.$(".selected");if(t.length){var e=t.attr("data-post-type");this.createNew(e),this.close()}},clickCreate:function(t){this.createNew(i(t.currentTarget).data("postType"))},disableKey:function(t){t.preventDefault()},mouseoverIcon:function(t){this.$(".selected").removeClass("selected"),this.set("tabIndex",i(t.currentTarget).data("index"))},nextIcon:function(){var t=this.get("tabIndex")+1;t>=this.get("icons").length&&(t=0),this.set("tabIndex",t)},previousIcon:function(){var t=this.get("tabIndex")-1;0>t&&(t=this.get("icons").length-1),this.set("tabIndex",t)},createNew:function(t){this.resumeKeycommandsOnClose=!1,n.has("Components/PostFormBuilder")?h.trigger("postForms:open",{updateURL:!1,postFormType:p.containerType("modal"),postType:t,loggingData:this.loggingData}):h.trigger("fastCompose:create",{type:t,loggingData:this.loggingData})},close:function(){var t=50,e=this.$(".tab-post-type"),n=Math.floor(.5*(e.length-1));r.all(s.map(e,function(e,s){var a=i(e),r=Math.floor(Math.abs(s-n))*t;return o.animate(a,{opacity:["0","1"],translateY:["-500px","0px"]},{duration:150,delay:r})},this)).then(function(){h.trigger("fastCompose:close:complete")})},teardown:function(){return this.resumeKeycommandsOnClose&&h.trigger("keycommands:resume"),this.remove()}});e.exports=d.bool("is_logged_in")?g:s.noop},{"../templates/fast_compose.tpl":260,"app/components/post-form-builder":83,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/lib/data":431,"prima/lib/flags":"f/LVtH","prima/lib/translate":456,"prima/mixins/accessor":458,"prima/mixins/keycommands":462,"prima/view":496,"velocity-animate":"lWl/mc",when:"RG2dij"}],262:[function(t,e){"use strict";var i=(t("jquery"),t("prima/component")),s=t("./views/tooltip"),o=i.extend({name:"ToolTip",class_name:"tumblr_tooltip",initialize:function(t){this.toolTipView=new s(t)}});e.exports=o},{"./views/tooltip":264,jquery:"HlZQrA","prima/component":428}],263:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="tooltip_wrapper '+(null==(__t=placement)?"":_.escape(__t))+" "+(null==(__t=class_name)?"":_.escape(__t))+'" style="left:'+(null==(__t=left_css)?"":_.escape(__t))+'"><div class="tooltip">'+(null==(__t=text)?"":__t)+"</div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],264:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/view"),n=t("../templates/tooltip.tpl"),a=o.extend({class_name:"tumblr_tooltip",template:n,defaults:{selector:"",class_name:"",offset:"50%",placement:"up"},initialize:function(t){this.options=t||{},this.options.selector=i.trim((t.selector||this.defaults.selector)+" "),this.options.class_name=t.class_name||this.defaults.class_name,this.options.offset=t.offset||this.defaults.offset,this.options.placement=t.placement||this.defaults.placement,this.tooltips=i(this.options.selector+"[data-tooltip]"),this.tooltips.on("remove",i.proxy(this.remove,this)),this.tooltips.on("mouseenter",s.bind(this.show,this)),this.tooltips.on("mouseleave",s.bind(this.hide,this))},show:function(t){var e=i(t.currentTarget);this.tooltip_template_data={tooltip:e.data("tooltip")};var s=i(this.tooltip(this.tooltip_template_data));e.append(s),this.setElement(s),this.delegateEvents(),s.removeClass("is_closed").addClass("is_open")},hide:function(t){var e=i(t.currentTarget),o=e.find("."+this.class_name);o.removeClass("is_open").addClass("is_closed"),o.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",s.bind(function(t){this.remove(t)},this))},remove:function(t){i(t.currentTarget).remove()},tooltip:function(t){return this.class_name="tooltip_wrapper",this.attributes={text:t.tooltip,placement:this.options.placement,class_name:this.options.class_name,left_css:this.options.offset},this.template(this.attributes)}});e.exports=a},{"../templates/tooltip.tpl":263,jquery:"HlZQrA",lodash:"K2RcUv","prima/view":496}],265:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/collection"),o=t("../models/upload"),n=t("when"),a=s.extend({model:o,_listenToUploadModel:function(t){this.listenTo(t,"change",this._onUploadModelChange)},_stopListeningToUploadModel:function(t){this.stopListening(t)},_onUploadModelChange:function(t){i.has(t.changed,"complete")&&this.trigger("complete",this,t),i.has(t.changed,"error")&&t.get("error")&&this.trigger("error",this,t),i.has(t.changed,"complete")&&this.allComplete()&&this.trigger("allComplete",this)},add:function(t){return i.isArray(t)?i.forEach(t,this._listenToUploadModel,this):this._listenToUploadModel(t),s.prototype.add.apply(this,arguments)},remove:function(t){return i.isArray(t)?i.forEach(t,this._stopListeningToUploadModel,this):this._stopListeningToUploadModel(t),s.prototype.remove.apply(this,arguments)},removeIncomplete:function(t){var e=this.where({uploading:!1,complete:!1});return this.remove(e,t)},removeFailed:function(t){var e=this.filter(function(t){return t.get("error")});return this.remove(e,t)},allComplete:function(){return this.length?this.every(function(t){return t.get("complete")}):!1},anyUploading:function(){return this.length>0&&this.any(function(t){return t.get("uploading")})},getProgress:function(){var t=0,e=0;return this.forEach(function(i){i.get("error")&&(t+=i.get("bytesLoaded")||0,e+=i.get("bytesTotal")||0)}),e?t/e:0},promise:function(){if(this.allComplete())return n.resolve(this);var t=n.promise(i.bind(function(t,e){var s,o;s=i.bind(function(){this.stopListening(this,"uploads:allComplete",s),this.stopListening(this,"uploads:error",o),t.apply(this,arguments)},this),o=i.bind(function(){this.stopListening(this,"uploads:allComplete",s),this.stopListening(this,"uploads:error",o),e.apply(this,arguments)},this),this.listenToOnce(this,"uploads:allComplete",s),this.listenToOnce(this,"uploads:error",o)},this));return t}});e.exports=a},{"../models/upload":267,lodash:"K2RcUv","prima/collection":427,when:"RG2dij"}],266:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/component"),o=t("./views/fileupload"),n=t("./collections/uploads"),a=(t("./models/upload"),s.extend({name:"Upload",initialize:function(t){t=i.extend({},t),this.collection=t.collection||(t.collection=new n),this.indexView=new o(t),this.listenTo(this.collection,"all",this._relayCollectionEvent)},_relayCollectionEvent:function(){this.trigger.apply(this,arguments)},addFiles:function(t){return this.indexView.add({files:t})},promise:function(){return this.indexView.promise()},teardown:function(){return this.remove()},remove:function(){return this.indexView.remove(),this.stopListening(),this},render:function(){return this.indexView.render(),this},getElement:function(){return this.indexView.$el}}));e.exports=a},{"./collections/uploads":265,"./models/upload":267,"./views/fileupload":268,lodash:"K2RcUv","prima/component":428}],267:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/model"),o=s.extend({defaults:{url:"",file:null,error:!1,uploading:!1,complete:!1,bytesLoaded:0,bytesTotal:0},initialize:function(t,e){this.options=i.extend({},e),this.options.jqXHR&&this.setUploadRequest(this.options.jqXHR)},setUploadRequest:function(t){return this.jqXHR=t,t.then(function(){}),t},_uploadDone:function(){this.set({error:!1,uploading:!1,complete:!0})},_uploadFail:function(){this.set({error:!0,uploading:!1,complete:!1})},cancelUpload:function(){var t;return this.jqXHR&&(t=this.jqXHR.abort(),this.jqXHR=null),t},getProgress:function(){return this.get("bytesTotal")?this.get("bytesLoaded")/this.get("bytesTotal"):0}});e.exports=o},{lodash:"K2RcUv","prima/model":471}],268:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/lib/mixin"),n=t("when"),a=t("prima/lib/translate"),r=t("../collections/uploads"),l=t("../models/upload"),h=t("prima/utils/recontextify"),d=t("prima/utils/getpath"),c=["add","submit","send","done","fail","always","progress","progressall","start","stop","change","paste","drop","dragover","chunksend","chunkdone","chunkfail","chunkalways"],u=["add","send","progress","active","enable","disable"],p=s.extend({tagName:"input",attributes:{type:"file"},defaults:{name:"photo",maxUploadSize:!1,uploadPattern:!1,mediaType:"image",message:{cancel:"Canceled upload",error:"Upload error",filesize:"The file is too big. Squish it down, and try again!",filetype:"This is not valid %1$s file."},fileUpload:{singleFileUploads:!0,limitConcurrentUploads:1,sequentialUploads:!1,autoUpload:!0,formData:[],dataType:"json",dropZone:null,pasteZone:null}},_createUploadModel:function(t,e){var i=new l(t);return this.collection.add(i,e||{}),i},_createUploadModelForFile:function(t,e,s){e=i.extend({file:t},e);var o=this._createUploadModel(e,s);return t._uploadModel=o,o},initialize:function(t){if(this.options=i.merge({},this.defaults,t),this.options.url&&(this.options.fileUpload.url=this.options.url),this.collection=this.options.collection?this.options.collection:new r,!this.options.fileUpload.url)throw new Error("Upload requires an endpoint URL");this.$el.prop("tabindex",-1),this.options.fileUpload.multiple&&this.$el.prop("multiple",!0),this.options.accept&&this.$el.prop("accept",this.options.accept);var e=i.merge({},this._fileUploadWrap);i.forEach(c,function(t){i.isFunction(e.defaults[t])||(e.defaults[t]=i.noop)},this);var s=new o(e);s.applyTo(this.options.fileUpload),i.forEach(c,function(t){this.options.fileUpload[t]=h(this.options.fileUpload[t],this)},this),this.$el.attr("name",this.options.name).fileupload(this.options.fileUpload),this._fileUpload=this.$el.data("blueimp-fileupload"),i.forEach(u,function(t){this[t]=function(){var e=i.toArray(arguments);e.unshift(t),this._fileUploadInvoke.apply(this,e)}},this)},_fileUploadInvoke:function(t){return this._fileUpload[t].apply(this._fileUpload,i.rest(arguments))},validateFile:function(t,e){e||(e=this.options);var s=[];return e.maxUploadSize&&t.size>e.maxUploadSize&&s.push({type:"filesize",message:i.sprintf(e.message.filesize,e.maxUploadSize)}),e.uploadPattern&&t.type&&!e.uploadPattern.test(t.type)&&s.push({type:"filetype",message:i.sprintf(e.message.filetype,e.mediaType)}),s},upload:function(t){this.add({files:[t]})},cancel:function(){var t;return this.jqXHR?(t=this.jqXHR.abort(),this.jqXHR=null):t=n.reject(this.options.message.cancel),t},_forMatchingFiles:function(t,e){var s=i.rest(arguments);this.collection.forEach(function(o){if(i.contains(t,o.get("file"))){var n=i.clone(s);n[0]=o,e.apply(this,n)}},this)},promise:function(){return this.collection.promise()},_fileUploadWrap:{defaults:{change:function(t){this._fileUpload.options.replaceFileInput&&this.setElement(t)},add:function(t,e,s){var o=s.files[0],n=this.validateFile(o),a={},r={};if(!i.isEmpty(n)){a.error=i.pluck(n,"message"),a.file=o;var l={errorType:"validation",messages:n,file:o};this.collection.trigger("invalid",this.collection,new this.collection.model(a)),this.trigger("error",l),r.silent=!0}return this._createUploadModelForFile(o,a,r),i.isEmpty(n)},send:function(){return!0}},before:{},after:{done:function(t,e,s){var o,n=d(s,"result.meta.status"),r=d(s,"result.response"),l=d(s,"result.errors");if(200!==n||i.isEmpty(r)){var h=function(){return r&&r.msg?r.msg:i.isArray(l)?i.isEmpty(l)?a("Woops :("):l:l.join(" ")}();o={error:h,uploading:!1}}else i.isArray(r)&&(r=r[0]),o=i.extend({complete:!0,uploading:!1},r);this._forMatchingFiles(s.files,function(t,e){t.set(e)},o)},fail:function(t,e,i){var s;s="abort"===i.errorThrown?{uploading:!1}:{error:this.options.message.error,uploading:!1},s.responseJSON=d(i,"jqXHR.responseJSON"),this._forMatchingFiles(i.files,function(t,e){t.set(e)},s)},progress:function(t,e,i){this._forMatchingFiles(i.files,function(t,e){t.set(e)},{bytesLoaded:i.loaded,bytesTotal:i.total})}},around:{add:function(t,e,s,o){var n=t.apply(this,i.rest(arguments));return n===!1||s.isDefaultPrevented()?!1:((o.autoUpload||o.autoUpload!==!1&&this._fileUpload.options.autoUpload)&&o.process().done(i.bind(function(){this.jqXHR=o.submit()},this)),n)},send:function(t,e,s,o){o.with_form_key=!0;var n=t.apply(this,i.rest(arguments));if(n){this._forMatchingFiles(o.files,function(t,e){t.set(e)},{uploading:!0});var a={files:o.files};this.collection.trigger("send",this.collection,a),this.trigger("send",a)}return n}}}});e.exports=p},{"../collections/uploads":265,"../models/upload":267,lodash:"K2RcUv","prima/lib/mixin":453,"prima/lib/translate":456,"prima/utils/getpath":484,"prima/utils/recontextify":491,"prima/view":496,when:"RG2dij"}],269:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/component"),o=t("./views/webcam"),n=t("./utils/get_user_media"),a=s.extend({name:"Webcam",initialize:function(t){this.options=t=i.extend({},t),this.indexView=new o(t),this.listenTo(this.indexView,"all",this._relayViewEvent);var e=["teardown","render","remove"].concat(a.prototype.commands||[]);i.forEach(e,function(t){var e=this.indexView;this[t]=function(){return e[t].apply(e,arguments),this}},this)},_relayViewEvent:function(){this.trigger.apply(this,arguments)},getElement:function(){return this.indexView.$el},getHeightForWidth:function(t){return this.indexView.get("width")?t*this.indexView.get("height")/this.indexView.get("width"):0}},{hasUserMediaSupport:function(){return!!n}});e.exports=a},{"./utils/get_user_media":274,"./views/video_stream":276,"./views/webcam":277,lodash:"K2RcUv","prima/component":428}],270:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div data-js-inner class="countdown-timer--inner"><div data-js-ticks class="countdown-timer--ticks"></div><div data-js-inner class="countdown-timer--fill"><div class="mask-static-half"><div class="fill"></div></div><div class="mask-rotating-half"><div data-js-rotator class="fill"></div></div></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],271:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<video class="video-stream--video" width="'+(null==(__t=retina?2*width:width)?"":_.escape(__t))+'" height="'+(null==(__t=retina?2*height:height)?"":_.escape(__t))+'"></video><div data-js-novideo class="video-stream--no-video"><div data-subview="loader"></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],272:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div data-js-sizer class="webcam--sizer" style="padding-top:'+(null==(__t=ratio)?"":_.escape(__t))+'"><div class="webcam--container"><div data-js-videostreamcontainer class="webcam--container-layer"><div data-subview="videoStream"></div></div><div data-js-previewcontainer class="webcam--container-layer" style="display:'+(null==(__t=showPreviewContainer?"block":"none")?"":_.escape(__t))+'"><canvas data-js-canvas width="'+(null==(__t=retina?2*width:width)?"":_.escape(__t))+'" height="'+(null==(__t=retina?2*height:height)?"":_.escape(__t))+'" class="webcam--canvas"></canvas></div><div data-js-controlcontainer class="webcam--container-layer"><div data-subview="webcamControls"></div></div></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],273:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div data-js-overlaybuttons class="media-overlay">',enableFlash&&(__p+='<div data-js-flashbutton class="button webcam--flash-button '+(null==(__t=flash?"active":"")?"":_.escape(__t))+'"><div class="icon"></div></div>'),__p+="",enableRemove&&(__p+='<div data-subview="removeButton"></div>'),__p+='</div><div data-js-primarybutton class="big-button webcam--primary-button"><div data-js-snapbuttongroup="countdownTimer" class="big-button-group"><div data-subview="countdownTimer"></div></div><div data-js-snapbuttongroup="snapButton" class="big-button-group"><div data-js-snapbutton class="button webcam--snap-button"><div class="icon"></div></div>',enableGifMode&&(__p+='<div data-js-gifbutton class="button webcam--gif-button"><div class="icon"></div></div>'),__p+='</div><div data-js-snapbuttongroup="processing" class="big-button-group"><div data-js-processingbutton class="button webcam--processing-button"><div class="icon"></div></div></div><div data-js-snapbuttongroup="retakeButton" class="big-button-group"><div data-js-retakebutton class="button webcam--retake-button"><div class="icon"></div></div></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],274:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery").browser,o=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;s.mozilla&&Math.floor(s.version)>=20&&(o=navigator.mozGetUserMedia),o&&(o=i.bind(o,navigator)),e.exports=o},{jquery:"HlZQrA",lodash:"K2RcUv"}],275:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("when"),n=t("velocity-animate").hook,a=t("velocity-animate").animate,r=t("prima/view"),l=t("prima/mixins/accessor"),h=t("prima/mixins/subviewable"),d=t("prima/mixins/selectorcache"),c=t("../templates/countdown_timer.tpl"),u=r.extend({className:"countdown-timer",template:c,mixins:[l,h,d],defaults:{duration:3e3,ticks:1},initialize:function(t){this.options=t=i.extend({},t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults)))},start:function(t,e){i.isNumber(t)||(t=this.get("duration")),i.isNumber(e)||(e=this.get("ticks")),this.set({duration:t,ticks:e}),this._generateTickMarks(e),this.stop(),this.trigger("countdown:start"),this.js$("inner").removeClass("half-past"),this._halfPastTimeout=i.delay(i.bind(function(){this.js$("inner").addClass("half-past")},this),Math.floor(t/2));var s=0;return o.join(o.promise(i.bind(function(o){clearInterval(this._tickerInterval),this._tickerInterval=setInterval(i.bind(function(){this.trigger("countdown:tick",s++,e),s>=e&&(clearInterval(this._tickerInterval),o())},this),t/e)},this)),a(this.js$("rotator"),{rotateZ:["360deg","0deg"]},{easing:"linear",duration:t})).then(i.bind(function(){this.trigger("countdown:complete")},this))},stop:function(){clearTimeout(this._halfPastTimeout),clearInterval(this._tickerInterval),a(this.js$("rotator"),"stop")},teardown:function(){return clearTimeout(this._halfPastTimeout),clearInterval(this._tickerInterval),this.stopListening(),this
},remove:function(){return this.teardown(),r.prototype.remove.apply(this,arguments)},_generateTickMarks:function(t){i.isNumber(t)||(t=this.get("ticks")),this.js$("ticks").empty(),t>1&&i.forEach(i.range(t),function(e){var i=s('<div class="countdown-timer--tick"></div>');n(i,"rotateZ",360*e/t+"deg"),n(i,"translateY","-50%"),this.js$("ticks").append(i)},this)},serialize:function(){return this.toJSON()},render:function(){return this.$el.html(this.template(this.serialize())),this._generateTickMarks(),this.attachSubViews(),this}});e.exports=u},{"../templates/countdown_timer.tpl":270,jquery:"HlZQrA",lodash:"K2RcUv","prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/view":496,"velocity-animate":"lWl/mc",when:"RG2dij"}],276:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("velocity-animate").animate,n=t("prima/view"),a=t("app/lib/create-object-url"),r=t("../utils/get_user_media"),l=t("prima/mixins/accessor"),h=t("prima/mixins/subviewable"),d=t("prima/mixins/selectorcache"),c=t("../templates/video_stream.tpl"),u=t("components/knight-rider-loader"),p=n.extend({className:"video-stream",template:c,mixins:[l,h,d],defaultOptions:{video:!0,audio:!1},defaults:{width:500,height:375,retina:!0,mirrored:!0,needsPermission:!0,running:!1},initialize:function(t){this.options=t=i.extend({},this.defaultOptions,t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults)))},_onChangeRetina:function(t,e){this.$video.attr(e?{width:2*this.get("width"),height:2*this.get("height")}:{width:this.get("width"),height:this.get("height")})},_onChangeMirrored:function(t,e){this.$el.toggleClass("mirrored",e)},_onChangeRunning:function(t,e){this.loader&&this.loader.set("animate",!e),o(this.js$("noVideo"),"stop"),o(this.js$("noVideo"),{opacity:e?0:1},{display:e?"none":"block",delay:e?50:0,duration:100})},startStream:function(){if(!r)throw new Error("VideoStream: Cannot initialize without getUserMedia support");return r(i.pick(this.options,["audio","video"]),i.bind(this._onStreamReady,this),i.bind(this._onStreamError,this))},stopStream:function(){this.set("running",!1),this.streamURL=null,this.stream&&(this.stream.stop(),this.stream=null)},_onStreamReady:function(t){this.set("needsPermission",!1),this.stream=t,this.streamURL=a(this.stream),this._playVideoSteam()},_onStreamError:function(t){this.stopStream(),this.trigger("error",t)},_playVideoSteam:function(){this.video&&this.streamURL&&(this.video.src=this.streamURL,this.$video.one("loadeddata",i.bind(function(){this.set("running",!0)},this)),this.video.play())},remove:function(){s(this.video).remove(),n.prototype.apply(this,arguments)},teardown:function(){return this.stopStream(),this.stopListening(),this},beforeRender:function(){this.loader=this.subViews.loader=new u({variation:"centered",loading:!this.get("running")}),this.listenTo(this,"change:retina",this._onChangeRetina),this.listenTo(this,"change:mirrored",this._onChangeMirrored),this.listenTo(this,"change:running",this._onChangeRunning)},render:function(){return this._onChangeMirrored(this,this.get("mirrored")),this.$el.html(this.template(this.toJSON())),this.attachSubViews(),this.$video=this.$(".video-stream--video"),this.video=this.$video.get(0),this._playVideoSteam(),this}});e.exports=p},{"../templates/video_stream.tpl":271,"../utils/get_user_media":274,"app/lib/create-object-url":295,"components/knight-rider-loader":353,jquery:"HlZQrA",lodash:"K2RcUv","prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/view":496,"velocity-animate":"lWl/mc"}],277:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("when"),n=t("velocity-animate").animate,a=t("prima/view"),r=t("app/vendor/gif.js"),l=t("prima/utils/image/loader"),h=t("prima/utils/image/filereader"),d=t("prima/utils/image/canvas"),c=t("prima/mixins/accessor"),u=t("prima/mixins/subviewable"),p=t("prima/mixins/selectorcache"),m=t("../templates/webcam.tpl"),g=t("./video_stream"),f=t("./webcam_controls"),_=250,v=300,b=s(document),y=a.extend({className:"webcam",template:m,mixins:[c,u,p],defaults:{width:500,height:375,retina:!0,mirrored:!0,enabled:!0,needsPermission:!0,showControls:!1,flash:!0,showPreviewContainer:!1,defaultTimer:3e3,timePerFrame:1e3,gifFrameCount:4,gifSpeed:200,enableFlash:!0,enableGifMode:!0,enableRemove:!0},commands:["toggleFlash","toggleMirrored","snap","gif","flash","gifStart","gifSnap","gifComplete","retake","close"],initialize:function(t){this.options=t=i.extend({},t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),this._WebcamControlsView=t.WebcamControlsView||f},_onChangeEnabled:function(t,e){e?this.videoStream.startStream():this.videoStream.stopStream()},_onChangeNeedsPermission:function(t,e){var i=200;e||clearTimeout(this._delayedPermissionCheck),n(this.$arrow,"stop"),n(this.$arrow,{opacity:e?1:0},{display:e?"block":"none",duration:i})},_onChangeShowControls:function(t,e){var i=200;n(this.js$("controlContainer"),"stop"),n(this.js$("controlContainer"),{opacity:e?1:0},{display:e?"block":"none",duration:i})},_onChangeShowPreviewContainer:function(t,e){e?this.js$("previewContainer").css("display","block"):(this.js$("previewContainer").children("img").remove(),this.js$("previewContainer").css("display","none"))},startStream:function(){this.set("enabled",!0)},stopStream:function(){this.set("enabled",!1)},snap:function(t){this._snapFrame(t).then(i.bind(function(t){this.set("showPreviewContainer",!0),this.trigger("webcam:image",t),this.webcamControls.trigger("webcam:snapped")},this))},gif:function(t,e){i.isNumber(t)||(t=this.get("gifFrameCount")),i.isNumber(e)||(e=this.get("timePerFrame")),this.gifStart();var s=0;clearInterval(this._gifInterval),this._gifInterval=setInterval(i.bind(function(){s++,this.gifSnap(s>=t),s>=t&&clearInterval(this._gifInterval)},this),e)},gifStart:function(){this._frameBuffer=[]},gifSnap:function(t,e){this._snapFrame(e).then(i.bind(function(){var e=this.js$("canvas"),i=e.get(0),s=document.createElement("canvas");s.width=.5*(i.width||e.width()),s.height=.5*(i.height||e.height()),d.drawElToCanvas(this.js$("canvas"),s),this._frameBuffer.push(s),t&&this.gifComplete()},this))},gifComplete:function(t){i.isNumber(t)||(t=this.get("gifSpeed"));var e=new r({workers:3,quality:1});i.forEach(this._frameBuffer,function(i){e.addFrame(i,{delay:t})},this),e.on("finished",i.bind(function(t){h.read(t).then(i.bind(function(t){l.load(t.base64).then(i.bind(function(t){var e=s('<img data-js-gif class="webcam--preview-image"/>');e.attr("src",t.src),this.js$("previewContainer").append(e),i.extend(t,{base64:t.src,isGif:!0}),this.trigger("webcam:image",t),this.webcamControls.showSnapButtonGroup("retakeButton"),this.set("showPreviewContainer",!0)},this))},this))},this)),e.render(),delete this._frameBuffer},retake:function(){this.set("showPreviewContainer",!1),this.trigger("webcam:reset")},close:function(){this.trigger("webcam:close")},_snapFrame:function(t){!i.isUndefined(t)||(t=this.get("flash"));var e=i.bind(this.flash,this),s=i.bind(this.grabVideoFrame,this);return o.promise(function(o){t?(e(),i.delay(function(){o(s())},.5*v)):o(s())})},grabVideoFrame:function(){d.drawElToCanvas(this.videoStream.video,this.js$("canvas"),this.get("mirrored"));var t=this.js$("canvas").get(0);return t?{width:t.width,height:t.height,base64:t.toDataURL("image/jpeg")}:{width:0,height:0,base64:null}},toggleFlash:function(t){!i.isUndefined(t)||(t=!this.get("flash")),this.set("flash",t)},toggleMirrored:function(t){!i.isUndefined(t)||(t=!this.get("mirrored")),this.set("mirrored",t)},flash:function(){return n(this.$flash,"stop"),this.$flash.css({display:"block",opacity:1}),n(this.$flash,{opacity:[0,1]},{display:"block",delay:v,duration:_}).then(i.bind(function(){this.$flash.css("display","none")},this))},_checkVideoStreamPermissions:function(){this._delayedPermissionCheck=i.delay(i.bind(function(){this.get("needsPermission")&&this._onChangeNeedsPermission(this,!0)},this),1e3),this.get("needsPermission")?(this.js$("controlContainer").css({display:"none",opacity:0}),this.listenToOnce(this.videoStream,"change:needsPermission",function(t,e){this.set("needsPermission",e)}),this.listenToOnce(this.videoStream,"change:running",function(t,e){clearTimeout(this._delayedPermissionCheck),e&&(this.set("needsPermission",!1),this.set("showControls",!0))})):this.set("showControls",!0)},serialize:function(){var t=this.toJSON();return t.ratio=(t.width?t.height/t.width*100:0)+"%",t},teardown:function(){return clearInterval(this._gifInterval),clearTimeout(this._delayedPermissionCheck),b.off("keydown.webcam keyup.webcam"),this.stopListening(),this.$flash&&this.$flash.remove(),delete this.$flash,this.$arrow&&this.$arrow.remove(),delete this.$arrow,this},remove:function(){return this.teardown(),a.prototype.remove.apply(this,arguments)},beforeRender:function(){var t=i.pick(this.attributes,i.keys(g.prototype.defaults)),e=i.pick(this.attributes,i.keys(this._WebcamControlsView.prototype.defaults));this.videoStream=this.subViews.videoStream=new g(t),this.webcamControls=this.subViews.webcamControls=new this._WebcamControlsView(e),this.$flash=s('<div class="webcam--flash"></div>').appendTo("body"),this.$arrow=s('<div class="webcam--permission-arrow"></div>').appendTo("body"),s.browser.mozilla&&this.$arrow.addClass("firefox"),this.set("needsPermission",!this.videoStream.get("running")),this.listenTo(this,"change:enabled",this._onChangeEnabled),this.listenTo(this,"change:needsPermission",this._onChangeNeedsPermission),this.listenTo(this,"change:showControls",this._onChangeShowControls),this.listenTo(this,"change:showPreviewContainer",this._onChangeShowPreviewContainer),this.listenTo(this.videoStream,"error",function(t){this.trigger("webcam:error",t),this.close()}),this.listenTo(this,"change:flash",function(t,e){this.webcamControls.set("flash",e)}),this.listenTo(this,"change:mirrored",function(t,e){this.videoStream.set("mirrored",e),this.webcamControls.set("mirrored",e)}),this.listenTo(this.webcamControls,"webcam",function(t){if(i.contains(this.commands,t)){var e=this[t];i.isFunction(e)&&e.apply(this,i.rest(arguments))}}),b.on("keydown.webcam keyup.webcam",i.bind(function(t){switch(t.which||t.keyCode){case 16:this.set("flash","keyup"===t.type);break;case 18:"keydown"===t.type&&t.metaKey&&this.toggle("mirrored");break;case 91:case 92:case 93:"keydown"===t.type&&t.altKey&&this.toggle("mirrored")}},this))},render:function(){return this.$el.html(this.template(this.serialize())),this.attachSubViews(),this._checkVideoStreamPermissions(),this.get("enabled")&&this.videoStream.startStream(),this}});e.exports=y},{"../templates/webcam.tpl":272,"./video_stream":276,"./webcam_controls":278,"app/vendor/gif.js":303,jquery:"HlZQrA",lodash:"K2RcUv","prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/utils/image/canvas":486,"prima/utils/image/filereader":487,"prima/utils/image/loader":488,"prima/view":496,"velocity-animate":"lWl/mc",when:"RG2dij"}],278:[function(t,e){"use strict";var i=t("lodash"),s=t("velocity-animate").hook,o=t("velocity-animate").animate,n=t("prima/view"),a=t("prima/mixins/accessor"),r=t("prima/mixins/subviewable"),l=t("prima/mixins/selectorcache"),h=t("./countdown_timer"),d=t("app/components/remove-button"),c=t("../templates/webcam_controls.tpl"),u=n.extend({className:"webcam-controls",template:c,events:{mouseenter:"_onHoverControls",mouseleave:"_onHoverControls","click [data-js-flashButton]":"_onClickFlashButton","click [data-js-snapButton]":"_onClickSnapButton","click [data-js-gifButton]":"_onClickGifButton","click [data-js-retakeButton]":"_onClickRetakeButton"},mixins:[a,r,l],defaults:{isActive:!1,flash:!0,mirrored:!0,defaultTimer:3e3,timePerFrame:1e3,gifFrameCount:4,enableFlash:!0,enableGifMode:!0,enableRemove:!0},initialize:function(t){this.options=t=i.extend({},t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults)))},_onHoverControls:function(t){clearTimeout(this._removeIsActive);var e="mouseover"===t.type||"mouseenter"===t.type;e?this.set("isActive",!0):this._removeIsActive=i.delay(i.bind(function(){this.set("isActive",!1)},this),500)},_onClickFlashButton:function(){this.trigger("webcam","toggleFlash",!this.get("flash"))},_onClickSnapButton:function(t){var e=!t.altKey;this.countdownTimer.stop(),this.listenToOnce(this,"webcam:snapped",function(){this.showSnapButtonGroup("retakeButton")});var s=this.get("defaultTimer");e?(this.showSnapButtonGroup("countdownTimer",0),this.countdownTimer.start(s,1).then(i.bind(function(){this.trigger("webcam","snap")},this))):this.trigger("webcam","snap")},_onClickGifButton:function(){this.countdownTimer.stop(),this.trigger("webcam","gifStart"),this.listenTo(this.countdownTimer,"countdown:tick",function(t,e){this.trigger("webcam","gifSnap",t+1>=e),e>t+1&&this.pulseButton()});var t=this.get("gifFrameCount"),e=this.get("timePerFrame");this.showSnapButtonGroup("countdownTimer",0),this.countdownTimer.start(t*e,t).then(i.bind(function(){this.stopListening(this.countdownTimer,"countdown:tick"),this.showSnapButtonGroup("processing")},this))},_onClickRetakeButton:function(){this.showSnapButtonGroup("snapButton"),this.trigger("webcam","retake")},pulseButton:function(){var t=1.5;s(this.js$("primaryButton"),"translateX","-50%"),s(this.js$("primaryButton"),"scale",t),o(this.js$("primaryButton"),"stop"),o(this.js$("primaryButton"),{scale:[1,t]},{duration:200})},showSnapButtonGroup:function(t,e){i.isNumber(e)||(e=100);var s=this.js$("snapButtonGroup").filter('[data-js-snapButtonGroup="'+t+'"]');if(!i.isEmpty(s)){var n=this.js$("snapButtonGroup").not(s);o(s,"stop"),o(n,"stop"),o(this.js$("primaryButton"),"stop"),o(s,{opacity:1},{display:"block",duration:e}),o(n,{opacity:0},{display:"none",duration:e}),this.js$("primaryButton").toggleClass("invert","processing"===t);var a=60;"snapButton"===t&&this.get("enableGifMode")&&(a=150),o(this.js$("primaryButton"),{width:a},{display:"block",duration:e})}},serialize:function(){return this.toJSON()},teardown:function(){return this},beforeRender:function(){this.countdownTimer=this.subViews.countdownTimer=new h,this.listenTo(this,"change:flash",function(t,e){this.js$("flashButton").toggleClass("active",e)}),this.removeButton=this.subViews.removeButton=new d({buttonClass:"active",onClick:i.bind(function(){this.trigger("webcam","close")},this)}),this.listenTo(this,"change:isActive",function(t,e){this.js$("overlayButtons").toggleClass("active",e)})},render:function(){return this.$el.html(this.template(this.serialize())),this.attachSubViews(),this.showSnapButtonGroup("snapButton",0),this}});e.exports=u},{"../templates/webcam_controls.tpl":273,"./countdown_timer":275,"app/components/remove-button":256,lodash:"K2RcUv","prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/view":496,"velocity-animate":"lWl/mc"}],279:[function(t,e){"use strict";var i=t("prima/component"),s=t("./views/main"),o=t("../mail-signup"),n=t("../slideshow"),a=t("prima/lib/data"),r=i.extend({name:"businesspage",initialize:function(){this.view=new s,this.mailSignup=new o;var t=a.get("Components/BusinessPage"),e=new n;e.render(t.gallery)}});e.exports=r},{"../mail-signup":284,"../slideshow":288,"./views/main":280,"prima/component":428,"prima/lib/data":431}],280:[function(t,e){var i=(t("jquery"),t("prima/view")),s=(t("prima/lib/domeventor"),t("prima/events"),i.extend({el:"body",events:{"focus .search_query":"searchFocus","blur .search_query":"searchBlur"},initialize:function(){},searchFocus:function(){this.$(".search_form_row").addClass("focus")},searchBlur:function(){this.$(".search_form_row").removeClass("focus")}}));e.exports=s},{jquery:"HlZQrA","prima/events":429,"prima/lib/domeventor":433,"prima/view":496}],281:[function(t,e){"use strict";var i=t("prima/component"),s=t("./views/buttons-page"),o=i.extend({name:"buttonspage",initialize:function(){this.view=new s}});e.exports=o},{"./views/buttons-page":283,"prima/component":428}],282:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="",__p+='<iframe class="btn" frameborder="0" border="0" scrolling="no" allowtransparency="true" height="20" width="'+(null==(__t=width)?"":_.escape(__t))+'" src="'+(null==(__t=followButtonUrl)?"":_.escape(__t))+"?type="+(null==(__t=followButtonType)?"":_.escape(__t))+"&amp;tumblelog="+(null==(__t=followBlog)?"":_.escape(__t))+"&amp;color="+(null==(__t=color)?"":_.escape(__t))+'"></iframe>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],283:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/lib/data"),a=(t("prima/lib/flags"),t("prima/mixins/accessor")),r=t("prima/utils/bindendevent").animation,l=t("app/components/flat-select"),h=t("standalone/share-button-internal/components/share-button/templates/post-button.tpl"),d=t("../templates/follow-button.tpl"),c=o.extend({mixins:[a],el:s(".buttons-content"),events:{"click   .button-type-select":"__onButtonTypeClick","click   .color-circle":"__onColorCircleClick","change  .note-count-position":"__onNoteCountPositionChange","change  .follow-blog-select":"__onFollowBlogChange","mouseup .embed-code":"__onEmbedCodeMouseup","copy    .embed-code":"__embedCodeCopied"},defaults:{buttonColor:"blue",buttonType:"share",notePosition:"right",followBlog:"staff"},initialize:function(){this._setupSources(),new l,this.$buttonOptions=this.$(".button-type-select"),this.$noteCountPosition=this.$(".note-count-position"),this.$followTumblelog=this.$(".follow-tumblelog-select"),this.$colorCircles=this.$(".color-circle"),this.$followBlogInput=this.$(".follow-blog-input"),this.$extraOption=this.$(".extra-option"),this.$embedCode=this.$(".embed-code"),this.$buttonPreview=this.$(".button-preview"),this.$copiedMessage=this.$(".copied-message"),this.$shareButton=this.$(".share-button"),this.$followButton=this.$(".follow-button"),this.$followBlogButton=this.$(".follow-blog-button"),this.$shareButton.html(h()),this.$followBlogSelect=this.$(".follow-blog-select"),this.$followBlogSelect[0]&&this.set("followBlog",this.$followBlogSelect.find("option:first").val()),this.on("change:buttonColor",this.updateFollowButtonOptions,this),this.on("change:buttonColor",this.updateButtonPreview,this),this.on("change:notePosition",this.updateButtonPreview,this),this.on("change:buttonType",this.updateButtonPreview,this),this.on("change:followBlog",this.updateButtonPreview,this),this.on("change:followBlog",this.updateFollowButtonOptions,this),this.on("change:buttonType",this.toggleExtraOption,this),this.$followBlogInput.on("keyup",i.debounce(i.bind(this.updateFollowBlog,this),500)),this.updateButtonPreview()},updateButtonPreview:function(){"share"===this.get("buttonType")?this.updateShareButtonPreview():this.updateFollowButtonPreview()},updateShareButtonPreview:function(){var t='<script>!function(d,s,id){var js,ajs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="'+this.shareButtonScript+'";ajs.parentNode.insertBefore(js,ajs);}}(document, "script", "tumblr-js");</script>',e='<a class="tumblr-share-button" data-color="'+this.get("buttonColor")+'" data-notes="'+this.get("notePosition")+'" href="'+this.shareHref+'"></a>';this.$buttonPreview.html(e),this.updateCode(e+"\n"+t),"function"==typeof initShareButton&&initShareButton()},updateFollowButtonPreview:function(){var t=this.getFollowButtonMarkup();this.$buttonPreview.html(t),this.updateCode(t)},updateFollowButtonOptions:function(){this.$followButton.html(this.getFollowButtonMarkup("follow")),this.$followBlogButton.html(this.getFollowButtonMarkup("follow-blog"))},getFollowButtonMarkup:function(t){t||(t=this.get("buttonType"));var e={followButtonUrl:this.followButtonUrl,followBlog:this.get("followBlog"),color:this.get("buttonColor"),followButtonType:t,width:"follow"===t?"65":"200"};return d(e)},updateCode:function(t){this.$embedCode.val(t)},toggleExtraOption:function(){this.$extraOption.removeClass("share follow follow-blog").addClass(this.get("buttonType"))},updateFollowBlog:function(){var t=this.$followBlogInput.val();t&&this.set("followBlog",t)},_setupSources:function(){var t=n.get("Context/hosts")||{};this.followButtonUrl=(t.platform_host||"https://platform.tumblr.com")+"/v2/follow_button.html",this.shareButtonScript=(t.assets_host||"https://assets.tumblr.com")+"/share-button.js",this.shareHref=(t.embed_host||"https://embed.tumblr.com")+"/share"},__onButtonTypeClick:function(t){var e=s(t.target).val();e&&this.set("buttonType",e)},__onColorCircleClick:function(t){var e=s(t.target).data("color");this.$colorCircles.removeClass("selected"),this.$shareButton.removeClass("blue black white").addClass(e),s(t.target).addClass("selected"),this.set("buttonColor",e)},__onNoteCountPositionChange:function(t){var e=s(t.target).val();e&&this.set("notePosition",e)},__onFollowBlogChange:function(t){var e=s(t.target).val();e&&this.set("followBlog",e)},__onEmbedCodeMouseup:function(){this.$embedCode.select()},__embedCodeCopied:function(){r(this.$copiedMessage,i.bind(function(){this.$copiedMessage.removeClass("animate-in")},this)),this.$copiedMessage.addClass("animate-in"),i.defer(i.bind(function(){this.$embedCode.blur()},this))}});e.exports=c},{"../templates/follow-button.tpl":282,"app/components/flat-select":47,jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/data":431,"prima/lib/flags":"f/LVtH","prima/mixins/accessor":458,"prima/utils/bindendevent":474,"prima/view":496,"standalone/share-button-internal/components/share-button/templates/post-button.tpl":499}],284:[function(t,e){var i=t("jquery"),s=(t("lodash"),t("prima/component")),o=t("prima/events"),n=t("app/components/drawer"),a=t("./views/mail-signup.js"),r=s.extend({name:"MailForm",initialize:function(){this.drawerManager=n(),this.listenTo(this.drawerManager,"open:mail-signup",this.open),this.listenTo(o,"mailForm:close",this.close)},close:function(){this.drawerManager.close()},open:function(){var t=i(document.activeElement).is("input,textarea,div[contenteditable]");this.drawerManager.canOpen()&&!t?this.drawerManager.open(a):this.drawerManager.close()}});e.exports=r},{"./views/mail-signup.js":287,"app/components/drawer":44,jquery:"HlZQrA",lodash:"K2RcUv","prima/component":428,"prima/events":429}],285:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<h1 class="mail-title mail-center">'+(null==(__t=__("Almost done"))?"":_.escape(__t))+'</h1><div class="mail-description mail-center">'+(null==(__t=__("We sent you an email to confirm the address."))?"":_.escape(__t))+"<br>"+(null==(__t=__("Just click the link inside and you're all set."))?"":_.escape(__t))+'</div><div class="mail-center"><button class="chrome shallow other_blue button confirm_next">'+(null==(__t=__("Okay"))?"":_.escape(__t))+"</button></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],286:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<h1 class="mail-title">'+(null==(__t=__("Get Marketr in your inbox."))?"":_.escape(__t))+'</h1><div class="mail-description">'+(null==(__t=__("No, no, don't get up. Let our marketing blog come to you."))?"":_.escape(__t))+'</div><hr><div class="mail-signup-errors"></div><div id="mc_embed_signup"><form action="//tumblr.us8.list-manage.com/subscribe/post-json?u=a1766e40da51474e590377fef&amp;id=70777df827&amp;c=?" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate><div class="mc-field-group"><label for="mce-FIRSTNAME">'+(null==(__t=__("First Name"))?"":_.escape(__t))+'</label><input type="text" value="" name="FIRSTNAME" class="" id="mce-FIRSTNAME"></div><div class="mc-field-group"><label for="mce-LASTNAME">'+(null==(__t=__("Last Name"))?"":_.escape(__t))+'</label><input type="text" value="" name="LASTNAME" class="" id="mce-LASTNAME"></div><div class="mc-field-group"><label for="mce-EMAIL">'+(null==(__t=__("Email Address"))?"":_.escape(__t))+'</label><input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL"></div><div id="mce-responses" class="clear"><div class="response" id="mce-error-response" style="display:none"></div><div class="response" id="mce-success-response" style="display:none"></div></div><div style="position: absolute; left: -5000px"><input type="text" name="b_a1766e40da51474e590377fef_70777df827" tabindex="-1" value=""></div><input type="submit" value="'+(null==(__t=__("Sign up"))?"":_.escape(__t))+'" name="subscribe" id="mc-embedded-subscribe" class="chrome shallow signup other_blue button right"></form></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],287:[function(t,e){"use strict";var i=t("prima/view"),s=t("prima/lib/translate"),o=t("prima/events"),n=t("jquery"),a=t("../templates/mail_signup.tpl"),r=t("../templates/mail_next_step.tpl"),l=i.extend({className:"mail-signup-drawer",templates:{mailForm:a,nextStep:r},events:{"click #mc-embedded-subscribe":"quickValidate","click .confirm_next":"confirmNext"},initialize:function(t){this.attributes=_.extend({__:s},t)},render:function(){return this.$el.html(this.templates.mailForm(this.attributes)),i.prototype.render.apply(this,arguments)},quickValidate:function(t){t.preventDefault();var e=this.$("#mce-EMAIL").val(),i=this;if(/\S+@\S+/.test(e)){var o=this.$("#mc-embedded-subscribe-form").serialize(),a=this.$("#mc-embedded-subscribe-form").attr("action");n.ajax({type:"GET",url:a,data:o,dataType:"json",contentType:"application/json; charset=utf-8",success:function(){i.almostDone()},error:function(){i.$(".mail-signup-errors").text(s("An error has occurred sending your request. Please try again later."))}})}else this.$(".mail-signup-errors").text(s("Please enter a valid email address."))},almostDone:function(){this.$el.html(this.templates.nextStep(this.attributes))},confirmNext:function(){o.trigger("mailForm:close")}});e.exports=l},{"../templates/mail_next_step.tpl":285,"../templates/mail_signup.tpl":286,jquery:"HlZQrA","prima/events":429,"prima/lib/translate":456,"prima/view":496}],288:[function(t,e){"use strict";var i=t("prima/component"),s=t("./views/main"),o=i.extend({name:"slideshow",initialize:function(){},render:function(t,e){return new s(t,e)}});e.exports=o},{"./views/main":289,"prima/component":428}],289:[function(t,e){var i=t("jquery"),s=(t("lodash"),t("prima/view")),o=(t("prima/lib/domeventor"),s.extend({el:".pages-overlay-wrapper",events:{"click .pages-arrow":"nextImage"},initialize:function(t,e){this.galleryArray=t;var s=this.$(".slideshow");this.galleryArray.forEach(function(t){var e=i('<div class="slide hide-slide"></div>');e.css("background-image","url("+t.url+")"),s.append(e)}),this.galleryPosition=-1,this.galleryCycleTime=e&&e.galleryCycleTime||6e3,this.nextImage()},nextImage:function(t){window.clearTimeout(this.galleryNext),this.galleryNext=window.setTimeout(this.nextImage.bind(this),this.galleryCycleTime),this.galleryPosition+=this.$(t&&(t.target||t.currentTarget)).hasClass("left")?-1:1,this.galleryPosition<0?this.galleryPosition=this.galleryArray.length-1:this.galleryPosition>=this.galleryArray.length&&(this.galleryPosition=0);var e=this.galleryArray[this.galleryPosition],i=this.$(".slideshow");if(i.find(".show-slide").removeClass("show-slide").addClass("hide-slide"),this.$(i.find(".slide")[this.galleryPosition]).addClass("show-slide").removeClass("hide-slide"),e.link&&e.linkTitle&&e.linkSelector){var s=i.find(e.linkSelector);s.html(e.linkTitle),s.attr("href",e.link)}this.$(".slideshow-overlay").css("background",e.overlay||"rgba(0,0,0,0)")}}));e.exports=o},{jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/domeventor":433,"prima/view":496}],"EFn+ou":[function(t,e){"use strict";var i=t("app/router"),s=(t("prima/lib/flags"),t("prima/lib/data")),o=t("app/components/net-neutrality"),n=t("app/components/net-neutrality-2015"),a=t("./components/businesspage"),r=t("./components/buttonspage"),l=t("components/help-form"),h=t("components/abuse-form"),d=i.extend({root:"/",routes:{business:"business",jobs:"jobs",logo:"logo",stop:"net_neutrality",transparency:"transparency","docs/*doc":"docs",suspended:"suspended",terminated:"suspended",buttons:"buttons","register/error":"registrationError","abuse(/)":"communityGuidelinesPage","abuse/:formType":"communityGuidelinesPage","everybodyontheinternet(/)":"nnc2015"},initialize:function(){},business:function(){new a},jobs:function(){},logo:function(){},buttons:function(){new r},net_neutrality:function(){this.page=new o,this.page.render()},transparency:function(){},docs:function(){this.helpForm=new l},suspended:function(){this.helpForm=new l},registrationError:function(){this.helpForm=new l},communityGuidelinesPage:function(t){var e=s.get("Components/AbuseForm");e.autolaunch===!0&&(this.abuseForm=new h,this.abuseForm.open({formType:t}))},nnc2015:function(){this.page=new n,this.page.render()}});e.exports=d},{"./components/businesspage":279,"./components/buttonspage":281,"app/components/net-neutrality":64,"app/components/net-neutrality-2015":60,"app/router":302,"components/abuse-form":306,"components/help-form":346,"prima/lib/data":431,"prima/lib/flags":"f/LVtH"}],context:[function(t,e){e.exports=t("EFn+ou")},{}],292:[function(t,e){"use strict";var i=t("prima/utils/exposer");i({"Tumblr.Prima.PostViewBuilder":t("components/post"),"Tumblr.Prima.Upload":t("app/components/upload"),"Tumblr.Prima.Ligature":t("ligature"),"Tumblr.Events":t("prima/events"),"Tumblr.Prima.Events":t("prima/events"),"Tumblr.Prima.Dialog":t("app/components/dialog"),"Tumblr.Dialog":t("app/components/dialog"),"Tumblr.PostMessageChannel":t("components/post-message-channel"),"Tumblr.Prima.DOMEventor":t("prima/lib/domeventor"),"Tumblr.Prima.gutterMediaManager":t("app/components/gutter-media-manager"),"Tumblr.Prima.Vendor.when":t("when"),"Tumblr.Prima.Vendor.sequence":t("when/sequence"),"Tumblr.log_lady":t("prima/lib/loglady"),"Tumblr.Prima.logLady":t("prima/lib/loglady"),"Tumblr.Prima.Models.Post":t("app/models/post"),"Tumblr.Prima.Models.Tumblelog":t("app/models/tumblelog"),"Tumblr.Prima.CrtPlayer":t("components/crt/player"),"Tumblr.Prima.BlogCard":t("app/components/blog-card"),"Tumblr.Prima.Url":t("prima/utils/url"),ace:t("app/vendor/ace"),"Tumblr.Prima.ToolTip":t("app/components/tooltip"),"Tumblr.Prima.SharePopover":t("components/popover/views/share-popover"),"Tumblr.Prima.utils.caniuse":t("prima/utils/caniuse"),"Tumblr.Prima.PostModerationPopover":t("components/popover/views/post_moderation_popover"),"Tumblr.Prima.ConfettiView":t("app/components/confetti/views/confetti-view"),"Tumblr.Prima.FlatSelect":t("app/components/flat-select"),"Tumblr.Prima.Mixins.loggingData":t("prima/mixins/generate-logging-data"),"Tumblr.Prima.Scrollbar":t("app/lib/scrollbar"),"Tumblr.Prima.MessageControlsPopover":t("components/popover/views/message-controls-popover"),"Tumblr.Prima.Block":t("app/lib/block")}),e.exports=i},{"app/components/blog-card":29,"app/components/confetti/views/confetti-view":38,"app/components/dialog":39,"app/components/flat-select":47,"app/components/gutter-media-manager":52,"app/components/tooltip":262,"app/components/upload":266,"app/lib/block":294,"app/lib/scrollbar":297,"app/models/post":299,"app/models/tumblelog":300,"app/vendor/ace":"4e8++S","components/crt/player":324,"components/popover/views/message-controls-popover":370,"components/popover/views/post_moderation_popover":371,"components/popover/views/share-popover":372,"components/post":376,"components/post-message-channel":373,ligature:511,"prima/events":429,"prima/lib/domeventor":433,"prima/lib/loglady":447,"prima/mixins/generate-logging-data":461,"prima/utils/caniuse":475,"prima/utils/exposer":482,"prima/utils/url":494,when:"RG2dij","when/sequence":521}],293:[function(t,e){"use strict";
var i=t("lodash"),s=[16,24,30,40,48,64,96,128,512],o=i.last(s),n=128,a=function(t){return t>=o?o:i.find(s,function(e){return e>=t})},r=function(t,e){var i=function(e){return e=null==e?n:a(e),t.replace(/^(.*_)?(\d+)(\D.*)?$/,"$1"+e+"$3")};return i.toString=function(){return this()},null!=e?i(e):i};e.exports=r},{lodash:"K2RcUv"}],294:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/lib/translate"),n=t("prima/lib/data"),a=t("app/components/dialog"),r=t("when"),l={_getCurrentTumblelog:function(){var t="",e=n.get("Context/userinfo");return e&&s.each(e.channels,function(e){e.is_current&&(t=e.name)}),t},block:function(t){t=t||{};var e={};return e.tumblelog=t.currentTumblelog||this._getCurrentTumblelog(),t.blockedTumblelog?e.blocked_tumblelog=t.blockedTumblelog:t.blockedPost&&(e.blocked_post=t.blockedPost),i.ajax({url:"/svc/block/add",type:"POST",data:e,with_form_key:!0})},unblock:function(t){t=t||{};var e={};return e.tumblelog=t.currentTumblelog||this._getCurrentTumblelog(),e.blocked_tumblelog=t.blockedTumblelog,i.ajax({url:"/svc/block/remove",type:"POST",data:e,with_form_key:!0})},confirmBlock:function(t){var e,i=r.defer();return e=t?s.sprintf(o("Are you sure you want to block %s?"),t):o("Are you sure you want to block this user?"),a.confirm(e,function(){i.resolve(t)},function(){i.reject()}),i.promise.catch(s.noop),i.promise}};e.exports=l},{"app/components/dialog":39,jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/data":431,"prima/lib/translate":456,when:"RG2dij"}],295:[function(t,e){"use strict";var i=(window.URL||window.webkitURL||window.mozURL||window.msURL||{}).createObjectURL;e.exports=i},{}],296:[function(t,e){"use strict";var i,s=t("app/models/user"),o=t("prima/lib/data"),n=function(){if(null==i){var t=o.get("Context/userinfo");i=t&&t.name?new s(t):!1}return i};e.exports=n},{"app/models/user":301,"prima/lib/data":431}],297:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("fastdom"),n=t("prima/events"),a=t("prima/class"),r=t("prima/mixins/accessor"),l=a.extend({mixins:[r],defaults:{tplScrollbarWrapper:'<div class="tx-scroll"></div>',tplScrollbarTrack:'<div class="tx-scrollbar-track"><div class="tx-scrollbar-thumb"></div></div>',trackActiveClass:"tx-scrollbar-track--active",scrollingClass:"tx-scroll--scrolling",containerClass:"tx-scroll-container",infiniteScrollPercent:.9,scrollable:!1,scrolling:!1},destroyed:!1,constructor:function(){this.initialize.apply(this,arguments)},initialize:function(t){this.$window=s(window),this.$container=s(t),this.container=this.$container[0],this.container&&(this._onScrollStop=i.debounce(i.bind(this.onScrollStop,this),150),this._onResize=i.debounce(i.bind(this.onResize,this),150),this.createElements(),this.wrapContainer(),this.bindEvents(),this.update())},createElements:function(){this.$wrapper=s(this.get("tplScrollbarWrapper")),this.$track=s(this.get("tplScrollbarTrack")),this.$thumb=this.$track.find(".tx-scrollbar-thumb")},wrapContainer:function(){this.$container.wrap(this.$wrapper),this.$wrapper.remove(),this.$wrapper=this.$container.parent()},appendTrack:function(){this.$track.insertAfter(this.$container)},removeTrack:function(){this.$track.remove()},bindEvents:function(){this.listenTo(n,"DOMEventor:flatresize",this._onResize),this.$wrapper.on("mousedown.txScroll",".tx-scrollbar-thumb",i.bind(this.onThumbMousedown,this)),this.$container.on("scroll.txScroll",i.bind(this.onScroll,this))},update:function(){if(!this.destroyed){if(this.$container.addClass(this.get("containerClass")),!this.get("scrollable")&&this._isScrollable()?(this.set("scrollable",!0),this.appendTrack(),"ontouchstart"in document.documentElement||(this.$container.off("mousewheel.txScroll DOMMouseScroll.txScroll"),this.$container.on("mousewheel.txScroll DOMMouseScroll.txScroll",i.bind(this.stealScroll,this)))):this._isScrollable()||(this.set("scrollable",!1),this.$container.removeClass(this.get("containerClass")),this.removeTrack()),this.get("scrollable")){var t=this.$container.height()/this.container.scrollHeight;this.$thumb.height(this.$track.height()*t)}this.updateScrollContstants()}},updateScrollContstants:function(){this.currentScrollTop=this.$container.scrollTop(),this.percentageDifference=(this.container.scrollHeight-this.$container.height())/(this.$track.height()-this.$thumb.height())},onResize:function(){this.update()},_isScrollable:function(){return this.container&&this.container.scrollHeight>this.$container.height()},_getScrollTop:function(t,e){return t.pageY-e.offset().top},onThumbMousedown:function(t){t.preventDefault(),this.$track.addClass(this.get("trackActiveClass")),this.$window.on("mousemove.txScroll",i.bind(this.onTrackMousemove,this)),this.$window.on("mouseup.txScroll",i.bind(this.onTrackMouseup,this)),this.mouseDownOriginalOffsetY=this._getScrollTop(t,this.$track),this.updateScrollContstants()},onTrackMousemove:function(t){var e;o.read(function(){this.destroyed||(e=this._getScrollTop(t,this.$track)-this.mouseDownOriginalOffsetY,o.write(function(){this.destroyed||this.$container.scrollTop(this.currentScrollTop+e*this.percentageDifference)},this))},this)},onTrackMouseup:function(t){t.preventDefault(),this.$track.removeClass(this.get("trackActiveClass")),this.$window.off(".txScroll")},onScroll:function(){var t,e,i;this.get("scrolling")||(this.trigger("scrollstart"),this.$wrapper.addClass(this.get("scrollingClass"))),this.set("scrolling",!0),this._onScrollStop(),o.read(function(){this.destroyed||(i=this.container.scrollTop,t=i/(this.container.scrollHeight-this.$container.height()),e=this.$track.height()-this.$thumb.height(),o.write(function(){this.destroyed||(this.$thumb.css("transform","translate3d(0, "+e*t+"px, 0)"),this.trigger("scroll",i,t),t>this.get("infiniteScrollPercent")&&this.trigger("infinitescroll",i,t))},this))},this)},onScrollStop:function(){this.destroyed||(this.trigger("scrollstop"),this.set("scrolling",!1),this.$wrapper.removeClass(this.get("scrollingClass")))},stealScroll:function(t){var e=t.currentTarget,i=t.originalEvent.wheelDelta||-t.originalEvent.detail;i>0&&e.scrollTop<=0&&t.preventDefault(),0>i&&e.scrollTop>=e.scrollHeight-s(e).height()&&t.preventDefault()},destroy:function(){this.destroyed=!0,this.$track.off().remove(),this.$thumb.remove(),this.$wrapper.off(".txScroll"),this.$container.off(".txScroll"),this.$container.unwrap(),this.$container.removeClass(this.get("containerClass")),this.$track=null,this.$thumb=null,this.$container=null,this.container=null,this.$wrapper=null,this.$window=null,this.set("scrollable",!1),this.off()}});e.exports=l},{fastdom:500,jquery:"HlZQrA",lodash:"K2RcUv","prima/class":426,"prima/events":429,"prima/mixins/accessor":458}],298:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/lib/mixin"),n=new o({setUpSelector:function(t){t.on("change",s.bind(this.__select_change,this))},__select_change:function(t){var e=i(t.currentTarget);this.__update_select(e)},__update_select:function(t){var e=t.siblings("label");e.text(t.find(":selected").text())}});e.exports=n},{jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/mixin":453}],299:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/model"),n=t("prima/events"),a=t("app/models/tumblelog"),r=t("app/components/dialog"),l=t("app/components/post-embed-code"),h=t("prima/lib/translate"),d=o.extend({defaults:{},endpoints:{like:"/svc/like",unlike:"/svc/unlike",reblog:"/fast_reblog",reply:"/svc/reply",publish:"/publish",queue:"/publish",destroy:"/svc/post/delete",promote:"/svc/promote",unpromote:"/svc/unpromote",answer:"/answer",deny:"/deny_submission",approve:"/approve_submission",remove_source:"remove_app_attribution"},initialize:function(){this._createPostTumblelogModel("tumblelog",this.get("tumblelog-data")),this._createPostTumblelogModel("parentTumblelog",this.get("tumblelog-parent-data")),this._createPostTumblelogModel("rootTumblelog",this.get("tumblelog-root-data"))},_createPostTumblelogModel:function(t,e){t=t||"tumblelog",e=e||!1;var s=!1;e&&e.name&&(s=new a(i(e).omit(i.isUndefined).omit(i.isNull).value())),this[t]=s},_setTumblelog:function(){this.tumblelog=new a(i({name:this.get("tumblelog"),ignoring:!1,sponsor:this.get("sponsored"),following:this.get("following"),mention_key:this.get("tumblelog_mention_key")}).omit(i.isUndefined).omit(i.isNull).value())},_setReblogTumblelog:function(){var t=this.get("reblog_source");t&&t.name&&(this.reblogTumblelog=new a(i({name:t.name,ignoring:!1,following:t.following}).omit(i.isUndefined).omit(i.isNull).value()))},_xhrRequest:function(t,e,o){o.init&&o.init();var n=s.ajax({data:e,type:"POST",url:t,with_form_key:!0});return n.done(i.bind(function(t){o[200]&&o[200].call(this,t)},this)),n.fail(i.bind(function(t){o[t.status]&&o[t.status].call(this,t.status)},this)),n.always(i.bind(function(){o.always&&o.always()},this)),n},_xhrSuccess:function(t){this.trigger(t+":success")},_xhrFailure:function(t){r.alert(h("Sorry, we seem to be having technical trouble.  Please try again later.")),this.trigger(t+":failure")},_xhrForbidden:function(t){this.trigger(t+":forbidden")},save:function(t,e,s){if(s||(s={}),this.endpoints[t]){var o={200:i.bind(this._xhrSuccess,this,t),401:i.bind(this._xhrFailure,this,t),404:i.bind(this._xhrFailure,this,t),403:i.bind(this._xhrForbidden,this,t),500:i.bind(this._xhrFailure,this,t)};return this._xhrRequest(this.endpoints[t],e,i.defaults(s,o))}throw new Error("Missing endpoint url for "+t)},like:function(t){if(!this.get("is_mine")){if(this.get("liked")===!1){this.set("liked",!0);var e=this.likePayload(t,this.getLikeSource("like"));this.save("like",{data:e})}this.trigger("like:set",this),n.trigger("post:like:set",this.get("id"),this,t)}},unlike:function(){if(this.get("liked")===!0){this.set("liked",!1);var t=this.likePayload("mouse",this.getLikeSource("unlike"));this.save("unlike",{data:t})}this.trigger("unlike:set",this),n.trigger("post:unlike:set",this.get("id"))},toggleLike:function(){this.get("liked")?this.unlike():this.like()},getLikeSource:function(t){t=t||"like";var e="LIKE_";switch(t){case"unlike":e="UNLIKE_";break;case"reply":e="REPLY_";break;case"ignore":e="IGNORE_"}var i=location.pathname;return i.match(/^\/dashboard/)?e+"SOURCE_DASHBOARD":i.match(/^\/tagged/)?e+"SOURCE_TAG_PAGE":i.match(/^\/likes/)?e+"SOURCE_LIKES_PAGE":i.match(/^\/inbox/)?e+"SOURCE_INBOX":i.match(/^\/search/)?e+"SOURCE_SEARCH_RESULTS_PAGE":i.match(/^\/explore/)?e+"SOURCE_DISCOVER":i.match(/^\/indash_blog\/peepr/)?e+this.getPeeprSource():e+"SOURCE_UNKNOWN"},getPeeprSource:function(){if(window.parent&&window.parent.location){var t=window.parent.location.pathname;if(t.match(/search/))return"SOURCE_SEARCH_PEEPR"}return"SOURCE_PEEPR"},getEmbedCode:function(t,e){var i={embed_key:this.get("embed_key"),embed_did:this.get("embed_did"),post_id:this.get("id"),post_url:this.get("post_url")};t&&(i.language=t),e&&(i.width=e);var s=new l(i);return s.getCode()},likePayload:function(t,e){return t=t||"mouse",e=e||"LIKE_SOURCE_UNKNOWN",{id:this.get("id"),root_id:this.get("root_id"),key:this.get("reblog_key"),method:t,source:e,placement_id:this.get("placement_id")||!1,is_recommended:this.get("is_recommended")||"",pt:this.get("pt")}},reblog:function(t){t||(t={}),t=i.extend({oldPostFormData:{pt:this.get("pt"),type:this.get("type"),reblog_id:this.get("id"),detached:!0,reblog:!0,reblog_key:this.get("reblog_key")}},t,{reblogId:this.get("id"),reblogKey:this.get("reblog_key"),pt:this.get("pt")}),n.trigger("postForms:reblog",t)},fastReblog:function(t){t||(t=!1),this.trigger("fastreblog:success",t);var e={reblog_key:this.get("reblog_key"),reblog_post_id:this.get("id"),queue:t,pt:this.get("pt")},s={200:i.bind(function(t){this.set("reblogged",!0),this.trigger("fastreblog:ajax:success",t.response)},this)};this.save("reblog",e,s)},reply:function(t){var e={reply_text:t,post_id:this.get("id"),tumblelog:this.get("tumblelog"),tumblelog_key:this.get("tumblelog_key"),source:this.getLikeSource("reply")},s={200:i.bind(function(){this.trigger("replied")},this)};return this.save("reply",{data:e},s)},destroy:function(){var t={post_id:this.get("id"),channel_id:this.get("tumblelog")};this.save("destroy",t)},publish:function(){var t=this.save("publish",{id:this.get("id")});t.fail(i.bind(function(t){this.trigger("publish:failure",s.parseJSON(t.responseText))},this))},promote:function(t){var e={tag:t,post_id:this.get("id"),reblog_key:this.get("reblog_key"),tumblelog_name:this.get("tumblelog")};return this.save("promote",e)},unpromote:function(t){var e={tag_id:t,post_id:this.get("id"),reblog_key:this.get("reblog_key"),tumblelog_name:this.get("tumblelog")};return this.save("unpromote",e)},queue:function(){var t={id:this.get("id"),queue:"queue"};this.save("queue",t)},removeSource:function(){var t={post_id:this.get("id"),tumblelog_id:this.get("tumblelog")};return this.save("remove_source",t)},approve:function(t){var e={id:this.get("id"),queue:t};return this.save("approve",e)},deny:function(){return this.save("deny",{pid:this.get("id")})},answer:function(t){var e={post_id:this.get("id"),tumblelog:this.get("tumblelog"),key:this.get("tumblelog_key"),answer_text:t};return this.save("answer",e)},embedFocus:function(){this.trigger("embed:focus",this)},updateReblogControl:function(t){this.trigger("reblog:success",t)},dismiss:function(){this.trigger("dismiss",this)}});e.exports=d},{"app/components/dialog":39,"app/components/post-embed-code":81,"app/models/tumblelog":300,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/lib/translate":456,"prima/model":471}],300:[function(t,e){"use strict";function i(t,e,i){var s=a.Deferred(),o={data:{tumblelog:t.get("name")}};i.placement_id&&(o.data.placement_id=i.placement_id),i.pt&&(o.data.pt=i.pt),i.source&&(o.data.source=i.source),i.context&&(o.data.context=i.context),i.tlt&&(o.data.tlt=i.tlt);var n=function(){i.wait||t.set({following:e.following},i)},r=function(o,n){i.wait||t.set({following:!e.following},i),s.reject(n)},l=function(){i.wait&&t.set({following:e.following},i),s.resolve()},h=e.following?"/svc/follow":"/svc/unfollow";return a.ajax({beforeSend:n,cache:!i.force,data:o,error:r,type:"POST",success:l,url:h,with_form_key:!0}),s.promise()}function s(t,e){var i=a.Deferred(),s={};r.has(e,"is_tumblelog_popover")&&(s.is_tumblelog_popover=e.is_tumblelog_popover),r.has(e,"is_user_mention")&&(s.is_user_mention=e.is_user_mention);var o=function(t,e){i.reject(e)},n=function(e){r.has(e,"highlighted_posts")||(e={highlighted_posts:e}),t.set(e),i.resolve()};return a.ajax({cache:!e.force,data:s,error:o,type:"GET",success:n,url:u(t),with_form_key:!0}),i.promise()}function o(t,e){return l.promise(function(i,s){var o={tumblelog:t.get("name")};r.has(e,"include_member_data")&&(o.include_member_data=e.include_member_data),r.has(e,"include_activity_data")&&r.has(e,"include_member_data")&&(o.include_activity_data=e.include_activity_data);var n=function(t,e){s(e)},l=function(e){t.set(e.response),i()};a.ajax({data:o,type:"GET",error:n,success:l,url:"/svc/data/tumblelog",with_form_key:!0})})}function n(t,e){return a.ajax({cache:!e.force,data:e.data,type:"GET",url:"/svc/tumblelog_popover/"+t,with_form_key:!0})}var a=t("jquery"),r=t("lodash"),l=t("when"),h=t("prima/events"),d=t("app/lib/block"),c=t("prima/singletonmodel"),u=function(){function t(t){return t.has("avatar_url")&&t.has("global_theme_params")}return function(e){return t(e)?"/svc/"+e.get("name")+"/posts/highlighted":"/svc/tumblelog_popover/"+e.get("name")}}(),p=c.extend({save_following:function(t,e){e||(e={}),t||(t={}),t.following=!!t.following;var s=this;return e.force||s.get("following")!==t.following?i(s,t,e).then(r.bindKey(s,"save_following",t)):a.when(s.get("following"))},fetch_popover_data:function(t){t||(t={}),t.is_user_mention=!!t.is_user_mention,t.is_tumblelog_popover=!!t.is_tumblelog_popover;var e=this;return!t.force&&e.has("highlighted_posts")?a.when(e.get("highlighted_posts")):s(e,t).then(r.bindKey(e,"fetch_popover_data",void 0))},fetch_analytics_data:function(){return o(this,{include_member_data:!0,include_activity_data:!0})},toggle_spam:function(){return a.ajax({url:"/spam/toggle",type:"POST",data:{tumblelog:this.id},with_form_key:!0})},toggle_nsfw:function(){return a.ajax({url:"/nsfw/toggle",type:"POST",data:{tumblelog:this.id},with_form_key:!0})},toggle_suspended:function(){return a.ajax({url:"/suspended/toggle",type:"POST",data:{tumblelog:this.id},with_form_key:!0})},follow:function(t){this.save_following({following:!0},t)},_unfollow:function(t){this.save_following({following:!1},t)},requestUnfollow:function(t){var e=l.defer();return e.promise.then(r.bind(this._unfollow,this,t)).catch(r.noop),e},ignore:function(){return a.ajax({url:"/svc/ignore/add",type:"POST",data:{tumblelog:this.id},with_form_key:!0})},unignore:function(){return a.ajax({url:"/svc/ignore/remove",type:"POST",data:{tumblelog:this.id},with_form_key:!0})},block:function(){return d.block({blockedTumblelog:this.id})},unblock:function(){return d.unblock({blockedTumblelog:this.id})},defaults:null,idAttribute:"name",initialize:function(){this.bindEvents()},bindEvents:function(){var t=this.get("name");this.on("change:following",function(){if(void 0!==this.previous("following")){var e=this.get("following")?"tumblelog:follow":"tumblelog:unfollow";h.trigger(e,{name:t,loggingData:t})}},this)},getDisplayName:function(){return this.get(this.get("is_legacy_private_channel")?"directory_safe_title":"name")},parse:function(t){return t},validate:function(){return!1},destroy:function(){return this},fetch:function(){return this},save:function(){return this},url:function(){},urlRoot:function(){}},{collection:null,modelFromToken:function(t){var e,i=p.getCollection(),s=a.Deferred(),o=i.findWhere({token:t});return o?s.resolve(o):(e={data:{is_user_mention:!0}},n(t,e).then(function(e){var i=new p(e);i.set({token:t}),s.resolve(i)},function(){s.reject()})),s.promise()}});p.collection=p.getCollection(),e.exports=p},{"app/lib/block":294,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/singletonmodel":473,when:"RG2dij"}],301:[function(t,e){"use strict";var i=t("prima/singletonmodel"),s=t("prima/model"),o=t("../collections/tumblelogs"),n=i.extend({idAttribute:"name",initialize:function(t){this.channels=new o(t.channels)},getUnreadCount:function(){return this.channels.reduce(function(t,e){return parseInt(t,10)+parseInt(e.get("unread_count"),10)},0)},getChannel:function(t){return null==t&&(t=this.get("primary")),this.channels.findWhere({name:t})},toJSON:function(){var t=s.prototype.toJSON.apply(this,arguments);return t.channels=this.channels.toJSON(),t},getChannelProperty:function(t,e){var i=this.getChannel(t);if(!(i&&"get"in i))return null;var s=i.get(e);return"undefined"==typeof s?null:s}});e.exports=n},{"../collections/tumblelogs":2,"prima/model":471,"prima/singletonmodel":473}],302:[function(t,e){"use strict";var i=t("lodash"),s=t("backbone"),o=t("prima/router"),n=t("prima/lib/data"),a=t("prima/lib/flags"),r=t("./bootloader"),l=o.extend({logs:function(){var e=[t("logs/instruments/embed"),t("logs/instruments/help-form"),t("logs/instruments/keycommands"),t("logs/instruments/login-register"),t("logs/instruments/video-player"),t("logs/instruments/vendor-button"),t("logs/instruments/dashboard-sharing"),t("logs/instruments/related-recommendations"),t("logs/instruments/explore-trending"),t("logs/instruments/mobile-callout"),t("logs/instruments/roadblock"),t("logs/instruments/linkpost-interactions"),t("logs/instruments/abuse-form")],s=a.bool("nav_redesign_activity")&&a.bool("nav_redesign_blog");return s&&e.push(t("logs/instruments/tour-guide-account")),i.union(e,o.prototype.logs.apply(this))},constructor:function(){o.apply(this,arguments),this.startHistory(),this.initializeApp()},getName:function(){return this.name=n.get("Context/name"),i.sprintf("Context/%s",this.name)},initializeApp:function(){{var e=t("app/components/header"),i=(new e,t("app/components/footer"));new i}},startHistory:function(t){s.History.started||i.isEmpty(this.routes)||(this.routeFound=s.history.start({pushState:"pushState"in window.history,hashChange:t?!("pushState"in window.history):!1,root:this.root}))}},{Bootloader:r});e.exports=l},{"./bootloader":1,"app/components/footer":49,"app/components/header":53,backbone:"5kFNoY",lodash:"K2RcUv","logs/instruments/abuse-form":409,"logs/instruments/dashboard-sharing":411,"logs/instruments/embed":412,"logs/instruments/explore-trending":413,"logs/instruments/help-form":414,"logs/instruments/keycommands":415,"logs/instruments/linkpost-interactions":416,"logs/instruments/login-register":417,"logs/instruments/mobile-callout":418,"logs/instruments/related-recommendations":419,"logs/instruments/roadblock":420,"logs/instruments/tour-guide-account":421,"logs/instruments/vendor-button":422,"logs/instruments/video-player":423,"prima/lib/data":431,"prima/lib/flags":"f/LVtH","prima/router":472}],303:[function(t,e){"use strict";var i=t("gif.js/dist/gif").GIF,s=t("./inline-worker"),o=function(t){var e=s;return t||(t={}),t.workerScript||(t.workerScript=e),new i(t)};e.exports=o},{"./inline-worker":304,"gif.js/dist/gif":501}],304:[function(t,e){var i=(window.URL||window.webkitURL||window.mozURL||window.msURL||{}).createObjectURL;i&&(e.exports=i(new Blob(["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error(\"Cannot find module '\"+o+\"'\")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n(function(b){function a(b,d){if({}.hasOwnProperty.call(a.cache,b))return a.cache[b];var e=a.resolve(b);if(!e)throw new Error('Failed to resolve module '+b);var c={id:b,require:a,filename:b,exports:{},loaded:!1,parent:d,children:[]};d&&d.children.push(c);var f=b.slice(0,b.lastIndexOf('/')+1);return a.cache[b]=c.exports,e.call(c.exports,c,c.exports,f,b),c.loaded=!0,a.cache[b]=c.exports}a.modules={},a.cache={},a.resolve=function(b){return{}.hasOwnProperty.call(a.modules,b)?a.modules[b]:void 0},a.define=function(b,c){a.modules[b]=c},a.define('/gif.worker.coffee',function(d,e,f,g){var b,c;b=a('/GIFEncoder.js',d),c=function(a){var c,e,d,f;return c=new b(a.width,a.height),a.index===0?c.writeHeader():c.firstFrame=!1,c.setTransparent(a.transparent),c.setRepeat(a.repeat),c.setDelay(a.delay),c.setQuality(a.quality),c.addFrame(a.data),a.last&&c.finish(),d=c.stream(),a.data=d.pages,a.cursor=d.cursor,a.pageSize=d.constructor.pageSize,a.canTransfer?(f=function(c){for(var b=0,d=a.data.length;b<d;++b)e=a.data[b],c.push(e.buffer);return c}.call(this,[]),self.postMessage(a,f)):self.postMessage(a)},self.onmessage=function(a){return c(a.data)}}),a.define('/GIFEncoder.js',function(e,h,i,j){function c(){this.page=-1,this.pages=[],this.newPage()}function b(a,b){this.width=~~a,this.height=~~b,this.transparent=null,this.transIndex=0,this.repeat=-1,this.delay=0,this.image=null,this.pixels=null,this.indexedPixels=null,this.colorDepth=null,this.colorTab=null,this.usedEntry=new Array,this.palSize=7,this.dispose=-1,this.firstFrame=!0,this.sample=10,this.out=new c}var f=a('/TypedNeuQuant.js',e),g=a('/LZWEncoder.js',e);c.pageSize=4096,c.charMap={};for(var d=0;d<256;d++)c.charMap[d]=String.fromCharCode(d);c.prototype.newPage=function(){this.pages[++this.page]=new Uint8Array(c.pageSize),this.cursor=0},c.prototype.getData=function(){var d='';for(var a=0;a<this.pages.length;a++)for(var b=0;b<c.pageSize;b++)d+=c.charMap[this.pages[a][b]];return d},c.prototype.writeByte=function(a){this.cursor>=c.pageSize&&this.newPage(),this.pages[this.page][this.cursor++]=a},c.prototype.writeUTFBytes=function(b){for(var c=b.length,a=0;a<c;a++)this.writeByte(b.charCodeAt(a))},c.prototype.writeBytes=function(b,d,e){for(var c=e||b.length,a=d||0;a<c;a++)this.writeByte(b[a])},b.prototype.setDelay=function(a){this.delay=Math.round(a/10)},b.prototype.setFrameRate=function(a){this.delay=Math.round(100/a)},b.prototype.setDispose=function(a){a>=0&&(this.dispose=a)},b.prototype.setRepeat=function(a){this.repeat=a},b.prototype.setTransparent=function(a){this.transparent=a},b.prototype.addFrame=function(a){this.image=a,this.getImagePixels(),this.analyzePixels(),this.firstFrame&&(this.writeLSD(),this.writePalette(),this.repeat>=0&&this.writeNetscapeExt()),this.writeGraphicCtrlExt(),this.writeImageDesc(),this.firstFrame||this.writePalette(),this.writePixels(),this.firstFrame=!1},b.prototype.finish=function(){this.out.writeByte(59)},b.prototype.setQuality=function(a){a<1&&(a=1),this.sample=a},b.prototype.writeHeader=function(){this.out.writeUTFBytes('GIF89a')},b.prototype.analyzePixels=function(){var g=this.pixels.length,d=g/3;this.indexedPixels=new Uint8Array(d);var a=new f(this.pixels,this.sample);a.buildColormap(),this.colorTab=a.getColormap();var b=0;for(var c=0;c<d;c++){var e=a.lookupRGB(this.pixels[b++]&255,this.pixels[b++]&255,this.pixels[b++]&255);this.usedEntry[e]=!0,this.indexedPixels[c]=e}this.pixels=null,this.colorDepth=8,this.palSize=7,this.transparent!==null&&(this.transIndex=this.findClosest(this.transparent))},b.prototype.findClosest=function(e){if(this.colorTab===null)return-1;var k=(e&16711680)>>16,l=(e&65280)>>8,m=e&255,c=0,d=16777216,j=this.colorTab.length;for(var a=0;a<j;){var f=k-(this.colorTab[a++]&255),g=l-(this.colorTab[a++]&255),h=m-(this.colorTab[a]&255),i=f*f+g*g+h*h,b=parseInt(a/3);this.usedEntry[b]&&i<d&&(d=i,c=b),a++}return c},b.prototype.getImagePixels=function(){var a=this.width,g=this.height;this.pixels=new Uint8Array(a*g*3);var b=this.image,c=0;for(var d=0;d<g;d++)for(var e=0;e<a;e++){var f=d*a*4+e*4;this.pixels[c++]=b[f],this.pixels[c++]=b[f+1],this.pixels[c++]=b[f+2]}},b.prototype.writeGraphicCtrlExt=function(){this.out.writeByte(33),this.out.writeByte(249),this.out.writeByte(4);var b,a;this.transparent===null?(b=0,a=0):(b=1,a=2),this.dispose>=0&&(a=dispose&7),a<<=2,this.out.writeByte(0|a|0|b),this.writeShort(this.delay),this.out.writeByte(this.transIndex),this.out.writeByte(0)},b.prototype.writeImageDesc=function(){this.out.writeByte(44),this.writeShort(0),this.writeShort(0),this.writeShort(this.width),this.writeShort(this.height),this.firstFrame?this.out.writeByte(0):this.out.writeByte(128|this.palSize)},b.prototype.writeLSD=function(){this.writeShort(this.width),this.writeShort(this.height),this.out.writeByte(240|this.palSize),this.out.writeByte(0),this.out.writeByte(0)},b.prototype.writeNetscapeExt=function(){this.out.writeByte(33),this.out.writeByte(255),this.out.writeByte(11),this.out.writeUTFBytes('NETSCAPE2.0'),this.out.writeByte(3),this.out.writeByte(1),this.writeShort(this.repeat),this.out.writeByte(0)},b.prototype.writePalette=function(){this.out.writeBytes(this.colorTab);var b=768-this.colorTab.length;for(var a=0;a<b;a++)this.out.writeByte(0)},b.prototype.writeShort=function(a){this.out.writeByte(a&255),this.out.writeByte(a>>8&255)},b.prototype.writePixels=function(){var a=new g(this.width,this.height,this.indexedPixels,this.colorDepth);a.encode(this.out)},b.prototype.stream=function(){return this.out},e.exports=b}),a.define('/LZWEncoder.js',function(e,g,h,i){function f(y,D,C,B){function w(a,b){r[f++]=a,f>=254&&t(b)}function x(b){u(a),k=i+2,j=!0,l(i,b)}function u(b){for(var a=0;a<b;++a)h[a]=-1}function A(z,r){var g,t,d,e,y,w,s;for(q=z,j=!1,n_bits=q,m=p(n_bits),i=1<<z-1,o=i+1,k=i+2,f=0,e=v(),s=0,g=a;g<65536;g*=2)++s;s=8-s,w=a,u(w),l(i,r);a:while((t=v())!=c){if(g=(t<<b)+e,d=t<<s^e,h[d]===g){e=n[d];continue}if(h[d]>=0){y=w-d,d===0&&(y=1);do if((d-=y)<0&&(d+=w),h[d]===g){e=n[d];continue a}while(h[d]>=0)}l(e,r),e=t,k<1<<b?(n[d]=k++,h[d]=g):x(r)}l(e,r),l(o,r)}function z(a){a.writeByte(s),remaining=y*D,curPixel=0,A(s+1,a),a.writeByte(0)}function t(a){f>0&&(a.writeByte(f),a.writeBytes(r,0,f),f=0)}function p(a){return(1<<a)-1}function v(){if(remaining===0)return c;--remaining;var a=C[curPixel++];return a&255}function l(a,c){g&=d[e],e>0?g|=a<<e:g=a,e+=n_bits;while(e>=8)w(g&255,c),g>>=8,e-=8;if((k>m||j)&&(j?(m=p(n_bits=q),j=!1):(++n_bits,n_bits==b?m=1<<b:m=p(n_bits))),a==o){while(e>0)w(g&255,c),g>>=8,e-=8;t(c)}}var s=Math.max(2,B),r=new Uint8Array(256),h=new Int32Array(a),n=new Int32Array(a),g,e=0,f,k=0,m,j=!1,q,i,o;this.encode=z}var c=-1,b=12,a=5003,d=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];e.exports=f}),a.define('/TypedNeuQuant.js',function(A,F,E,D){function C(A,B){function I(){o=[],q=new Int32Array(256),t=new Int32Array(a),y=new Int32Array(a),z=new Int32Array(a>>3);var c,d;for(c=0;c<a;c++)d=(c<<b+8)/a,o[c]=new Float64Array([d,d,d,0]),y[c]=e/a,t[c]=0}function J(){for(var c=0;c<a;c++)o[c][0]>>=b,o[c][1]>>=b,o[c][2]>>=b,o[c][3]=c}function K(b,a,c,e,f){o[a][0]-=b*(o[a][0]-c)/d,o[a][1]-=b*(o[a][1]-e)/d,o[a][2]-=b*(o[a][2]-f)/d}function L(j,e,n,l,k){var h=Math.abs(e-j),i=Math.min(e+j,a),g=e+1,f=e-1,m=1,b,d;while(g<i||f>h)d=z[m++],g<i&&(b=o[g++],b[0]-=d*(b[0]-n)/c,b[1]-=d*(b[1]-l)/c,b[2]-=d*(b[2]-k)/c),f>h&&(b=o[f--],b[0]-=d*(b[0]-n)/c,b[1]-=d*(b[1]-l)/c,b[2]-=d*(b[2]-k)/c)}function C(p,s,q){var h=2147483647,k=h,d=-1,m=d,c,j,e,n,l;for(c=0;c<a;c++)j=o[c],e=Math.abs(j[0]-p)+Math.abs(j[1]-s)+Math.abs(j[2]-q),e<h&&(h=e,d=c),n=e-(t[c]>>i-b),n<k&&(k=n,m=c),l=y[c]>>g,y[c]-=l,t[c]+=l<<f;return y[d]+=x,t[d]-=r,m}function D(){var d,b,e,c,h,g,f=0,i=0;for(d=0;d<a;d++){for(e=o[d],h=d,g=e[1],b=d+1;b<a;b++)c=o[b],c[1]<g&&(h=b,g=c[1]);if(c=o[h],d!=h&&(b=c[0],c[0]=e[0],e[0]=b,b=c[1],c[1]=e[1],e[1]=b,b=c[2],c[2]=e[2],e[2]=b,b=c[3],c[3]=e[3],e[3]=b),g!=f){for(q[f]=i+d>>1,b=f+1;b<g;b++)q[b]=d;f=g,i=d}}for(q[f]=i+n>>1,b=f+1;b<256;b++)q[b]=n}function E(j,i,k){var b,d,c,e=1e3,h=-1,f=q[i],g=f-1;while(f<a||g>=0)f<a&&(d=o[f],c=d[1]-i,c>=e?f=a:(f++,c<0&&(c=-c),b=d[0]-j,b<0&&(b=-b),c+=b,c<e&&(b=d[2]-k,b<0&&(b=-b),c+=b,c<e&&(e=c,h=d[3])))),g>=0&&(d=o[g],c=i-d[1],c>=e?g=-1:(g--,c<0&&(c=-c),b=d[0]-j,b<0&&(b=-b),c+=b,c<e&&(b=d[2]-k,b<0&&(b=-b),c+=b,c<e&&(e=c,h=d[3]))));return h}function F(){var c,f=A.length,D=30+(B-1)/3,y=f/(3*B),q=~~(y/w),n=d,o=u,a=o>>h;for(a<=1&&(a=0),c=0;c<a;c++)z[c]=n*((a*a-c*c)*m/(a*a));var i;f<s?(B=1,i=3):f%l!==0?i=3*l:f%k!==0?i=3*k:f%p!==0?i=3*p:i=3*j;var r,t,x,e,g=0;c=0;while(c<y)if(r=(A[g]&255)<<b,t=(A[g+1]&255)<<b,x=(A[g+2]&255)<<b,e=C(r,t,x),K(n,e,r,t,x),a!==0&&L(a,e,r,t,x),g+=i,g>=f&&(g-=f),c++,q===0&&(q=1),c%q===0)for(n-=n/D,o-=o/v,a=o>>h,a<=1&&(a=0),e=0;e<a;e++)z[e]=n*((a*a-e*e)*m/(a*a))}function G(){I(),F(),J(),D()}function H(){var b=[],g=[];for(var c=0;c<a;c++)g[o[c][3]]=c;var d=0;for(var e=0;e<a;e++){var f=g[e];b[d++]=o[f][0],b[d++]=o[f][1],b[d++]=o[f][2]}return b}var o,q,t,y,z;this.buildColormap=G,this.getColormap=H,this.lookupRGB=E}var w=100,a=256,n=a-1,b=4,i=16,e=1<<i,f=10,B=1<<f,g=10,x=e>>g,r=e<<f-g,z=a>>3,h=6,t=1<<h,u=z*t,v=30,o=10,d=1<<o,q=8,m=1<<q,y=o+q,c=1<<y,l=499,k=491,p=487,j=503,s=3*j;A.exports=C}),a('/gif.worker.coffee')}.call(this,this))\n//# sourceMappingURL=gif.worker.js.map\n// gif.worker.js 0.1.6 - https://github.com/jnordberg/gif.js\n\n},{}]},{},[1])"],{type:"text/javascript"})))},{}],305:[function(t,e){"use strict";var i=function(){},s=e.exports={};s.stringIsClean=function(t){for(var e=0;e<t.length;e++)if(t.charCodeAt(e)<32)return!1;return!0},s.parseNum=function(t,e,i,s){var o,n,a=">"===t;for(void 0===i&&(i=0),void 0===s&&(s=e.length-i),o=a?i:i+s-1;a?i+s>o:o>=i;a?o++:o--)n<<=8,n+=e.charCodeAt(o);return n},s.parseSnum=function(t,e,i,s){var o,n,a,r=">"===t;for(void 0===i&&(i=0),void 0===s&&(s=e.length-i),o=r?i:i+s-1;r?i+s>o:o>=i;r?o++:o--)void 0===a&&(a=128===(128&e.charCodeAt(o))),n<<=8,n+=a?255&~e.charCodeAt(o):e.charCodeAt(o);return a&&(n+=1,n*=-1),n},s.Rational=function(t,e){return this.num=t,this.den=e||1,this},s.Rational.prototype.toString=function(){return 0===this.num?""+this.num:1===this.den?""+this.num:1===this.num?this.num+" / "+this.den:this.num/this.den},s.Rational.prototype.asFloat=function(){return this.num/this.den},s.MetaGroup=function(t,e){return this.fieldName=t,this.description=e,this.metaProps={},this},s.MetaGroup.prototype._addProperty=function(t,e,i){var o=new s.MetaProp(t,e,i);
this[o.fieldName]=o,this.metaProps[o.fieldName]=o},s.MetaGroup.prototype.toString=function(){return"[MetaGroup "+this.description+"]"},s.MetaProp=function(t,e,i){return this.fieldName=t,this.description=e,this.value=i,this},s.MetaProp.prototype.toString=function(){return""+this.value},s.JpegFile=function(t,e){var i=this._SOS;this.metaGroups={},this._binary_data=t,this.filename=e;var o,n,a,r,l,h,d,c=0,u=0;if(this._binary_data.slice(0,2)!==this._SOI_MARKER)throw new Error("Doesn't look like a JPEG file. First two bytes are "+this._binary_data.charCodeAt(0)+","+this._binary_data.charCodeAt(1)+".");for(c+=2;c<this._binary_data.length&&(o=this._binary_data.charCodeAt(c++),n=this._binary_data.charCodeAt(c++),u=c,o==this._DELIM)&&n!==i;){for(l=s.parseNum(">",this._binary_data,c,2),c+=l;c<this._binary_data.length;)if(o=this._binary_data.charCodeAt(c++),o==this._DELIM&&(a=this._binary_data.charCodeAt(c++),0!==a)){c-=2;break}r=c-u,this._markers[n]?(h=this._markers[n][0],d=this._markers[n][1]):(h="UNKN",d=void 0),d&&this[d](n,u+2)}if(void 0===this.general)throw Error("Invalid JPEG file.");return this},s.JpegFile.prototype.toString=function(){return"[JpegFile "+this.filename+" "+this.general.type+" "+this.general.pixelWidth+"x"+this.general.pixelHeight+" Depth: "+this.general.depth+"]"},s.JpegFile.prototype._SOI_MARKER="ÿØ",s.JpegFile.prototype._DELIM=255,s.JpegFile.prototype._EOI=217,s.JpegFile.prototype._SOS=218,s.JpegFile.prototype._sofHandler=function(t,e){if(void 0!==this.general)throw Error("Unexpected multiple-frame image");this._addMetaGroup("general","General"),this.general._addProperty("depth","Depth",s.parseNum(">",this._binary_data,e,1)),this.general._addProperty("pixelHeight","Pixel Height",s.parseNum(">",this._binary_data,e+1,2)),this.general._addProperty("pixelWidth","Pixel Width",s.parseNum(">",this._binary_data,e+3,2)),this.general._addProperty("type","Type",this._markers[t][2])},s.JpegFile.prototype._JFIF_IDENT="JFIF\x00",s.JpegFile.prototype._JFXX_IDENT="JFXX\x00",s.JpegFile.prototype._EXIF_IDENT="Exif\x00",s.JpegFile.prototype._types={1:["BYTE",1],2:["ASCII",1],3:["SHORT",2],4:["LONG",4],5:["RATIONAL",8],6:["SBYTE",1],7:["UNDEFINED",1],8:["SSHORT",2],9:["SLONG",4],10:["SRATIONAL",8],11:["FLOAT",4],12:["DOUBLE",8]},s.JpegFile.prototype._tifftags={256:["Image width","ImageWidth"],257:["Image height","ImageLength"],258:["Number of bits per component","BitsPerSample"],259:["Compression scheme","Compression",{1:"uncompressed",6:"JPEG compression"}],262:["Pixel composition","PhotmetricInerpretation",{2:"RGB",6:"YCbCr"}],274:["Orientation of image","Orientation",{1:"Normal",2:"Reverse?",3:"Upside-down",4:"Upside-down Reverse",5:"90 degree CW",6:"90 degree CW reverse",7:"90 degree CCW",8:"90 degree CCW reverse"}],277:["Number of components","SamplesPerPixel"],284:["Image data arrangement","PlanarConfiguration",{1:"chunky format",2:"planar format"}],530:["Subsampling ratio of Y to C","YCbCrSubSampling"],531:["Y and C positioning","YCbCrPositioning",{1:"centered",2:"co-sited"}],282:["X Resolution","XResolution"],283:["Y Resolution","YResolution"],296:["Resolution Unit","ResolutionUnit",{2:"inches",3:"centimeters"}],273:["Image data location","StripOffsets"],278:["Number of rows per strip","RowsPerStrip"],279:["Bytes per compressed strip","StripByteCounts"],513:["Offset to JPEG SOI","JPEGInterchangeFormat"],514:["Bytes of JPEG Data","JPEGInterchangeFormatLength"],301:["Transfer function","TransferFunction"],318:["White point chromaticity","WhitePoint"],319:["Chromaticities of primaries","PrimaryChromaticities"],529:["Color space transformation matrix coefficients","YCbCrCoefficients"],532:["Pair of black and white reference values","ReferenceBlackWhite"],306:["Date and time","DateTime"],270:["Image title","ImageDescription"],271:["Make","Make"],272:["Model","Model"],305:["Software","Software"],315:["Person who created the image","Artist"],316:["Host Computer","HostComputer"],33432:["Copyright holder","Copyright"],34665:["Exif tag","ExifIfdPointer"],34853:["GPS tag","GPSInfoIfdPointer"]},s.JpegFile.prototype._exiftags={36864:["Exif Version","ExifVersion"],40960:["FlashPix Version","FlashpixVersion"],40961:["Color Space","ColorSpace"],37121:["Meaning of each component","ComponentsConfiguration"],37122:["Compressed Bits Per Pixel","CompressedBitsPerPixel"],40962:["Pixel X Dimension","PixelXDimension"],40963:["Pixel Y Dimension","PixelYDimension"],37500:["Manufacturer notes","MakerNote"],37510:["User comments","UserComment"],40964:["Related audio file","RelatedSoundFile"],36867:["Date Time Original","DateTimeOriginal"],36868:["Date Time Digitized","DateTimeDigitized"],37520:["DateTime subseconds","SubSecTime"],37521:["DateTimeOriginal subseconds","SubSecTimeOriginal"],37522:["DateTimeDigitized subseconds","SubSecTimeDigitized"],33434:["Exposure time","ExposureTime"],33437:["FNumber","FNumber"],34850:["Exposure program","ExposureProgram"],34852:["Spectral sensitivity","SpectralSensitivity"],34855:["ISO Speed Ratings","ISOSpeedRatings"],34856:["Optoelectric coefficient","OECF"],37377:["Shutter Speed","ShutterSpeedValue"],37378:["Aperture Value","ApertureValue"],37379:["Brightness","BrightnessValue"],37380:["Exposure Bias Value","ExposureBiasValue"],37381:["Max Aperture Value","MaxApertureValue"],37382:["Subject Distance","SubjectDistance"],37383:["Metering Mode","MeteringMode"],37384:["Light Source","LightSource"],37385:["Flash","Flash"],37386:["Focal Length","FocalLength"],37396:["Subject Area","SubjectArea"],41483:["Flash Energy","FlashEnergy"],41484:["Spatial Frequency Response","SpatialFrequencyResponse"],41486:["Focal Plane X Resolution","FocalPlaneXResolution"],41487:["Focal Plane Y Resolution","FocalPlaneYResolution"],41488:["Focal Plane Resolution Unit","FocalPlaneResolutionUnit"],41492:["Subject Location","SubjectLocation"],41493:["Exposure Index","ExposureIndex"],41495:["Sensing Method","SensingMethod"],41728:["File Source","FileSource"],41729:["Scene Type","SceneType"],41730:["CFA Pattern","CFAPattern"],41985:["Custom Rendered","CustomRendered"],41986:["Exposure Mode","Exposure Mode"],41987:["White Balance","WhiteBalance"],41988:["Digital Zoom Ratio","DigitalZoomRatio"],41989:["Focal length in 35 mm film","FocalLengthIn35mmFilm"],41990:["Scene Capture Type","SceneCaptureType"],41991:["Gain Control","GainControl"],41992:["Contrast","Contrast"],41993:["Saturation","Saturation"],41994:["Sharpness","Sharpness"],41995:["Device settings description","DeviceSettingDescription"],41996:["Subject distance range","SubjectDistanceRange"],42016:["Unique image ID","ImageUniqueID"],40965:["Interoperability tag","InteroperabilityIFDPointer"]},s.JpegFile.prototype._gpstags={0:["GPS tag version","GPSVersionID"],1:["North or South Latitude","GPSLatitudeRef"],2:["Latitude","GPSLatitude"],3:["East or West Longitude","GPSLongitudeRef"],4:["Longitude","GPSLongitude"],5:["Altitude reference","GPSAltitudeRef"],6:["Altitude","GPSAltitude"],7:["GPS time (atomic clock)","GPSTimeStamp"],8:["GPS satellites usedd for measurement","GPSSatellites"],9:["GPS receiver status","GPSStatus"],10:["GPS mesaurement mode","GPSMeasureMode"],11:["Measurement precision","GPSDOP"],12:["Speed unit","GPSSpeedRef"],13:["Speed of GPS receiver","GPSSpeed"],14:["Reference for direction of movement","GPSTrackRef"],15:["Direction of movement","GPSTrack"],16:["Reference for direction of image","GPSImgDirectionRef"],17:["Direction of image","GPSImgDirection"],18:["Geodetic survey data used","GPSMapDatum"],19:["Reference for latitude of destination","GPSDestLatitudeRef"],20:["Latitude of destination","GPSDestLatitude"],21:["Reference for longitude of destination","GPSDestLongitudeRef"],22:["Longitude of destination","GPSDestLongitude"],23:["Reference for bearing of destination","GPSDestBearingRef"],24:["Bearing of destination","GPSDestBearing"],25:["Reference for distance to destination","GPSDestDistanceRef"],26:["Distance to destination","GPSDestDistance"],27:["Name of GPS processing method","GPSProcessingMethod"],28:["Name of GPS area","GPSAreaInformation"],29:["GPS Date","GPSDateStamp"],30:["GPS differential correction","GPSDifferential"]},s.JpegFile.prototype._markers={192:["SOF0","_sofHandler","Baseline DCT"],193:["SOF1","_sofHandler","Extended sequential DCT"],194:["SOF2","_sofHandler","Progressive DCT"],195:["SOF3","_sofHandler","Lossless (sequential)"],197:["SOF5","_sofHandler","Differential sequential DCT"],198:["SOF6","_sofHandler","Differential progressive DCT"],199:["SOF7","_sofHandler","Differential lossless (sequential)"],200:["JPG",null,"Reserved for JPEG extensions"],201:["SOF9","_sofHandler","Extended sequential DCT"],202:["SOF10","_sofHandler","Progressive DCT"],203:["SOF11","_sofHandler","Lossless (sequential)"],205:["SOF13","_sofHandler","Differential sequential DCT"],206:["SOF14","_sofHandler","Differential progressive DCT"],207:["SOF15","_sofHandler","Differential lossless (sequential)"],196:["DHT",null,"Define Huffman table(s)"],204:["DAC",null,"Define arithmetic coding conditioning(s)"],208:["RST0",null,"Restart with modulo 8 count “0”"],209:["RST1",null,"Restart with modulo 8 count “1”"],210:["RST2",null,"Restart with modulo 8 count “2”"],211:["RST3",null,"Restart with modulo 8 count “3”"],212:["RST4",null,"Restart with modulo 8 count “4”"],213:["RST5",null,"Restart with modulo 8 count “5”"],214:["RST6",null,"Restart with modulo 8 count “6”"],215:["RST7",null,"Restart with modulo 8 count “7”"],216:["SOI",null,"Start of image"],217:["EOI",null,"End of image"],218:["SOS",null,"Start of scan"],219:["DQT",null,"Define quantization table(s)"],220:["DNL",null,"Define number of lines"],221:["DRI",null,"Define restart interval"],222:["DHP",null,"Define hierarchical progression"],223:["EXP",null,"Expand reference component(s)"],224:["APP0","_app0Handler","Reserved for application segments"],225:["APP1","_app1Handler"],226:["APP2",null],227:["APP3",null],228:["APP4",null],229:["APP5",null],230:["APP6",null],231:["APP7",null],232:["APP8",null],233:["APP9",null],234:["APP10",null],235:["APP11",null],236:["APP12",null],237:["APP13",null],238:["APP14",null],239:["APP15",null],240:["JPG0",null],241:["JPG1",null],242:["JPG2",null],243:["JPG3",null],244:["JPG4",null],245:["JPG5",null],246:["JPG6",null],247:["JPG7",null],248:["JPG8",null],249:["JPG9",null],250:["JPG10",null],251:["JPG11",null],252:["JPG12",null],253:["JPG13",null],254:["COM",null],1:["JPG13",null]},s.JpegFile.prototype._addMetaGroup=function(t,e){var i=new s.MetaGroup(t,e);return this[i.fieldName]=i,this.metaGroups[i.fieldName]=i,i},s.JpegFile.prototype._parseIfd=function(t,e,o,n,a,r,l){var h,d,c,u,p,m,g,f,_,v,b,y=s.parseNum(t,e,o+n,2);b=this._addMetaGroup(r,l);for(var w=0;y>w;w++)if(h=o+n+2+12*w,d=s.parseNum(t,e,h,2),u=s.parseNum(t,e,h+2,2),m=s.parseNum(t,e,h+4,4),g=s.parseNum(t,e,h+8,4),void 0!==this._types[u]){if(c=this._types[u][0],p=this._types[u][1],g=4>=p*m?h+8:o+g,"UNDEFINED"==c)f=void 0;else if("ASCII"==c)f=e.slice(g,g+m),f=f.split("\x00")[0],s.stringIsClean(f)||(f="");else{f=[];for(var x=0;m>x;x++,g+=p)("BYTE"==c||"SHORT"==c||"LONG"==c)&&f.push(s.parseNum(t,e,g,p)),("SBYTE"==c||"SSHORT"==c||"SLONG"==c)&&f.push(s.parseSnum(t,e,g,p)),"RATIONAL"==c&&(_=s.parseNum(t,e,g,4),v=s.parseNum(t,e,g+4,4),f.push(new s.Rational(_,v))),"SRATIONAL"==c&&(_=s.parseSnum(t,e,g,4),v=s.parseSnum(t,e,g+4,4),f.push(new s.Rational(_,v))),f.push();1===m&&(f=f[0])}a.hasOwnProperty(d)?b._addProperty(a[d][1],a[d][0],f):i("WARNING(jpegmeta.js): Unknown tag: ",d)}},s.JpegFile.prototype._jfifHandler=function(t,e){if(void 0!==this.jfif)throw Error("Multiple JFIF segments found");this._addMetaGroup("jfif","JFIF"),this.jfif._addProperty("version_major","Version Major",this._binary_data.charCodeAt(e+5)),this.jfif._addProperty("version_minor","Version Minor",this._binary_data.charCodeAt(e+6)),this.jfif._addProperty("version","JFIF Version",this.jfif.version_major.value+"."+this.jfif.version_minor.value),this.jfif._addProperty("units","Density Unit",this._binary_data.charCodeAt(e+7)),this.jfif._addProperty("Xdensity","X density",s.parseNum(">",this._binary_data,e+8,2)),this.jfif._addProperty("Ydensity","Y Density",s.parseNum(">",this._binary_data,e+10,2)),this.jfif._addProperty("Xthumbnail","X Thumbnail",s.parseNum(">",this._binary_data,e+12,1)),this.jfif._addProperty("Ythumbnail","Y Thumbnail",s.parseNum(">",this._binary_data,e+13,1))},s.JpegFile.prototype._app0Handler=function(t,e){var i=this._binary_data.slice(e,e+5);i==this._JFIF_IDENT?this._jfifHandler(t,e):i==this._JFXX_IDENT},s.JpegFile.prototype._app1Handler=function(t,e){var i=this._binary_data.slice(e,e+5);i==this._EXIF_IDENT&&this._exifHandler(t,e+6)},s.JpegFile.prototype._exifHandler=function(t,e){if(void 0!==this.exif)throw new Error("Multiple JFIF segments found");var i,o,n,a=this._binary_data.slice(e,e+2);if("II"===a)i="<";else{if("MM"!==a)throw new Error("Malformed TIFF meta-data. Unknown endianess: "+a);i=">"}if(o=s.parseNum(i,this._binary_data,e+2,2),42!==o)throw new Error("Malformed TIFF meta-data. Bad magic: "+o);if(n=s.parseNum(i,this._binary_data,e+4,4),this._parseIfd(i,this._binary_data,e,n,this._tifftags,"tiff","TIFF"),this.tiff.ExifIfdPointer&&this._parseIfd(i,this._binary_data,e,this.tiff.ExifIfdPointer.value,this._exiftags,"exif","Exif"),this.tiff.GPSInfoIfdPointer){if(this._parseIfd(i,this._binary_data,e,this.tiff.GPSInfoIfdPointer.value,this._gpstags,"gps","GPS"),this.gps.GPSLatitude){var r;r=this.gps.GPSLatitude.value[0].asFloat()+1/60*this.gps.GPSLatitude.value[1].asFloat()+1/3600*this.gps.GPSLatitude.value[2].asFloat(),"S"===this.gps.GPSLatitudeRef.value&&(r=-r),this.gps._addProperty("latitude","Dec. Latitude",r)}if(this.gps.GPSLongitude){var l;l=this.gps.GPSLongitude.value[0].asFloat()+1/60*this.gps.GPSLongitude.value[1].asFloat()+1/3600*this.gps.GPSLongitude.value[2].asFloat(),"W"===this.gps.GPSLongitudeRef.value&&(l=-l),this.gps._addProperty("longitude","Dec. Longitude",l)}}}},{}],306:[function(t,e){"use strict";var i=t("prima/component"),s=t("prima/events"),o=t("app/components/drawer"),n=t("./views/abuseformview.js"),a=i.extend({name:"AbuseForm",initialize:function(){this.drawerManager=o(),this.bindEvents()},bindEvents:function(){this.listenTo(s,"abuseform:open",this.open),this.listenTo(s,"abuseform:close",this.close)},close:function(){this.drawerManager.close()},open:function(t){this.drawerManager.canOpen()?this.drawerManager.open(n,t):this.drawerManager.close()}},{CONTEXTS:n.CONTEXTS});e.exports=a},{"./views/abuseformview.js":316,"app/components/drawer":44,"prima/component":428,"prima/events":429}],307:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="form-container form"><div class="survey"><div class="survey-step"></div></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],308:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="content-preview-toggle toggle-preview"><span class="hide-preview">'+(null==(__t=__("Hide"))?"":_.escape(__t))+'</span> <span class="show-preview">'+(null==(__t=__("Show"))?"":_.escape(__t))+'</span></div><div class="content-preview-container"></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],309:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="",errors?(__p+="",_.each(errors,function(t){__p+='<div class="error-message"><div class="error-text">'+(null==(__t=t.error)?"":__t)+"</div></div>"}),__p+=""):__p+='<div class="error-message"><div class="error-text">'+(null==(__t=__("Oops. There was an error. Try again."))?"":__t)+"</div></div>",__p+="";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],310:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="form-container success"><div class="success-message"><h1 class="message-title">'+(null==(__t=__("Got it"))?"":__t)+'</h1><p class="message-text">'+(null==(__t=__("It may take us a day or two, but we're on the case and we'll get back to you as quickly as we can."))?"":__t)+'</p><p class="message-text">'+(null==(__t=__("Also: We know it's tempting to submit the same thing a few times in hopes that it'll get addressed sooner, but really it just clogs up our system and makes it harder for us respond quickly. We're kind of like an elevator button."))?"":__t)+"</p></div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],311:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<form class="survey-result" data-abuse-form><input type="hidden" name="form_key" value="'+(null==(__t=formKey)?"":__t)+'"> <input type="hidden" name="abuse_type" value="'+(null==(__t=formName)?"":__t)+'">',languageNotice&&(__p+='<div class="form-row"><span class="language-notice">'+(null==(__t=__("Just so you know, we're not yet able to address queries that are written in [language]. You can still use this form to contact our Support team, but you'll need to fill it out in English. Sorry about that, and thanks for your patience."))?"":__t)+"</span></div>"),__p+="",_.each(form,function(t){__p+='<div class="form-row"><div class="row-label">'+(null==(__t=__(t.groupLabel))?"":__t)+'</div><div class="row-content">',_.each(t.fields,function(t){__p+='<div class="row-field">',"text"===t.type?(__p+="",__p+="undefined"!=typeof t.link?"<p>"+(null==(__t=__(t.text,'<a target="_blank" href="/abuse/'+t.link+'">',"</a>"))?"":__t)+"</p>":"<p>"+(null==(__t=__(t.text))?"":__t)+"</p>",__p+=""):"input"===t.type?(__p+="",__p+=t.optional===!0?'<input class="text_field" name="'+(null==(__t=t.name)?"":__t)+'" placeholder="'+(null==(__t=__(t.placeholder))?"":__t)+'"><div class="optional-tag">'+(null==(__t=__("Optional"))?"":__t)+"</div>":'<input class="text_field" data-validate-input="text" name="'+(null==(__t=t.name)?"":__t)+'" placeholder="'+(null==(__t=__(t.placeholder))?"":__t)+'">',__p+=""):"input-link"===t.type?(__p+="","urlreporting"===t.name&&"standalone"!==mode?(__p+="",posts.length>0?(__p+="",_.each(posts,function(e){__p+=' <input class="text_field input-link" name="'+(null==(__t=t.name)?"":__t)+'[]" value="'+(null==(__t=e.postUrl)?"":_.escape(__t))+'">'}),__p+=""):"undefined"!=typeof tumblelogUrl&&(__p+=' <input class="text_field input-link" name="'+(null==(__t=t.name)?"":__t)+'[]" value="'+(null==(__t=tumblelogUrl)?"":_.escape(__t))+'">'),__p+=""):(__p+="",__p+=t.optional===!0?' <input class="text_field input-link" name="'+(null==(__t=t.name)?"":__t)+'[]" placeholder="'+(null==(__t=__(t.placeholder?t.placeholder:"URL"))?"":__t)+'"><div class="optional-tag">'+(null==(__t=__("Optional"))?"":__t)+"</div>":'<input class="text_field input-link" data-validate-input="text" name="'+(null==(__t=t.name)?"":__t)+'[]" placeholder="'+(null==(__t=__(t.placeholder?t.placeholder:"URL"))?"":__t)+'">',__p+='<div class="url-manipulator" data-original-field-name="'+(null==(__t=t.name)?"":__t)+'[]"><div class="remove-url hidden" data-remove-url-field>'+(null==(__t=__("- Remove"))?"":__t)+'</div><div class="add-url" data-add-url-field>'+(null==(__t=__("+ Add More"))?"":__t)+"</div></div>"),__p+=""):"input-name"===t.type?(__p+="",__p+=t.optional===!0?'<input class="text_field" name="'+(null==(__t=t.name)?"":__t)+'" placeholder="'+(null==(__t=__("Name"))?"":__t)+'"><div class="optional-tag">'+(null==(__t=__("Optional"))?"":__t)+"</div>":'<input class="text_field" data-validate-input="text" name="'+(null==(__t=t.name)?"":__t)+'" placeholder="'+(null==(__t=__("Name"))?"":__t)+'">',__p+=""):"input-email"===t.type?(__p+="",__p+=email?' <input class="text_field" value="'+(null==(__t=email)?"":__t)+'" data-validate-input="email" data-error-text="email" name="'+(null==(__t=t.name)?"":__t)+'" placeholder="'+(null==(__t=__("Email address"))?"":__t)+'">':' <input class="text_field" data-validate-input="email" data-error-text="email" name="'+(null==(__t=t.name)?"":__t)+'" placeholder="'+(null==(__t=__("Email address"))?"":__t)+'">',__p+=""):"textarea"===t.type?__p+='<textarea name="'+(null==(__t=t.name)?"":__t)+'" data-validate-input="text" cols="30" rows="5" placeholder="'+(null==(__t=__(t.placeholder))?"":__t)+'"></textarea>':"file"===t.type?__p+='<div class="image-upload-input"><label class="image-upload" for="image-upload"></label><input id="image-upload" class="image-upload" data-validate-input="file" type="file" name="attachments[]" accept="image/*"></div><div class="image-upload-preview"><img src=""><div class="btn_remove btn-remove-uploaded" data-tooltip="'+(null==(__t=__("Remove image"))?"":__t)+'"></div></div>':"checkbox"===t.type&&(__p+='<div class="checkbox"><input type="checkbox" name="'+(null==(__t=t.name)?"":__t)+'" data-validate-input="checkbox" id="'+(null==(__t=t.name)?"":__t)+'"><label for="'+(null==(__t=t.name)?"":__t)+'">'+(null==(__t=__(t.text))?"":__t)+"</label></div>"),__p+="</div>"}),__p+="</div></div>"}),__p+="</form>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],312:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="survey-result">',_.each(message,function(t){__p+='<div class="form-row">',"text"===t.type?(__p+="",__p+="undefined"!=typeof t.link?"<p>"+(null==(__t=__(t.text,'<a target="_blank" href="/abuse/'+t.link+'">',"</a>"))?"":__t)+"</p>":"<p>"+(null==(__t=__(t.text))?"":__t)+"</p>",__p+=""):"link"===t.type?__p+='<a href="'+(null==(__t=t.href)?"":__t)+'" target="_blank">'+(null==(__t=__(t.text))?"":__t)+"</a>":"highlight"===t.type&&(__p+='<p class="highlight">'+(null==(__t=__(t.text))?"":__t)+"</p>"),__p+="</div>"}),__p+="</div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],313:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="options">',_.each(options,function(t){__p+="",__p+="standalone"!==mode&&"undefined"!=typeof t.flaggingTo?'<div class="option" data-survey-nav-to="'+(null==(__t=t.flaggingTo)?"":__t)+'">'+(null==(__t=__(t.name))?"":__t)+"</div>":'<div class="option" data-survey-nav-to="'+(null==(__t=t.to)?"":__t)+'">'+(null==(__t=__(t.name))?"":__t)+"</div>",__p+=""}),__p+="</div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],314:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="form-row"><h3 class="form-subheading">'+(null==(__t=__("What's going on?"))?"":__t)+'</h3></div><form><div class="form-row"><div class="option-radio"><input type="radio" name="flag" id="flag-nsfw" data-flag-action="nsfw" value="nsfw"></div><label class="option-label" for="flag-nsfw">'+(null==(__t=__("This should be filtered"))?"":__t),safesearch&&(__p+='<div class="sub-label">'+(null==(__t=__("Adult-oriented content is currently being hidden ( %1$s ) but this post still showed up.",'<i class="icon_lock_thick_12"></i>'))?"":__t)+"</div>"),__p+='</label></div><div class="form-row"><div class="option-radio"><input type="radio" name="flag" id="flag-spam" data-flag-action="spam" value="spam"></div><label class="option-label" for="flag-spam">'+(null==(__t=__("This is spam"))?"":__t)+'</label></div><div class="form-row"><div class="option-radio"><input type="radio" name="flag" id="flag-cg" data-flag-action="cg" value="cg"></div><label class="option-label" for="flag-cg">'+(null==(__t=__("This violates Tumblr's %1$sCommunity Guidelines%2$s",'<a class="community_guidelines_link" href="https://www.tumblr.com/policy/community" target="_blank">',"</a>"))?"":__t)+'</label></div><div class="form-row ignore">',__p+=Flags.bool("block_feature")?'<div class="option-radio"><label class="binary_switch"><input type="checkbox" name="block" id="block" checked="checked"> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></label></div><label class="option-label" for="block">'+(null==(__t=__("Block %1$s",tumblelog))?"":__t)+"</label>":'<div class="option-radio"><label class="binary_switch"><input type="checkbox" name="flag_ignore" id="flag_ignore" checked="checked"> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></label></div><label class="option-label" for="flag_ignore">'+(null==(__t=__("Ignore %1$s",tumblelog))?"":__t)+"</label>",__p+='</div><div class="form-row"><button class="chrome big red right flag" type="button" data-submit-flag-form><span class="label">'+(null==(__t=__("Flag"))?"":__t)+'</span> <span class="Knight-Rider-loader animate"><span class="Knight-Rider-bar"></span><span class="Knight-Rider-bar"></span><span class="Knight-Rider-bar"></span></span></button> <button class="chrome big blue right continue" type="button" data-survey-nav-to="abuse"><span class="label">'+(null==(__t=__("Continue"))?"":__t)+"</span></button></div></form>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],315:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="form-row">',hideTitles||(__p+='<h3 class="form-subheading">'+(null==(__t=__(title))?"":__t)+"</h3>"),__p+="","undefined"!=typeof tagline&&(__p+='<p class="form-subheading-tagline '+(null==(__t=hideTitles?"bold":"")?"":__t)+'">'+(null==(__t=__(tagline))?"":__t)+"</p>"),__p+='</div><div class="step-content">'+(null==(__t=stepContent)?"":__t)+'</div><div class="form-row">',displayBackButton&&(__p+='<button class="survey-back-button" data-survey-nav-back>'+(null==(__t=__("Go back"))?"":__t)+"</button>"),__p+="","undefined"!=typeof button&&(__p+="","submit"===button.type?__p+=' <button class="chrome big right blue" data-survey-submit disabled="disabled"><span class="label">'+(null==(__t=__("Submit"))?"":__t)+'</span> <span class="Knight-Rider-loader animate"><span class="Knight-Rider-bar"></span><span class="Knight-Rider-bar"></span><span class="Knight-Rider-bar"></span></span></button>':"dismiss"===button.type&&(__p+=' <button class="chrome big right red" data-survey-dismiss><span class="label">'+(null==(__t=__("Got it"))?"":__t)+"</span></button>"),__p+=""),__p+="</div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],316:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/lib/data"),n=t("prima/events"),a=t("app/models/tumblelog"),r=t("prima/lib/flags"),l=t("components/drawer-form"),h=t("components/drawer-form/views/formheader.js"),d=t("./subviews/contentpreview"),c=t("./subviews/surveyview"),u=t("./subviews/form"),p=t("./subviews/dynamicfields"),m=t("./../templates/abuseform.tpl"),g=t("./../templates/success.tpl"),f=t("./../templates/error_message.tpl"),_=t("./survey/survey-structure"),v=l.extend({templates:{layout:m,success:g,error:f},className:"abuse-form",survey:_,initialize:function(t){if(t=t||{},l.prototype.initialize.call(this,t),this.listenTo(n,"drawer:close",this.teardown),this.contexts=v.CONTEXTS,t.formType&&this.survey[t.formType]){var e="start"===t.formType?"abuse":t.formType;this.set("surveyStep",e),this.mode="standalone"}else t.tumblelog?(this.set("surveyStep","start"),this.mode="blogcard",this.tumblelog=t.tumblelog,this.posts=this.getBlogcardPosts()):t.post?(this.set("surveyStep","start"),this.mode=t.mode===this.contexts.IMAGE?"image":"post",this.tumblelog=t.post.get("tumblelog_name"),this.posts=[{id:t.post.get("post_id"),rootId:t.post.get("root_id"),postUrl:t.post.get("post_url")}]):(this.set("surveyStep","abuse"),this.mode="standalone");t.targetPost&&(this.targetPost=t.targetPost),this.fillTemplateAttributes()},teardown:function(){i("body").removeClass("abuseform-open"),this.selfDestroyTimer&&(clearTimeout(this.selfDestroyTimer),this.selfDestroyTimer=null)},fillTemplateAttributes:function(){var t=o.get("Components/AbuseForm")||{};if(this.templateAttributes.Flags=r,this.templateAttributes.email=t.email,this.templateAttributes.lang=t.lang,this.templateAttributes.languageNotice=t.language_notice,this.templateAttributes.safesearch=i(".nsfw_filter_enabled").length,this.templateAttributes.tumblelog=this.tumblelog,this.templateAttributes.posts=this.posts,this.templateAttributes.mode=this.mode,this.templateAttributes.hideTitles="standalone"===this.mode,"blogcard"===this.mode&&this.tumblelog){var e=new a({name:this.tumblelog});this.templateAttributes.tumblelogUrl=e.get("url")}},getBlogcardPosts:function(){var t=this.getFlaggedContent(),e=t.find(".post"),o=[];return s.each(e,function(t){t=i(t),o.push({id:t.data("id"),rootId:t.data("root_id"),postUrl:t.data("json").share_popover_data.post_url})},this),o},getFlaggedContent:function(){if("post"===this.mode)return i('.post[data-post-id="'+this.posts[0].id+'"]').first();if("blogcard"===this.mode){var t=i(".indash_header_wrapper.tumblelog_name_"+this.tumblelog).first();return 0===t.find(".recent_posts").length&&(t=t.closest(".popover")),t}return"image"===this.mode?this.targetPost:void 0},hideFlaggedContent:function(){if("post"===this.mode)this.getFlaggedContent().addClass("is_flagged");else if("blogcard"===this.mode){var t=this.targetPost||this.getFlaggedContent();t&&t.addClass("is_flagged")}},displaySuccessMessage:function(){this.$el.html(this.templates.success(this.templateAttributes)),n.trigger("drawer:disableCloseConfirmation"),this.selfDestroyTimer&&clearTimeout(this.selfDestroyTimer),this.selfDestroyTimer=setTimeout(function(){n.trigger("abuseform:close")},15e3)},displayErrorMessage:function(t){this.removeErrorMessage(),this.errorMessage=i(this.templates.error(s.extend(this.templateAttributes,{errors:t}))),this.errorMessage.appendTo(this.$surveyStep)},removeErrorMessage:function(){this.errorMessage&&(this.errorMessage.remove(),this.errorMessage=null)},render:function(){return this.$el.append(this.templates.layout(this.templateAttributes)),this.$surveyContainer=this.$(".survey"),this.$surveyStep=this.$(".survey-step"),i("body").addClass("abuseform-open"),this.header=new h({title:this.survey[this.get("surveyStep")].title,description:this.survey[this.get("surveyStep")].description}),this.header.render().$el.insertBefore(this.$surveyContainer),"standalone"!==this.mode&&(this.contentPreview=new d({abuseform:this}),this.contentPreview.render().$el.insertAfter(this.$surveyContainer)),this.formView=new u({el:this.$surveyStep,abuseform:this}),this.surveyView=new c({el:this.$surveyContainer,abuseform:this}),this.surveyView.displaySurveyStep(this.get("surveyStep")),this.dynamicfields=new p({el:this.$surveyContainer}),this}},{CONTEXTS:{POST:"post",IMAGE:"image",BLOGCARD:"blogcard"}});e.exports=v},{"./../templates/abuseform.tpl":307,"./../templates/error_message.tpl":309,"./../templates/success.tpl":310,"./subviews/contentpreview":317,"./subviews/dynamicfields":318,"./subviews/form":320,"./subviews/surveyview":321,"./survey/survey-structure":322,"app/models/tumblelog":300,"components/drawer-form":339,"components/drawer-form/views/formheader.js":344,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/lib/data":431,"prima/lib/flags":"f/LVtH"}],317:[function(t,e){"use strict";
var i=t("jquery"),s=t("lodash"),o=t("prima/lib/translate"),n=t("prima/events"),a=t("prima/view"),r=t("velocity-animate"),l=t("../../templates/contentpreview.tpl"),h=a.extend({className:"content-preview",template:l,templateAttributes:{__:o},animation:{collapseDuration:300,expandDuration:350,easing:[.545,.42,.435,1.065]},events:{"click .toggle-preview":"togglePreview"},initialize:function(t){t=t||{},this.abuseform=t.abuseform,this.mode=t.abuseform.mode,this.tumblelog=t.abuseform.tumblelog,this.posts=t.abuseform.posts,this.listenTo(n,"abuseform:contentpreview:close",this.hidePreview),this.isExpanded=!0},togglePreview:function(){this.isExpanded?this.hidePreview():this.showPreview()},hidePreview:function(){this.isExpanded&&(this.animateContentPreview(!0),this.animatePostContainer(!0),this.isExpanded=!1)},showPreview:function(){this.isExpanded||(this.animateContentPreview(!1,s.bind(this.scrollToPost,this)),this.animatePostContainer(!1),this.isExpanded=!0)},animateContentPreview:function(t,e){var o;if(t)o=i(".form-container").height()-this.$el.position().top+50;else{var n=i(".survey");o=n.outerHeight(!0)+n.position().top-this.$el.position().top}r.animate(this.$el,{translateY:[o,0]},{duration:t?this.animation.collapseDuration:this.animation.expandDuration,easing:this.animation.easing,complete:s.bind(function(){this.$el.toggleClass("is-hidden"),t?r.animate(this.$el,{translateY:[0,50]},{delay:50,duration:this.animation.collapseDuration,complete:s.bind(function(){this.$el.attr("style","")},this)}):this.$el.attr("style",""),"function"==typeof e&&e()},this)})},animatePostContainer:function(t){r.animate(this.$contentPreviewContainer,{translateY:t?[0,0]:[0,200],opacity:t?[0,1]:[1,0],"max-height":t?[0,99999]:[99999,99999]},{delay:.3*(t?this.animation.collapseDuration:this.animation.expandDuration),duration:t?this.animation.collapseDuration:this.animation.expandDuration,easing:this.animation.easing})},scrollToPost:function(){this.$el.velocity("scroll",{container:i(".drawer")})},cloneFlaggedContent:function(){var t=this.abuseform.getFlaggedContent();if(!s.isEmpty(t)){if("post"===this.mode){var e=t.clone();e.hasClass("is_video")&&e.find(".dockable_video_embed").hasClass("docked")&&(e=e.find(".dockable_video_embed"));var i=e.clone();return i.hasClass("post_full")&&i.find(".post_avatar").remove(),i.find(".dock_video_button")&&i.find(".dock_video_button").remove(),i}if("blogcard"===this.mode){var o=t.clone();return o.find(".info_popover").remove(),o.removeClass("tumblelog_popover"),o}if("image"===this.mode)return t.clone()}return!1},render:function(){var t=this.cloneFlaggedContent();return t&&(this.$el.append(this.template(this.templateAttributes)),this.$(".content-preview-container").append(t),this.$contentPreviewContainer=this.$(".content-preview-container")),this}});e.exports=h},{"../../templates/contentpreview.tpl":308,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/lib/translate":456,"prima/view":496,"velocity-animate":"lWl/mc"}],318:[function(t,e){"use strict";var i=t("jquery"),s=t("prima/view"),o=10,n=s.extend({events:{"click [data-add-url-field]":"addUrlField","click [data-remove-url-field]":"removeUrlField"},addUrlField:function(t){var e=i(t.target).parent().data("original-field-name"),s=i('[name="'+e+'"]'),n=s.length;s.eq(0).clone(!0).val("").removeClass("error").removeAttr("data-validate-input").insertAfter(s.eq(n-1)),n++,n>1&&i(t.target).prev().removeClass("hidden"),n===o&&i(t.target).addClass("hidden")},removeUrlField:function(t){var e=i(t.target).parent().data("original-field-name"),s=i('[name="'+e+'"]'),n=s.length;s.eq(n-1).remove(),n--,1===n&&i(t.target).addClass("hidden"),o>n&&i(t.target).next().removeClass("hidden")}});e.exports=n},{jquery:"HlZQrA","prima/view":496}],319:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("when"),n=t("prima/view"),a=t("prima/events"),r=t("prima/mixins/accessor"),l=t("prima/lib/flags"),h=t("app/models/tumblelog"),d=t("../../templates/survey/start.tpl"),c=n.extend({mixins:[r],events:{"change [data-flag-action]":"onFlagClick","click [data-submit-flag-form]":"onFlagFormSubmit",'change input[type="radio"]':"onInputChange",'change input[type="checkbox"]':"onInputChange","submit form":"onSubmit",'change input[name="flag_ignore"]':"onIgnoreChange",'change input[name="block"]':"onBlockChange"},initialize:function(t){t=t||{},this.abuseform=t.abuseform,this.set("loading",!1),this.on("change:loading",this.updateLoadingIndicator),l.bool("block_feature")?this.abuseform.set("blockFlagSet",!0):this.abuseform.set("ignoreFlagSet",!0)},onIgnoreChange:function(t){this.abuseform.set("ignoreFlagSet",i(t.target).prop("checked"))},onBlockChange:function(t){this.abuseform.set("blockFlagSet",i(t.target).prop("checked"))},onInputChange:function(){var t=!1;s.each(this.$radiosAndCheckboxes,function(e){t=i(e).is(":checked")||t}),this.$submitButton.attr("disabled",!t)},onFlagFormSubmit:function(t){t.preventDefault(),this.set("loading",!0);var e=[];if(this.$form.find("[name=flag]:checked").length&&e.push(i.ajax({url:"/svc/flag",type:"POST",data:this.getFlagRequestData(),with_form_key:!0})),l.bool("block_feature")&&this.abuseform.get("blockFlagSet")){var n=new h({name:this.abuseform.tumblelog});e.push(n.block())}o.all(e).then(s.bind(this.onSubmitSuccess,this),s.bind(this.onSubmitError,this)).finally(s.bind(this.onCallComplete,this))},getFlagRequestData:function(){var t=this.$form.serializeArray(),e={};return s.each(t,function(t){e[t.name]=t.value}),"post"===this.abuseform.mode||"image"===this.abuseform.mode?(e.post_id=this.abuseform.posts[0].id,e.root_id=this.abuseform.posts[0].rootId,e.context=this.abuseform.mode):"blogcard"===this.abuseform.mode&&(e.context="blogcard"),e.tumblelog_name=this.abuseform.tumblelog,e},onSubmitSuccess:function(){this.abuseform.hideFlaggedContent();var t=this.$("form").find("input[type=radio]:checked"),e={reason:t.length?t.val():null};l.bool("block_feature")?e.blocked=this.abuseform.get("blockFlagSet"):e.ignored=this.abuseform.get("ignoreFlagSet"),a.trigger("abuseform:submitted",{loggingData:e}),this.abuseform.displaySuccessMessage()},onSubmitError:function(){this.abuseform.displayErrorMessage()},onCallComplete:function(){this.set("loading",!1)},onSubmit:function(t){t.preventDefault()},updateLoadingIndicator:function(){this.$submitButton.toggleClass("loading",this.get("loading"))},onFlagClick:function(t){var e=i(t.target).data("flag-action"),s=i(".chrome.flag"),o=i(".chrome.continue");"cg"===e?(s.hide(),o.show()):(s.show(),o.hide())},render:function(){return this.$el.html(d(this.abuseform.templateAttributes)),this.$form=this.$("form"),this.$submitButton=this.$("[data-submit-flag-form]"),this.$radiosAndCheckboxes=this.$('input[type="radio"], input[type="checkbox"]'),this}});e.exports=c},{"../../templates/survey/start.tpl":314,"app/models/tumblelog":300,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/lib/flags":"f/LVtH","prima/mixins/accessor":458,"prima/view":496,when:"RG2dij"}],320:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("when"),n=t("prima/lib/flags"),a=t("app/models/tumblelog"),r=t("prima/view"),l=t("prima/events"),h=r.extend({events:{"click [data-survey-submit]":"onSubmitClick","click [data-survey-dismiss]":"onDismissClick"},initialize:function(t){this.abuseform=t.abuseform,this.savedFormState={},this.listenTo(l,"abuseforms:formview:savestate",this.saveFormState),this.listenTo(l,"abuseforms:formview:restorestate",this.restoreFormState)},onSubmitClick:function(t){t.preventDefault(),this.abuseform.set("loading",!0);var e=[];if(e.push(i.ajax({url:"/abuse/ticket/new",type:"POST",contentType:!1,processData:!1,data:this.prepareData(),with_form_key:!0})),n.bool("block_feature")){if(this.abuseform.get("blockFlagSet")){var r=new a({name:this.abuseform.tumblelog});e.push(r.block())}}else this.abuseform.get("ignoreFlagSet")&&e.push(i.ajax({url:"/svc/ignore/add",type:"POST",data:{tumblelog:this.abuseform.tumblelog},with_form_key:!0}));o.all(e).done(s.bind(this.onSubmitSuccess,this),s.bind(this.onSubmitError,this))},prepareData:function(){var t=this.$("[data-abuse-form]");return new FormData(t[0]||{})},saveFormState:function(t){this.$("[data-abuse-form]").length&&(this.savedFormState[t]=this.$("[data-abuse-form]").serializeArray())},restoreFormState:function(t){if(this.savedFormState[t]){var e=this.savedFormState[t];s.each(e,function(t){if(t.value&&!s.isEmpty(t.value)){var e=this.$(this.$('input[name="'+t.name+'"]').length?'input[name="'+t.name+'"]':'textarea[name="'+t.name+'"]');e.val(t.value).trigger("blur")}},this),l.trigger("drawerform:validation:trigger")}},onSubmitSuccess:function(){this.abuseform.set("loading",!1),this.abuseform.hideFlaggedContent(),l.trigger("abuseform:submitted",{loggingData:{reason:this.abuseform.get("surveyStep")}}),this.abuseform.displaySuccessMessage()},hideFlaggedPost:function(){"post"===this.abuseform.mode?i('.post[data-id="'+this.abuseform.posts[0].id+'"]').addClass("is_flagged"):"blogcard"===this.abuseform.mode&&i('.post[data-tumblelog="'+this.abuseform.tumblelog+'"]').addClass("is_flagged")},onSubmitError:function(t){this.abuseform.set("loading",!1);var e=i.parseJSON(t.responseText||{}),s=e.response&&e.response.errors&&e.response.errors.errors||"";this.abuseform.displayErrorMessage(s)},onDismissClick:function(){l.trigger("abuseform:close")}});e.exports=h},{"app/models/tumblelog":300,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/lib/flags":"f/LVtH","prima/view":496,when:"RG2dij"}],321:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("velocity-animate"),n=t("prima/view"),a=t("prima/events"),r=t("./flaggingform"),l=t("../../templates/survey/step.tpl"),h=t("../../templates/survey/partials/options.tpl"),d=t("../../templates/survey/partials/message.tpl"),c=t("../../templates/survey/partials/form.tpl"),u=t("../survey/survey-structure"),p=n.extend({survey:u,templates:{surveyStep:l,surveyOptions:h,surveyMessage:d,surveyForm:c},duration:200,events:{"click [data-survey-nav-to]":"surveyLinkHandler","click [data-survey-nav-back]":"surveyBackHandler"},initialize:function(t){t=t||{},this.abuseform=t.abuseform,this.abuseform.on("change:complete",s.bind(this.updateSubmitButton,this)),this.abuseform.on("change:loading",s.bind(this.updateLoadingIndicator,this)),this.history=[],this.$surveyContainer=this.abuseform.$surveyContainer,this.$surveyStep=this.abuseform.$surveyStep},updateSubmitButton:function(){this.abuseform.get("complete")===!0?this.submitButton.removeAttr("disabled"):this.submitButton.attr("disabled","disabled")},updateLoadingIndicator:function(){this.submitButton.toggleClass("loading",this.abuseform.get("loading"))},surveyLinkHandler:function(t){this.history.push(this.abuseform.get("surveyStep"));var e=i(t.currentTarget).data("survey-nav-to");this.displaySurveyStep(e)},surveyBackHandler:function(){var t=this.history.pop();this.displaySurveyStep(t,!0)},displaySurveyStep:function(t,e){var n,l,h=this.survey[t];a.trigger("abuseforms:formview:savestate",this.abuseform.get("surveyStep")),this.abuseform.set("surveyStep",t),a.trigger("abuseform:stepviewed",{loggingData:{step:t}}),h.displayBackButton=!!this.history.length,a.trigger("drawerform:errortag:removeall");var d=this.$surveyStep.clone().addClass("dummy-step");"start"===t?(this.flaggingForm=new r({abuseform:this.abuseform}),this.$surveyStep.html(this.flaggingForm.render().$el)):(h.options&&(n=this.templates.surveyOptions(s.extend(h,this.abuseform.templateAttributes))),h.message&&(n=this.templates.surveyMessage(s.extend(h,this.abuseform.templateAttributes))),h.form&&(h.formName=t,n=this.templates.surveyForm(s.extend(h,this.abuseform.templateAttributes))),h.stepContent=n,this.$surveyStep.html(this.templates.surveyStep(s.extend(h,this.abuseform.templateAttributes))),!this.abuseform.get("wasPreviewAutoclosed")&&this.history.length>0&&(a.trigger("abuseform:contentpreview:close"),this.abuseform.set("wasPreviewAutoclosed",!0))),d.appendTo(this.$surveyContainer),o.animate(d,{translateX:[e?"290px":"-290px","0"],opacity:[0,1]},{duration:this.duration,easing:"easeOut",complete:function(t){i(t).remove()}}),h.options&&(l=this.$surveyStep.find(".option"),l.css("opacity",0),s.each(l,function(t,i){o.animate(t,{translateX:[0,e?"-70px":"70px"],opacity:[1,0]},{delay:this.duration/4*(i+1),duration:this.duration,easing:"easeOut"})},this)),o.animate(this.$surveyStep,{translateX:["0",e?"-290px":"290px"],opacity:[1,0]},{duration:this.duration,easing:"easeOut"}),this.submitButton=this.$("[data-survey-submit]"),a.trigger("drawerform:validation:trigger"),h.form&&(a.trigger("abuseforms:formview:restorestate",t),a.trigger("drawer:enableCloseConfirmation"))}});e.exports=p},{"../../templates/survey/partials/form.tpl":311,"../../templates/survey/partials/message.tpl":312,"../../templates/survey/partials/options.tpl":313,"../../templates/survey/step.tpl":315,"../survey/survey-structure":322,"./flaggingform":319,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/view":496,"velocity-animate":"lWl/mc"}],322:[function(t,e){"use strict";var i={start:{title:"",description:"",template:"start"},abuse:{title:"What kind of violation is it?",options:[{name:"Someone is at risk of harm",to:"harm"},{name:"Misuse of your identity or work",to:"misuse"},{name:"This content is gross or hateful",to:"hateful"},{name:"Some other reason",to:"other"}],prev:"start"},harm:{title:"Someone is at risk of harm",options:[{name:"Harassment",to:"harassment"},{name:"Privacy violation",to:"privacy"},{name:"Harm to minors",to:"minors"},{name:"Promotion or glorification of self-harm",to:"selfharm"}],prev:"abuse"},misuse:{title:"Misuse of your identity or work",options:[{name:"Misattribution or non-attribution",to:"misattrib"},{name:"Copyright infringement",to:"copyright"},{name:"Trademark infringement",to:"trademark"},{name:"Confusion or impersonation",to:"confusion"}],prev:"abuse"},hateful:{title:"This content is gross or hateful",options:[{name:"Gore, mutilation, bestiality, or necrophilia",to:"gore"},{name:"Malicious speech",to:"maliciousspeech"}],prev:"abuse"},harassment:{title:"Harassment",tagline:"Are you the person being harassed?",description:"Being a jerk. Circumventing the ignore feature in order to send someone mean and hateful messages.",options:[{name:"Yes",to:"harassment-self",flaggingTo:"harassment-self-blog"},{name:"No",to:"harassment-someoneelse"}],prev:"harm"},"harassment-someoneelse":{title:"Harassment",tagline:"Are you the person being harassed?",message:[{type:"highlight",text:"No"},{type:"text",text:"Thanks for bringing this to our attention, but we need to hear directly from the person being harassed. Get in contact with them if you can, and refer them to our %1$sabuse form%2$s.",link:"harassment"}],button:{type:"dismiss"},prev:"harassment"},"harassment-self":{title:"Harassment",tagline:"Where on Tumblr is the harassment taking place?",options:[{name:"Somewhere on a blog or in a post (including tags)",to:"harassment-self-blog"},{name:"In an inbox message (an Ask or Fan Mail)",to:"harassment-self-message"}],prev:"harassment"},"harassment-self-blog":{title:"Harassment",form:[{groupLabel:"Content you're reporting",fields:[{type:"input-link",name:"urlreporting",placeholder:"URL of the post"}]},{groupLabel:"A little about yourself",fields:[{type:"input-name",optional:!0,name:"name"},{type:"input-email",name:"email"}]}],button:{type:"submit"},prev:"harassment-self"},"harassment-self-message":{title:"Harassment",form:[{groupLabel:"Screenshot of the message you're reporting",fields:[{type:"file",name:"screenshot"}]},{groupLabel:"A little about yourself",fields:[{type:"input-name",optional:!0,name:"name"},{type:"input-email",name:"email"}]}],button:{type:"submit"},prev:"harassment-self"},privacy:{title:"Privacy Violation",description:"Posting content that violates anyone's privacy, especially personally identifying or confidential information like credit card numbers, social security numbers, unlisted contact information, or private photos.",tagline:"Is it your privacy that's being violated?",options:[{name:"Yes",to:"privacy-self"},{name:"No",to:"privacy-someoneelse"}],prev:"harm"},"privacy-someoneelse":{title:"Privacy Violation",tagline:"Is it your privacy that's being violated?",message:[{type:"highlight",text:"No"},{type:"text",text:"Thanks for bringing this to our attention, but we need to hear directly from the person who's privacy is being violated. Get in contact with them if you can, and refer them to our %1$sabuse form%2$s.",link:"privacy"}],button:{type:"dismiss"},prev:"privacy"},"privacy-self":{title:"Privacy Violation",tagline:"What, specifically, was posted?",options:[{name:"My name ",to:"privacy-self-name"},{name:"My IP address ",to:"privacy-self-ip"},{name:"My private home address",to:"privacy-self-form"},{name:"My private email address",to:"privacy-self-form"},{name:"My private telephone number was posted",to:"privacy-self-form"},{name:"Private images of me have been posted ",to:"privacy-self-image"},{name:"Something else private was posted ",to:"privacy-self-form"}],prev:"privacy"},"privacy-self-name":{title:"Privacy Violation",tagline:"What, specifically, was posted?",message:[{type:"highlight",text:"Name"},{type:"text",text:"Unfortunately, your name isn't considered private information, and posting it isn't a violation of either the law or of our Community Guidelines. If you're uncomfortable with the post, try to communicate with the person who posted it and make your feelings on it known."}],button:{type:"dismiss"},prev:"privacy-self"},"privacy-self-ip":{title:"Privacy Violation",tagline:"What, specifically, was posted?",message:[{type:"highlight",text:"IP address"},{type:"text",text:"Unfortunately, your IP address isn't considered private information, and posting it isn't a violation of either the law or of our Community Guidelines. If you're uncomfortable with the post, try to communicate with the person who posted it and make your feelings on it known."}],button:{type:"dismiss"},prev:"privacy-self"},"privacy-self-form":{title:"Privacy Violation",form:[{groupLabel:"Content you're reporting",fields:[{type:"input-link",name:"urlreporting",placeholder:"URL of the post"}]},{groupLabel:"Source of the private information, if known",fields:[{type:"input-link",optional:!0,name:"source-link",placeholder:"URL of information source"}]},{groupLabel:"A little about yourself",fields:[{type:"input-name",optional:!0,name:"name"},{type:"input-email",name:"email"}]}],button:{type:"submit"},prev:"privacy-self"},"privacy-self-image":{title:"Privacy Violation",form:[{groupLabel:"Proof of identity",fields:[{type:"text",text:"We'll need some proof of your identity to pursue this. A picture of your photo ID would be perfect, but if you don't have one handy then you can take a picture of yourself holding up a sign that reads “Tumblr, this is me.” Don't worry, these photos are kept private."},{type:"file",name:"userphoto"}]},{groupLabel:"Content you're reporting",fields:[{type:"input-link",name:"urlreporting",placeholder:"URL of the post"}]},{groupLabel:"Source of the private information, if known",fields:[{type:"input-link",optional:!0,name:"source-link",placeholder:"URL of information source"}]},{groupLabel:"A little about yourself",fields:[{type:"input-name",optional:!0,name:"name"},{type:"input-email",name:"email"}]}],button:{type:"submit"},prev:"privacy-self"},minors:{title:"Harm to minors",description:"Sexually suggestive or violent depictions of minors; or bullying, even by another minor.",form:[{groupLabel:"Content you're reporting",fields:[{type:"input-link",name:"urlreporting",placeholder:"URL of the post"}]},{groupLabel:"Some explanation",fields:[{type:"textarea",name:"description",placeholder:"Describe, as best you can, how it violates Tumblr's Community Guidelines"}]},{groupLabel:"A little about yourself",fields:[{type:"input-name",optional:!0,name:"name"},{type:"input-email",name:"email"}]}],button:{type:"submit"},prev:"harm"},selfharm:{title:"Promotion or glorification of self-harm",description:"Encouraging others to injure themselves in ways large or small, or celebrating such injuries in any fashion. Glamorizing anorexia, bulimia, or other eating disorders.",form:[{groupLabel:"Content you're reporting",fields:[{type:"input-link",name:"urlreporting",placeholder:"URL of the post"}]},{groupLabel:"A little about yourself",fields:[{type:"input-name",optional:!0,name:"name"},{type:"input-email",name:"email"}]}],button:{type:"submit"},prev:"harm"},misattrib:{title:"Misattribution or non-attribution",description:"Stealing something that someone else made and trying to pass it off as your own (probably by downloading it and reposting it, instead of reblogging it like a decent human being). This also includes reblogging something and gratuitously injecting a link back to your blog.",tagline:"Is it your work that's being misattributed, or that's missing an attribution?",options:[{name:"Yes",to:"misattrib-self"},{name:"No",to:"misattrib-someoneelse"}],prev:"misuse"},"misattrib-someoneelse":{title:"Misattribution or non-attribution",tagline:"Is it your work that's being misattributed, or that's missing an attribution?",message:[{type:"highlight",text:"No"},{type:"text",text:"Thanks for letting us know. Unfortunately, in situations like this, we need to hear directly from the user whose work has been misattributed, or is missing attribution. Get in contact with them if you can, and refer them to our %1$sabuse form %2$s.",link:"misattrib"}],button:{type:"dismiss"},prev:"misattrib"},"misattrib-self":{title:"Misattribution or non-attribution",tagline:"Did you originally post this work on Tumblr, or somewhere else?",options:[{name:"I posted it to Tumblr",to:"misattrib-self-tumblr"},{name:"I posted it somewhere else",to:"misattrib-self-somewhereelse"}],prev:"misattrib"},"misattrib-self-somewhereelse":{title:"Misattribution or non-attribution",tagline:"Did you originally post this work on Tumblr, or somewhere else?",message:[{type:"highlight",text:"I posted it somewhere else"},{type:"text",text:"You'll need to file a request under the Digital Millenium Copyright Act (DMCA). Don't worry, we've got a form for that."},{type:"link",text:"File a DMCA request",href:"/dmca"}],button:{type:"dismiss"},prev:"misattrib-self"},"misattrib-self-tumblr":{title:"Misattribution or non-attribution",tagline:"Which of the following best describes your issue?",options:[{name:"Someone reposted it instead of reblogging it",to:"misattrib-self-tumblr-repost"},{name:"Someone reblogged it and injected a link back to their own blog",to:"misattrib-self-tumblr-link"}],prev:"misattrib-self"},"misattrib-self-tumblr-repost":{title:"Misattribution or non-attribution",form:[{groupLabel:"Original content",fields:[{type:"input-link",name:"urloriginal",placeholder:"URL of the original content"}]},{groupLabel:"Repost",fields:[{type:"input-link",name:"urlreporting",placeholder:"URL of the repost"}]},{groupLabel:"A little about yourself",fields:[{type:"input-name",optional:!0,name:"name"},{type:"input-email",name:"email"}]}],button:{type:"submit"},prev:"misattrib-self-tumblr"},"misattrib-self-tumblr-link":{title:"Misattribution or non-attribution",form:[{groupLabel:"Original content",fields:[{type:"input-link",name:"urloriginal",placeholder:"URL of the original content"}]},{groupLabel:"Reblog",fields:[{type:"input-link",name:"urlreporting",placeholder:"URL of the reblog"}]},{groupLabel:"A little about yourself",fields:[{type:"input-name",optional:!0,name:"name"},{type:"input-email",name:"email"}]}],button:{type:"submit"},prev:"misattrib-self-tumblr"},copyright:{title:"Copyright infringement",description:"Posting someone else's copyrighted work without their permission, or without a legal exemption like fair use.",tagline:"Did you originally post this work on Tumblr, or somewhere else?",options:[{name:"I posted it to Tumblr",to:"misattrib"},{name:"I posted it somewhere else",to:"copyright-dmca"}],button:{type:"submit"},prev:"misuse"},"copyright-dmca":{title:"Copyright infringement",tagline:"Are you making a copyright claim or reporting an attribution issue?",message:[{type:"highlight",text:"Copyright"},{type:"text",text:"You'll need to file a request under the Digital Millenium Copyright Act (DMCA). Don't worry, we've got a form for that."},{type:"link",text:"File a DMCA request",href:"/dmca"}],button:{type:"dismiss"},prev:"copyright"},trademark:{title:"Trademark infringement",description:"Using someone else's trademark without their permission.",tagline:"Are you the trademark holder or an authorized representative?",options:[{name:"Yes",to:"trademark-holder"},{name:"No",to:"trademark-notholder"}],prev:"misuse"},"trademark-notholder":{title:"Trademark infringement",tagline:"Are you the trademark holder or an authorized representative?",message:[{type:"highlight",text:"No"},{type:"text",text:"Thanks for bringing this to our attention, but we need to hear directly from the trademark holder or their authorized representative. Get in contact with them if you can, and refer them to our %1$sabuse form%2$s.",link:"trademark"}],button:{type:"dismiss"},prev:"trademark"},"trademark-holder":{title:"Trademark infringement",form:[{groupLabel:"Your information",fields:[{type:"input-name",name:"name"},{type:"input",name:"company",optional:!0,placeholder:"Your company, if applicable"},{type:"input-email",name:"email"},{type:"input",name:"contactinfo",optional:!0,placeholder:"Other contact info, like your address"}]},{groupLabel:"Trademark information",fields:[{type:"input",name:"trademark",placeholder:"Trademark"},{type:"input",name:"trademark-type",placeholder:"Type of trademark (e.g., word, design, etc)"},{type:"input",name:"trademark-jurisdiction",placeholder:"Jurisdiction"},{type:"input",name:"trademark-regnumber",optional:!0,placeholder:"Registration number (if not granted)"},{type:"input",name:"trademark-serialnumber",optional:!0,placeholder:"Serial number "}]},{groupLabel:"Registration documentation",fields:[{type:"file",name:"trademark-regdocument"},{type:"input-link",name:"urlreporting",placeholder:"URL of the content you're reporting"}]},{groupLabel:"How is this content infringing your trademark(s)?",fields:[{type:"textarea",name:"description",placeholder:"Short explanation"}]},{groupLabel:"",fields:[{type:"checkbox",name:"consent",text:"I understand that Tumblr may provide third parties, for example the reported blogger(s), with details of this report, such as the reported blog or post. Your contact information, like your email address, will not be disclosed."}]}],button:{type:"submit"},prev:"trademark"},confusion:{title:"Confusion or impersonation",description:"A deliberate attempt to appear to be someone or something else, like a teacher, classmate, celebrity, or corporation. Someone trying to be a better version of him or herself is all cool though.",tagline:"Whose identity is being impersonated or confused?",options:[{name:"My own",to:"confusion-own"},{name:"My company, brand, or organization",to:"trademark"},{name:"Someone else's",to:"confusion-else"}],prev:"misuse"},"confusion-own":{title:"Confusion or impersonation",form:[{groupLabel:"Some information about you",fields:[{type:"input-name",optional:!0,name:"name"},{type:"input-email",name:"email"}]},{groupLabel:"Where confusion or impersonation takes place",fields:[{type:"input-link",name:"urlreporting",placeholder:"URL with an example of the impersonation"}]},{groupLabel:"Explain how you're being impersonated",fields:[{type:"textarea",name:"explanation",placeholder:"Short explanation"}]}],button:{type:"submit"},prev:"confusion"},"confusion-else":{title:"Confusion or impersonation",tagline:"Whose identity is being impersonated or confused?",message:[{type:"highlight",text:"Someone else's"},{type:"text",text:"We appreciate your bringing this to our attention. In these cases, we need to hear directly from the person being impersonated by this blog. Get in contact with them if you can, and refer them to our %1$sabuse form%2$s.",link:"confusion"}],button:{type:"dismiss"},prev:"confusion"},"confusion-company-notauthorized":{title:"Confusion or impersonation",tagline:"Are you an authorized representative for the company, brand, or organization being impersonated?",message:[{type:"highlight",text:"No"},{type:"text",text:"We appreciate your bringing this to our attention. In these cases, we need to hear directly from an authorized representative for the company, brand or organization being impersonated by this blog. Get in contact with them if you can, and refer them to our %1$sabuse form%2$s.",link:"confusion"}],button:{type:"dismiss"},prev:"confusion-company"},"confusion-company-authorized":{title:"Confusion or impersonation",tagline:"Are you reporting an impersonation/confusion issue or a trademark violation?",options:[{name:"Impersonation/confusion",to:"confusion-company-authorized-impersonation"},{name:"Trademark violation",to:"trademark"}],prev:"confusion-company"},"confusion-company-authorized-impersonation":{title:"Confusion or impersonation",form:[{groupLabel:"Some information about you",fields:[{type:"input-name",name:"name"},{type:"input-email",name:"email"}]},{groupLabel:"Information about company",fields:[{type:"input",name:"impersonated-company",placeholder:"Company/brand/organization"},{type:"input",name:"affiliation",placeholder:"Your affiliation"}]},{groupLabel:"Examples of the impersonation or confusion",fields:[{type:"input-link",name:"urlreporting"},{type:"textarea",name:"explanation",placeholder:"Explain how these examples are impersonating or causing confusion with your brand"}]}],button:{type:"submit"},prev:"confusion-company-authorized"},gore:{title:"Gore, mutilation, bestiality, or necrophilia",description:"Showcasing the mutilation or torture of human beings, animals, or their remains. Doing so just to be a dick.",form:[{groupLabel:"Content you're reporting",fields:[{type:"input-link",name:"urlreporting",placeholder:"URL of the post"}]},{groupLabel:"Which of these things does it contain",fields:[{type:"checkbox",name:"gore",text:"Gore/mutilation"},{type:"checkbox",name:"bestiality",text:"Bestiality"},{type:"checkbox",name:"necrophilia",text:"Necrophilia"}]},{groupLabel:"A little about yourself",fields:[{type:"input-name",optional:!0,name:"name"},{type:"input-email",name:"email"}]}],button:{type:"submit"},prev:"hateful"},maliciousspeech:{title:"Malicious speech",description:"Encouraging violence or hatred on the basis of things like race, ethnic origin, religion, disability, gender, age, veteran status, or sexual orientation.",form:[{groupLabel:"Content you're reporting",fields:[{type:"input-link",name:"urlreporting",placeholder:"URL of the post"}]},{groupLabel:"Describe, as best you can, how it violates Tumblr's Community Guidelines",fields:[{type:"textarea",name:"description",placeholder:"Short explanation"}]},{groupLabel:"A little about yourself",fields:[{type:"input-name",optional:!0,name:"name"},{type:"input-email",name:"email"}]}],button:{type:"submit"},prev:"hateful"},other:{title:"Some other reason",description:"Pretty sure you found a post that doesn't belong on Tumblr, but don't see the violation you're looking for? Let us know about it.",form:[{groupLabel:"Content you're reporting",fields:[{type:"input-link",name:"urlreporting",placeholder:"URL of the post"}]},{groupLabel:"Describe, as best you can, how it violates Tumblr's Community Guidelines",fields:[{type:"textarea",name:"description",placeholder:"Short explanation"}]},{groupLabel:"A little about yourself",fields:[{type:"input-name",optional:!0,name:"name"},{type:"input-email",name:"email"}]}],button:{type:"submit"},prev:"abuse"}};e.exports=i},{}],323:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/component"),n=t("prima/events"),a=t("./player"),r=[],l=o.extend({name:"CrtControl",maxLoopTime:10,playerSelector:"[data-crt-video]",initialize:function(t){t=t||{},this.listenTo(n,"CrtControl:newPlayer",this.playerFactory,this),this.listenTo(n,"DOMEventor:flatscroll",i.throttle(this.onScroll,500),this)
},findPlayers:function(t){var e=s(this.playerSelector);e.length&&this.playerFactory(e,t)},playerFactory:function(t,e){i.defer(i.bind(function(){i.each(t,function(t){this.newPlayer(t,e)},this)},this))},newPlayer:function(t,e){if(t.player)return t.player;var i=new a(t,e);return r.push(i),i.render(),this.bindPlayerEvents(i),n.trigger("CrtControl:playerCreated",i),i},bindPlayerEvents:function(t){this.listenTo(t,"ready",this.onPlayerReady),this.listenTo(t,"teardown",this.onPlayerTeardown)},onPlayerReady:function(){this.playInViewport()},onPlayerTeardown:function(t){if(t=i.where(r,{_id:t._id}),t.length){var e=i.indexOf(r,t[0]);e>-1&&(t=r.splice(e,1))}},onScroll:function(){this.playInViewport()},pauseAutoplaying:function(){i.each(r,function(t){t.get("autoplay")&&t.get("loaded")&&t.pause()})},getInViewport:function(){return i.filter(r,function(t){return t.watcher?t.watcher.isFullyInViewport:!1})},playInViewport:function(){var t=this.getInViewport();if(t.length){var e=t[0];e.get("paused")&&e.get("autoplay")&&(this.pauseAutoplaying(),e.play())}}});e.exports=new l},{"./player":324,jquery:"HlZQrA",lodash:"K2RcUv","prima/component":428,"prima/events":429}],324:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("scrollmonitor"),n=t("fastdom"),a=t("prima/class"),r=t("prima/mixins/accessor"),l=t("prima/lib/flags"),h=t("prima/events"),d=t("prima/utils/caniuse"),c=t("./plugins/videojs-crt"),u=a.extend({mixins:[r],defaults:{loaded:!1,paused:!0,muted:!1,autoplay:!1,_preload:!1,_preloadThreshold:10,loop:!0,autoheight:!1,watch:!0,duration:0,hideFullscreen:!1,_elapsed:0,_position:0,_startSeekJumpTime:null,minLoopDuration:1},classNames:{base:"crt-video crt-skin-default",autoplay:"crt-state-autoplaying",autoheight:"crt-autoheight",hideFullscreen:"crt-hide-fullscreen-toggle"},constructor:function(t,e){this._id=i.uniqueId("crtplayer"),this.initialize(t,e)},initialize:function(t,e){e||(e={}),i.isObject(e.attributes)&&this.set(e.attributes),this.video=t,this.$video=s(this.video);var o=this.$video.data("crt-options");this.$video.removeAttr("data-crt-options"),this.vjsOptions=i.defaults({crt:this,crtOptions:o},e.vjsOptions||{}),o&&o.duration&&this.set("duration",o.duration),n.write(function(){this.$video.addClass(this.classNames.base)},this)},render:function(){return n.write(function(){c(this.video,this.vjsOptions).then(i.bind(this.ready,this))},this),this},ready:function(t){this.player=t,this.el=t.player_.el(),this.$el=s(this.el),this.$post=this.$el.closest(".post"),this.playerID=this.player.id_,this.hasLooped=!1,this._bindEvents(),this.setAutoplayState(this.shouldAutoplay()),this.setMutedState(this.shouldAutoplay()),this.setLoopState(!0),this.setAutoheightState(),this.setFullscreenControl(!d.prop("requestFullscreen")),this.get("watch")&&this.setupWatcher(),h.trigger("CrtPlayer:ready",this),this.trigger("ready",this)},_bindEvents:function(){this.listenTo(h,"peepr:open",this.pause),this.listenTo(h,"post:form:show",this.pause),this.listenTo(h,"post:docked:afterRender",this.onDockedAfterRender),this.on("change:autoplay",this.onChangeAutoplay,this),this.on("change:autoheight",this.onChangeAutoheight,this),this.on("change:duration",this.onChangeDuration,this),this.on("change:loop",this.onChangeLoop,this),this.on("change:muted",this.onChangeMuted,this),this.player.on("loadedmetadata",i.bind(this.onLoadedMetadata,this)),this.player.on("durationchange",i.bind(this.onUpdateDuration,this)),this.player.on("play",i.bind(this.onPlay,this)),this.player.on("pause",i.bind(this.onPause,this)),this.player.on("ended",i.bind(this.onEnded,this)),this.player.on("fullscreenchange",i.bind(this.onFullscreenChange,this)),this.player.on("error",i.bind(this.onError,this))},setupWatcher:function(){this.watcher=o.create(this.el,-100),this.watcher.fullyEnterViewport(i.bind(function(){this.trigger("fullyEnterViewport")},this)),this.watcher.partiallyExitViewport(i.bind(function(){this.trigger("partiallyExitViewport")},this)),this.watcher.exitViewport(i.bind(function(){this.trigger("exitViewport"),this.shouldAutoplay()&&this.pause()},this)),this.shouldAutoplay()&&this.$el.on("click.crtAutoPlay touchend.crtAutoPlay",i.bind(this.onClickPlayer,this))},onClickPlayer:function(t){s(t.target).closest(".vjs-mute-control").length||s(t.target).closest(".vjs-fullscreen-control").length?this.restart():this.pause(),this.set("autoplay",!1),this.set("muted",!1),this.$el.off("click.crtAutoPlay touchend.crtAutoPlay")},restart:function(){this.get("autoplay")&&(this.set("autoplay",!1),this.set("muted",!1),this.onTimeUpdate(),this.player.trigger({type:"restart",start:this.player.currentTime(),end:0}),this.player.currentTime(0))},pollTimeUpdate:function(){this.get("paused")||(this.onTimeUpdate(),setTimeout(i.bind(this.pollTimeUpdate,this),150))},shouldAutoplay:function(){return this.get("autoplay")&&!l.bool("is_mobile")&&this.get("duration")>this.get("minLoopDuration")&&this.$el.is(":visible")},play:function(t){t||(t={}),this.player.paused()&&(this.player.play(),t.skipLog||(t.type="userPlay",this.player.trigger(t)))},pause:function(t){t||(t={}),this.player.paused()||(this.player.pause(),t.skipLog||this.player.trigger("userPause"))},onPlay:function(){this.set("paused",!1),this.pollTimeUpdate()},onPause:function(){this.set("paused",!0)},onUpdateDuration:function(){this.get("duration")||this.set("duration",this.player.duration())},onLoadedMetadata:function(){this.set("loaded",!0)},onEnded:function(){this.get("loop")===!0?(this.play({skipLog:!0}),this.player.trigger("looped"),this.get("autoplay")||this.hasLooped||(this.hasLooped=!0)):(this.pause({skipLog:!0}),this.player.trigger("videoEnded"))},onError:function(){this.set("paused",!0),this.set("loop",!1),this.set("autoplay",!1)},onChangeAutoplay:function(t,e,i){this.setAutoplayState(e,i)},onChangeAutoheight:function(t,e){this.setAutoheightState(e)},onChangeDuration:function(){this.setLoopState(!0)},onChangeLoop:function(t,e){this.setLoopState(e)},onChangeMuted:function(t,e){this.player.muted(e)},onFullscreenChange:function(){this.$post.hasClass("docked")&&(this.player.isFullscreen()?(this.cached_top=this.$el.position().top,this.$el.css("top",0)):this.$el.css("top",this.cached_top))},onDockedAfterRender:function(t){i.isEmpty(t.embedID)||this.playerID===t.embedID&&this.player.trigger("CRTPlayer:updateDimensions")},setLoopState:function(t){i.isUndefined(t)&&(t=this.get("loop")),this.set("loop",t),"undefined"!=typeof this.get("duration")&&this.get("duration")<=this.get("minLoopDuration")&&this.set("loop",!1)},setMutedState:function(t){i.isUndefined(t)&&(t=this.get("muted")),this.set("muted",t)},setAutoplayState:function(t){i.isUndefined(t)&&(t=this.get("autoplay")),this.set("autoplay",t),this.toggleAttrClass("autoplay",t),!t&&this.get("duration")&&this.setLoopState(!0)},setAutoheightState:function(t){i.isUndefined(t)&&(t=this.get("autoheight")),this.set("autoheight",t),this.toggleAttrClass("autoheight",t)},setFullscreenControl:function(t){i.isUndefined(t)&&(t=this.get("hideFullscreen")),this.set("hideFullscreen",t),this.toggleAttrClass("hideFullscreen",t)},onTimeUpdate:function(){var t=.3,e=this.get("_position"),i=this.player.currentTime(),s=Math.abs(e-i);t>s&&this.set("_elapsed",this.get("_elapsed")+s),this.set("_position",i),this.set("_startSeekJumpTime",i)},getStartSeekJumpPosition:function(){return this.get("_startSeekJumpTime")},getPosition:function(){return Math.floor(this.get("_position"))},getElapsed:function(){return Math.floor(this.get("_elapsed"))},toggleAttrClass:function(t,e){this.classNames[t]&&n.write(function(){this.$el.toggleClass(this.classNames[t],e)},this)},teardown:function(){this.trigger("teardown",this),this.off(),this.stopListening(),this.watcher&&(this.watcher.destroy(),this.watcher=null),this.player&&(this.player.dispose(),this.player=null)}});e.exports=u},{"./plugins/videojs-crt":338,fastdom:500,jquery:"HlZQrA",lodash:"K2RcUv","prima/class":426,"prima/events":429,"prima/lib/flags":"f/LVtH","prima/mixins/accessor":458,"prima/utils/caniuse":475,scrollmonitor:"y33VHk"}],325:[function(t,e){"use strict";var i=t("video.js"),s=t("./templates/mute_toggle.tpl"),o=i.MuteToggle.extend({init:function(t,e){i.MuteToggle.prototype.init.call(this,t,e),this.addListeners(t)},addListeners:function(){this.on("click",this.onMuteClick)},onMuteClick:function(){this.player_.trigger("muteClicked")},createEl:function(){var t="vjs-mute-control vjs-control";return this.player_.options_.muted&&(t+=" vjs-vol-0"),i.Button.prototype.createEl.call(this,"div",{className:t,innerHTML:s()})},update:function(){var t=this.player_.volume(),e=3;0===t||this.player_.muted()?e=0:.33>t?e=1:.67>t&&(e=2),this.player_.muted()?"Unmute"!==this.el_.children[1].children[0].innerHTML&&(this.el_.children[1].children[0].innerHTML="Unmute"):"Mute"!==this.el_.children[1].children[0].innerHTML&&(this.el_.children[1].children[0].innerHTML="Mute");for(var s=0;4>s;s++)i.removeClass(this.el_,"vjs-vol-"+s);i.addClass(this.el_,"vjs-vol-"+e)}});e.exports=o},{"./templates/mute_toggle.tpl":337,"video.js":"AcVSFw"}],326:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("video.js"),n=o.CoreObject.extend({init:function(t,e){this.options=e||{},this.player=t,this.$player=s(this.player.el()),this._selectorCache(),this.player.on("dispose",i.bind(this.dispose,this)),this.initialize.apply(this,arguments)},_selectorCache:function(){this.$$=i.memoize(function(t){return this.$player.find(t)},i.identity),this.$$.remove=i.bind(function(t){delete this.$$.cache[t]},this),this.$$.clear=i.bind(function(){this.$$.cache={}},this)},initialize:function(){},dispose:function(){this.$$.clear(),this.$player.off()}});e.exports=n},{jquery:"HlZQrA",lodash:"K2RcUv","video.js":"AcVSFw"}],327:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("video.js"),n=t("prima/utils/bindendevent").animation,a=o.Button.extend({init:function(){o.Button.prototype.init.apply(this,arguments),this.player().usingNativeControls()&&this.player().controls(!1)},createEl:function(){return o.Button.prototype.createEl.call(this,"div",{className:"vjs-big-play-button",innerHTML:'<span class="vjs-big-play-button-icon"></span><span class="vjs-big-pause-button-icon"></span></span><span aria-hidden="true"></span>',"aria-label":"play video"})},onClick:function(){this.$el=this.$el||i(this.el()),this.player_.userActive(!0),this.player().usingNativeControls()?this.player().paused()&&(this.player().play(),this.player().controls(!0)):this.togglePlay()},togglePlay:function(){n(this.$el,s.bind(function(){this.$el.removeClass("poof-play poof-pause")},this)),this.player().paused()?(this.player().play(),this.$el.removeClass("poof-pause").addClass("poof-play")):(this.player().pause(),this.$el.removeClass("poof-play").addClass("poof-pause"))}});e.exports=a},{jquery:"HlZQrA",lodash:"K2RcUv","prima/utils/bindendevent":474,"video.js":"AcVSFw"}],328:[function(t,e){"use strict";var i=t("video.js"),s=i.SeekBar.extend({onMouseMove:function(){i.SeekBar.prototype.onMouseMove.apply(this,arguments),this.update()},update:function(){if(this.el_){var t=this.getPercent(),e=this.handle,s=this.bar;isNaN(t)&&(t=0);var o=i.round(100*t,2)+"%";e.el().style.left=o,s.el().style.width=o}}});e.exports=s},{"video.js":"AcVSFw"}],329:[function(t,e){"use strict";var i=t("lodash"),s=t("./base/base-plugin"),o=s.extend({elSelector:".vjs-progress-holder",lastPlayPosition:0,currentPlayPosition:0,lastWaitedTime:0,buffering:!1,polling:!1,interval:100,initialize:function(){this.player.on("play",i.bind(this.startPolling,this)),this.player.on("ended",i.bind(this.stopPolling,this)),this.player.on("pause",i.bind(this.stopPolling,this))},checkBuffering:function(){this.currentPlayPosition=this.player.currentTime();var t=1/this.interval;if(!this.buffering&&this.currentPlayPosition<this.lastPlayPosition+t&&!this.player.paused()&&(this.lastWaitedTime=i.now(),this.$player.trigger("waiting"),this.buffering=!0),this.buffering&&this.currentPlayPosition>this.lastPlayPosition+t&&!this.player.paused()){var e=i.now()-this.lastWaitedTime;this.$player.trigger("stopwaiting",{timeWaited:e}),this.buffering=!1}this.lastPlayPosition=this.currentPlayPosition},tick:function(){this.polling&&(this.checkBuffering(),i.delay(i.bind(this.tick,this),this.interval))},startPolling:function(){this.polling||(this.polling=!0,this.tick())},stopPolling:function(){this.polling=!1}});e.exports=o},{"./base/base-plugin":326,lodash:"K2RcUv"}],330:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/events"),n=t("prima/lib/flags"),a=t("./base/base-plugin"),r=a.extend({videoConversionLogged:!1,loggingInProgress:!1,startSeekTime:null,loadStartTime:0,triggerElement:s(),initialize:function(){this.player.crt.on("ready",i.bind(function(){this.setPlayerData(),this.bindEvents(),this.cacheUnloadData()},this)),this.$doc=s(document)},setPlayerData:function(){this.playerData={id:this.player.crt.playerID,tech:this.player.techName,post_id:this.player.crt.$post.data("post-id"),duration:this.player.crt.get("duration")}},bindEvents:function(){this.$player.on("mousedown touchstart",i.bind(this.setTriggerElement,this)),this.player.on("userPlay",i.bind(this.onUserPlay,this)),this.player.on("play",i.bind(this.onVJSPlay,this)),this.player.on("userPause",i.bind(this.onUserPause,this)),this.player.on("pause",i.bind(this.onVJSPause,this)),this.player.on("looped",i.bind(this.onLooped,this)),this.player.on("videoEnded",i.bind(this.onVideoEnded,this)),this.player.on("restart",i.bind(this.onRestart,this)),this.player.on("muteClicked",i.bind(this.onMuteClicked,this)),this.player.on("fullscreenchange",i.bind(this.onFullscreenChange,this)),this.player.on("error",i.bind(this.onError,this)),this.player.on("seeking",i.bind(this.onSeeking,this)),this.player.on("resolutionchange",i.bind(this.onResolutionChange,this)),this.player.on("timeupdate",i.bind(this.onTimeUpdate,this)),this.$player.on("stopwaiting",i.bind(this.onStopWaiting,this)),this.player.on("firstplay",i.bind(this.onLoadStart,this)),this.player.on("loadeddata",i.bind(this.onLoadedData,this))},triggerEvent:function(t,e){e=this._buildLoggingData(e),o.trigger("VideoPlayer:"+t,{loggingData:e})},_buildLoggingData:function(t){return t=i.extend({},this.playerData,t),t.elapsed=this.player.crt.getElapsed(),t.position=this.player.crt.getPosition(),t},setTriggerElement:function(t){this.triggerElement=s(t.target)},onLogComplete:function(){this.triggerElement=s()},cacheUnloadData:function(){this.triggerEvent("cacheUnload")},onError:function(){var t=this.player.error(),e="MEDIA_ERR_CUSTOM";if(t){switch(t.code){case 1:e="MEDIA_ERR_ABORTED";break;case 2:e="MEDIA_ERR_NETWORK";break;case 3:e="MEDIA_ERR_DECODE";break;case 4:e="MEDIA_ERR_SRC_NOT_SUPPORTED";break;case 5:e="MEDIA_ERR_ENCRYPTED"}this.triggerEvent("error",{code:t.code,name:e})}},onUserPlay:function(t){this.onPlay(!0,t)},onVJSPlay:function(t){this.onPlay(!1,t)},onPlay:function(t,e){if(t||0!==this.triggerElement.closest(".vjs-big-play-button").length||0!==this.triggerElement.closest(".vjs-play-control").length){var i=this.player.crt.get("autoplay"),s={};e.onDock&&(s.onDock=!0),this.logConversion({name:"CONVERSION_ACTION_HTML5_VIDEO",extra:{player:this.player.techName,player_version:2}}),this.triggerEvent(i?"autoplay":"play",s),this.onLogComplete()}},onUserPause:function(){this.onPause(!0)},onVJSPause:function(){this.onPause(!1)},onPause:function(t){(t||0!==this.triggerElement.closest(".vjs-big-play-button").length||0!==this.triggerElement.closest(".vjs-play-control").length)&&(this.triggerEvent("pause",this.playerData),this.onLogComplete())},onLooped:function(){this.triggerEvent("looped")},onVideoEnded:function(){this.triggerEvent("ended")},onRestart:function(t){var e=i.pick(t,["start","end"]);this.triggerEvent("restart",e)},onFullscreenChange:function(){this.triggerEvent("fullscreen",{fullscreen:this.player.isFullscreen()}),this.onLogComplete()},onMuteClicked:function(){this.triggerEvent("muted",{muted:this.player.muted()}),this.onLogComplete()},onSeeking:function(){0!==this.triggerElement.closest(".vjs-progress-control").length&&(this.startSeekTime||(this.startSeekTime=this.player.crt.getStartSeekJumpPosition()),this.$doc.one("mouseup.crtEvents touchend.crtEvents",i.bind(this.onSeeked,this)))},onSeeked:function(){if(this.startSeekTime){var t={start:this.startSeekTime,end:this.player.currentTime()};this.triggerEvent("seek",t),this.startSeekTime=null}},onTimeUpdate:function(){this.triggerEvent("timeupdate")},onResolutionChange:function(t){var e=i.pick(t,"resolution");this.triggerEvent("resolutionchange",e)},onStopWaiting:function(t,e){!e.timeWaited||e.timeWaited<2e3||this.triggerEvent("waiting",e)},onLoadStart:function(){this.loadStartTime=i.now()},onLoadedData:function(){var t=i.now()-this.loadStartTime;this.triggerEvent("initialLoad",{loadTime:t})},logConversion:function(t){if(!this.videoConversionLogged&&n.bool("is_logged_in")&&!this.loggingInProgress){this.loggingInProgress=!0;var e=s.ajax({url:"/svc/log/conversion",type:"POST",contentType:"application/x-www-form-urlencoded",with_form_key:!0,data:"log="+JSON.stringify(t)});e.done(i.bind(this.onConversionSuccess,this)),e.fail(i.bind(this.onConversionFail,this))}},onConversionSuccess:function(){this.videoConversionLogged=!0,this.loggingInProgress=!1},onConversionFail:function(){this.loggingInProgress=!1}});e.exports=r},{"./base/base-plugin":326,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/lib/flags":"f/LVtH"}],331:[function(t,e){"use strict";var i=t("lodash"),s=t("video.js"),o=s.Component.extend({sdURL:null,hdURL:null,isUsingSD:!0,timeIntervalBinding:null,init:function(t,e){s.Component.prototype.init.call(this,t,e),this.addListeners(t)},addListeners:function(){this.on("click",this.toggleHDState)},createEl:function(){if(this.hdURL=this.player_.options_.crtOptions.hdUrl,!this.hdURL)return s.Component.prototype.createEl.call(this,"div",{});this.player_.addClass("vjs-has-hd-toggle");var t=s.Component.prototype.createEl.call(this,"div",{className:"vjs-hd-toggle vjs-sd vjs-menu-button vjs-control",innerHTML:"<span>HD</span>"});return t},currentSource:function(){return this.player_.currentSrc()},toggleSrc:function(){var t;this.isUsingSD?(this.sdURL=this.currentSource(),t=this.hdURL,s.removeClass(this.el_,"vjs-sd"),s.addClass(this.el_,"vjs-hd")):(t=this.sdURL,s.removeClass(this.el_,"vjs-hd"),s.addClass(this.el_,"vjs-sd")),this.isUsingSD=!this.isUsingSD,this.player_.src({src:t,type:"video/mp4"})},toggleHDState:function(){var t=this.player_.currentTime(),e=this.player_.paused(),s=this.player_.muted();this.player_.addClass("vjs-quality-toggling"),this.player_.trigger({type:"resolutionchange",resolution:this.isUsingSD?"hd":"sd"});i.delay(i.bind(function(){this.player_.pause(),this.toggleSrc(),this.player_.ready(function(){this.player_.one("loadedmetadata",i.bind(function(){this.player_.currentTime(t)},this)),this.timeIntervalBinding=i.bind(function(){this.player_.currentTime()-t>.1&&(this.player_.removeClass("vjs-quality-toggling"),this.player_.off("timeupdate",this.timeIntervalBinding),e&&(this.player_.pause(),this.player_.muted(s)))},this),this.player_.on("timeupdate",this.timeIntervalBinding),i.defer(i.bind(function(){this.player_.load(),s===!1&&e===!0&&this.player_.muted(!0),this.player_.play()},this))})},this),300)}});e.exports=o},{lodash:"K2RcUv","video.js":"AcVSFw"}],332:[function(t,e){"use strict";var i=t("jquery"),s=(t("lodash"),t("video.js")),o=t("./base/base-plugin"),n=o.extend({seeking:!1,render:function(){return this.$el=i('<div class="vjs-hover-handle vjs-slider-handle" aria-live="off"><span class="vjs-control-text"></span></div>'),this},afterRender:function(){this.$seekHandle=this.$$(".vjs-seek-handle")},update:function(t){t||(t={}),this.$time_el=this.$time_el||this.$el.find(".vjs-hover-handle-time");var e=t.hoverX||0,i=t.hoverTime||"0:00",o=s.formatTime(i);this.$time_el.html(o),this.$el.css("left",e+"px")}});e.exports=n},{"./base/base-plugin":326,jquery:"HlZQrA",lodash:"K2RcUv","video.js":"AcVSFw"}],333:[function(t,e){"use strict";var i=t("jquery"),s=t("video.js"),o=t("./base/base-plugin"),n=o.extend({render:function(){return this.$el=i('<div class="vjs-hover-slider-time" aria-live="off"></div>'),this},update:function(t){t||(t={});var e=t.hoverX||0,i=t.hoverTime||"0:00",o=s.formatTime(i);this.$el.html(o),this.$el.css("left",e+"px")}});e.exports=n},{"./base/base-plugin":326,jquery:"HlZQrA","video.js":"AcVSFw"}],334:[function(t,e){"use strict";var i=(t("jquery"),t("lodash")),s=t("video.js"),o=t("./base/base-plugin"),n=t("./hover-slider-handle"),a=t("./hover-slider-time"),r=t("./progress-bar-tooltip"),l=o.extend({elSelector:".vjs-progress-holder",initialize:function(){this.children={},this.$el=this.$$(this.elSelector),this.slider_width=this.$el.width(),this.createChildren(),this.$player.on("mousemove.sliderHover",this.elSelector,i.bind(this.onMouseMove,this)),this.$player.on("mouseenter.sliderHover",this.elSelector,i.bind(this.onMouseEnter,this)),this.$player.on("mouseout.sliderHover",this.elSelector,i.bind(this.onMouseOut,this)),this.player.on("dispose",i.bind(this.dispose,this)),this.player.on("fullscreenchange",i.bind(this.onUpdateDimensions,this)),this.player.on("CRTPlayer:updateDimensions",i.bind(this.onUpdateDimensions,this))},onUpdateDimensions:function(){this.slider_width=this.$el.width()},createChildren:function(){this.children.hoverSliderHandle=new n(this.player),this.children.hoverSliderTime=new a(this.player),this.player.options_.crtOptions.filmstrip&&(this.$el.addClass("with-filmstrip"),this.children.progressBarTooltip=new r(this.player)),this.appendChildren()},appendChildren:function(){i.each(this.children,i.bind(function(t){this.$el.append(t.render().$el)},this))},updateChildren:function(t){i.each(this.children,function(e){e.update(t)})},onMouseMove:function(t){this.$el.removeClass("auto-hide");var e=s.findPosition(this.$el[0]),i=t.pageX-e.left,o=s.Slider.prototype.calculateDistance.apply(this.player.controlBar.progressControl,[t.originalEvent]),n=o*this.player.player().duration(),a=n/this.player.player().duration();0>i?i=0:i>this.slider_width&&(i=this.slider_width),this.updateChildren({hoverX:i,hoverTime:n,hoverPercent:a})},onMouseOut:function(){this.$el.addClass("auto-hide")},onMouseEnter:function(){this.$el.removeClass("auto-hide")},dispose:function(){i.each(this.children,function(t){i.result(t,"dispose")}),o.prototype.dispose.apply(this,arguments)}});e.exports=l},{"./base/base-plugin":326,"./hover-slider-handle":332,"./hover-slider-time":333,"./progress-bar-tooltip":336,jquery:"HlZQrA",lodash:"K2RcUv","video.js":"AcVSFw"}],335:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("video.js"),n=o.Component.extend({isHidden:!0,init:function(t,e){o.Component.call(this,t,e),t.ready(s.bind(this.onReady,this))},onReady:function(){this.$player=i(this.player().el_),this.$el=i(this.el()),this.$loader=this.$el.find(".Knight-Rider-loader");var t=s.bind(this.hideLoader,this),e=s.bind(this.showLoader,this);this.player().on("waiting",e),this.player().on("canplay",t),this.player().on("canplaythrough",t),this.player().on("playing",t),this.player().on("seeking",e),this.player().on("seeked",t),this.player().on("ended",t),this.player().on("resolutionchange",e)},createEl:function(){return o.Component.prototype.createEl.call(this,"div",{className:"vjs-loading-spinner",innerHTML:'<div class="Knight-Rider-loader centered"><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div></div>',"aria-label":"loading"})},hideLoader:function(){return this.isHidden?this:(this.$loader.removeClass("animate"),this.$player.removeClass("vjs-loading"),this.isHidden=!0,this)},showLoader:function(){return this.isHidden?(this.$loader.addClass("animate"),this.$player.addClass("vjs-loading"),this.isHidden=!1,this):this},dispose:function(){o.Component.prototype.dispose.apply(this,arguments),this.$player=null,this.$el=null}});e.exports=n},{jquery:"HlZQrA",lodash:"K2RcUv","video.js":"AcVSFw"}],336:[function(t,e){"use strict";var i=t("jquery"),s=(t("lodash"),t("video.js"),t("./base/base-plugin")),o=s.extend({filmstrip_thumbnail_count:10,render:function(){var t=this.player.options_.crtOptions.filmstrip,e=t.url,s=.5*t.width,o=.5*t.height,n=6;return this.$el=i('<div class="crt-progress-tooltip"></div>'),this.$thumbnail=i('<div class="crt-progress-tooltip-thumbnail"></div>'),this.$el.css({transform:"translateX(-50%)",width:s+n+"px",height:o+n+"px"}),this.$thumbnail.css({width:s+"px",height:o+"px","background-image":"url("+e+")","background-size":s*this.filmstrip_thumbnail_count+"px "+o+"px"}),this.$el.append(this.$thumbnail),this},update:function(t){t||(t={});var e=t.hoverX||0;this.$el.css("left",e+"px");var i=isNaN(t.hoverPercent)?0:100*t.hoverPercent,s=100/(this.filmstrip_thumbnail_count-1),o=Math.floor(i/this.filmstrip_thumbnail_count)*s;this.$thumbnail.css("background-position",o+"% 0%")}});e.exports=o},{"./base/base-plugin":326,jquery:"HlZQrA",lodash:"K2RcUv","video.js":"AcVSFw"}],337:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="mute-icon"><div class="speaker"></div><div class="unmuted"></div><div class="muted"></div></div><div><span class="vjs-control-text">Mute</span></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],338:[function(t,e){"use strict";function i(t,e){var i=s.merge({},p(),e);s.extend(i,s.pick(e,"techOrder"));var a=n.defer(),l=function(){var t;e.src&&e.type?(this.src(e),a.resolve(this)):e.file?(t=e.file.type||"video/mp4",this.src({src:r(e.file),type:t}),a.resolve(this),delete e.file):a.resolve(this)};return o(t,i,l),a.promise}var s=t("lodash"),o=t("video.js"),n=t("when"),a=t("prima/lib/data"),r=t("app/lib/create-object-url"),l=t("./hover-slider"),h=t("./detect-buffering"),d=t("./event-dispatcher");o.BigPlayToggle=t("./big-play-toggle"),o.AnimatingMuteToggle=t("./animating-mute-toggle"),o.CrtSeekBar=t("./crt-seekbar"),o.LoadingSpinner=t("./loading-spinner"),o.HDToggle=t("./hd-toggle"),o.log=s.noop,o.log.error=s.noop,o.log.warn=s.noop,o.log.history=[];var c=function(t){this.crt=this.options_.crt,this.options_.crt=null,this.hoverSlider=new l(this,t),this.detectBuffering=new h(this,t),this.eventDispatcher=new d(this,t)};o.plugin("crt",c);var u,p=function(){var t=a.get("Context/hosts");return u||(u={children:["mediaLoader","posterImage","bigPlayToggle",{name:"controlBar",children:["playToggle","currentTimeDisplay","timeDivider","durationDisplay","remainingTimeDisplay",{name:"progressControl",children:["crtSeekBar"]},"fullscreenToggle","hDToggle","animatingMuteToggle","loadingSpinner"]},"errorDisplay"],plugins:{crt:{}},crtOptions:{filmstrip:!1,hdUrl:!1,duration:null},controls:!0,autoplay:!1,defaultVolume:.8,flash:{swf:t.assets_host+"/assets/src/scripts/vendor/video-js/video-js-swf-4.5.2.swf"},techOrder:["html5","flash"]}),u};e.exports=i},{"./animating-mute-toggle":325,"./big-play-toggle":327,"./crt-seekbar":328,"./detect-buffering":329,"./event-dispatcher":330,"./hd-toggle":331,"./hover-slider":334,"./loading-spinner":335,"app/lib/create-object-url":295,lodash:"K2RcUv","prima/lib/data":431,"video.js":"AcVSFw",when:"RG2dij"}],339:[function(t,e){"use strict";var i=t("./views/drawerform.js");e.exports=i},{"./views/drawerform.js":341}],340:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<h1 class="form-heading">',__p+=title?""+(null==(__t=__(title))?"":__t):""+(null==(__t=__("Flag this"))?"":__t),__p+='</h1><div class="form-description">',__p+=description?""+(null==(__t=__(description))?"":__t):""+(null==(__t=__("Seeing something you shouldn't? This is the place to tell us about it. %1$sLearn more%2$s about how we handle these matters and what you can do to help.",'<a href="/docs/discovery#moderationheader" target="_blank">',"</a>"))?"":__t),__p+="</div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],341:[function(t,e){"use strict";var i=t("jquery"),s=(t("lodash"),t("prima/view")),o=t("prima/lib/translate"),n=t("prima/mixins/accessor"),a=t("prima/events"),r=t("./imageupload"),l=t("./fieldvalidation"),h=t("./errortags"),d=s.extend({mixins:[n],templateAttributes:{__:o,formKey:i("#tumblr_form_key").attr("content")},initialize:function(t){t=t||{},this.set("complete",!1),this.fieldValidation=new l({el:this.$el}),this.imageUpload=new r({el:this.$el}),this.errortags=new h({mobileMode:"undefined"!=typeof t.mobileMode?t.mobileMode:!1}),this._bindEvents()},_bindEvents:function(){this.listenTo(a,"drawer:close",this._teardown),this.listenTo(a,"drawerform:validation",this._updateCompleteStatus)},_updateCompleteStatus:function(t){this.set("complete",t.status)},_teardown:function(){this.fieldValidation.remove(),this.imageUpload.remove(),this.errortags.remove()}});e.exports=d},{"./errortags":342,"./fieldvalidation":343,"./imageupload":345,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/lib/translate":456,"prima/mixins/accessor":458,"prima/view":496}],342:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/lib/translate"),n=t("prima/mixins/accessor"),a=t("prima/view"),r=t("prima/events"),l=t("velocity-animate"),h=a.extend({mixins:[n],el:".form-container",defaultText:"A few details, please",initialize:function(t){this.set("mobileMode","undefined"!=typeof t&&t.mobileMode?t.mobileMode:!1),this.errorTags={},this.listenTo(r,"drawerform:errortag:show",this.showErrorTag),this.listenTo(r,"drawerform:errortag:remove",this.removeErrorTag),this.listenTo(r,"drawerform:errortag:removeall",this.removeAllErrorTags)},showErrorTag:function(t){if("undefined"!=typeof t&&t.field){var e=t.field,n=t.text||o(this.defaultText),a=e.attr("name");this.errorTags[a]||(this.errorTags[a]=i("<div>").addClass("drawer-error-tag").text(n),this.get("mobileMode")?(this.errorTags[a].css({top:e.position().top}).addClass(a).appendTo(e.closest(".form-container")),l.animate(this.errorTags[a],"fadeIn",{duration:100,easing:"easeInOut"}),l.animate(this.errorTags[a],"fadeOut",{duration:100,easing:"easeIn",delay:3e3,complete:s.bind(function(){this.removeErrorTag({field:e})},this)})):("undefined"==typeof this.drawer&&(this.$drawer=i(".drawer"),this.$drawer.on("scroll",s.bind(this.updateErrortagPosition,this))),this.errorTags[a].css({top:e.offset().top,right:this.$drawer.width()}).insertAfter(this.$drawer),l.animate(this.errorTags[a],{translateX:["-5px","0px"]},{duration:100,easing:"easeInOut"})))}},removeErrorTag:function(t){var e=t.field,i=e.attr("name");"undefined"!=typeof this.errorTags&&this.errorTags[i]&&(this.errorTags[i].remove(),delete this.errorTags[i])},removeAllErrorTags:function(){"undefined"!=typeof this.errorTags&&this.errorTags&&s.each(this.errorTags,function(t){t&&(t.remove(),t="")})},updateErrortagPosition:function(){"undefined"!=typeof this.errorTags&&this.errorTags&&s.each(this.errorTags,function(t,e){var s=i('.form-container [name="'+e+'"]');s?t.css({top:s.offset().top}):(t.remove(),this.removeErrorTag({field:s}))},this)},remove:function(){this.removeAllErrorTags(),"undefined"!=typeof this.$drawer&&this.$drawer.off("scroll",s.bind(this.updateErrortagPosition,this)),a.prototype.remove.apply(this)}});e.exports=h},{jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/lib/translate":456,"prima/mixins/accessor":458,"prima/view":496,"velocity-animate":"lWl/mc"}],343:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/lib/translate"),n=t("prima/view"),a=t("prima/events"),r=t("prima/lib/validators"),l=5e3,h=n.extend({events:{'change [data-validate-input="dropdown"]':"fieldValidationHandler",'keyup [data-validate-input="email"]':"fieldValidationHandler",'blur [data-validate-input="email"]':"fieldValidationHandler",'keyup [data-validate-input="text"]':"fieldValidationHandler",'blur [data-validate-input="text"]':"fieldValidationHandler",'change [data-validate-input="file"]':"fieldValidationHandler",'change [data-validate-input="checkbox"]':"validateAllFields"},validationErrorMessages:{email:"We gotta write you back, though"},initialize:function(){this.listenTo(a,"drawerform:validation:trigger",this.validateAllFields)
},validateAllFields:function(){var t=i("[data-validate-input]"),e=t.length>0;s.each(t,function(t){var s=i(t).data("validate-input"),o=i(t).val();return this.isFieldValid(o,s)?void 0:(e=!1,!1)},this),a.trigger("drawerform:validation",{status:e})},fieldValidationHandler:function(t){var e=i(t.target),s=e.val(),n=e.data("validate-input"),r=e.data("error-text");this.isFieldValid(s,n)?(e.hasClass("error")&&e.removeClass("error"),a.trigger("drawerform:errortag:remove",{field:e})):"focusout"===t.type&&(e.addClass("error"),a.trigger("drawerform:errortag:show",{field:e,text:o(this.validationErrorMessages[r])})),this.validateAllFields()},isFieldValid:function(t,e){var i;switch(e){case"email":i=r.isEmail(t);break;case"text":i=!r.isBlank(t)&&r.maxLength(t,l);break;case"file":i=!r.isBlank(t);break;case"dropdown":i=!r.isBlank(t);break;case"checkbox":i=this.isAtLeastOneChecked()}return i},isAtLeastOneChecked:function(){var t=i('input[type="checkbox"]:checked');return t.length>0}});e.exports=h},{jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/lib/translate":456,"prima/lib/validators":457,"prima/view":496}],344:[function(t,e){"use strict";var i=t("prima/lib/translate"),s=t("prima/view"),o=t("../templates/formheader.tpl"),n=s.extend({className:"form-header",initialize:function(t){return t=t||{},this.templateAttributes={__:i,title:"undefined"!=typeof t.title?t.title:"",description:"undefined"!=typeof t.description?t.description:""},this},render:function(){return this.$el.html(o(this.templateAttributes)),this}});e.exports=n},{"../templates/formheader.tpl":340,"prima/lib/translate":456,"prima/view":496}],345:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/lib/translate"),n=t("prima/view"),a=t("prima/events"),r=15e6,l=n.extend({events:{"change .image-upload":"onImageUploadClick","click .btn-remove-uploaded":"onRemoveImageClick"},onImageUploadClick:function(t){var e=t.currentTarget;if(this.imageUploadEl=i(".image-upload-input"),this.imagePreviewEl=i(".image-upload-preview"),e.files&&e.files[0]){if(e.files[0].size>r)return a.trigger("drawerform:errortag:show",{field:this.imageUploadEl,text:o("File is too big.")}),void i(e).replaceWith(i(e).val("").clone(!0));a.trigger("drawerform:errortag:remove",{field:this.imageUploadEl}),this.imageUploadEl.addClass("hidden");var n=new FileReader;n.readAsDataURL(e.files[0]),n.onload=s.bind(function(t){this.imagePreviewEl.removeClass("hidden"),t.target.result&&t.target.result.length?(this.imagePreviewEl.find("img").attr("src",t.target.result),this.imagePreviewEl.addClass("shown")):this.imageUploadEl.removeClass("hidden")},this)}},onRemoveImageClick:function(){var t=i(".image-upload-input input");t.replaceWith(t.val("").clone(!0)),i(".image-upload-input input").trigger("change"),this.imagePreviewEl.removeClass("shown"),this.imageUploadEl.removeClass("hidden")}});e.exports=l},{jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/lib/translate":456,"prima/view":496}],346:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/component"),n=t("prima/events"),a=t("app/components/drawer"),r=t("prima/mixins/keycommands"),l=t("./views/helpformview.js"),h=o.extend({name:"HelpForm",mixins:[r],keycommands:{"keydown:shift+h":"open"},initialize:function(){this.drawerManager=a(),this.bindEvents()},bindEvents:function(){this.listenTo(n,"helpform:open",this.open),this.listenTo(n,"helpform:close",this.close),this.listenTo(this.drawerManager,"open:helpform",this.openEventHandler),this.listenTo(this.drawerManager,"open:helpform:terminated",s.partial(this.openEventHandler,{category:"terminated"})),this.listenTo(this.drawerManager,"open:helpform:login",s.partial(this.openEventHandler,{category:"login"}))},close:function(){this.drawerManager.close(),n.trigger("helpform:closed")},openEventHandler:function(t){this.open(t),n.trigger("helpform:opened:withButton")},open:function(t){var e=i(document.activeElement).is("input,textarea,div[contenteditable]");this.drawerManager.canOpen()&&!e?this.drawerManager.open(l,t):this.drawerManager.close()}});e.exports=h},{"./views/helpformview.js":352,"app/components/drawer":44,jquery:"HlZQrA",lodash:"K2RcUv","prima/component":428,"prima/events":429,"prima/mixins/keycommands":462}],347:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="form-container form"><div class="form-header with-border"><h1 class="form-heading">'+(null==(__t=__("Help me, Tumblr"))?"":__t)+'</h1><div class="form-description"><p>'+(null==(__t=__("You got it. Describe the problem you're having as best you can, and a member of our Support team will be in touch with you as soon as possible."))?"":__t)+"</p>",abuse_forms&&(__p+="<br><p>"+(null==(__t=__("%1$sNote:%2$s This form is for technical issues and general weirdness. If you're reporting a violation of our Community Guidelines, use %3$sthis other form%4$s instead.","<strong>","</strong>",'<a href="/abuse">',"</a>"))?"":__t)+"</p>"),__p+='</div></div><form action="/support/ticket/new" src="" method="POST" enctype="multipart/form-data" target="help_form_target"><iframe id="help_form_target" name="help_form_target" style="width:0;height:0;border:none;margin:0;padding:0"></iframe><input type="hidden" name="jsonp" value="help_modal.evaluate_response"> <input type="hidden" name="support_type" id="support_form_support_type" value="support"> <input type="hidden" name="form_key" id="support_form_form_key" value="'+(null==(__t=formKey)?"":__t)+'">',languageNotice&&(__p+='<div class="form-group"><div class="group-row"><span class="language-notice">'+(null==(__t=__("Just so you know, we're not yet able to address queries that are written in [language]. You can still use this form to contact our Support team, but you'll need to fill it out in English. Sorry about that, and thanks for your patience."))?"":__t)+"</span></div></div>"),__p+='<div class="form-group"><div class="group-label"><h3 class="settings_subheading">'+(null==(__t=__("What's going on?"))?"":__t)+'</h3></div><div class="group-content"><div class="flat_select attached">',preSelectedCategory?(__p+='<select name="subject" id="category" class="category" data-validate-input="dropdown"><option value="'+(null==(__t=__("Category"))?"":__t)+'" disabled="disabled">'+(null==(__t=__("Category"))?"":__t)+"</option>",_.each(categories,function(t,e){__p+="",__p+=e===preSelectedCategory?'<option value="'+(null==(__t=e)?"":__t)+'" selected="selected">'+(null==(__t=__(t))?"":__t)+"</option>":'<option value="'+(null==(__t=e)?"":__t)+'">'+(null==(__t=__(t))?"":__t)+"</option>",__p+=""}),__p+='</select><label for="category" class="current_selection">'+(null==(__t=categories[preSelectedCategory])?"":__t)+"</label>"):(__p+='<select name="subject" id="category" class="category" data-validate-input="dropdown"><option value="'+(null==(__t=__("Category"))?"":__t)+'" disabled="disabled" selected="selected">'+(null==(__t=__("Category"))?"":__t)+"</option>",_.each(categories,function(t,e){__p+='<option value="'+(null==(__t=e)?"":__t)+'">'+(null==(__t=__(t))?"":__t)+"</option>"}),__p+='</select><label for="category" class="current_selection">'+(null==(__t=__("Category"))?"":__t)+"</label>"),__p+='<i class="icon"></i></div><textarea class="body" data-validate-input="text" name="body" cols="30" rows="5" placeholder="'+(null==(__t=__("The more details, the better"))?"":__t)+'"></textarea></div></div><div class="form-group"><div class="group-label"><h3 class="settings_subheading">'+(null==(__t=__("Attachment"))?"":__t)+'</h3><div class="sub-label">'+(null==(__t=__("Optional"))?"":__t)+'</div></div><div class="group-content"><div class="image-upload-input"><input id="image-upload" class="image-upload" type="file" name="attachments[]" accept="image/*"><label class="image-upload" for="image-upload"></label></div><div class="image-upload-preview"><img src=""><div class="btn_remove btn-remove-uploaded" data-tooltip="'+(null==(__t=__("Remove image"))?"":__t)+'"></div></div></div></div><div class="form-group"><div class="group-label"><h3 class="settings_subheading">'+(null==(__t=__("Relevant blog"))?"":__t)+'</h3><div class="sub-label">'+(null==(__t=__("Optional"))?"":__t)+'</div></div><div class="group-content">',tumblelogs&&_.size(tumblelogs)>=1?(__p+='<div class="flat_select"><select name="support_form_blog" id="tumblelog" class="tumblelog"><option value="" selected="selected">'+(null==(__t=__("None selected"))?"":__t)+"</option>",_.each(tumblelogs,function(t){__p+='<option value="'+(null==(__t=t.name)?"":_.escape(__t))+'">'+(null==(__t=t.name)?"":_.escape(__t))+"</option>"}),__p+='</select><label for="tumblelog" class="current_selection">'+(null==(__t=__("None selected"))?"":__t)+'</label><i class="icon"></i></div>'):__p+='<input class="text_field" name="support_form_blog" placeholder="'+(null==(__t=__("Username or URL"))?"":__t)+'">',__p+='</div></div><div class="form-group"><div class="group-label"><h3 class="settings_subheading">'+(null==(__t=__("Where should we reach you?"))?"":__t)+'</h3></div><div class="group-content"><input class="text_field" data-validate-input="email" data-error-text="email" name="user_email" placeholder="'+(null==(__t=__("Email address"))?"":__t)+'" value="'+(null==(__t=email)?"":__t)+'"></div></div><div class="form-group"><button class="chrome big blue right help-form-next" disabled="disabled"><span class="label">'+(null==(__t=__("Next"))?"":__t)+'</span> <span class="Knight-Rider-loader animate"><span class="Knight-Rider-bar"></span><span class="Knight-Rider-bar"></span><span class="Knight-Rider-bar"></span></span></button></div></form></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],348:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="error-message"><div class="error-text">',errors?(__p+="",_.each(errors,function(t){__p+="<div>"+(null==(__t=t.error)?"":_.escape(__t))+"</div>"}),__p+=""):__p+=""+(null==(__t=__("Oops. There was an error. Try again."))?"":__t),__p+="</div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],349:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="question">'+(null==(__t=question)?"":__t)+'</div><div class="answer">'+(null==(__t=answer)?"":__t)+"</div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],350:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="form-container suggestions"><div class="form-header with-border"><h1 class="form-heading">'+(null==(__t=__("Does any of this help?"))?"":__t)+'</h1></div><div class="suggestions-list"></div><div class="form-group"><button class="chrome big left help-form-dismiss">'+(null==(__t=__("Yep, found it"))?"":__t)+'</button> <button class="chrome big blue right help-form-submit"><span class="label">'+(null==(__t=__("No, send my thing"))?"":__t)+'</span> <span class="Knight-Rider-loader animate"><span class="Knight-Rider-bar"></span><span class="Knight-Rider-bar"></span><span class="Knight-Rider-bar"></span></span></button></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],351:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="form-container success"><div class="success-message"><h1 class="message-title">'+(null==(__t=__("Got it"))?"":__t)+'</h1><p class="message-text">'+(null==(__t=__("Our Support team will be emailing you shortly."))?"":__t)+"<br>"+(null==(__t=__("And thanks for bringing this thing to our attention."))?"":__t)+"</p></div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],352:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/lib/data"),n=t("prima/events"),a=t("prima/mixins/accessor"),r=t("app/mixins/tumblrselect"),l=t("prima/lib/flags"),h=t("../templates/helpform.tpl"),d=t("../templates/suggestions.tpl"),c=t("../templates/ticketcreated.tpl"),u=t("../templates/partials/error_message.tpl"),p=t("../templates/partials/suggestion_item.tpl"),m=t("components/drawer-form"),g=m.extend({mixins:[a,r],templates:{helpForm:h,suggestions:d,suggestionItem:p,ticketCreated:c,errorMessage:u},events:{"click .help-form-next":"onFormNextClick","click .help-form-submit":"onFormSubmitClick","click .help-form-dismiss":"dismissForm","click .suggestion.with-link":"onSuggestionClick","change [data-validate-input]":"onFieldInputChange"},className:"help-form",categories:{terminated:"Terminated blog",login:"Trouble logging in",suspiciousact:"Suspicious activity on my account",dashboard:"Dashboard is behaving weirdly",mobile:"Mobile app is behaving weirdly",theme:"Theme is acting up",featrequest:"Feature request","else":"Something else"},initialize:function(t){m.prototype.initialize.call(this,t),this.set("suggestionsShown",!1),this.on("change:complete",this.updateSubmitButton),this.set("wasFormTouched",!1),this.set("wasFaqLoaded",!1),this.set("mobileMode",t.mobileMode||!1),n.on("drawer:close",s.bind(this.teardown,this));var e=o.get("Components/HelpForm");this.templateAttributes.email=e.email,this.templateAttributes.tumblelogs=e.tumblelogs,this.templateAttributes.languageNotice=e.language_notice,this.templateAttributes.categories=this.categories,this.templateAttributes.preSelectedCategory=t&&t.category?t.category:"",this.templateAttributes.abuse_forms=l.bool("abuse_forms"),this.lang=e.lang,this.setUpResponseHandler()},dismissForm:function(){this.logEvent("foundItClicked"),this.get("mobileMode")?"undefined"!=typeof window.history&&window.history.length>2?window.history.go(-1):window.location="/dashboard":n.trigger("helpform:close")},setUpResponseHandler:function(){window.help_modal={},window.help_modal.evaluate_response=s.bind(function(t){t.meta&&201===t.meta.status?this.onRequestSuccess():this.onRequestFail(t)},this)},getFaqs:function(){var t=i.ajax({url:"/svc/faqs/"+this.lang});t.then(s.bind(this.onFaqRequestSuccess,this),s.bind(this.onFaqRequestFail,this))},onFaqRequestSuccess:function(t){this.prepareFaqIndex("undefined"!=typeof t.response.faqs?t.response.faqs:[])},onFaqRequestFail:function(){this.prepareFaqIndex([])},prepareFaqIndex:function(t){this.keywordIndex={},this.faqList={};var e;"undefined"!=typeof t&&t.length>0&&s.each(t,function(t){s.each(t.keywords.split(","),function(i){this.faqList[t.id]={},this.faqList[t.id].question=t.question,this.faqList[t.id].answer=t.answer,e=t.question.match('(https?://[^"]+)'),this.faqList[t.id].faqLink=null!==e?e[0]:!1,"undefined"==typeof this.keywordIndex[i]&&(this.keywordIndex[i]=[]),this.keywordIndex[i].push(t.id)},this)},this),this.set("wasFaqLoaded",!0)},updateSubmitButton:function(){this.get("complete")===!0?this.nextFormButton.removeAttr("disabled"):this.nextFormButton.attr("disabled","disabled")},onRequestSuccess:function(){this.$el.html(this.templates.ticketCreated(this.templateAttributes)),this.logEvent("submit:success"),n.trigger("drawer:disableCloseConfirmation"),setTimeout(function(){n.trigger("helpform:close")},5e3)},onRequestFail:function(t){var e=i(this.get("suggestionsShown")?".help-form-submit":".help-form-next"),o=s.clone(this.templateAttributes),n=i(".error-message");n&&n.remove(),t.response&&t.response.errors&&s.extend(o,t.response),i(this.templates.errorMessage(o)).insertBefore(e.closest(".form-group")),e.removeClass("loading"),this.logEvent("submit:error",{error:t})},onFormNextClick:function(t){if(t.target&&t.preventDefault(),n.trigger("drawerform:errortag:removeall"),!this.get("wasFaqLoaded"))return this.nextFormButton.addClass("loading"),void this.once("change:wasFaqLoaded",this.onFormNextClick,this);var e=this.getSuggestions();e.length>0?(this.set("suggestionsShown",!0),this.form.addClass("not-shown"),this.$el.prepend(this.templates.suggestions(s.extend(this.templateAttributes))),this.fillInSuggestions(e),this.resetScroll(),this.logEvent("suggestions:found",{suggestions:e})):(this.form.find("form").submit(),this.nextFormButton.addClass("loading"),this.logEvent("suggestions:notfound")),this.sendLogQuery()},onSuggestionClick:function(t){var e=i(t.target);this.logEvent("suggestions:clicked",{faqLink:e.attr("href")})},onFieldInputChange:function(){this.get("wasFormTouched")||(this.set("wasFormTouched",!0),n.trigger("drawer:enableCloseConfirmation"),this.getFaqs())},resetScroll:function(){var t;this.get("mobileMode")?t=i("body"):("undefined"==typeof this.drawer&&(this.drawer=this.$el.closest(".drawer")),t=this.drawer),s.defer(function(){t.scrollTop(0)})},logEvent:function(t,e){if(t&&t.length){var i={category:this.categoryField.val()||"",query:this.bodyField.val()||""};s.extend(i,e),n.trigger("helpform:"+t,{loggingData:i})}},fillInSuggestions:function(t){var e=i(".suggestions-list");s.each(t,function(t){t.faqLink?i("<a></a>").attr({href:t.faqLink,target:"_blank","class":"suggestion with-link"}).html(this.templates.suggestionItem(t)).appendTo(e):i("<div></div>").attr({"class":"suggestion"}).html(this.templates.suggestionItem(t)).appendTo(e)},this)},onFormSubmitClick:function(){this.form.find("form").submit(),this.$el.find(".help-form-submit").addClass("loading")},sendLogQuery:function(){i.ajax({url:"/help/query",type:"POST",data:{query:this.bodyField.val(),matched:this.get("suggestionsShown")?1:0}})},getSuggestions:function(){var t=this.bodyField.val().trim().toLowerCase(),e={},i=[];return s.each(this.keywordIndex,function(i,o){(0===t.indexOf(o)||t.indexOf(" "+o)>0)&&s.each(i,function(t,i){"undefined"==typeof e[t]&&(e[t]=0),e[t]+=10>i?.05*(10-i):0},this)},this),e=s.chain(e).map(function(t,e){return{name:e,score:t}}).sortBy(function(t){return t.score}).reverse().filter(function(t,e){return 5>e}).value(),s.each(e,function(t){i.push(this.faqList[t.name])},this),i},render:function(){return this.$el.html(this.templates.helpForm(this.templateAttributes)),this.form=this.$el.find(".form-container.form"),this.bodyField=this.$el.find(".body"),this.categoryField=this.$el.find(".category"),this.nextFormButton=this.$el.find(".help-form-next"),this.setUpSelector(this.$el.find(".category")),this.setUpSelector(this.$el.find(".tumblelog")),this},teardown:function(){window.location&&"/support"===window.location.pathname&&n.trigger("helpform:navigateBackToHelp")}});e.exports=g},{"../templates/helpform.tpl":347,"../templates/partials/error_message.tpl":348,"../templates/partials/suggestion_item.tpl":349,"../templates/suggestions.tpl":350,"../templates/ticketcreated.tpl":351,"app/mixins/tumblrselect":298,"components/drawer-form":339,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/lib/data":431,"prima/lib/flags":"f/LVtH","prima/mixins/accessor":458}],353:[function(t,e){"use strict";var i=t("./views/knight-rider-loader-view.js");e.exports=i},{"./views/knight-rider-loader-view.js":355}],354:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="knight-rider-loader '+(null==(__t=variation)?"":_.escape(__t))+'" data-js-knightrider><div class="knight-rider-bar"></div><div class="knight-rider-bar"></div><div class="knight-rider-bar"></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],355:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/subviewable"),n=t("prima/mixins/selectorcache"),a=t("prima/mixins/accessor"),r=t("../templates/knight-rider-loader.tpl"),l=s.extend({className:"knight-rider-container",mixins:[o,n,a],template:r,defaults:{variation:"",loading:!1},initialize:function(t){t=i.extend({},t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),this.listenTo(this,"change:loading",this._onChangeLoading)},_onChangeLoading:function(t,e){this.$el.toggleClass("loading",e),this.js$("knightRider").toggleClass("animate",e),this.$el.toggle(e)},serialize:function(){return this.toJSON()},render:function(){return this.$el.html(this.template(this.serialize())),this._onChangeLoading(this,this.get("loading")),this}});e.exports=l},{"../templates/knight-rider-loader.tpl":354,lodash:"K2RcUv","prima/mixins/accessor":458,"prima/mixins/selectorcache":467,"prima/mixins/subviewable":468,"prima/view":496}],356:[function(t,e){"use strict";var i=t("./views/base.js");e.exports=i},{"./views/base.js":360}],357:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="bar white"></div><div class="bar red"></div><div class="bar orange"></div><div class="bar green"></div><div class="bar purple"></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],358:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+=""+(null==(__t=_subview("loaderType"))?"":__t);return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],359:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/views/base"),o=t("../templates/bar.tpl"),n=s.extend({className:"loader-bar",template:o,defaults:{classModifiers:"",loading:!1},initialize:function(t){this.options=i.extend({},this.defaults,t),this.$el.addClass(this.get("classModifiers")),this.interval=null,this.timeout=null},afterRender:function(){this.$bars=this.$el.find(".bar"),this.get("loading")===!0&&this.toggleLoading(this.get("loading"))},toggleLoading:function(t){this.currentBar=0,this.counter=0,t===!0?(clearTimeout(this.timeout),this.$el.addClass("loading"),this.$bars.addClass("animating"),this.startAnimating()):(this.$el.removeClass("loading"),this.stopAnimating(),setTimeout(i.bind(function(){this.$bars.removeClass("animating")},this),300))},showBar:function(t){this.$bars.eq(t).addClass("active")},hideBar:function(t){this.$bars.eq(t).removeClass("active")},loop:function(){var t=this.$bars.eq(this.currentBar);t.remove(),this.$el.append(t),this.currentBar+=1,this.currentBar>=this.$bars.length&&(this.currentBar=0),this.counter++},startAnimating:function(){this.stopAnimating(),this.loop(),this.interval=setInterval(i.bind(function(){this.loop()},this),300)},stopAnimating:function(){clearInterval(this.interval)}});e.exports=n},{"../templates/bar.tpl":357,lodash:"K2RcUv","prima/views/base":497}],360:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/views/base"),o=t("./bar.js"),n=t("../templates/base.tpl"),a=s.extend({className:"loader-container",template:n,defaults:{type:"",classModifiers:"",loading:!1},initialize:function(t){this.options=i.extend({},this.defaults,t),this.$container=t.$container,"bar"===this.get("type")&&this.createBarLoader(),this.listenTo(this,"change:loading",this._onChangeLoading),this.attach()},createBarLoader:function(){this.subviews.loaderType=new o(this.options)},_onChangeLoading:function(t,e){this.subviews.loaderType.toggleLoading(e)},attach:function(){this.render(),this.$el.attr("data-subview=loader"),this.$container.find("[data-subview=loader]").replaceWith(this.$el)}});e.exports=a},{"../templates/base.tpl":358,"./bar.js":359,lodash:"K2RcUv","prima/views/base":497}],361:[function(t,e){"use strict";e.exports={SharePopoverView:t("./views/share-popover"),FeatureHelpPopoverView:t("./views/feature-help-popover")}},{"./views/feature-help-popover":369,"./views/share-popover":372}],362:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/model"),o=t("prima/lib/translate"),n=s.extend({defaults:{flags:[{name:"nsfw",label:o("This should be filtered")},{name:"spam",label:o("This is spam")},{name:"general",label:i.sprintf(o("This violates Tumblr's %1$sCommunity Guidelines%2$s"),'<a class="community_guidelines_link" href="https://www.tumblr.com/policy/community" target="_blank">',"</a>")}],violations:[{name:"hate",label:o("Malicious speech")},{name:"minors",label:o("Harm to minors")},{name:"selfharm",label:o("Promotion or glorification of self-harm")},{name:"gore",label:o("Gore, mutilation, bestiality, or necrophilia")},{name:"attribution",label:o("Misattribution or non-attribution")},{name:"impersonation",label:o("Confusion or impersonation")},{name:"harassment",label:o("Harassment")}]}});e.exports=n},{lodash:"K2RcUv","prima/lib/translate":456,"prima/model":471}],363:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/model"),n=t("prima/lib/data"),a=t("prima/lib/flags"),r=t("app/components/post-embed-code"),l=o.extend({urlRoot:function(){var t=n.get("Context/hosts");return s.isEmpty(t)?"http://www.tumblr.com":t.www_host},defaults:{embed_code:"",form_key:i("#tumblr_form_key").attr("content"),has_facebook:!1,has_user:!1,is_private:!1,permalink_label:"",post_id:"",post_tiny_url:"",post_url:"",show_email:!0,show_embed:!0,show_facebook:!0,show_permalink:!0,show_pinterest:!0,show_twitter:!0,show_flagging:!0,tumblelog_name:"",twitter_username:"",embed_key:"",pinterest_share_window:{}},initialize:function(){this.get("embed_code")||this.set("embed_code",new r(this.toJSON()).getCode()),a.bool("enable_share_embed_code")||this.set("show_embed",!1),a.bool("pinterest_sharing")||this.set("show_pinterest",!1)},shareEmail:function(t){return this.share("/svc/share/email",t)},shareTwitter:function(t){return this.share("/svc/share/twitter",t)},shareFacebook:function(t){return this.share("/svc/share/facebook",t)},sharePinterest:function(t){return this.share("/svc/share/pinterest",t)},facebookStatus:function(){return i.ajax({url:this.urlRoot()+"/svc/facebook_status",type:"post",data:{form_key:this.get("form_key")}})},share:function(t,e){return e=e||[],e.push({name:"form_key",value:this.get("form_key")}),i.ajax({url:this.urlRoot()+t,type:"post",data:e,success:s.bind(function(){this.trigger("success")},this),error:s.bind(function(){this.trigger("error")},this)}),this}});e.exports=l},{"app/components/post-embed-code":81,jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/data":431,"prima/lib/flags":"f/LVtH","prima/model":471}],364:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="","undefined"!=typeof template&&"standard"===template?(__p+='<div class="popover tutorial '+(null==(__t=name)?"":_.escape(__t))+'_step">',"undefined"!=typeof title&&(__p+='<h3 class="title">'+(null==(__t=title)?"":__t)+"</h3>"),__p+='<p class="content">'+(null==(__t=content)?"":_.escape(__t))+"</p>","undefined"!=typeof ok_text&&(__p+='<button class="chrome blue ok_button" type="button">'+(null==(__t=ok_text)?"":_.escape(__t))+"</button>"),__p+="</div>"):"undefined"!=typeof template&&"appearance"===template&&(__p+='<div class="popover tutorial '+(null==(__t=name)?"":_.escape(__t))+'_step"><div class="popover_inner">',"undefined"!=typeof title&&(__p+='<h3 class="title">'+(null==(__t=title)?"":__t)+"</h3>"),__p+='<p class="content">'+(null==(__t=content)?"":_.escape(__t))+'</p></div><div class="appearance small" style="background-color:'+(null==(__t=appearance_data.global_theme_params.background_color)?"":_.escape(__t))+"; color:"+(null==(__t=appearance_data.global_theme_params.background_color)?"":_.escape(__t))+'"><div class="navigation"><a class="chrome edit_button" href="/settings/blog/'+(null==(__t=appearance_data.name)?"":_.escape(__t))+'">'+(null==(__t=edit_text)?"":_.escape(__t))+'</a></div><div class="header_image" style="background-image:url('+(null==(__t=appearance_data.global_theme_params.header_image_focused)?"":_.escape(__t))+')"></div><div class="avatar '+(null==(__t=appearance_data.global_theme_params.avatar_shape)?"":_.escape(__t))+'" style="background-image:url('+(null==(__t=appearance_data.avatar_url)?"":_.escape(__t))+')"><img src="'+(null==(__t=appearance_data.avatar_url)?"":_.escape(__t))+'" alt=""></div><div class="info" style="color:'+(null==(__t=appearance_data.global_theme_params.title_color)?"":_.escape(__t))+'">',appearance_data.title&&(__p+='<h1 class="title" style="font-weight:'+(null==(__t=appearance_data.global_theme_params.title_font_weight)?"":_.escape(__t))+'">'+(null==(__t=appearance_data.title)?"":_.escape(__t))+"</h1>"),__p+="",appearance_data.description&&(__p+='<div class="description"><p class="description_inner">'+(null==(__t=appearance_data.description)?"":_.escape(__t))+"</p></div>"),__p+="</div></div></div>"),__p+='<div class="glass blue"></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],365:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="popover popover_menu popover_gradient message-controls-popover"><div class="popover_inner"><ul>',this.options.blockString&&(__p+='<li class="popover_menu_item" data-action="block" data-block="'+(null==(__t=this.options.blockString)?"":_.escape(__t))+'"><a class="popover_menu_item_anchor" href="#">'+(null==(__t=__("Block"))?"":_.escape(__t))+"</a></li>"),__p+='<li class="popover_menu_item" data-action="delete" data-confirm="'+(null==(__t=__("Are you sure you want to delete this?"))?"":__t)+'"><a class="popover_menu_item_anchor" href="#">'+(null==(__t=__("Delete"))?"":_.escape(__t))+"</a></li></ul></div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],366:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="popover moderation"><div class="popover_inner"><div class="popover_header">'+(null==(__t=__("Flag this post"))?"":__t)+'<a class="moderation_help_link" href="https://www.tumblr.com/docs/discovery#moderationheader" target="_blank"><span class="icon_help"></span></a></div><form class="popover_form" action="/svc/flag" method="post"><input type="hidden" name="tumblelog_name" value="'+(null==(__t=tumblelog)?"":__t)+'"> <input type="hidden" name="post_id" value="'+(null==(__t=post_id)?"":__t)+'"> <input type="hidden" name="root_id" value="'+(null==(__t=root_id)?"":__t)+'">',_.each(flags,function(t){__p+='<div class="popover_form_row">';var e="flag_"+t.name;__p+='<input type="radio" id="'+(null==(__t=e)?"":__t)+'" name="flag" value="'+(null==(__t=t.name)?"":__t)+'"><label for="'+(null==(__t=e)?"":__t)+'" class="form_label">'+(null==(__t=t.label)?"":__t)+"</label>","nsfw"===t.name&&safe_search&&(__p+='<div class="popover_form_row_help">'+(null==(__t=_.sprintf(__("Adult-oriented content is currently being hidden ( %1$s ) but this post still showed up."),'<i class="icon_lock_thick_12"></i>'))?"":__t)+"</div>"),__p+="</div>"}),__p+='<div class="violation_types_wrapper">',_.each(violations,function(t){__p+='<div class="popover_form_row">';var e="violation_"+t.name;__p+='<input type="radio" id="'+(null==(__t=e)?"":__t)+'" name="violation" value="'+(null==(__t=t.name)?"":__t)+'"><label for="'+(null==(__t=e)?"":__t)+'" class="form_label">'+(null==(__t=t.label)?"":__t)+"</label></div>"}),__p+='</div><div class="popover_form_row ignore"><label class="binary_switch"><input type="checkbox" name="flag_ignore" checked="checked"> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></label><label for="ignore">'+(null==(__t=_.sprintf(__("Ignore %1$s"),tumblelog))?"":__t)+'</label></div><button class="chrome red full_width submit_flag">'+(null==(__t=__("Flag"))?"":__t)+"</button></form></div></div>";
return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],367:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="popover popover_menu popover_gradient popover_share_social"><div class="popover_inner"><ul class="share_options active" data-tumblelog-name="'+(null==(__t=tumblelog_name)?"":_.escape(__t))+'" data-post-id="'+(null==(__t=post_id)?"":_.escape(__t))+'" data-root-id="'+(null==(__t=root_id)?"":_.escape(__t))+'" data-post-url="'+(null==(__t=post_url)?"":_.escape(__t))+'" data-post-tiny-url="'+(null==(__t=post_tiny_url)?"":_.escape(__t))+'" data-embed-key="'+(null==(__t=embed_key)?"":_.escape(__t))+'" data-embed-did="'+(null==(__t=embed_did)?"":_.escape(__t))+'">',is_private||(__p+="",show_permalink&&(__p+='<li class="share_permalink popover_menu_item"><a class="popover_menu_item_anchor" data-share-type="permalink" href="'+(null==(__t=post_url)?"":_.escape(__t))+'" target="_blank" class="external" title="'+(null==(__t=permalink_label)?"":_.escape(__t))+'">'+(null==(__t=permalink_label)?"":_.escape(__t))+'<i class="icon icon_arrow_carrot_right"></i></a></li>'),__p+="",show_embed&&(__p+='<li class="embed_post popover_menu_item"><a class="popover_menu_item_anchor" data-share-type="embed" href="#">'+(null==(__t=__("Embed"))?"":_.escape(__t))+"</a></li>"),__p+="",show_email&&(__p+='<li class="share_email popover_menu_item"><a class="popover_menu_item_anchor" data-share-type="email" href="#">'+(null==(__t=__("Email"))?"":_.escape(__t))+"</a></li>"),__p+="",show_twitter&&(__p+='<li class="share_twitter popover_menu_item" data-twitter-username="'+(null==(__t=twitter_username)?"":_.escape(__t))+'"><a class="popover_menu_item_anchor" data-share-type="twitter" href="#">'+(null==(__t=__("Twitter"))?"":_.escape(__t))+"</a></li>"),__p+="",show_facebook&&(__p+='<li class="share_facebook popover_menu_item" data-has-facebook="'+(null==(__t=has_facebook?"1":"")?"":__t)+'"><a class="popover_menu_item_anchor" data-share-type="facebook" href="#">'+(null==(__t=__("Facebook"))?"":_.escape(__t))+"</a></li>"),__p+="",show_pinterest&&(__p+='<li class="share_pinterest popover_menu_item"><a class="popover_menu_item_anchor" data-share-type="pinterest" href="#">'+(null==(__t=__("Pinterest"))?"":_.escape(__t))+"</a></li>"),__p+="",show_flagging&&(__p+='<li class="flag_post popover_menu_item"><a class="popover_menu_item_anchor" href="#">'+(null==(__t=__("Flag this post"))?"":_.escape(__t))+"</a></li>"),__p+="",show_reporting_links&&(__p+='<li class="popover_menu_item"><a class="popover_menu_item_anchor" target="_blank" href="'+(null==(__t=abuse_url)?"":_.escape(__t))+'">'+(null==(__t=__("Report Abuse"))?"":_.escape(__t))+"</a></li>"),__p+=""),__p+="</ul>",is_private||(__p+='<form method="post" class="share_form email_form" id="share_email_'+(null==(__t=post_id)?"":_.escape(__t))+'" novalidate><div class="form_wrapper"><div class="share_label" data-embed-label="'+(null==(__t=__("Embed"))?"":_.escape(__t))+'"></div><span class="cancel service icon_arrow_thin_left"></span><div class="input_group"><ul><li><input type="email" class="email_address" name="email_address" maxlength="100" placeholder="'+(null==(__t=__("Email"))?"":_.escape(__t))+'" title="'+(null==(__t=__("Email"))?"":_.escape(__t))+'"> <input type="hidden" name="post_id" value="'+(null==(__t=post_id)?"":_.escape(__t))+'"> <input type="hidden" name="tumblelog_name" value="'+(null==(__t=tumblelog_name)?"":_.escape(__t))+'"> <span class="cancel icon_close"></span></li><li><textarea name="message" class="share_message" maxlength="255" placeholder="'+(null==(__t=__("Message (Optional)"))?"":_.escape(__t))+'" title="'+(null==(__t=__("Message (Optional)"))?"":_.escape(__t))+'"></textarea><div class="character_count">140</div></li></ul></div>',show_embed&&(__p+='<div class="embed_code_wrapper"><textarea name="embed_code" class="embed_code_text" spellcheck="false" readonly="readonly">'+(null==(__t=embed_code)?"":_.escape(__t))+"</textarea></div>"),__p+="",has_user&&(__p+='<div class="reply_to" title="'+(null==(__t=__("Let them reply to"))?"":_.escape(__t))+'"><div class="menu_item_option"><label class="binary-switch"><input type="checkbox" id="allow_reply_to_'+(null==(__t=post_id)?"":_.escape(__t))+'" class="reply_to_input" name="allow_reply_to"> <span class="binary-switch-track"></span> <span class="binary-switch-button"></span></label></div><label class="menu_item_label" for="allow_reply_to_'+(null==(__t=post_id)?"":_.escape(__t))+'">'+(null==(__t=__("Let them reply to <span>"))?"":__t)+"</label></div>"),__p+='<div class="error_status"></div><button type="submit" class="flat-button blue email_submit" data-label-sending="'+(null==(__t=__("Sending..."))?"":_.escape(__t))+'" data-label="'+(null==(__t=__("Send"))?"":_.escape(__t))+'" disabled="disabled">'+(null==(__t=__("Send"))?"":_.escape(__t))+'</button></div></form><div class="status" data-sent="'+(null==(__t=__("Sent!"))?"":_.escape(__t))+'" data-error="'+(null==(__t=__("Error!"))?"":_.escape(__t))+'"><span class="status_message">'+(null==(__t=__("Sent!"))?"":_.escape(__t))+"</span></div>"),__p+="</div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],368:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/events"),a=t("prima/mixins/popoverbase"),r=t("app/components/blog-card"),l=o.extend({mixins:[a],className:"tumblelog_popover popover popover--blog-card",blogCardView:null,initialize:function(t){t||(t={}),t.identifier="TumblelogPopover",this.$targetPost=s(t.pinnedTarget).closest(".post"),o.prototype.initialize.call(this,t)},openPopover:function(){return this.blogCardView?(this.render(),this):(this.blogCardView=new r({model:this.model,targetPost:this.$targetPost}),void this.listenToOnce(this.blogCardView,"ready",this.render))},closePopover:function(){this.animateOut(),i.delay(i.bind(this.teardown,this),250)},onMouseMove:function(t){this.overElement(t,this.$el)||this.overElement(t,this.$pinned)?this.teardownTimer&&(clearTimeout(this.teardownTimer),this.teardownTimer=null):this.teardownTimer||(this.teardownTimer=i.delay(i.bind(this.closePopover,this),300))},overElement:function(t,e){var i=e.offset();return t.pageX>i.left&&t.pageY>i.top&&t.pageX<i.left+e.outerWidth()&&t.pageY<i.top+e.outerHeight()},render:function(){return this.blogCardView.render(),this.$el.html(this.blogCardView.el),i.defer(i.bind(this.animateIn,this)),this.boundMouseMove=i.bind(this.onMouseMove,this),s("body").on("mousemove",this.boundMouseMove),this._logOpen(),this},animateIn:function(){return this.$el.css("opacity",1),this},animateOut:function(){return this.$el.css("opacity",0),this},_logOpen:function(){n.trigger("popover:blogcard:open",{loggingData:{blog:this.model.get("name")}})},teardown:function(){return s("body").off("mousemove",this.boundMouseMove),this.$el.remove(),this}});e.exports=l},{"app/components/blog-card":29,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/mixins/popoverbase":465,"prima/view":496}],369:[function(t,e){"use strict";var i=t("jquery"),s=t("prima/view"),o=t("prima/events"),n=t("prima/lib/domeventor"),a=t("prima/utils/bindendevent").transition,r=t("../templates/feature-help-popover.tpl"),l={TOP:1,BOTTOM:2,LEFT:4,RIGHT:8,CENTER:16},h=s.extend({className:"tour_guide",template:r,events:{"click .glass":"_onDismiss","click .ok_button":"_onDismiss"},_onDismiss:function(t){t.preventDefault(),this.hide(),this.trigger("hide")},_onScroll:function(t){this.scrollPosition=t,this.isDim&&this.fadeGlass()},initialize:function(){this.$body=i("body"),this.$highlighted=i(),this.$glass=i(),this.$popover=i(),this.isDim=!1,this.isOpen=!1,this.openScrollPosition=0,this.highlightedClass="",this.scrollPosition=n.rect(),this.listenTo(o,"DOMEventor:flatscroll",this._onScroll)},setHighlighted:function(t,e){this.$highlighted=t,this.highlightedClass=e},show:function(t){return this.config=t,this.$el.html(this.template(t)),this.$body.addClass("tour_guide_open").append(this.$el),this.isOpen=!0,this.config.glass&&(this.$el.addClass("dim"),this.isDim=!0),this.config.name&&this.$body.attr("data-help-popover",this.config.name),this.config.glass&&this.$highlighted.length&&this.$highlighted.addClass("tour_guide_element").addClass(this.highlightedClass),this.openScrollPosition=this.$highlighted.length?this.scrollPosition.windowScrollTop:this.scrollPosition.windowScrollTop+.5*this.scrollPosition.windowHeight,this.$glass=this.$(".glass"),this.$popover=this.$(".popover"),this.delegateEvents(),this.positionPopover(),this},hide:function(){this.$el.addClass("removing"),this.$body.addClass("help-popover-removing"),a(this.$el,this.remove.bind(this))},remove:function(){this.undelegateEvents(),this.isDim=!1,this.isOpen=!1,this.config=null,this.$el.removeClass("dim removing").remove(),this.$body.removeClass("tour_guide_open help-popover-removing").removeAttr("data-help-popover"),this.$highlighted.length&&(this.$highlighted.off(".tour_guide_highlighted").removeClass("tour_guide_element").removeClass(this.highlightedClass),this.$highlighted=i(),this.highlightedClass="")},fadeGlass:function(){var t=(this.openScrollPosition-this.scrollPosition.windowScrollTop)/this.scrollPosition.windowHeight,e=t>0?1-t:t+1;return 0>=e?(this.isDim=!1,this.hide(),void this.trigger("hide")):void this.$glass.css("opacity",e)},positionPopover:function(){if(this.$popover.length){var t=this.$popover.outerHeight(!0),e=this.$popover.outerWidth(!0);if(this.$highlighted.length){var s,o,n=this.config.position,a=this.$highlighted.offset(),r=this.$highlighted.outerWidth(),h=a.left,d=a.top,c=d-t<this.scrollPosition.windowScrollTop+80;if(n||(n=l.CENTER|c?l.BOTTOM:l.TOP),n&l.LEFT?(o=h,this.$popover.addClass("horizontal-left")):n&l.RIGHT?(o=h-e+r,this.$popover.addClass("horizontal-right")):(o=h-.5*(e-r),this.$popover.addClass("horizontal-center")),this.$popover.css("left",o),this.config.fixed_position)return void(i("#site_notice").length&&this.$popover.css("margin-top","+="+i("#site_notice").outerHeight()+"px"));n&l.TOP?(s=d-t,this.$popover.addClass("vertical-top")):(s=d+this.$highlighted.outerHeight(),this.$popover.addClass("vertical-bottom")),this.$popover.css("top",s)}else this.$popover.addClass("centered").css({top:.5*this.scrollPosition.windowHeight-.5*t,left:.5*this.scrollPosition.windowWidth-.5*e})}}},{POSITION:l});e.exports=h},{"../templates/feature-help-popover.tpl":364,jquery:"HlZQrA","prima/events":429,"prima/lib/domeventor":433,"prima/utils/bindendevent":474,"prima/view":496}],370:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/popoverbase"),n=t("../templates/message-controls-popover.tpl"),a=s.extend({className:"popover--message-controls-popover",mixins:[o],template:n,events:{'click [data-action="delete"]':"_delete",'click [data-action="block"]':"_block"},initialize:function(t){this.options=i.extend({},t),this.post=t.post},_delete:function(t){t.preventDefault(),this.post.delete(t)},_block:function(t){t.preventDefault(),this.post.block(t)},render:function(){return this.$el.html(this.template()),this},teardown:function(){return this.$el.remove(),this}});e.exports=a},{"../templates/message-controls-popover.tpl":365,lodash:"K2RcUv","prima/mixins/popoverbase":465,"prima/view":496}],371:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/view"),n=t("prima/events"),a=t("prima/lib/translate"),r=t("prima/mixins/popoverbase"),l=t("app/models/tumblelog"),h=t("app/components/dialog"),d=t("../models/post_moderation_popover"),c=t("../templates/post_moderation.tpl"),u=o.extend({className:"popover--post-moderation",mixins:[r],template:c,events:{'change input[name="flag"]':"onChangeFlag",'change input[name="violation"]':"onChangeViolation",'change input[name="flag_ignore"]':"onChangeIgnore","change input":"onChangeForm",submit:"onSubmit"},selectedFlag:null,selectedViolation:null,ignore:!0,initialize:function(t){this.options=s.extend({},t),this.model=new d,this.postModel=this.options.post,this.tumblelog=this.postModel.tumblelog||(this.postModel.tumblelog=new l(this.postModel.get("tumblelog_data")))},cacheSelectors:function(){this.$form=this.$el.find("form"),this.$submitButton=this.$form.find(".submit_flag"),this.$violationsContainer=this.$form.find(".violation_types_wrapper"),this.$violationInputs=this.$violationsContainer.find("input")},onChangeViolation:function(t){var e=i(t.currentTarget);this.selectedViolation=e.val()},onChangeFlag:function(t){var e=i(t.currentTarget);this.selectedFlag=e.val()},onChangeForm:function(){this.toggleViolations(),this.$submitButton.prop("disabled",!this.isValid())},onChangeIgnore:function(t){var e=i(t.currentTarget);this.ignore=e.is(":checked"),this.ignore?this.tumblelog.ignore():this.tumblelog.unignore()},onSubmit:function(t){t.preventDefault();var e=this.$form.serializeArray(),o={};s.each(e,function(t){o[t.name]=t.value}),i.ajax({url:this.$form.attr("action"),type:this.$form.attr("method")||"POST",data:o,with_form_key:!0,success:s.noop,error:function(){var t=a("Sorry, we seem to be having technical trouble.  Please try again later.");h.alert(t)}}),this.teardown(),n.trigger("flagged:"+this.tumblelog.get("name"))},toggleViolations:function(){"general"===this.selectedFlag?this.$violationsContainer.show():(this.$violationsContainer.hide(),this.selectedViolation=null,this.$violationInputs.prop("checked",!1))},isValid:function(){if(!this.ignore){if(!this.selectedFlag)return!1;if("general"===this.selectedFlag&&!this.selectedViolation)return!1}return!0},serialize:function(){return{__:a,safe_search:i(".nsfw_filter_enabled").length,flags:this.model.get("flags"),violations:this.model.get("violations"),root_id:this.postModel.get("root_id"),post_id:this.postModel.get("id"),tumblelog:this.tumblelog.get("name"),ignore:this.ignore}},render:function(){return this.$el.html(this.template(this.serialize())),this.delegateEvents(),this.cacheSelectors(),this},reset:function(){this.selectedFlag=null,this.selectedViolation=null,this.ignore=!0},teardown:function(){return this.reset(),this.$el.remove(),this}});e.exports=u},{"../models/post_moderation_popover":362,"../templates/post_moderation.tpl":366,"app/components/dialog":39,"app/models/tumblelog":300,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/lib/translate":456,"prima/mixins/popoverbase":465,"prima/view":496}],372:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/view"),n=t("prima/events"),a=t("prima/utils/cookie"),r=t("prima/mixins/popoverbase"),l=t("../templates/share-popover.tpl"),h=t("../models/share-popover"),d=t("app/models/post"),n=t("prima/events"),c=t("prima/mixins/generate-logging-data"),u=o.extend({className:"popover--post-share-popover",mixins:[r,c],template:l,defaults:{popoverData:{},forceSocialFallback:!1,forceEmailFallback:!1},events:{"click .embed_post":"__embedPostClick","click .share_email":"__emailTriggerClick","click .share_facebook":"__shareFacebookClick","click .share_pinterest":"__sharePinterestClick","click .share_twitter":"__shareTwitterClick","click .share_permalink":"__sharePermalinkClick","click .flag_post":"__flagPostClick","click .cancel":"__cancelClick","click .popover_menu_item_anchor":"__checkIfPremiumPost","input .email_address":"__emailFormInput","input .twitter .share_message":"__shareTwitterInput","change .reply_to_input":"__replyToChange","keydown .share_form":"__submitKeydown","submit .share_form":"__submit","focus input":"__suspendKeyCommands","focus textarea":"__suspendKeyCommands","blur textarea":"__resumeKeyCommands","blur input":"__resumeKeyCommands"},__embedPostClick:function(t){t.preventDefault(),n.trigger("dashboard-share:embed"),this._showEmbedCode()},__emailTriggerClick:function(t){t.preventDefault(),n.trigger("dashboard-share:email"),this._toggleEmailForm()},__shareFacebookClick:function(t){t.preventDefault(),n.trigger("dashboard-share:facebook"),this._shareFacebook()},__sharePinterestClick:function(t){t.preventDefault(),n.trigger("dashboard-share:pinterest"),this._sharePinterest()},__shareTwitterClick:function(t){t.preventDefault(),n.trigger("dashboard-share:twitter"),this._shareTwitter()},__sharePermalinkClick:function(){this.resetAndHide()},__flagPostClick:function(t){t.preventDefault(),this.onClickOutside(),n.trigger("abuseform:open",{post:this.model})},__cancelClick:function(t){t.preventDefault(),this._cancelOrClose()},__emailFormInput:function(){var t=u.validateEmail(this.$emailAddress.val());this.$submitButton.attr("disabled",!t)},__shareTwitterInput:function(t){t.preventDefault();var e=u.validateTwitter(this.$shareMessage.val(),this.$characterCount);this.$submitButton.attr("disabled",!e)},__replyToChange:function(t){var e=i(t.currentTarget).is(":checked");a.set("share_popover_reply_to",e,31536e3)},__submitKeydown:function(t){13===t.keyCode&&(t.ctrlKey||t.metaKey||t.altKey)&&(t.preventDefault(),t.stopPropagation(),this.submitForm())},__submit:function(){return this.submitForm(),!1},__submitSuccess:function(){this.$status.show(),this._fadeoutPopover()},__submitError:function(){this.$errorStatus.html(this.errorText),this.$submitButton.html(this.$submitButton.data("label")),this.$submitButton.attr("disabled",!1),this.$errorStatus.addClass("active")},__suspendKeyCommands:function(){n.trigger("keycommands:suspend")},__resumeKeyCommands:function(){n.trigger("keycommands:resume")},__checkIfPremiumPost:function(){var t=i("[data-id="+this.options.popoverData.post_id+"]").data("json");if(t.pt){var e=new d(t);n.trigger("useraction:explore_click:share",{model:e,loggingData:this.loggingData({userAction:"share"})})}},_shareTwitter:function(){!this.options.forceSocialFallback&&this.twitterUsername?(this.$serviceCancel.show(),this.$submitButton.html("Tweet"),this.$shareForm.data("type","twitter"),this.$shareLabel.text("@"+this.twitterUsername),this.$shareMessage.val(" [URL]"),this.$shareForm.addClass("active"),this.$shareOptions.removeClass("active"),this.$shareMessage.get(0).setSelectionRange(0,0),this.$shareMessage.attr("placeholder",""),this.$submitButton.attr("disabled",!1),this.$shareForm.addClass("twitter"),u.validateTwitter(this.$shareMessage.val(),this.$characterCount),this.$shareForm.hasClass("active")&&this.placeholderSupported&&(this.$shareMessage.focus(),this.$shareMessage.get(0).setSelectionRange(0,0))):this._shareTwitterFallback()},_shareTwitterFallback:function(){window.open("https://twitter.com/intent/tweet?url="+encodeURIComponent(this.tinyUrl||this.url),"twitter-share-dialog","width=626,height=258");var t=this._getGenericShareData();this.model.shareTwitter(t),this.resetAndHide()},_shareFacebook:function(){!this.options.forceSocialFallback&&this.hasFacebook?this.model.facebookStatus().done(s.bind(this._shareFacebookSuccess,this)).fail(s.bind(this._shareFacebookFallback,this)):this._shareFacebookFallback()},_shareFacebookSuccess:function(t){t?(this.$serviceCancel.show(),this.$submitButton.html(this.$submitButton.data("label")),this.$shareForm.data("type","facebook"),this.$shareLabel.text(t),this.$submitButton.attr("disabled",!1),this.$shareForm.addClass("facebook"),this.$shareOptions.toggleClass("active"),this.$shareForm.toggleClass("active"),this.$shareForm.hasClass("active")&&this.placeholderSupported&&this.$shareMessage.focus()):this._shareFacebookFallback()},_shareFacebookFallback:function(){window.open("https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(this.url),"facebook-share-dialog","width=626,height=436");var t=this._getGenericShareData();this.model.shareFacebook(t),this.resetAndHide()},_sharePinterest:function(){var t=this.model.get("pinterest_share_window");window.open(t.url,t.name,t.dimensions);var e=this._getGenericShareData();this.model.sharePinterest(e),this.resetAndHide()},_toggleEmailForm:function(){return this.options.forceEmailFallback||!this.model.get("has_user")?void this._emailFormFallback():(this.$submitButton.html(this.$submitButton.data("label")),this.$shareForm.data("type","email"),this.$shareOptions.toggleClass("active"),this.$shareForm.toggleClass("active"),this.$replyTo.addClass("active"),void(this.$shareForm.hasClass("active")&&this.$emailAddress.length&&this.$emailAddress.focus()))},_emailFormFallback:function(){var t=this._getGenericShareData();this.model.shareEmail(t);var e="mailto:?body="+this.url;if(this.model.get("embed_key")){var i=window.open();i.document.write('<html><script>location.href = "'+e+'";setTimeout(function(){window.close();},500);</script></html>'),i.document.close()}else window.location.href=e;this.resetAndHide()},_showEmbedCode:function(){this.$serviceCancel.show(),this.$shareForm.data("type","embed"),this.$shareLabel.text(this.$shareLabel.data("embed-label")),this.$shareForm.addClass("active"),this.$shareOptions.removeClass("active"),this.$shareMessage.attr("placeholder",""),this.$shareForm.addClass("embed");var t=this.$shareForm.find(".embed_code_text");t.length&&(t.click(function(){t.select()}),setTimeout(function(){t.trigger("click")},100))},_fadeoutPopover:function(){setTimeout(s.bind(function(){this.$el.fadeOut(150,s.bind(this.resetAndHide,this))},this),1250)},_cancelOrClose:function(){var t=this.$emailAddress.val()||"";"email"===this.$shareForm.data("type")&&t.length?(this.$emailAddress.val(""),this.$submitButton.attr("disabled",!0)):this.resetForm()},_getGenericShareData:function(){return[{name:"post_id",value:this.model.get("post_id")},{name:"tumblelog_name",value:this.model.get("tumblelog_name")},{name:"share_fallback",value:!0}]},initialize:function(t){this.options=s.extend({},this.defaults,t),this.model=new h(this.options.popoverData),this.listenTo(this.model,"error",this.__submitError),this.listenTo(this.model,"success",this.__submitSuccess)},cacheSelectors:function(){this.$shareForm=this.$(".share_form"),this.$shareLabel=this.$(".share_label"),this.$replyTo=this.$(".reply_to"),this.$shareOptions=this.$(".share_options"),this.$submitButton=this.$("button.email_submit"),this.$emailAddress=this.$(".email_address"),this.$shareMessage=this.$(".share_message"),this.$embedCode=this.$(".embed_code_text"),this.$characterCount=this.$(".character_count"),this.$serviceCancel=this.$(".cancel.service"),this.$status=this.$(".status"),this.$errorStatus=this.$(".error_status"),this.$statusMessage=this.$(".status_message"),this.$replyToInput=this.$(".reply_to_input"),this.sentText=this.$status.data("sent")||"",this.errorText=this.$status.data("error")||"",this.$(".share_twitter").length&&(this.twitterUsername=this.$(".share_twitter").data("twitter-username")),this.$(".share_facebook").length&&(this.hasFacebook=this.$(".share_facebook").data("has-facebook")),this.url=this.$shareOptions.data("post-url"),this.tinyUrl=this.$shareOptions.data("post-tiny-url"),this.tumblelogName=this.$shareOptions.data("tumblelog-name"),this.embedKey=this.$shareOptions.data("embed-key"),this.postId=this.$shareOptions.data("post-id"),this.rootId=this.$shareOptions.data("root-id")},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.cacheSelectors(),this.$replyToInput.prop("checked","true"===a.get("share_popover_reply_to")),this},resetForm:function(){this.$serviceCancel.hide(),this.$submitButton.html(this.$submitButton.data("label")),this.$submitButton.attr("disabled",!0),this.$emailAddress.val(""),this.$shareMessage.val(""),this.$shareMessage.attr("placeholder",this.$shareMessage.attr("title")),this.$shareOptions.addClass("active"),this.$shareForm.removeClass("active"),this.$shareForm.removeClass("facebook"),this.$shareForm.removeClass("twitter"),this.$shareForm.removeClass("embed"),this.$status.hide(),this.$statusMessage.html(this.sentText),this.$replyTo.removeClass("active"),this.$errorStatus.removeClass("active"),this.$el.show()},resetAndHide:function(){this.resetForm(),this.teardown()},submitForm:function(){var t=this.$shareForm.serializeArray();switch(this.$shareForm.data("type")){case"facebook":this.model.shareFacebook(t);break;case"twitter":this.model.shareTwitter(t);break;default:this.model.shareEmail(t)}this.$submitButton.attr("disabled",!0),this.$submitButton.html(this.$submitButton.data("label-sending"))},teardown:function(){return this.__resumeKeyCommands(),this.$el.remove(),this}},{placeholderSupport:function(){var t=document.createElement("input");return"placeholder"in t},validateEmail:function(t){var e=/\S+@\S+\.\S+/;return e.test(t)},validateTwitter:function(t,e){var i=t.match(/\[URL\]/gi),s=i?24*i.length:0,o=140-t.length-s,n=e&&e.length?e:!1;return n&&(n.removeClass("character-limit").html(o),10>o&&n.addClass("character-limit")),0>o||140===o?!1:!0}});e.exports=u},{"../models/share-popover":363,"../templates/share-popover.tpl":367,"app/models/post":299,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/mixins/generate-logging-data":461,"prima/mixins/popoverbase":465,"prima/utils/cookie":478,"prima/view":496}],373:[function(t,e){"use strict";function i(t){return"string"==typeof t||t&&"object"==typeof t&&"[object String]"==u.call(t)||!1}function s(){var t=new m;return t.cid=g,g+=1,f[t.cid]=t,t}function o(t,e){for(var i,s=_.length-1;s>=0;s--)_[s].message_callback(t,e);for(s=v.length-1;s>=0;s--)i=v[s],i&&i.shouldRespond&&i.shouldRespond(t,e)&&i.cb(t,e)}function n(t){var e=this;if(t.cid_response&&t.cid_response in f){var i=f[t.cid_response];i.resolve.call(null,e,t.response),delete f[t.cid_response]}}function a(t){if(t||(t={}),!(h&&h.stringify&&h.parse))throw"Must have JSON parsing and stringify";if(t.iframe&&(t.window=t.iframe.contentWindow,!t.origin)){var e=t.iframe.src,i=e.match(/^(http(?:s)?:\/\/[\w_\-\.]+(?::\d+)?)\/?/);i&&(t.origin=i[1])}this.namespace=t.namespace?t.namespace+":":"",this.origin=t.origin||"*",this.responders={_method_callback_responder:n,_syn:c(this._syn,this)},this._on_connected=new p,this._unanswered_calls={},this.on_connection(c(this.enable_sending_post_message,this)),_.push(this),t.window&&this.setWindow(t.window)}function r(t,e,i){i||(i=this.origin),t.postMessage(e,i)}var l=t("prima/utils/clean-window-object"),h=l("JSON",function(t){return t&&t.stringify}),d=[].slice,c=function(t,e){return function(){return t.apply(e,arguments)}},u=Object.prototype.toString,p=t("./utils/one_time_event"),m=t("./utils/deferred"),g=1,f={},_=[],v=[];!function(){var t=window.addEventListener?"addEventListener":"attachEvent",e=window[t],i="attachEvent"===t?"onmessage":"message";e(i,function(t){var e;if("string"==typeof t.data){try{t.data&&"{"===t.data[0]&&(e=h.parse(t.data))}catch(i){}e&&e.method&&o(t,e)}},!1)}(),a.prototype.setWindow=function(t){if(t){this.window=t;var e=this.call("_syn");e.then(c(function(t,e){"ack"===e&&this._is_connected()},this))}},a.on=function(t,e){var i;i="*"===t?function(){return!0}:"*"===t[t.length-1]?function(e,i){return 0===i.method.indexOf(t.substring(0,t.length-2))}:function(e,i){return i.method===t},v.push({shouldRespond:i,cb:e})},a.off=function(t){for(var e,i=v.length-1;i>=0;i--)if(v[i].cb===t){e=i;break}return e&&e>-1?(v.splice(e,1),!0):!1},a.prototype.match_origin=function(t){return"*"===this.origin?!0:this.origin===t},a.prototype.message_callback=function(t,e){var s;if((!this.window||t.source===this.window)&&this.match_origin(t.origin)){if(e.method&&e.method.slice(0,this.namespace.length)===this.namespace&&(s=e.method.slice(this.namespace.length,e.method.length)),e.args&&i(e.args))try{e.args=h.parse(e.args)}catch(o){return}this.call_responder(s,t,e)}},a.prototype.call_responder=function(t,e,i){var s,o;if(t){if(i.args||(i.args=[]),o=this.responders[t],!o)return this._unanswered_calls[t]||(this._unanswered_calls[t]=[]),void this._unanswered_calls[t].push(arguments);s=o.apply(e,i.args),i.cid&&"_method_callback_responder"!==t&&this.send_to_window(e.source,"_method_callback_responder",{cid_response:i.cid,response:s})}},a.prototype._syn=function(){return this._is_connected(),"ack"},a.prototype._is_connected=function(){this.connected||(this.connected=!0,this._on_connected.trigger(this))},a.prototype.on_connection=function(){return this._on_connected.push.apply(this._on_connected,arguments),this},a.prototype.method=function b(t){var e=this,b=function(){var i=1<=arguments.length?d.call(arguments,0):[];return i.unshift(t),e.send.apply(e,i)};return b},a.prototype.call=function(){var t=1<=arguments.length?d.call(arguments,0):[];return this.window?(t.unshift(this.window),this.call_on_window.apply(this,t)):void console.warn("no window specified on channel")},a.prototype.call_on_window=function(t,e){var i=3<=arguments.length?d.call(arguments,2):[],o=s();try{var n=h.stringify({method:this.namespace+e,args:i,cid:o.cid});"_syn"===e||"_method_callback_responder"===e?r.call(this,t,n):this.send_post_message(t,n)}catch(a){o.reject(a)}return o.promise()},a.prototype.send=function(){var t=1<=arguments.length?d.call(arguments,0):[];return this.window?(t.unshift(this.window),this.send_to_window.apply(this,t)):void console.warn("no window specified on channel")},a.prototype.send_to_window=function(t,e){var i=3<=arguments.length?d.call(arguments,2):[],s=h.stringify({method:this.namespace+e,args:i});"_syn"===e||"_method_callback_responder"===e?r.call(this,t,s):this.send_post_message(t,s)},a.prototype.send_post_message=function(){this._delayed_sent_messages||(this._delayed_sent_messages=[]),this._delayed_sent_messages.push(arguments)},a.prototype.enable_sending_post_message=function(){if(this.send_post_message=r,this._delayed_sent_messages){for(var t=0;t<this._delayed_sent_messages.length;t+=1)r.apply(this,this._delayed_sent_messages[t]);delete this._delayed_sent_messages}},a.prototype.listening_to=function(t){return t in this.responders},a.prototype.listen_to=function(t,e,s){if(i(t)){if(t in this.responders)return void console.warn("already listening to this method, turn it off first");if(s&&(e=c(e,s)),this.responders[t]=e,this._unanswered_calls[t]){var o,n=this._unanswered_calls[t];delete this._unanswered_calls[t];for(var a=0;a<n.length;a+=1)o=n[a],this.call_responder.apply(this,o)}}else{var r=t;for(t in r)r.hasOwnProperty(t)&&this.listen_to(t,r[t],s)}},a.prototype.stop_listen_to=function(t){return"_method_callback_responder"===t?void console.warn("cannot disable the method callback responder"):void delete this.responders[t]},e.exports=a},{"./utils/deferred":374,"./utils/one_time_event":375,"prima/utils/clean-window-object":476}],374:[function(t,e){"use strict";function i(){this._on_resolved=new n,this._on_rejected=new n,this.then=o(this.then,this),this.fail=o(this.fail,this),this.resolve=o(this.resolve,this),this.reject=o(this.reject,this)}var s=[].slice,o=function(t,e){return function(){return t.apply(e,arguments)}},n=t("./one_time_event");i.prototype.then=function(){return this._on_resolved.push.apply(this._on_resolved,arguments),this},i.prototype.success=i.prototype.then,i.prototype.fail=function(){return this._on_resolved.push.apply(this._on_rejected,arguments),this},i.prototype.resolve=function(){return this.resolved||this.rejected?void 0:(this._on_resolved.trigger.apply(this._on_resolved,arguments),this.resolved=!0,this)},i.prototype.reject=function(){return this.resolved||this.rejected?void 0:(this._on_rejected.trigger.apply(this._on_rejected,arguments),this.rejected=!0,this)},i.prototype.reject_timeout=function(){var t=1<=arguments.length?s.call(arguments,0):[],e=t.shift();return setTimeout(o(function(){this.reject.apply(this,t)},this),e),this},i.prototype.promise=function(){function t(){var t=this;this.fail=function(){return e.fail.apply(e,arguments),t},this.then=function(){return e.then.apply(e,arguments),t},this.success=this.then,this.reject_timeout=function(){return e.reject_timeout.apply(e,arguments),t},this.cid=e.cid}var e=this;return new t},e.exports=i},{"./one_time_event":375}],375:[function(t,e){"use strict";function i(){this.length=0}var s=[].slice,o=[].push;i.prototype={slice:s,indexOf:Array.prototype.indexOf},i.prototype.push=function(){if(this.triggered_with)for(var t=1<=arguments.length?s.call(arguments,0):[],e=0;e<t.length;e+=1)t[e].apply(null,this.triggered_with);
return o.apply(this,arguments)},i.prototype.trigger=function(){var t=1<=arguments.length?s.call(arguments,0):[],e=this.length;this.triggered_with=t;for(var i=0;e>i;i+=1)this[i].apply(null,this.triggered_with);return this},e.exports=i},{}],376:[function(t,e){"use strict";function i(t,e){return e||(e={}),t.jquery?(e.el=t,e.model||(e.model=new s(e.el.data("json")))):e.model=t instanceof s?t:new s(t),new o(e)}var s=t("app/models/post"),o=t("./views/post_view");e.exports=i},{"./views/post_view":408,"app/models/post":299}],377:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/lib/mixin"),n=function(){for(var t="transform WebkitTransform MozTransform OTransform msTransform".split(" "),e=0;e<t.length;e++)if(void 0!==document.createElement("div").style[t[e]])return!0;return!1}(),a=new o({before:{initialize:function(){this._draggable={dragging:!1,dragX:!1,$doc:i(document),pointerDown:!1,transform:n},this.events=s.extend({"mousedown [data-draggabletags]":"_dragEvents","touchstart [data-draggabletags]":"_dragEvents","touchmove [data-draggabletags]":"_dragEvents","mouseleave [data-draggabletags]":"_dragEvents","mouseup [data-draggabletags]":"_dragEvents","touchend [data-draggabletags]":"_dragEvents","click [data-draggabletags] a":"_dragLinkHandler"},s.result(this,"events")),this.$el.one("mouseenter",s.bind(this._dragSetup,this))}},_dragSetup:function(){this._dragOverflowing()&&this.$el.addClass("draggable")},_dragGetInnerEl:function(){return this._draggable.$dragInner||(this._draggable.$dragInner=this.$("[data-draggabletags]")),this._draggable.$dragInner},_dragOverflowing:function(){return this.$el.width()<this._dragGetInnerEl().width()},_dragCheckMouseOut:function(t){var e=t.relatedTarget||t.toElement;e&&"HTML"!==e.nodeName||this._dragEnd(t)},_dragGetDimensions:function(){var t=this.$el.width(),e=this._dragGetInnerEl().width();return{parentWidth:t,innerWidth:e,maxLeft:0,maxRight:t-e-10}},_dragEvents:function(t){switch(t.type){case"mousedown":case"touchstart":this._dragStart(t);break;case"mousemove":case"touchmove":this._draggable.pointerDown&&this._dragMove(t);break;case"touchend":case"mouseup":this._dragEnd(t)}},_dragBindDocEvents:function(){this._draggable.$doc.on("mousemove.tagsDraggable",s.bind(this._dragEvents,this)),this._draggable.$doc.on("mouseup.tagsDraggable",s.bind(this._dragReset,this)),this._draggable.$doc.on("mouseout",s.bind(this._dragCheckMouseOut,this))},_dragUnbindDocEvents:function(){this._draggable.$doc.off("mousemove.tagsDraggable"),this._draggable.$doc.off("mouseup.tagsDraggable"),this._draggable.$doc.off("mouseout")},_dragLinkHandler:function(t){this._draggable.dragging&&(t.stopPropagation(),t.preventDefault())},_dragStart:function(t){if(t.preventDefault(),!this._draggable.dragging&&!this._draggable.pointerDown&&this._dragOverflowing()){var e=parseInt(this.$el.css("padding-left").replace("px",""));this._draggable.pointerDown=!0,this._draggable.startX=this._dragGetInnerEl().position().left-e,this._draggable.pageX="pageX"in t?t.pageX:t.originalEvent.touches[0].pageX,this._dragBindDocEvents()}},_dragMove:function(t){t.preventDefault(),t.stopPropagation(),this._dragGetInnerEl().addClass("dragging"),this._draggable.dragging=!0;var e=("clientX"in t?t.clientX:t.originalEvent.touches[0].clientX)-this._draggable.pageX;this._draggable.dragX=e+this._draggable.startX,this._dragSet(this._draggable.dragX)},_dragSet:function(t){this._draggable.transform?this._dragGetInnerEl().css("transform","translate("+t+"px, 0)"):this._dragGetInnerEl().css("left",t)},_dragResetPosition:function(){var t=this._dragGetDimensions();this._draggable.dragX>t.maxLeft?this._dragSet(t.maxLeft):this._draggable.dragX<t.maxRight&&this._dragSet(t.maxRight)},_dragEnd:function(t){t.preventDefault(),t.stopPropagation();var e=s.bind(this._dragReset,this);s.delay(e,100)},_dragReset:function(){(this._draggable.dragging||this._draggable.pointerDown)&&(this._draggable.dragging=!1,this._draggable.pointerDown=!1,this._dragGetInnerEl().removeClass("dragging"),this._dragResetPosition(),this._dragUnbindDocEvents())}});e.exports=a},{jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/mixin":453}],378:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/subviewable"),n=t("prima/mixins/loggedouthelper"),a=s.extend({mixins:[o,n],initialize:function(t){this.buildSubviews(t.subViews)},buildSubviews:function(t){t||(t={}),i(this.hasSubViews).each(function(e,s){var o=t[s];if(o!==!1){var n={model:this.model,el:this.$('[data-subview="'+s+'"]')};t[s]&&i.isObject(t[s])&&(n.subViews=t[s]);var a=new e(n);i.result(a,"shouldAttachAsSubview")!==!1&&(this.subViews[s]=a)}},this)},attachedToDOM:function(){i(this.subViews).filter("attachedToDOM").invoke("attachedToDOM")},beforeTeardown:function(){return this.stopListening(this.model),this},render:function(){return this.attachSubViews(),this},afterRender:function(){this.renderSubViews()},remove:function(){this.teardown(),s.prototype.remove.apply(this,arguments)}});e.exports=a},{lodash:"K2RcUv","prima/mixins/loggedouthelper":464,"prima/mixins/subviewable":468,"prima/view":496}],379:[function(t,e){"use strict";var i=t("../../../base_view"),s=i.extend({hasSubViews:{}});e.exports=s},{"../../../base_view":378}],380:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("../base_view"),n=t("prima/events"),a=t("prima/mixins/generate-logging-data"),r=o.extend({events:{"click img":"toggle","click a":"_checkIfPremiumPost"},mixins:[a],initialize:function(t){o.prototype.initialize.call(this,t),this.$("p > .toggle_inline_image, figure > img:not(.inline_external_image)").each(function(t,e){s(e).addClass("toggle_inline_image").wrap(s('<div class="image_wrapper"></div>'))})},toggle:function(){this.toggleInline(),this.toggleExternal(),this.toggleThumbnail(),this.toggleHighres()},toggleInline:function(){this.$el.find(".toggle_inline_image").toggleClass("inline_image")},toggleExternal:function(){i.each(this.$el.find(".inline_external_image"),function(t){var e=s(t),i=e.attr("external_src");if(e.toggleClass("enlarged"),e.hasClass("enlarged"))e.attr("src",e.attr("original_src"));else{e.attr("original_src",e.attr("src")),e.attr("loader")&&e.attr("src",e.attr("loader"));var o=new Image;o.onload=function(){e.attr("src",i)},o.src=i}})},toggleThumbnail:function(){var t=this.$el.find(".image_thumbnail");if(t.length){var e=t.hasClass("enlarged");t.toggleClass("enlarged"),t.attr("width",t.data(e?"thumbnail-width":"width")),t.attr("height",t.data(e?"thumbnail-height":"height"))}},toggleHighres:function(){this.$el.find(".photo_info").toggleClass("hidden")},_checkIfPremiumPost:function(){this.model.get("pt")&&n.trigger("useraction:explore_click:caption",{model:this.model,loggingData:this.loggingData({userAction:"caption"})})}});e.exports=r},{"../base_view":378,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/mixins/generate-logging-data":461}],381:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/lib/translate"),o=t("prima/events"),n=t("../base_view"),a=n.extend({events:{click:"_onClick"},className:"expand-post-content",classOnTruncatedEl:"truncated-content",transitionTime:50,initialize:function(t){this.parent=t.parent,this.parent.subViews||(this.parent.subViews={}),this.parent.subViews.expandContent=this,this.$photoPostIcons=this.parent.$(".photo-post-icons")},_onClick:function(){this.expand()},expand:function(){this.parent.$el.velocity(this._parentDesiredCSS(),this.transitionTime,i.bind(function(){o.trigger("post:photo_expanded",this.parent.$el),o.trigger("search:post:photo_expanded",this.parent.$el)},this)),this.$photoPostIcons.velocity({bottom:this.originalPhotoPostBottom},this.transitionTime,i.bind(function(){this.$photoPostIcons.css("bottom",""),this.$photoPostIcons=null},this)),this.$el.velocity({opacity:0},this.transitionTime,i.bind(function(){this.remove(),delete this.parent.subViews.expandContent},this))},_parentTruncatedCSS:function(){return{"max-height":this.parent.limitHeightTo+this.$el.height(),overflow:"hidden"}},_parentDesiredCSS:function(){return{"max-height":this.parent.desiredHeight}},render:function(){if(n.prototype.render.apply(this,arguments),this.$el.attr("data-subview","expandContent"),this.$el.text(s("Expand")),this.parent.$el.after(this.$el),this.parent.$el.css(this._parentTruncatedCSS()),this.$photoPostIcons.length){var t=this.$photoPostIcons[0].offsetTop;if(t>this.parent.limitHeightTo){var e=t-this.parent.limitHeightTo+20;this.originalPhotoPostBottom=parseFloat(this.$photoPostIcons[0].style.bottom),this.$photoPostIcons.css({bottom:e})}}return this}});e.exports=a},{"../base_view":378,lodash:"K2RcUv","prima/events":429,"prima/lib/translate":456}],382:[function(t,e){"use strict";var i=t("prima/events"),s=t("../base_view"),o=s.extend({events:{click:"_onExpand"},_onExpand:function(t){t.preventDefault();var e=this.$el.parent(),s=e.find(".post_media.truncated"),o=s.find("img.photo");this.$el.remove(),s.removeClass("truncated"),s.velocity({"max-height":o.attr("height")},50,function(){i.trigger("post:photo_expanded",e)})}});e.exports=o},{"../base_view":378,"prima/events":429}],383:[function(t,e){"use strict";var i=t("jquery"),s=t("prima/lib/flags"),o=t("../base_view"),n=t("./media_view"),a=t("./body_view"),r=t("./expand_media_view"),l=t("./expand_content_view"),h=o.extend({hasSubViews:{media:n,expand:r,body:a},events:{tumblelogPopover:"__popoverLaunched"},limitHeightTo:400,limitBuffer:150,initialize:function(t){o.prototype.initialize.call(this,t),this.$("p > .toggle_inline_image, figure > img:not(.inline_external_image)").each(function(t,e){i(e).addClass("toggle_inline_image").wrap(i('<div class="image_wrapper"></div>'))})},attachedToDOM:function(){this.limitHeight(),o.prototype.attachedToDOM.apply(this,arguments)},limitHeight:function(){if(this.limitHeightTo&&s.bool("truncate_all_brick_posts")){var t=this.$el.height();if(this.desiredHeight=t,t>this.limitHeightTo+this.limitBuffer){var e=new l({parent:this});e.render()}}},__popoverLaunched:function(){this.subViews.expandContent&&this.subViews.expandContent.expand()}});e.exports=h},{"../base_view":378,"./body_view":380,"./expand_content_view":381,"./expand_media_view":382,"./media_view":384,jquery:"HlZQrA","prima/lib/flags":"f/LVtH"}],384:[function(t,e){"use strict";function i(t){var e=t.model.get("type");switch(e){case"photo":return new o(t);case"photoset":return new n(t);case"audio":return new a(t);case"video":return new s(t)}}var s=t("./video/media_view"),o=t("./photo/photo_media/photo_media_view"),n=t("./photo/photo_media/photoset_media_view"),a=t("./audio/audio_media/player_view");i.prototype.shouldAttachAsSubview=!1,e.exports=i},{"./audio/audio_media/player_view":379,"./photo/photo_media/photo_media_view":385,"./photo/photo_media/photoset_media_view":386,"./video/media_view":387}],385:[function(t,e){"use strict";var i=t("jquery"),s=t("prima/events"),o=t("../../../base_view"),s=t("prima/events"),n=t("prima/mixins/generate-logging-data"),a=o.extend({events:{click:"_openLightbox"},mixins:[n],_openLightbox:function(t){var e=i(t.currentTarget).data("lightbox");e&&(s.trigger("tumblelogPopover:init",[e]),this.$el.trigger("tumblelogPopover",[{opened:!0}]),this.model.get("pt")&&s.trigger("useraction:explore_click:media",{model:this.model,loggingData:this.loggingData({userAction:"photo"})}))}});e.exports=a},{"../../../base_view":378,jquery:"HlZQrA","prima/events":429,"prima/mixins/generate-logging-data":461}],386:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/events"),n=t("../../../base_view"),a=t("components/knight-rider-loader"),r=t("prima/mixins/generate-logging-data"),l=n.extend({events:{click:"displayShownPhotoInLightbox",mouseenter:function(){this.toggleLoader(!0)},mouseleave:function(){this.toggleLoader(!1)}},mixins:[r],initialize:function(){this.boundShowNextPhotosetPhotoAndReCycle=s.bind(this.showNextPhotosetPhotoAndReCycle,this),this.loader=new a({variation:"small"}),this.$(".photo-post-icons").append(this.loader.render().$el),this.$deferredImgs=this.$("img[data-src]"),this.$el.hoverIntent({over:s.bind(this.cyclePhotoset,this),out:s.bind(this.stopPhotosetCycle,this),interval:350})},loadDeferreds:function(){this.$deferredImgs.length&&(this.$deferredImgs.imagesLoaded(s.bind(function(){this.toggleLoader(!1),this.$deferredImgs=[],this._cycling&&this.cyclePhotoset()},this)),this.$deferredImgs.each(function(t,e){var s=i(e);s.attr("src",""),s.attr("src",s.data("src"))}))},cyclePhotoset:function(t){return this._cycling=!0,this.$deferredImgs.length?void this.loadDeferreds():(s.isNumber(t)||(t=1300),this._photosetCycleRate||this.showNextPhotosetPhoto(),this._photosetCycleRate=t,this.$photoset().css("background-color","#000"),this._photosetCycleTimeout&&clearTimeout(this._photosetCycleTimeout),this._photosetCycleTimeout=setTimeout(this.boundShowNextPhotosetPhotoAndReCycle,this._photosetCycleRate),void o.trigger("PhotosetMediaView:cycle",{view:this}))},showNextPhotosetPhotoAndReCycle:function(){this.showNextPhotosetPhoto(),this.cyclePhotoset()},showNextPhotosetPhoto:function(){var t=this.$shown().next();t.length||(t=this.$photoset().find(".photoset_photo:first")),this.$shown().removeClass("shown"),t.addClass("shown"),this._$shown=t},stopPhotosetCycle:function(){clearTimeout(this._photosetCycleTimeout),this._photosetCycleRate=null,this._cycling=!1,this.$photoset().css("background-color",""),this.toggleLoader(!1)},$photoset:function(){return"_$photoset"in this||(this._$photoset=this.$(".photoset_photos")),this._$photoset},$shown:function(){return this._$shown&&this._$shown.length||(this._$shown=this.$photoset().find(".photoset_photo.shown")),this._$shown&&this._$shown.length||(this._$shown=this.$photoset().find(".photoset_photo:last").addClass("shown")),this._$shown},toggleLoader:function(t){this.$deferredImgs.length&&(this.loader.set("loading",t),this.$el.toggleClass("loading-deferred-images",t))},displayShownPhotoInLightbox:function(){var t=this.$shown().data("lightbox"),e=s.collect(this.$photoset().find("[data-lightbox]"),function(t){return i(t).data("lightbox")}),n=s.indexOf(e,t);o.trigger("tumblelogPopover:init",e,n+1),this.stopPhotosetCycle(),this.$el.trigger("tumblelogPopover",[{opened:!0}]),this.model.get("pt")&&o.trigger("useraction:explore_click:media",{model:this.model,loggingData:this.loggingData({userAction:"photo"})})}});e.exports=l},{"../../../base_view":378,"components/knight-rider-loader":353,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/mixins/generate-logging-data":461}],387:[function(t,e){"use strict";function i(t){var e=s(t.el),i=e.find("video[data-crt-video]");return i.length?(t.$video=i,new o(t)):new n(t)}var s=t("jquery"),o=t("./native_media_view"),n=t("./poster_media_view");e.exports=i},{"./native_media_view":388,"./poster_media_view":389,jquery:"HlZQrA"}],388:[function(t,e){"use strict";var i=t("components/crt"),s=t("../../base_view"),o=s.extend({initialize:function(t){this.$video=t.$video||this.$("video[data-crt-video]"),this.video=this.$video[0],this.video&&i.playerFactory([this.video])}});e.exports=o},{"../../base_view":378,"components/crt":323}],389:[function(t,e){"use strict";var i=(t("jquery"),t("../../base_view")),s=i.extend({events:{click:"toggleVideoPlayer"},toggleVideoPlayer:function(){var t=this.$(".video_embed"),e=t.data("render-context"),i=this.$("script.embed_source");return"blank"===e?void window.open(t.data("post-url")):void(i.length&&(this.$(".video_poster").hide(),i.parent().html(i.html())))}});e.exports=s},{"../../base_view":378,jquery:"HlZQrA"}],390:[function(t,e){"use strict";var i=t("../../base_view"),s=i.extend({});e.exports=s},{"../../base_view":378}],391:[function(t,e){"use strict";var i=t("../../base_view"),s=i.extend({});e.exports=s},{"../../base_view":378}],392:[function(t,e){"use strict";var i=t("../../base_view"),s=i.extend({});e.exports=s},{"../../base_view":378}],393:[function(t,e){"use strict";var i=t("../../base_view"),s=t("./share_menu_view"),o=t("./admin_menu_view"),n=t("./creator_menu_view"),a=t("./sponsor_menu_view"),r=t("./ignore_view"),l=t("./photo_reply_view"),h=t("./reply_view"),d=t("./reblog_view"),c=t("./like_view"),u=i.extend({hasSubViews:{shareMenu:s,adminMenu:o,creatorMenu:n,sponsorMenu:a,ignore:r,photoReply:l,reply:h,reblog:d,like:c}});e.exports=u},{"../../base_view":378,"./admin_menu_view":390,"./creator_menu_view":391,"./ignore_view":392,"./like_view":395,"./photo_reply_view":396,"./reblog_view":397,"./reply_view":398,"./share_menu_view":399,"./sponsor_menu_view":400}],394:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="post_animated_heart post_poof'+(null==(__t=liked?"":" unliked")?"":__t)+'"><span class="heart_left"></span><span class="heart_right"></span></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],395:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("../../base_view"),n=t("prima/mixins/loggedouthelper"),a=t("prima/events"),r=t("./like_button_heart.tpl"),l=o.extend({heartTemplate:r,mixins:[n],events:function(){return{click:this.isLoggedIn()?"onClick":this.redirect("/register?redirect_to=/explore")}},initialize:function(){this.listenTo(this.model,"like:set",this.updateLikeStatus),this.listenTo(this.model,"unlike:set",this.updateLikeStatus),this.render()},onClick:function(t){t.preventDefault(),this._liked()?(this.model.unlike(),this._logUnlike()):(this.model.like(),this._logLike())},render:function(){return this},_liked:function(){return this.model.get("liked")},updateLikeStatus:function(){var t=this._liked();this.$el.toggleClass("liked",t);var e=s(this.heartTemplate({liked:t}));this.$el.append(e),i.delay(function(){e.fadeOut(200,function(){e.remove()})},300)},_logLike:function(){a.trigger("post:like:set",{loggingData:{blog:this.model.get("tumblelog"),post_id:this.model.id,position:this.model.get("collection_index"),initiator:"post_masonry"}})},_logUnlike:function(){a.trigger("post:unlike:set",{loggingData:{blog:this.model.get("tumblelog"),postId:this.model.id,position:this.model.get("collection_index"),initiator:"post_masonry"}})}});e.exports=l},{"../../base_view":378,"./like_button_heart.tpl":394,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/mixins/loggedouthelper":464}],396:[function(t,e){"use strict";var i=t("../../base_view"),s=i.extend({});e.exports=s},{"../../base_view":378}],397:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=(t("prima/lib/flags"),t("prima/mixins/accessor")),n=t("../../base_view"),a=t("prima/mixins/loggedouthelper"),r=t("prima/events"),l=n.extend({mixins:[o,a],events:function(){return{click:this.isLoggedIn()?"onClick":this.redirectLink()}},initialize:function(){this.listenTo(this.model,"fastreblog:success",this.onFastReblogged),this.render()},render:function(){return this.$el.toggleClass("reblogged",!!this.get("startedFastReblog")||!!this.model.get("reblogged")),this.$el.toggleClass("queued",!!this.get("fastRebloggedQueue")),this.started_fast_reblog=!1,this},onClick:function(t){return event.preventDefault(),this._logReblog(),t.altKey&&!this.model.reblogged?(this.set("startedFastReblog",!0),this.model.fastReblog()):this.model.reblog()},onFastReblogged:function(t){this.set("fastReblogQueue",t);var e=s('<div class="post_reblog_poof post_poof"></div>');t&&e.addClass("queue"),this.get("startedFastReblog")||this.$el.height()>s(window).height()&&e.css("top",.5*s(window).height()),this.$el.append(e),i.delay(function(t){e.fadeOut(200,function(){e.remove(),t.render()})},300,this)},_logReblog:function(){r.trigger("post:log-reblog",{loggingData:{blog:this.model.get("tumblelog"),post_id:this.model.id,position:this.model.get("collection_index"),initiator:"post_masonry"}})}});e.exports=l},{"../../base_view":378,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/lib/flags":"f/LVtH","prima/mixins/accessor":458,"prima/mixins/loggedouthelper":464}],398:[function(t,e){"use strict";var i=t("../../base_view"),s=i.extend({});e.exports=s},{"../../base_view":378}],399:[function(t,e){"use strict";var i=t("../../base_view"),s=t("components/popover/views/share-popover"),o=i.extend({events:{click:"openSharePopover"},openSharePopover:function(t){t.preventDefault();var e={popoverData:this.model.get("share_popover_data"),pinnedTarget:this.$el};this.popover=new s(e),this.popover.render()}});e.exports=o},{"../../base_view":378,"components/popover/views/share-popover":372}],400:[function(t,e){"use strict";var i=t("../../base_view"),s=i.extend({});e.exports=s},{"../../base_view":378}],401:[function(t,e){"use strict";var i=t("../base_view"),s=t("./controls"),o=t("./notes_view"),n=i.extend({hasSubViews:{controls:s,notes:o}});e.exports=n},{"../base_view":378,"./controls":393,"./notes_view":402}],402:[function(t,e){"use strict";var i=t("jquery"),s=t("prima/events"),o=t("../base_view"),n=t("prima/mixins/generate-logging-data"),a=o.extend({events:{"click .note_count":"showNotes","click .note .follow":"followFromNote"},mixins:[n],initialize:function(){this.bindEvents()},bindEvents:function(){this.listenTo(this.model,"change:liked",this.updateCount)},render:function(){this.$notesLabel=this.$el.find(".note_link_current")},updateCount:function(t,e){var i,s=this.$notesLabel.text();e?(i=this.$notesLabel.data("more"),this.$notesLabel.data("less",s)):(i=this.$notesLabel.data("less"),this.$notesLabel.data("more",s)),this.$notesLabel.text(i),this.$notesLabel.attr("title",i)},showNotes:function(t){s.trigger("useraction:click:post:notes",{event:t}),this.model.get("pt")&&s.trigger("useraction:explore_click:notes",{model:this.model,loggingData:this.loggingData({userAction:"notes"})})},followFromNote:function(t){t.preventDefault();var e=i(t.currentTarget),o=e.closest(".note"),n=o.data("tumblelog");if(n){if(!this.isLoggedIn())return void window.open("/follow/"+n);o.addClass("is_following"),s.trigger("useraction:click:notes:follow",n)}}});e.exports=a},{"../base_view":378,jquery:"HlZQrA","prima/events":429,"prima/mixins/generate-logging-data":461}],403:[function(t,e){"use strict";var i=t("prima/lib/flags"),s=t("prima/events"),o=t("../base_view"),n=t("components/popover/views/post_moderation_popover"),a=o.extend({events:{click:"onClick"},onClick:function(t){i.bool("abuse_forms")?s.trigger("abuseform:open",{post:this.model}):(t.preventDefault(),this.popover=new n({post:this.model,pinnedTarget:this.$el}),this.popover.render())}});e.exports=a},{"../base_view":378,"components/popover/views/post_moderation_popover":371,"prima/events":429,"prima/lib/flags":"f/LVtH"}],404:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/events"),o=t("prima/view"),n=t("prima/mixins/loggedouthelper"),a=o.extend({mixins:[n],events:function(){return{click:this.isLoggedIn()?"onClick":this.redirect("/register?redirect_to=/explore")}},initialize:function(){this.pt=this.model.get("pt"),this.model=this.model.tumblelog,this.listenTo(this.model,"change:following",this.updateFollowStatus)},onClick:function(t){t.preventDefault(),this._log_follow(),this.model.follow({pt:this.pt,source:"FOLLOW_SOURCE_DISCOVER_POSTS_GRID"})},_log_follow:function(){var t=this.$el.closest("article"),e=JSON.parse(t.attr("data-json"));s.trigger("post:log_follow",{loggingData:{postId:e.id,tumblelog:e.tumblelog,position:t.index()}})},_following:function(){return this.model.get("following")},updateFollowStatus:function(){this._following()?(this.$el.addClass("active animated poof"),i.delay(function(t){t.addClass("final_state")},1e3,this.$el)):this.$el.removeClass("active animated poof final_state")}});e.exports=a},{lodash:"K2RcUv","prima/events":429,"prima/mixins/loggedouthelper":464,"prima/view":496}],405:[function(t,e){"use strict";var i=t("../base_view"),s=t("./follow_view"),o=t("./info_view"),n=t("./flag_view"),a=i.extend({hasSubViews:{follow:s,info:o,flagMenu:n}});e.exports=a},{"../base_view":378,"./flag_view":403,"./follow_view":404,"./info_view":406}],406:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/events"),o=t("prima/mixins/loggedouthelper"),n=t("../base_view"),a=t("components/popover/views/blog_card_popover"),r=t("prima/mixins/generate-logging-data"),l=n.extend({hidePopoverTimeout:null,mixins:[o,r],events:{click:"checkIfPremiumPost"},initialize:function(){n.prototype.initialize.apply(this,arguments),this.isLoggedIn()&&this.$el.hoverIntent({over:i.bind(this.showBlogCardPopover,this),out:i.noop,sensitivity:3})},checkIfPremiumPost:function(){this.model.get("pt")&&s.trigger("useraction:explore_click:lightbox",{model:this.model,loggingData:this.loggingData({userAction:"lightbox"})})},showBlogCardPopover:function(){this.popover&&(this.popover.teardown(),this.popover=null);var t=this.$el.closest("article"),e=JSON.parse(t.attr("data-json"));s.trigger("TumblelogPopover:log_follow_open",{loggingData:{postId:e.id,tumblelog:e.tumblelog,position:t.index()}}),this.popover=new a({model:this.model.tumblelog,pinnedTarget:this.$el}),this.popover.openPopover()},hideBlogCardPopover:function(){this.popover&&this.popover.closePopover()},teardown:function(){this.$el.off("mouseenter mouseleave")}});e.exports=l},{"../base_view":378,"components/popover/views/blog_card_popover":368,lodash:"K2RcUv","prima/events":429,"prima/mixins/generate-logging-data":461,"prima/mixins/loggedouthelper":464}],407:[function(t,e){"use strict";var i=t("../base_view"),s=t("components/post/mixins/draggabletags"),o=t("prima/events"),n=t("prima/mixins/generate-logging-data"),a=i.extend({mixins:[s,n],events:{"click .post_tag":"_checkIfPremiumPost"},_checkIfPremiumPost:function(){this.model.get("pt")&&o.trigger("useraction:explore_click:tag_click",{model:this.model,loggingData:this.loggingData({userAction:"tag_click"})})}});e.exports=a},{"../base_view":378,"components/post/mixins/draggabletags":377,"prima/events":429,"prima/mixins/generate-logging-data":461}],408:[function(t,e){"use strict";var i=t("prima/events"),s=t("./base_view"),o=t("./header"),n=t("./content"),a=t("./footer"),r=t("./post_tags"),l=s.extend({hasSubViews:{header:o,content:n,footer:a,tags:r},initialize:function(){s.prototype.initialize.apply(this,arguments),this.render()},render:function(){return s.prototype.render.apply(this,arguments),this.bindEvents(),this},bindEvents:function(){this.listenTo(i,"flagged:"+this.model.tumblelog.get("name"),this.onFlagged)},onFlagged:function(){this.$el.addClass("is_flagged")}});e.exports=l},{"./base_view":378,"./content":383,"./footer":401,"./header":405,"./post_tags":407,"prima/events":429}],409:[function(t,e){"use strict";var i=t("logs/instruments/base"),s=i.extend({logKey:"abuseform",events:{"abuseform:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(t,e){this.log(t,e)}});e.exports=s},{"logs/instruments/base":410}],410:[function(t,e){"use strict";var i=t("backbone"),s=t("lodash"),o=t("prima/class"),n=t("prima/events"),a=t("prima/lib/logger"),r=[];r.push(t("prima/lib/loglady/endpoints/cslogger"));var l=/^\/(.+)\/([gimy]*)$/,h=o.extend({constructor:function(){this._eventHandlers=[],this.setupEndpoints(),this.initialize();var t=s.result(this,"events")||{};s(t).each(this._addEventHandlerByString,this);var e=s.result(this,"eventBus");this.listenTo(e,"all",this._handleEvent),a.log("LogLady","[instrument]",this.logKey)},logSpots:r,eventBus:n,_addEventHandlerByString:function(t,e){var i,s=e.match(l);if(s){var o=new RegExp(s[1],s[2]);i=function(t){var e=t.match(o);if(e){for(var i=new Array(e.length-1),s=0;s<e.length;s+=1)s>0&&(i[s-1]=e[s]);return i}}}else if("*"===e[e.length-1]){var n=e.substring(0,e.length-1);i=function(t){var e=t.indexOf(n);return 0===e?[t.substring(n.length,t.length)]:void 0}}else i=function(t){return t===e?[t]:null};this._addEventHandler(t,i)},_addEventHandler:function(t,e){this._eventHandlers.push({method:t,matcher:e})},_handleEvent:function(t,e){for(var i,o,n,a=this._eventHandlers.length-1;a>=0;a--)i=this._eventHandlers[a],n=i.callback||this[i.method],n&&(o=i.matcher.call(this,t,e),s.isArray(o)&&(e&&e.loggingData&&o.push(s.cloneDeep(e.loggingData)),n.apply(this,o)))},setupEndpoints:function(){var t=s.result(this,"logSpots");this.loggers=s(t).map(function(t){return t(this)},this).compact().value()},initialize:s.noop,log:function(){for(var t=this.loggers.length-1;t>=0;t--){var e=this.loggers[t];e.trigger.apply(e,arguments)}}},{start:function(){return this._setupInstance||(this._setupInstance=new this),this._setupInstance}});s.extend(h.prototype,i.Events),e.exports=h},{backbone:"5kFNoY",lodash:"K2RcUv","prima/class":426,"prima/events":429,"prima/lib/logger":436,"prima/lib/loglady/endpoints/cslogger":441}],411:[function(t,e){"use strict";var i=t("logs/instruments/base"),s=i.extend({logKey:"dashboard_sharing",events:{"dashboard-share:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(t,e){e=e||{},this.log(t,e)}});e.exports=s},{"logs/instruments/base":410}],412:[function(t,e){"use strict";var i=t("lodash"),s=t("logs/instruments/base"),o=s.extend({logKey:"dashboard_embed",events:{"/post:((?:un)?docked)/":"log","post:embed:stateChange":"logStateChange"},logStateChange:function(t,e){if(!i.isEmpty(e)&&e.state&&e.postID&&e.service){if("tumblr"===e.service)return;this.log(e.state,{service:e.service,post_id:e.postID})}}});e.exports=o},{lodash:"K2RcUv","logs/instruments/base":410}],413:[function(t,e){"use strict";var i=t("logs/instruments/base"),s=i.extend({logKey:"explore_trending",logOptions:{init_event:!1},events:{"explore-trending:*":"log"},logEnv:{location:document.location.pathname}});e.exports=s},{"logs/instruments/base":410}],414:[function(t,e){"use strict";var i=t("logs/instruments/base"),s=i.extend({logKey:"helpform",events:{"helpform:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(t,e){this.log(t,e)}});e.exports=s},{"logs/instruments/base":410}],415:[function(t,e){"use strict";var i=t("logs/instruments/base"),s=i.extend({logKey:"keycommands_trigger",events:{"keycommands:*":"handleEvent"},initialize:function(){this.hasLoggedJK=!1},handleEvent:function(t,e){if("jk"===t){if(this.hasLoggedJK)return;this.hasLoggedJK=!0}this.log(t,e)}});e.exports=s},{"logs/instruments/base":410}],416:[function(t,e){"use strict";var i=t("logs/instruments/base"),s=i.extend({logKey:"linkpost_interactions",logOptions:{init_event:!1},events:{"linkpost:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(t,e){this.log(t,e)}});e.exports=s},{"logs/instruments/base":410}],417:[function(t,e){"use strict";var i=t("logs/instruments/base"),s=i.extend({logKey:"loginregister",events:{"loginregister:*":"handleEvent"},initialize:function(){this.hasStartedFunnel=!1},logEnv:{actionType:"/login"===document.location.pathname?"login":"register",captchaType:"recaptcha"},handleEvent:function(t,e){if("beginFlow"===t){if(this.hasStartedFunnel)return;this.hasStartedFunnel=!0}this.log(t,e)}});e.exports=s},{"logs/instruments/base":410}],418:[function(t,e){"use strict";var i=t("logs/instruments/base"),s=i.extend({logKey:"mobile_callout",logEnv:{location:document.location.pathname},logOptions:{init_event:!1},events:{"MobileCallout:*":"log"}});e.exports=s},{"logs/instruments/base":410}],419:[function(t,e){"use strict";var i=t("logs/instruments/base"),s=i.extend({logKey:"related_recommendations",logOptions:{init_event:!1},events:{"rapid-recommendations:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(t,e){this.log(t,e)}});e.exports=s},{"logs/instruments/base":410}],420:[function(t,e){"use strict";var i=t("logs/instruments/base"),s=i.extend({logKey:"roadblock",events:{"roadblock:*":"log"}});e.exports=s},{"logs/instruments/base":410}],421:[function(t,e){"use strict";var i=t("logs/instruments/base"),s=i.extend({logKey:"tourguide_account",logEnv:{referrer:document.location.pathname},logOptions:{init_event:!1},events:{"TourGuideAccount:*":"log"}});e.exports=s},{"logs/instruments/base":410}],422:[function(t,e){"use strict";var i=t("lodash"),s=t("logs/instruments/base"),o=s.extend({logKey:"vendorbutton",logEnv:{referrer:document.location.pathname},events:{"VendorButton:*":"handleEvent"},handleEvent:function(t,e){var s=i.extend({},e);
s.post_id=e.postData.id,s.root_post_id=e.postData.root_id,s.tumblelog=e.postData.tumblelog,delete s.postData,this.log(t,s)}});e.exports=o},{lodash:"K2RcUv","logs/instruments/base":410}],423:[function(t,e){"use strict";var i=t("lodash"),s=t("logs/instruments/base"),o=s.extend({logKey:"videoplayer",logEnv:{referrer:document.location.pathname},events:{"VideoPlayer:cacheUnload":"cacheUnloadLog","VideoPlayer:timeupdate":"updateLogCache","VideoPlayer:*":"log"},initialize:function(){this.excludedEvents=["cacheUnload","timeupdate"],this.unloadData={},i.each(this.loggers,function(t){t.before_unloaded=i.bind(this.beforeUnloaded,this)},this)},log:function(t){i.contains(this.excludedEvents,t)||s.prototype.log.apply(this,arguments)},cacheUnloadLog:function(t,e){this.unloadData[e.id]=e},beforeUnloaded:function(){i.each(this.unloadData,function(t){this.log("unload",t)},this)},updateLogCache:function(t,e){var s=["elapsed","position"];this.unloadData[e.id]=i.extend(this.unloadData[e.id],i.pick(e,s))}});e.exports=o},{lodash:"K2RcUv","logs/instruments/base":410}],424:[function(t,e){"use strict";var i=t("lodash"),s={loadedLogs:[],init:function(){},startLogs:function(t){i.each(t,function(t){var e=t.start();this.loadedLogs.push(e.logKey)},this)},startLog:function(t){this.startLogs([t])}};e.exports=s},{lodash:"K2RcUv"}],425:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/class"),o=t("prima/lib/data"),n=t("prima/lib/logger"),a=t("prima/lib/translate"),r=t("prima/lib/templateutils"),l=t("logs/logging-manager"),h=s.extend({constructor:function(t){this.setup(t),this.initialize()},setup:function(t){o.setup(t),n.log("Exec","Bootstrap/Data"),a.setup(t.Translations),n.log("Exec","Bootstrap/Translations"),l.init(),n.log("Exec","Bootstrap/logs")},initialize:function(){throw new Error("No router defined")}});i.extend(i.templateSettings.imports,r),e.exports=h},{lodash:"K2RcUv","logs/logging-manager":424,"prima/class":426,"prima/lib/data":431,"prima/lib/logger":436,"prima/lib/templateutils":454,"prima/lib/translate":456}],426:[function(t,e){"use strict";function i(){}var s=t("backbone"),o=t("./lib/extendwithmixins");i.extend=s.Model.extend,o.applyTo(i),e.exports=i},{"./lib/extendwithmixins":435,backbone:"5kFNoY"}],427:[function(t,e){"use strict";var i=t("backbone"),s=t("./mixins/withformkeytrue"),o=t("./lib/extendwithmixins"),n=i.Collection.extend();s.applyTo(n.prototype),o.applyTo(n),e.exports=n},{"./lib/extendwithmixins":435,"./mixins/withformkeytrue":470,backbone:"5kFNoY"}],428:[function(t,e){"use strict";var i=t("lodash"),s=t("backbone"),o=t("./class"),n=t("./lib/data"),a=(t("./lib/logger"),t("./utils/ensure-element")),r=t("./mixins/accessor/simple"),l=["selector","container","rootEl","view","viewOptions","autoAppend"],h=o.extend({name:null,rootEl:null,selector:null,view:null,viewOptions:{},autoAppend:!1,defaults:{},constructor:function(t){t||(t={}),this.cid=i.uniqueId("component"),i.extend(this,i.pick(t,l));var e=i.result(this,"defaults"),o=i.extend({},i.pick(t,i.keys(e)),e);this.attributes={},this.set(o,{silent:!0}),this.changed={},(this.autoAppend||this.selector)&&this.setContainer(),this.selector||(this.selector=this.defaultSelector),this.view&&this.view.prototype&&this.view.prototype instanceof s.View?this.view=new this.view(this.viewOptions):i.isFunction(this.view)&&(this.view=this.view.call(this,this.viewOptions)),this.initialize.apply(this,arguments),this.autoAppend&&this.append()},initialize:i.noop,setContainer:function(){return this.selector||(this.selector=this.defaultSelector),this.container=this.selector,this.container},getOwnData:function(){return this.data},remove:function(){i.result(this,"beforeRemove"),this.view&&i.isFunction(this.view.remove)&&this.view.remove();var t=["container","view","defaults","attributes"];return i.each(t,i.bind(function(t){this[t]&&delete this[t]},this)),this.stopListening(),this.trigger("remove"),this},append:function(){return this.view&&i.isFunction(this.view.render)&&(this.container?this.container.appendChild(this.view.render().el):this.view.render()),this.trigger("append"),this}});Object.defineProperties(h.prototype,{defaultSelector:{get:function(){return"[prima-component="+this.name+"]"},set:function(){}},container:{get:function(){return this._container},set:function(t){var e=a(t,this.rootEl);this._container=e}},data:{get:function(){return this._data||(this._data=n.get("Components/"+this.name)),this._data},set:function(t){this._data=t}}}),r.mixin.applyTo(h.prototype),e.exports=h},{"./class":426,"./lib/data":431,"./lib/logger":436,"./mixins/accessor/simple":459,"./utils/ensure-element":481,backbone:"5kFNoY",lodash:"K2RcUv"}],429:[function(t,e){"use strict";var i=t("lodash"),s=t("backbone"),o=function(){};o.extend=s.Model.extend,i.extend(o.prototype,s.Events),o.prototype.trigger=function(){return i.isObject(arguments[1])&&(arguments[1].loggingData=arguments[1].loggingData||{}),s.Events.trigger.apply(this,arguments)},e.exports=new o},{backbone:"5kFNoY",lodash:"K2RcUv"}],430:[function(t,e){"use strict";function i(t,e){this.options=e||{},this._onClick=s.bind(this._onClick,this,t),document.addEventListener("click",this._onClick,!0)}var s=t("lodash"),o=t("jquery"),n=t("backbone");i.prototype._onClick=function(t,e){t===e.target||o.contains(t,e.target)?this.trigger("click:inside"):(this.trigger("click:outside"),this.options.preventInteraction&&(e.preventDefault(),e.stopPropagation()))},i.prototype.remove=function(){return document.removeEventListener("click",this._onClick,!0),this.off(),this},s.extend(i.prototype,n.Events),e.exports=i},{backbone:"5kFNoY",jquery:"HlZQrA",lodash:"K2RcUv"}],431:[function(t,e){"use strict";function i(t){if(!n)throw new Error("Data hasn't been initialized with `setup`.");if(!a.isString(t))return null;var e=r(n,t.replace(/\//g,"."));return a(e).cloneDeep()}function s(t){if(!n)throw new Error("Data hasn't been initialized with `setup`.");return a.isString(t)?l(n,t.replace(/\//g,".")):null}function o(t){n=a.isObject(t)?t:{}}var n,a=t("lodash"),r=t("../utils/getpath"),l=t("../utils/haspath");e.exports={get:i,has:s,setup:a.once(o)}},{"../utils/getpath":484,"../utils/haspath":485,lodash:"K2RcUv"}],432:[function(t,e){"use strict";function i(t){t=s.extend({entries:{},name:"Dictionary"},t),this._hadLastLookup=!1,this._entries=t.entries,this._name=t.name}var s=t("lodash"),o=(t("./logger"),function(t,e,i){null!=i||(i=this);var s=t.apply(i,e);return e=Array.prototype.slice.call(e,1),e.unshift(s),e});i.prototype.addEntries=function(t){return s.extend(this._entries,t),this},i.prototype.lookup=function(t){return s.has(this._entries,t)?(this._hadLastLookup=!0,this._entries[t]):(this._hadLastLookup=!1,t)},i.prototype.lookupWithFormatting=function(t){var e;return arguments.length>1?(e=this.lookup(s.sprintf.apply(this,arguments)),this._hadLastLookup||(e=s.sprintf.apply(this,o(this.lookup,arguments,this)))):e=this.lookup(t),e},i.prototype.get=function(t){var e=this.lookupWithFormatting.apply(this,arguments);return!this._hadLastLookup&&this.logMissing,e},i.prototype.getEntries=function(){return s(this._entries).cloneDeep()},e.exports=i},{"./logger":436,lodash:"K2RcUv"}],433:[function(t,e){"use strict";function i(){function t(){o(),d.trigger("DOMEventor:flatresize",p),e=!1}var e;u.on("resize.DOMEventor-nextResizeLoop",function(){e||(g(t),e=!0)})}function s(){function t(){i--||(m.documentHeight=p.documentHeight,p.documentHeight=c.height(),i=1),m.windowScrollTop=m.windowScrollY=p.windowScrollTop,p.windowScrollTop=p.windowScrollY=u.scrollTop(),d.trigger("DOMEventor:flatscroll",p),e=!1}var e,i=0;u.on("scroll.DOMEventor-nextScrollLoop",function(){e||(g(t),e=!0)})}function o(){m.documentHeight=p.documentHeight,p.documentHeight=c.height(),m.windowHeight=p.windowHeight,p.windowHeight=u.height(),m.windowWidth=p.windowWidth,p.windowWidth=u.width(),m.windowScrollTop=m.windowScrollY=p.windowScrollTop,p.windowScrollTop=p.windowScrollY=u.scrollTop()}function n(){var t=[],e={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"leftmeta",92:"rightmeta",93:"rightmeta",96:"num0",97:"num1",98:"num2",99:"num3",100:"num4",101:"num5",102:"num6",103:"num7",104:"num8",105:"num9",106:"multiply",107:"add",109:"subtract",110:"decimal",111:"devide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:"semicolon",187:"equal",188:"comma",189:"dash",190:"period",191:"forwardslash",192:"graveaccent",219:"openbracket",220:"backslash",221:"closebracket",222:"singlequote"};c.on("keydown.DOMEventor keyup.DOMEventor",function(i){var s=i.type;if("keyup"===s||"keydown"===s){var o=h(i.target),n=i.which;if(!((o.is("input")||o.is("textarea")||o.is("select"))&&n>=48&&90>=n)||i.metaKey||i.ctrlKey||i.altKey){n>=48&&90>=n&&"keydown"===s&&(t[n]=1);var a="";for(var r in t)"keydown"===s&&n!==parseInt(r,10)&&(a+=e[r]?e[r]+"+":"");var l=s+":"+(i.altKey&&18!==n?"alt+":"")+(i.ctrlKey&&17!==n?"ctrl+":"")+(i.metaKey&&91!==n&&92!==n&&93!==n?"meta+":"")+(i.shiftKey&&16!==n?"shift+":"")+(a||"")+(e[n]||"");d.trigger("DOMEventor:"+l,i,l),"keyup"===s&&(t=[])}}}),d.off("DOMEventor:startKeyboardObserver"),d.on("DOMEventor:stopKeyboardObserver",a)}function a(){c.off("keydown.DOMEventor keyup.DOMEventor"),d.on("DOMEventor:startKeyboardObserver",n),d.off("DOMEventor:stopKeyboardObserver")}function r(){o(),s(),i(),n(),d.on("DOMEventor:updateRect",o)}var l=t("lodash"),h=t("jquery"),d=t("../events"),c=h(document),u=h(window),p={},m={};p.documentHeight=m.documentHeight=null,p.windowHeight=m.windowHeight=null,p.windowWidth=m.windowHeight=null,p.windowScrollTop=m.windowScrollTop=null,p.windowScrollY=m.windowScrollY=null;var g=!Object.hasOwnProperty.call(window,"requestAnimationFrame")&&window.requestAnimationFrame||!Object.hasOwnProperty.call(window,"webkitRequestAnimationFrame")&&window.webkitRequestAnimationFrame||!Object.hasOwnProperty.call(window,"mozRequestAnimationFrame")&&window.mozRequestAnimationFrame||!Object.hasOwnProperty.call(window,"oRequestAnimationFrame")&&window.oRequestAnimationFrame||function(t){window.setTimeout(function(){t()},50)},f={init:l.once(r),rect:function(){return p},lastRect:function(){return m}};e.exports=f},{"../events":429,jquery:"HlZQrA",lodash:"K2RcUv"}],434:[function(t,e){"use strict";function i(t){function e(){n.removeEventListener("DOMContentLoaded",e),t()}n.addEventListener("DOMContentLoaded",e)}function s(t){o||(o=/^loaded|^i|^c/.test(n.readyState)),o?setTimeout(t):i(t)}var o,n=document;e.exports=s},{}],435:[function(t,e){"use strict";function i(t){var e=n.apply(this,arguments);return o.has(t,"mixins")&&t.mixins.forEach(function(t){t.applyTo(e.prototype)}),e}function s(t){t.extend=i}var o=t("lodash"),n=t("backbone").Model.extend;e.exports.applyTo=s},{backbone:"5kFNoY",lodash:"K2RcUv"}],436:[function(t,e){"use strict";var i=t("lodash"),s=(t("./domready"),{}),o=function(){return s};s.log=o,s.logSaw=o,s.count=i.noop,s.echo=o,s.flush=o,s.flushCount=o,s.groupNameWithUrl=i.identity,e.exports=s},{"./domready":434,lodash:"K2RcUv"}],437:[function(t,e){"use strict";function i(t){this.watching={},this.pending_events=[],this.endpoint=t.endpoint,t.event_payload_name&&(this.event_payload_name=t.event_payload_name),t.event_filter&&(this.event_filter=t.event_filter),s.bindAll(this,"_flush_from_timeout"),this._flush_from_timeout();var e=t.EventClass||g;this.Log=m.extend({EventClass:e}),o(window).on("beforeunload.log_lady",s.bind(this._flush_on_unload,this))}var s=t("lodash"),o=t("jquery"),n=t("backbone"),a=(t("prima/lib/logger"),t("prima/lib/flags")),r=t("prima/utils/realnow"),l=r.getRealNow,h=t("../utils/extend-with-defaults"),d=t("../utils/uuid"),c=t("../utils/send-beacon"),u=[].slice,p=t("./config"),m=t("./log"),g=t("./logladyphp/event"),f=1e3;s.extend(i.prototype,n.Events,{initialize:s.noop,defaults:{flush_rate:15*f},min_flush_rate:function(){var t=s.map(this.watching,function(t){return s.result(t,"flush_rate")});return t.push(this.defaults.flush_rate),s.min(t)},set_flush_rate:function(t){return t&&(this.defaults.flush_rate=t),this.flush_rate=this.min_flush_rate(),this.flush_is_overdue()&&this._flush_from_timeout(),this.flush_rate},flush:function(){var t=this.build_payload();if(!(t[this.event_payload_name].length<1)&&a.bool("log_lady"))return c(this.endpoint,t,!this.unloading),this.last_flush_at=l(),!0},_flush_on_unload:function(){this._flush_timeout&&clearTimeout(this._flush_timeout),this._trigger_unloads(),this.unloading=!0,this.flush()},_trigger_unloads:function(){var t;for(var e in this.watching)t=this.watching[e],"function"==typeof t.unloaded&&t.unloaded()},_flush_from_timeout:function(){this._flush_timeout&&clearTimeout(this._flush_timeout);var t=this.flush();t!==!1&&(this._flush_timeout=setTimeout(this._flush_from_timeout,this.flush_rate))},flush_is_overdue:function(){this.last_flush_at||(this.last_flush_at=l());var t=l()-this.last_flush_at;return t>this.flush_rate},watch:function(){var t,e,i,o=u.apply(arguments);for(i=0;i<o.length;i++)t=o[i],this.is_valid(t)&&(t.log_lady=this,this.watching[t.log_key]&&(e=this.watching[t.log_key],e&&s.isFunction(e.replaced)&&e.replaced(t)),this.watching[t.log_key]=t);return this.set_flush_rate(),this},pending_log_events:function(){var t=this.pending_events;return this.pending_events=[],t},event_payload_name:"events",event_filter:function(){return!0},build_payload:function(){var t=s.merge({},this.watching,[this]),e=s(t).collect(function(t){return t.pending_log_events()}).flatten().filter(this.event_filter).collect(s.bind(function(t){return t.json},this)).value(),i={};return i[this.event_payload_name]=e,i},is_valid:function(t){var e=!!t;return e&&(e=s.result(t,"log_key")),e&&(e=s.result(t,"uuid")),e&&(e=s.isFunction(t.pending_log_events)),e},log:function(t,e){if(t){if(!(t in this.watching)){e&&e.log_key&&console.warn("log key gets overridden by log name");var i=p("keys",t);e=s.extend({},i,e,{log_key:t});var o=new this.Log(e);this.watch(o)}return this.watching[t]}},new_uuid:d}),i.extend=h,i.Log=m,e.exports=i},{"../utils/extend-with-defaults":450,"../utils/send-beacon":451,"../utils/uuid":452,"./config":439,"./log":443,"./logladyphp/event":445,backbone:"5kFNoY",jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/flags":"f/LVtH","prima/lib/logger":436,"prima/utils/realnow":490}],438:[function(t,e){"use strict";var i,s=t("prima/lib/data"),o=function(){return i||(i=s.get("Components/LogLady")),i};e.exports=o()},{"prima/lib/data":431}],439:[function(t,e){"use strict";function i(){for(var t,e=n.apply(arguments),i=o,a=0;a<e.length;a++){if(t=e[a],!i||!s.has(i,t))return;i=i[t]}return i}var s=t("lodash"),o=t("./bootstrap"),n=[].slice;e.exports=i},{"./bootstrap":438,lodash:"K2RcUv"}],440:[function(t,e){"use strict";function i(t){return o.isString(t)?t:JSON.stringify(t)}function s(t,e,s){this.name=e,this.log_key=o.result(t,"log_key"),this.data=s||null;var n=r(),h=o.result(t,"generate_relative_id"),d=o.result(t,"env"),c=t.uuid,u={category:this.log_key},p=8,m=new Array(p);m[0]=i(n),m[1]=i(l),m[2]=i(c),m[3]=i(h),m[4]=i(a.getElapsed(n)),m[5]=i(e),m[6]=i(s),m[7]=i(d),u.fields=m,this.json=u}var o=t("lodash"),n=t("prima/utils/cookie"),a=t("prima/utils/realnow"),r=a.getRealNow,l=n.get("tmgioct");e.exports=s},{lodash:"K2RcUv","prima/utils/cookie":478,"prima/utils/realnow":490}],441:[function(t,e){"use strict";function i(t){var e=s.result(t,"logKey"),i=s.result(t,"logEnv");if(e){var n=s.result(t,"logOptions")||{};return i&&(n.env=i),o.log(e,n)}}var s=t("lodash"),o=t("./logger");e.exports=i},{"./logger":442,lodash:"K2RcUv"}],442:[function(t,e){"use strict";var i=t("../base"),s=t("./event"),o=new i({EventClass:s,event_payload_name:"payload",event_filter:function(){return!0},endpoint:"/services/cslog"});e.exports=o},{"../base":437,"./event":440}],443:[function(t,e){"use strict";function i(t,e){t.uuid?(e=t,t=e.uuid):e||!t||s.isString(t)||(e=t,t=void 0),this.options=s.extend({},this.defaults,e),delete this.options.log_key,delete this.options.env,delete this.options.uuid,r(this,"uuid",t||this._generate_uuid()),e.env||(e.env={}),s.each(e.flags,function(t){e.env.flags||(e.env.flags={}),e.env.flags[t]=n.bool(t)}),r(this,"env",e.env),this.log_key=e.log_key||this.log_key,this.events=[],this.event_count=0,this.pending_events=[],this.event_counts={},this.started_at||(this.started_at=this.options.started_at||a.getRealNow()),delete this.options.started_at,this.initialize(e),this.options.init_event&&this.trigger("init")}var s=t("lodash"),o=t("backbone"),n=t("prima/lib/flags"),a=t("prima/utils/realnow"),r=t("../utils/define-immutable-property"),l=t("../utils/extend-with-defaults"),h=t("../utils/uuid"),d=t("./config"),c=t("./logladyphp/event");s.extend(i.prototype,o.Events,{EventClass:c,initialize:s.noop,_generate_uuid:function(){return d("default_session")||h()},defaults:{init_event:!0,keep_counts:!1},pending_log_events:function(){var t=this.pending_events;return this.pending_events=[],t},generate_relative_id:function(){return this.event_count},unloaded:function(t){t||(t={}),t=this.before_unloaded(t)||{},this.options.keep_counts&&s.extend(t,{event_counts:this.event_counts}),s.isEmpty(t)||this.trigger("unload",t)},before_unloaded:function(t){return t},replaced:function(t){this.before_replaced(t);for(var e=this.pending_log_events();e.length;)this.log_lady.pending_events.push(e.shift())},before_replaced:s.noop,trigger:function(t,e){var i=new this.EventClass(this,t,e);return this.options.keep_counts&&"init"!==t&&"unload"!==t&&(this.event_counts[t]||(this.event_counts[t]=0),this.event_counts[t]++),this.event_count+=1,this.pending_events.push(i),o.Events.trigger.call(this,t,i,this),this}}),i.extend=l,e.exports=i},{"../utils/define-immutable-property":449,"../utils/extend-with-defaults":450,"../utils/uuid":452,"./config":439,"./logladyphp/event":445,backbone:"5kFNoY",lodash:"K2RcUv","prima/lib/flags":"f/LVtH","prima/utils/realnow":490}],444:[function(t,e){"use strict";var i=t("lodash"),s=t("../config"),o=i.keys(s("keys"));e.exports=function(t){return o.indexOf(t.log_key)>=0}},{"../config":439,lodash:"K2RcUv"}],445:[function(t,e){"use strict";function i(t,e,i){this.name=e,this.log_key=s.result(t,"log_key"),this.data=i||null;var o=n(),r=s.result(t,"generate_relative_id"),l=s.result(t,"env"),h=t.uuid,d={};d.log_key=this.log_key,d.uuid=h,d.event=this.name,d.ts=o,r!==!1&&void 0!==r&&(d.rid=r),d.elapsed=d.ts-a,d.data=this.data,d.env=l,this.json=d}var s=t("lodash"),o=t("prima/utils/realnow"),n=o.getRealNow,a=o.realStartedAt;e.exports=i},{lodash:"K2RcUv","prima/utils/realnow":490}],446:[function(t,e){"use strict";var i=t("prima/events"),s=t("../base"),o=t("./event"),n=t("./event-filter"),a=new s({EventClass:o,event_payload_name:"events",event_filter:n,endpoint:"/svc/log/lady"});i.on("Capture:push",function(t,e,i){a.log(t,{init_event:!1}).trigger(e,i)}),e.exports=a},{"../base":437,"./event":445,"./event-filter":444,"prima/events":429}],447:[function(t,e){"use strict";var i=t("./endpoints/logladyphp/logger");e.exports=i},{"./endpoints/logladyphp/logger":446}],448:[function(t,e){"use strict";function i(t){var e,s;Object.freeze(t);for(s in t)e=t[s],t.hasOwnProperty(s)&&null!==e&&"object"==typeof e&&!Object.isFrozen(e)&&i(e)}e.exports=i},{}],449:[function(t,e){"use strict";function i(t,e,i){s.isObject(i)&&o(i),Object.defineProperty(t,e,{value:i,writeable:!1,enumerable:!0,configurable:!1})}var s=t("lodash"),o=t("./deepfreeze");e.exports=i},{"./deepfreeze":448,lodash:"K2RcUv"}],450:[function(t,e){"use strict";function i(t,e){var i,o=this;i=t&&s.has(t,"constructor")?t.constructor:function(){return o.apply(this,arguments)},s.extend(i,o,e);var n=function(){this.constructor=i};return n.prototype=o.prototype,i.prototype=new n,t.defaults&&(s.extend(i.prototype.defaults,t.defaults),delete t.defaults),t&&s.extend(i.prototype,t),i.__super__=o.prototype,i}var s=t("lodash");e.exports=i},{lodash:"K2RcUv"}],451:[function(t,e){"use strict";function i(t,e,i){return!!n.ajax({url:t,type:"POST",data:JSON.stringify(e),contentType:"text/plain",async:i})}function s(t,e,s){var o=window.navigator.sendBeacon(t,JSON.stringify(e));return o||(o=i(t,e,s)),o}var o,n=t("jquery");o=window.navigator&&window.navigator.sendBeacon?s:i,e.exports=o},{jquery:"HlZQrA"}],452:[function(t,e){"use strict";function i(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,i="x"===t?e:3&e|8;return i.toString(16)})}e.exports=i},{}],453:[function(t,e){"use strict";function i(t,e){h.each(e,function(e,i){var s=t[i];t[i]=function(){return e.apply(this,arguments),s.apply(this,arguments)}})}function s(t,e){h.each(e,function(e,i){var s=t[i];t[i]=function(){var t=s.apply(this,arguments);return e.apply(this,arguments),t}})}function o(t,e){h.each(e,function(e,i){var s=t[i];t[i]=function(){var t=h.toArray(arguments);return t.unshift(h.bind(s,this)),e.apply(this,t)}})}function n(t,e){h.each(e,function(e,i){var s=i in t?t[i]:!1;t[i]=function(){var t=h.toArray(arguments),i=s?h.bind(s,this):h.noop;return t.unshift(i),e.apply(this,t)}})}function a(t,e){h.defaults(t,e)}function r(t,e){h.extend(t,e)}function l(){this.mixins=h.filter(arguments,function(t){return t instanceof l}),this.properties=arguments[this.mixins.length]||{}}var h=t("lodash");l.prototype.mixins=null,l.prototype.properties=null,l.prototype.applyTo=function(t){var e=this.properties;a(t,e.defaults),r(t,e.extend),h.extend(t,h.omit(e,"before","after","around","onto","defaults","extend","applyTo")),h.invoke(this.mixins,"applyTo",t),i(t,e.before),s(t,e.after),o(t,e.around),n(t,e.onto),h.isFunction(e.applyTo)&&e.applyTo.apply(this,arguments)},l.before=i,l.after=s,l.around=o,l.onto=n,e.exports=l},{lodash:"K2RcUv"}],454:[function(t,e){"use strict";{var i=t("prima/lib/translate"),s=t("./subview");t("prima/lib/logger")}e.exports={__:i,_subview:s}},{"./subview":455,"prima/lib/logger":436,"prima/lib/translate":456}],455:[function(t,e){"use strict";e.exports=function(t){return'<noscript data-subview="'+t+'"></noscript>'}},{}],456:[function(t,e){"use strict";function i(t){n.addEntries(s.isObject(t)?t:{})}var s=t("lodash"),o=t("./dictionary"),n=new o({name:"Translations"}),a=s.bind(n.get,n);a.setup=s.once(i),e.exports=a},{"./dictionary":432,lodash:"K2RcUv"}],457:[function(t,e){"use strict";var i=t("jquery"),s={isBlank:function(t){return""===i.trim(t)},minLength:function(t,e){return t.length>=e},maxLength:function(t,e){return t.length<=e},range:function(t,e,i){return t.length>=e&&t.length<=i},pattern:function(t,e){return new RegExp(e,"gi").test(t)?!0:!1},isEmail:function(t){return this.pattern(t,"^[a-zA-Z0-9._+-]+@[a-zA-Z0-9][a-zA-Z0-9.-]*[.]{1}[a-zA-Z]{2,20}$")},equals:function(t,e){return t===e}};e.exports=s},{jquery:"HlZQrA"}],458:[function(t,e){"use strict";var i=t("lodash"),s=t("backbone"),o=t("../../lib/mixin"),n=t("./simple"),a=new o(i.extend({},n.props,{defaults:i.extend({},s.Events),before:{initialize:function(){var t=i.defaults({},i.result(this,"defaults"));this.attributes={},this.set(t),this.changed={}}}}));e.exports=a},{"../../lib/mixin":453,"./simple":459,backbone:"5kFNoY",lodash:"K2RcUv"}],459:[function(t,e){"use strict";var i=t("lodash"),s=t("backbone"),o=t("../../lib/mixin"),n=s.Model.prototype,a={get:n.get,has:n.has,set:n.set,unset:n.unset,clear:n.clear,hasChanged:n.hasChanged,changedAttributes:n.changedAttributes,previous:n.previous,toJSON:n.toJSON,toggle:function(t){this.set(t,!this.get(t))},_validate:i.constant(!0)},r=new o(i.extend({},a,{defaults:i.extend({},s.Events)}));e.exports={props:a,mixin:r}},{"../../lib/mixin":453,backbone:"5kFNoY",lodash:"K2RcUv"}],460:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/lib/mixin"),o=new s({delegateObject:function(t){var e={},o={};t&&(i.each(t,function(t,i){"undefined"!=typeof t&&("function"==typeof t?e[i]=t:o[i]=t)},this),s.onto(this,e),i.extend(this,o))}});e.exports=o},{lodash:"K2RcUv","prima/lib/mixin":453}],461:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/lib/mixin"),o=new s({loggingData:function(t){var e={};return!i.isEmpty(this.model)&&i.isFunction(this.model.toJSON)&&(e.modelData=this.model.toJSON()),i.isObject(t)&&(e=i.extend(e,t)),e}});e.exports=o},{lodash:"K2RcUv","prima/lib/mixin":453}],462:[function(t,e){"use strict";var i=t("prima/lib/mixin"),s=t("prima/events"),o=t("lodash"),n=t("./registry"),a=new i({__bindKeycommands:function(){o.result(this,"keycommands")&&(o.each(o.result(this,"keycommands"),this.__bindKey,this),n.add({id:this.__keyId,keys:o.keys(o.result(this,"keycommands"))}))},__bindKey:function(t,e){this.listenTo(s,"DOMEventor:"+e,this.__keyFn)},__keyFn:function(t,e){!this.__keysDisabled&&n.shouldRun(e,this.__keyId)&&this[this.keycommands[e]].apply(this,arguments)},focusKeys:function(){n.focus(this.__keyId)},unfocusKeys:function(){n.unfocus(this.__keyId)},soloKeys:function(){n.solo(this.__keyId)},unSoloKeys:function(){n.unSolo(this.__keyId)},disableKeys:function(){this.__keysDisabled=!0},enableKeys:function(){this.__keysDisabled=!1},before:{initialize:function(){this.keycommands||(this.keycommands={}),this.__keysDisabled=!1,this.__keyId=o.uniqueId("keycomms"),this.__bindKeycommands()},stopListening:function(){n.remove(this.__keyId)}}});e.exports=a},{"./registry":463,lodash:"K2RcUv","prima/events":429,"prima/lib/mixin":453}],463:[function(t,e){"use strict";var i=t("prima/class"),s=t("lodash"),o=i.extend({soloId:null,constructor:function(){this.keySets=[]},add:function(t){this.keySets.unshift(t)},remove:function(t){var e=this.getSetForId(t);e&&(this.unSolo(t),this.keySets=s.without(this.keySets,e))},focus:function(t){var e=this.getSetForId(t);e&&(this.keySets=s.without(this.keySets,e),this.keySets.unshift(e))},unfocus:function(t){var e=this.getSetForId(t);e&&(this.keySets=s.without(this.keySets,e),this.keySets.push(e))},solo:function(t){var e=this.getSetForId(t);e&&(this.soloId=t)},unSolo:function(t){this.soloId===t&&(this.soloId=null)},getSetForId:function(t){return this.keySets[s.findIndex(this.keySets,{id:t})]},getSetsWithKey:function(t){return s.where(this.keySets,{keys:[t]})},shouldRun:function(t,e){var i=this.getSetsWithKey(t);return this.soloId===e?!0:i.length>1?i[0].id===e:!0}});e.exports=new o},{lodash:"K2RcUv","prima/class":426}],464:[function(t,e){"use strict";var i=t("prima/lib/mixin"),s=t("prima/lib/flags"),o=new i({isLoggedIn:function(){return s.bool("is_logged_in")},redirect:function(t){return function(e){e.preventDefault(),window.location.href=t}},redirectLink:function(t){return t||(t="/register"),function(e){var i=e.currentTarget.attributes.href,s=t+"?redirect_to=";s+=encodeURIComponent(i?i.value:window.location.href),e.preventDefault(),window.location.href=s}}});e.exports=o},{"prima/lib/flags":"f/LVtH","prima/lib/mixin":453}],465:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("../lib/mixin"),n=t("prima/events"),a=t("prima/mixins/subviewable"),r=!1,l=i("body"),h=i(window),d=t("prima/lib/clickoutside"),c=function(t){return s.noop},u=new o(a,{removeAutoTeardown:function(){this._popoverBase.clickOutside&&(this._popoverBase.clickOutside.remove(),this._popoverBase.clickOutside=null)},setupAutoTeardown:function(){this._rendered&&(this.removeAutoTeardown(),this._popoverBase.autoTeardown&&(this._popoverBase.clickOutside=new d(this.el,this.options),this._popoverBase.clickOutside.on("click:outside",this.onClickOutside,this)))},onClickOutside:function(){this._popoverBase.shouldTeardown?(this._popoverBase.lastAutoTeardown=s.now(),this.teardown()):this._popoverBase.shouldTeardown=!0},reposition:function(){if(!this.$pinned.closest("body").length)return void this.$el.css("visibility","hidden");var t=this.pinnedRect(),e={scrollTop:this.isContainerBody?0:this.$container.scrollTop(),scrollLeft:this.isContainerBody?0:this.$container.scrollLeft(),realTop:this.isContainerBody?0:this.$container.offset().top,realLeft:this.isContainerBody?0:this.$container.offset().left},i=this._popoverBase.shift,o=this._popoverBase.pinnedSide,n={visibility:"visible"},a={},r=this.$el.width(),l=null,h=null,d=null,c=null;this.debug("reposition: pinnedSide=%s, shift=%O, pinnedRect=%O",o,i,t),this._popoverBase.isFixedPosition&&(n.position="fixed"),"top"===o||"bottom"===o?(s.extend(n,{left:t.left+Math.floor(t.width/2)+i.x}),a={top:t.top+e.scrollTop-i.y,bottom:t.top+e.scrollTop+t.height+i.y,left:t.left+e.scrollLeft-i.x,right:t.left+e.scrollLeft+t.width+i.x},a.center=(a.right-a.left)/2,l=e.realTop+a.top-this.$el.height(),h=e.realTop+a.bottom+this.$el.height(),"top"===o&&this._crossesViewportEdge("top",l)&&!this._crossesViewportEdge("bottom",h)&&(o="bottom"),"bottom"===o&&this._crossesViewportEdge("bottom",h)&&!this._crossesViewportEdge("top",l)&&(o="top"),"bottom"===o?s.extend(n,{top:a.bottom,transform:"translateX(-50%)"}):"top"===o&&s.extend(n,{top:a.top,transform:"translateX(-50%) translateY(-100%)"}),d=e.realLeft+(a.center+a.left)-r/2,c=e.realLeft+(a.center+a.left)+r/2,this._crossesViewportEdge("left",d)&&!this._crossesViewportEdge("right",c)&&s.extend(n,{left:this._popoverBase.minDistanceFromContainer+"px",transform:"top"===o?"translateX(0) translateY(-100%)":"translateX(0)"}),!this._crossesViewportEdge("left",d)&&this._crossesViewportEdge("right",c)&&s.extend(n,{left:"auto",right:this._popoverBase.minDistanceFromContainer+"px",transform:"top"===o?"translateX(0) translateY(-100%)":"translateX(0)"})):"left"===o||"right"===o?(s.extend(n,{top:t.top-i.y}),a={left:t.left+e.scrollLeft-i.x,right:t.left+e.scrollLeft+t.width+i.x},d=e.realLeft+a.left-this.$el.width(),c=e.realLeft+a.right+this.$el.width(),"left"===o&&this._crossesViewportEdge("left",d)&&!this._crossesViewportEdge("right",c)&&(o="right"),"right"===o&&this._crossesViewportEdge("right",c)&&!this._crossesViewportEdge("left",d)&&(o="left"),"left"===o?s.extend(n,{left:a.left,transform:"translateX(-100%) translateY(-50%)"}):"right"===o&&s.extend(n,{left:a.right,transform:"translateY(-50%)"})):s.extend(n,{top:t.top-i.y,left:t.left+i.x,transform:""}),s.extend(n,{transform:n.transform}),this.$el.css(n),this.debug("reposition: ad-hoc css %O",n),this.$el.removeClass("top bottom left right").addClass(o)},_crossesViewportEdge:function(t,e){var s=i(window),o={top:s.scrollTop(),left:s.scrollLeft(),right:s.scrollLeft()+s.width(),bottom:s.scrollTop()+s.height()};return this.debug("viewportCheck against %s side (%s) coordinate=[%s]",t,o[t],e),"top"===t?o.top>e:"bottom"===t?o.bottom<e:"left"===t?o.left>e:"right"===t?o.right<e:void 0},isRendered:function(){return this._rendered},isOrWasRecentlyRendered:function(){var t=this._popoverBase.lastAutoTeardown,e=s.now()-t;return 100>e||this._rendered},setPinnedSide:function(t){return this._popoverBase.pinnedSide=t,this},setPinnedTarget:function(t){return this.$pinned=i(t).addClass("pinned-target"),this.debug("setPinnedTarget: %O",this.$pinned),this},setPopoverContainer:function(t){return this.$container=i(t),this.isContainerBody=this.$container.is(l),this.debug("setPopoverContainer: %O, isContainerBody=%s",this.$container,this.isContainerBody),this},setShift:function(t){if(!s.isObject(t)||!s.isNumber(t.x)||!s.isNumber(t.y))throw new Error("Popover shift needs to be: {Object} => x: {Number}, y: {Number}");return this._popoverBase.shift.x=t.x,this._popoverBase.shift.y=t.y,this},getShift:function(){return this._popoverBase.shift},_initializeDebugger:function(){this.debug=r?c(this):s.noop},defaults:{pinnedRect:function(){var t,e,i=this.$container.offset();t=this.$pinned.offset(),e=t,this._popoverBase.isFixedPosition&&(t.top-=this.isContainerBody?h.scrollTop():this.$container.scrollTop());var s={};return s.height=this.$pinned.outerHeight(),s.width=this.$pinned.outerWidth(),s.top=Math.round(t.top-i.top),s.left=Math.round(e.left-i.left),s.bottom=Math.round(s.top+s.height),s.right=Math.round(s.left+s.width),this.debug("pinnedRect calculation: container %O, pinned %O, containerOffset %O, pinnedOffset %O",this.$container,this.$pinned,i,e),this.debug("pinnedRect results: height(pinnedOuterHeight)=%s, width(pinnedOuterWidth)=%s, top(pTop-cTop)=%s, left=(pLeft-cLeft)=%s, bottom(top+height)=%s, right(left+width)=%s",s.height,s.width,s.top,s.left,s.bottom,s.right),s
}},after:{initialize:function(t){var e={identifier:"popover",pinnedSide:"bottom",className:"popover--base",autoTeardown:!0,teardownOnEscape:!0,minDistanceFromContainer:10,shift:{x:0,y:0},clickOutside:null,lastAutoTeardown:0,shouldTeardown:!0,isFixedPosition:!1};this._popoverBase=s.defaults(s.pick(t||{},s.keys(e)),e),this._initializeDebugger(),this.setPinnedTarget(t.pinnedTarget||null),this.setPopoverContainer(t.popoverContainer||l)},render:function(){this.$el.addClass(this._popoverBase.className),this.$el.appendTo(this.$container);var t=this.$el.children().first(),e=t.width();t.width(e-e%2),this._popoverBase.autoTeardown&&this.setupAutoTeardown(),this.reposition(),this.isContainerBody&&(this.debug("DOMEventor subscribe: flatresize + flatscroll reposition active"),this.listenTo(n,"DOMEventor:flatresize",this.reposition),this._popoverBase.isFixedPosition||this.listenTo(n,"DOMEventor:flatscroll",this.reposition)),this._popoverBase.teardownOnEscape&&this.listenTo(n,"DOMEventor:keyup:escape",this.teardown),this.trigger("open",this),n.trigger(this._popoverBase.identifier+":open",this)},teardown:function(){this.$pinned.removeClass("pinned-target"),this._popoverBase.teardownOnEscape&&this.stopListening(n,"DOMEventor:keyup:escape"),this.$el.off("mousewheel DOMMouseScroll"),this.removeAutoTeardown(),this.trigger("close",this),n.trigger(this._popoverBase.identifier+":close",this)}}});e.exports=u},{"../lib/mixin":453,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/lib/clickoutside":430,"prima/mixins/subviewable":468}],466:[function(t,e){"use strict";var i=t("lodash"),s=t("when"),o=t("../lib/mixin"),n=new o({defaults:{whenEvent:function(t,e){return 1===arguments.length&&(e=t,t=this),s.promise(i.bind(function(i){this.listenToOnce(t,e,function(){i.call(void 0,arguments)})},this))}}});e.exports=n},{"../lib/mixin":453,lodash:"K2RcUv",when:"RG2dij"}],467:[function(t,e){"use strict";function i(t){return s.trim(t)}var s=t("lodash"),o=t("../lib/mixin"),n=function(t,e){return t=i(t),e&&s.isFunction(this.$$)&&delete this.$$.cache[t],t},a=function(t){return this.$$?(t=i(t),this.$(t)):void 0},r=function(t){this.$$&&(t=i(t),delete this.$$.cache[t])},l=function(t){return this.$$?(t=i(t),delete this.$$.cache[t],this.$(t)):void 0},h=function(){this.$$&&(s.forEach(this.$$.cache,function(t,e,i){delete i[e]}),this.$$.cache={})},d=function(t){return"[data-js-"+t+"]"},c=function(t){return function(){var t=s.memoize(s.bind(a,this),s.bind(n,this));t.update=s.bind(l,this),t.remove=s.bind(r,this),t.empty=s.bind(h,this);var e=function(e,i){return t(d(e),i)};return e.update=function(e){t.update(d(e))},e.remove=function(e){t.remove(d(e))},this.$$=t,this.js$=e,this.$$initialize=s.noop,t}.call(t)},u=new o({defaults:{$$cacheKeys:{},$$cacheSelectors:function(t){return"undefined"==typeof t&&(t=this.$$cacheKeys),s.forEach(t,function(t){this.$$.update(t)},this),this},$$initialize:function(){return c(this)},$$:function(){return c(this).apply(this,arguments)}},before:{initialize:function(){this.$$initialize()},render:function(){this.$$.empty()}},after:{setElement:function(){s.isFunction(this.$$.empty)&&this.$$.empty()},remove:function(){s.isFunction(this.$$.empty)&&this.$$.empty()},render:function(){s.isFunction(this.$$cacheSelectors)&&this.$$cacheSelectors()}}});e.exports=u},{"../lib/mixin":453,lodash:"K2RcUv"}],468:[function(t,e){"use strict";var i=t("lodash"),s=t("../lib/mixin"),o=new s({defaults:{teardown:function(){return this},beforeTeardown:function(){},afterTeardown:function(){return this.teardownSubViews()},render:function(){return this},beforeRender:function(){},afterRender:function(){return this.renderSubViews()},attachSubView:function(t,e){if(1===arguments.length)if("string"==typeof t){if(e=t,t=this.subViews[e],!t)return this}else e=t.$el.data("subview")||"";var i=this.$('[data-subview="'+e+'"]');return i.length>1&&(i=i.first()),t&&i.length&&(i.replaceWith(t.$el),t.$el.attr("data-subview",e)),this},attachSubViews:function(){return i.forEach(this.subViews,this.attachSubView,this),this},teardownSubViews:function(){return i.forEach(this.subViews,function(t,e){t&&i.isFunction(t.teardown)&&t.teardown(),this.subViews[e]=null},this),this.subViews={},this},renderSubViews:function(){return i.forEach(this.subViews,function(t){t&&i.isFunction(t.render)&&t.render()},this),this},isInitialized:function(){return this._initialized},isRendered:function(){return this._rendered},isRendering:function(){return this._rendering},isRemoved:function(){return this._removed}},around:{initialize:function(t){this._initialized=!1,this._rendering=!1,this._rendered=!1,this._removed=!1,this.subViews={};var e=t.apply(this,i.rest(arguments));return this._initialized=!0,e},teardown:function(t){var e=i.rest(arguments);i.isFunction(this.beforeTeardown)&&this.beforeTeardown.apply(this,e);var s=t.apply(this,e);return i.isFunction(this.afterTeardown)&&this.afterTeardown.apply(this,e),this._rendered=!1,s},render:function(t){var e=i.rest(arguments);this._rendering=!0,i.isFunction(this.beforeRender)&&this.beforeRender.apply(this,e);var s=t.apply(this,e);return i.isFunction(this.afterRender)&&this.afterRender.apply(this,e),this._rendering=!1,this._rendered=!0,s}},after:{remove:function(){this._removed=!0,this.subViews=null}}});e.exports=o},{"../lib/mixin":453,lodash:"K2RcUv"}],469:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/lib/mixin"),n=t("prima/events"),a=new o({defaults:{$tabLimiterEl:i(),_tabLimiterAutoFocus:!1,_tabLimiterItems:[],_tabLimiterSelector:["input","select","textarea","button","object","a","div"],_tabLimiterCurrentIndex:-1,_tabLimiterEnterKey:!0},__tabLimiterTabKeydown:function(t){return t.preventDefault(),t.stopPropagation(),t.shiftKey&&-1===this._tabLimiterCurrentIndex&&(this._tabLimiterCurrentIndex=0),this._tabLimiterCurrentIndex=(this._tabLimiterCurrentIndex+(t.shiftKey?-1:1)+this._tabLimiterItems.length)%this._tabLimiterItems.length,this._focusTabbableItem(),!1},__tabLimiterItemKeydown:function(t){t=t||window.event;var e=t.which||t.keyCode;if(13===e){t.preventDefault(),t.stopPropagation();var s=i(t.target),o=s.find("input");return o.length?o.trigger("click"):s.trigger("click"),!1}},__tabbableItemFocus:function(t){var e=s.indexOf(this._tabLimiterItems,t.target);this._tabLimiterCurrentIndex=e>=0?e:this._tabLimiterCurrentIndex},_focusTabbableItem:function(){if(this.$tabLimiterEl&&this.$tabLimiterEl.length){var t=i(this._tabLimiterItems[this._tabLimiterCurrentIndex]);t.length&&t.focus()}},isTabbable:function(t){var e=i(t),s=t.nodeName.toLowerCase(),o=e.attr("tabindex"),n=!1;return n=/input|select|textarea|button|object/.test(s)?!t.disabled&&!e.is(":hidden"):(t.href||!isNaN(o))&&!e.is(":hidden"),(isNaN(o)||o>=0)&&n},updateTabbableItems:function(){this.$tabLimiterEl&&this.$tabLimiterEl.length&&(this._tabLimiterItems=s.filter(this.$tabLimiterEl.find(this._tabLimiterSelector.join(",")),s.bind(function(t){return this.isTabbable(t)},this)),this._tabLimiterItems.length&&(this._tabLimiterItems=s.sortBy(this._tabLimiterItems,function(t){return t.tabIndex})))},catchTabs:function(t){if(this.releaseTabs(),this.$tabLimiterEl=t?i(t):this.$tabLimiterEl,this.$tabLimiterEl&&this.$tabLimiterEl.length){this.updateTabbableItems(),this._tabLimiterAutoFocus&&this._focusTabbableItem();var e=this._tabLimiterSelector.join(",");this.listenTo(n,"DOMEventor:keydown:tab",this.__tabLimiterTabKeydown),this.listenTo(n,"DOMEventor:keydown:shift+tab",this.__tabLimiterTabKeydown),this.$tabLimiterEl.on("focus.tablimiter",e,s.bind(this.__tabbableItemFocus,this)),this._tabLimiterEnterKey&&this.$tabLimiterEl.on("keydown.tablimiter",e,s.bind(this.__tabLimiterItemKeydown,this))}},releaseTabs:function(){this.$tabLimiterEl&&this.$tabLimiterEl.length&&(this._tabLimiterItems=[],this._tabLimiterCurrentIndex=-1,this.stopListening(n,"DOMEventor:keydown:tab",this.__tabLimiterTabKeydown),this.stopListening(n,"DOMEventor:keydown:shift+tab",this.__tabLimiterTabKeydown),this.$tabLimiterEl.off(".tablimiter"))}});e.exports=a},{jquery:"HlZQrA",lodash:"K2RcUv","prima/events":429,"prima/lib/mixin":453}],470:[function(t,e){"use strict";var i=t("../lib/mixin"),s=new i({before:{sync:function(t,e,i){i.with_form_key=!0}}});e.exports=s},{"../lib/mixin":453}],471:[function(t,e){"use strict";var i=t("backbone"),s=t("./mixins/withformkeytrue"),o=t("./lib/extendwithmixins"),n=i.Model.extend({});s.applyTo(n.prototype),o.applyTo(n),e.exports=n},{"./lib/extendwithmixins":435,"./mixins/withformkeytrue":470,backbone:"5kFNoY"}],472:[function(t,e){"use strict";var i=t("backbone"),s=t("prima/bootloader"),o=(t("prima/lib/logger"),t("logs/logging-manager")),n=i.Router.extend({root:"/",logs:function(){return[]},constructor:function(){o.startLogs(this.logs()),i.Router.apply(this,arguments)},getName:function(){return"Prima/Router"}},{Bootloader:s,bootloader:function(t){return new this.Bootloader(t)}});e.exports=n},{backbone:"5kFNoY","logs/logging-manager":424,"prima/bootloader":425,"prima/lib/logger":436}],473:[function(t,e){"use strict";function i(t,e){function i(t,e){var i,o;if(!s.isObject(t))throw new Error("SingletonModel requires attributes");if(i=t[u],s.isEmpty(i)&&!s.isNumber(i))throw new Error('SingletonModel attributes require a "'+u+'"');if(o=d[i],c[i]++||(c[i]=1),o)s.keys(t).length>=2&&o.set(t,e),o.collection!==!0&&(o.collection=!0);else{d[i]=this;try{Object.defineProperty(this,"collection",{value:!0,configurable:!1,enumerable:!0,writable:!1})}finally{this.collection||(this.collection=!0)}this.constructor.__super__.constructor.call(this,t,e),h.add(this)}return o||this}function a(){return this.id}function r(){return h}function l(){0===--c[this.id]&&(delete d[this.id],delete c[this.id],h.remove(this))}t||(t={}),e||(e={});var h=new o.Collection,d=Object.create(null),c=Object.create(null),u=t.idAttribute||n.prototype.idAttribute;return t.constructor=i,t.release=l,t.toString=a,t.toJSON=t.toJSON||n.prototype.toJSON,e.getCollection=r,n.extend(t,e)}var s=t("lodash"),o=t("backbone"),n=t("./model");e.exports.extend=i},{"./model":471,backbone:"5kFNoY",lodash:"K2RcUv"}],474:[function(t,e){"use strict";function i(){var t,e,i={animation:null,transition:null},s=document.createElement("div"),o={animation:"animationend",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(e in o)if(void 0!==s.style[e]){i.animation=o[e];break}var n={transition:"transitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in n)if(void 0!==s.style[t]){i.transition=n[t];break}return i}function s(t,e){a.animation?n(t).one(a.animation,function(t){e(t)}):setTimeout(function(t){e(t)},0)}function o(t,e){a.transition?n(t).one(a.transition,function(t){e(t)}):setTimeout(function(t){e(t)},0)}var n=t("jquery"),a=i();e.exports={animation:s,transition:o}},{jquery:"HlZQrA"}],475:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/class"),o={requestFullscreen:["requestFullScreen"]},n=s.extend({vendors:["moz","webkit","ms","o","khtml"],el:document.body||document.documentElement,get:i.memoize(function(t){var e=this._getProp(t);return!e&&o[t]&&i.each(o[t],function(t){var i=this._getProp(t);i&&(e=i)},this),e}),prop:function(t){return!!this.get(t)},_getProp:function(t){var e=!1;return"string"==typeof this.el[t]?t:"string"==typeof this._styles()[t]?t:(t=t.charAt(0).toUpperCase()+t.substr(1),i.forEach(this.vendors,function(i){"undefined"!=typeof this.el[i+t]&&(e=i+t),"undefined"!=typeof this._styles()[i+t]&&(e=i+t)},this),e)},_styles:i.memoize(function(){return this.el.style})});e.exports=new n},{lodash:"K2RcUv","prima/class":426}],476:[function(t,e){"use strict";function i(t,e){if(t in s)return s[t];var i=window[t];if(!e||!e(i)){var o=document.createElement("iframe");document.body.appendChild(o),i=o.contentWindow[t],document.body.removeChild(o)}return s[t]=i,i}var s={};e.exports=i},{}],477:[function(t,e){"use strict";function i(t,e,i){return"#"+((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1)}function s(t){t=String(t).replace(/[^0-9a-f]/gi,""),t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]);var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function o(t,e,i){var s=Math.min(Math.min(t,e),i),o=Math.max(Math.max(t,e),i),n=o-s,a={h:6,s:o?(o-s)/o:0,v:o/255};return n?a.h+=o===t?(e-i)/n:o===e?2+(i-t)/n:4+(t-e)/n:a.h=0,a.h=60*a.h%360,a}function n(t,e,i){var s,o,n;if(e){s=o=n=0;var a=(t+360)%360/60,r=i*e,l=i-r,h=r*(1-Math.abs(a%2-1));1>a?(s=r,o=h):2>a?(s=h,o=r):3>a?(o=r,n=h):4>a?(o=h,n=r):5>a?(n=r,s=h):(n=h,s=r),s+=l,o+=l,n+=l}else s=o=n=i;return{r:Math.round(255*s),g:Math.round(255*o),b:Math.round(255*n)}}function a(t){t=String(t).replace(/[^0-9a-f]/gi,""),t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]);var e=s(t),i=o(e.r,e.g,e.b);return i}function r(t,e,s){var o=n(t,e,s),a=i(o.r,o.g,o.b);return a}function l(t,e){t=String(t).replace(/[^0-9a-f]/gi,""),t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),e=e||0;var i,s,o,n=parseInt(t,16),a=0>e?0:255,r=0>e?-e:e,l=n>>16,h=n>>8&255,d=255&n;return i=Math.round((a-l)*r)+l,s=Math.round((a-h)*r)+h,o=Math.round((a-d)*r)+d,"#"+(16777216+65536*i+256*s+o).toString(16).slice(1)}function h(t){return"string"==typeof t&&(t=a(t)),t.s<.2&&t.v>.8?"#444":"#FFF"}function d(t,e,i){var s={upperBound:.8,lowerBound:.2,diffBound:.1,hueBound:15};c.extend(s,i);var o=s.upperBound,n=s.lowerBound,a=s.diffBound,r=s.hueBound,l=Math.abs(t.h-e.h),h=Math.abs(t.s-e.s),d=Math.abs(t.v-e.v);return a>=l&&a>=h&&a>=d?!0:a>=h&&a>=d&&(h>=o||n>=h&&d>=o||n>=d&&r>=l)?!0:!1}var c=t("lodash");e.exports={rgbToHex:i,hexToRgb:s,rgbToHsv:o,hsvToRgb:n,hexToHsv:a,hsvToHex:r,brighten:l,readable:h,compare:d}},{lodash:"K2RcUv"}],478:[function(t,e){"use strict";function i(t){return new RegExp(t+"=([^;]+)").test(decodeURIComponent(document.cookie))}function s(t){return new RegExp(t+"=([^;]+)").test(decodeURIComponent(document.cookie))?RegExp.$1:null}function o(t,e,i,s){"object"==typeof e&&(e=JSON.stringify(e));var o=encodeURIComponent(t)+"="+encodeURIComponent(e);if(l.isPlainObject(i)&&(s=i,i=s?s.expires:!1),s=l.extend({expires:i},c,s),s.expires instanceof Date)o+=";expires="+s.expires.toGMTString();else if("number"==typeof s.expires){var n=new Date;n.setTime(n.getTime()+1e3*s.expires),o+=";expires="+n.toGMTString()}s.path&&(o+=";path="+encodeURI(s.path)),s.secure&&(o+=";secure"),s.domain&&(o+=";domain="+encodeURI(s.domain)),document.cookie=o}function n(t){o(t,"",-1)}function a(t,e){var i=s(t);try{i=JSON.parse(i)}catch(o){return i}return e?d(i,e):i}function r(t,e,i,s){var n;l.isPlainObject(e)?(s=i,n=e):(n=a(t)||{},l.isPlainObject(n)||(n={}),h(n,e,i)),o(t,JSON.stringify(n),s)}var l=t("lodash"),h=t("./setpath"),d=t("./getpath"),c={path:"/",secure:!1,domain:""},u={has:i,get:s,set:o,unset:n,getHash:a,setHash:r};e.exports=u},{"./getpath":484,"./setpath":493,lodash:"K2RcUv"}],479:[function(t,e){"use strict";function i(t,e,i){return function(){i||(i=this);var s=arguments;return setTimeout(function(){t.apply(i,s)},e)}}e.exports=i},{}],480:[function(t,e){"use strict";function i(t){var e=document.implementation.createHTMLDocument("");return e.body.innerHTML=t,e.body}function s(t){var e=document.implementation.createHTMLDocument("");return e.body.appendChild(t.cloneNode(!0)),e.body}function o(t){return s(t).innerHTML}e.exports={nodeFromString:i,wrapNode:s,outerHTML:o}},{}],481:[function(t,e){"use strict";function i(t){return t&&t.nodeType&&1===t.nodeType}var s=t("lodash");e.exports=function(t,e){if(i(t))return t;if(s.isString(t)){var o=(e||document).querySelector(t);if(i(o))return o}return t&&t.jquery?t.get(0):!1}},{lodash:"K2RcUv"}],482:[function(t,e){"use strict";function i(t,e){e=e||"Exposer";var i=window;s.each(t,function(t,s){if(n(i,s))throw new Error('"'+s+'" already exists');o.log(e,"%s.%s",i,s),a(i,s,t)})}var s=t("lodash"),o=t("../lib/logger"),n=t("./haspath"),a=t("./setpath");e.exports=i},{"../lib/logger":436,"./haspath":485,"./setpath":493,lodash:"K2RcUv"}],483:[function(t,e){"use strict";function i(t){return s.last((t||"").split("."))}var s=t("lodash");e.exports={getExtension:i}},{lodash:"K2RcUv"}],484:[function(t,e){"use strict";function i(t,e){"string"==typeof t&&(e=t,t=window),e=e.split(".");for(var i;;){if(i=e.shift(),!(i in t))return;if(0===e.length)return t[i];t=t[i]}}e.exports=i},{}],485:[function(t,e){"use strict";function i(t,e){"string"==typeof t&&(e=t,t=window),e=e.split(".");for(var i;;){if(i=e.shift(),!(i in t))return!1;if(0===e.length)return!0;t=t[i]}}e.exports=i},{}],486:[function(t,e){"use strict";var i=t("jquery"),s=function(t,e,i){if(0===i)return 0;var s=null==i?e:e/i;return 2===arguments.length?Math.round(t*s):void 0},o=function(t,e,i){if(0===i)return 0;var s=null==i?e:e/i;return Math.round(t/s)},n=function(t,e,i,n){var a=t,r=e,l=t/e,h=i/n;return(t>i||e>n)&&(l>h?(a=i,r=o(a,l)):(r=n,a=s(r,l))),{width:a,height:r}},a=function(t,e,i,n,a,r){null!=a||(a=.5),null!=r||(r=.5);var l=0,h=0,d=t,c=e,u=t/e,p=i/n;return u>p?(d=s(e,p),l=Math.round(a*(t-d))):p>u&&(c=o(t,p),l=Math.round(r*(e-c))),{left:l,top:h,width:d,height:c}},r=function(t){var e;t instanceof i?(e=t,t=e.get(0)):e=i(t);var s=document.createElement("canvas");return s.width=t.width||e.width(),s.height=t.height||e.height(),s},l=function(t,e,s){var o;t instanceof i?(o=t,t=o.get(0)):o=i(t),e?e instanceof i&&(e=e.get(0)):e=r(t);var n=e.width,a=e.height,l=e.getContext("2d");return l.save(),s&&(l.translate(e.width,0),l.scale(-1,1)),l.drawImage(t,0,0,n,a),l.restore(),e},h=function(t,e,s,n,a,r){var l;t instanceof i?(l=t,t=l.get(0)):l=i(t);var h=90===n||270===n;h?r&&s>r&&(e=o(r,s,e),s=r):r&&e>r&&(s=o(r,e,s),e=r);var d=document.createElement("canvas");h?(d.width=s,d.height=e):(d.width=e,d.height=s);var c=d.getContext("2d");return c.save(),c.translate(.5*d.width,.5*d.height),c.rotate(n*Math.PI/180),a&&c.scale(-1,1),c.drawImage(t,-.5*e,-.5*s,e,s),c.restore(),d},d={widthForHeight:s,heightForWidth:o,maxSize:n,cropBox:a,createCanvasForEl:r,drawElToCanvas:l,drawScaledAndRotated:h};e.exports=d},{jquery:"HlZQrA"}],487:[function(t,e){"use strict";var i=t("lodash"),s=t("when"),o=t("prima/class"),n="FileReader"in window&&"readAsDataURL"in FileReader.prototype,a=(window.URL||window.webkitURL||window.mozURL||window.msURL||{}).createObjectURL,r=[],l=t("app/vendor/jpegmeta").JpegFile,h=o.extend({constructor:function(t){null!=t&&this.read(t)},read:function(t,e){if(!i.isUndefined(e)||(e=!0),this.file=t,!t)return s.reject("No file to read");if(!n)return s.reject("FileReader is not supported");t.type.match(/image\/(jpg|jpeg)/i)||(e=!1);var o;return o=e&&"readAsBinaryString"in FileReader.prototype?this.readBinaryString(t).then(i.bind(function(e){try{var s=new l(e.binary,t.name);e.rotation=function(t){switch(t){case 1:return 0;case 2:return 0;case 3:return 180;case 4:return 180;case 5:return 270;case 6:return 90;case 7:return 90;case 8:return 270;default:return 0}}(s.tiff.Orientation.value),e.mirrored=function(t){switch(t){case 2:return!0;case 4:return!0;case 5:return!0;case 7:return!0;default:return!1}}(s.tiff.Orientation.value)}catch(o){}return this.readDataUrl(t).then(i.bind(function(t){return i.extend(e,t)},this))},this)):this.readDataUrl(t),this.promise=o,o},readDataUrl:function(t){var e=new FileReader;return"readAsDataURL"in e?s.promise(function(i,s){e.onload=function(t){var s=t.target.result;i(s),e.onload=null,e.onerror=null},e.onerror=function(){s(),e.onload=null,e.onerror=null},e.readAsDataURL(t)}).then(i.bind(this._onLoadDataUrl,this),i.bind(this._onError,this)):s.reject("FileReader.readAsDataURL is not supported")},_onLoadDataUrl:function(t){var e={base64:t,file:this.file};return a&&(e.objectUrl=a(this.file),r.push(e.objectUrl)),s.resolve(e)},readBinaryString:function(t){var e=new FileReader;return"readAsBinaryString"in e?s.promise(function(i,s){e.onload=function(t){var s=t.target.result;i(s),e.onload=null,e.onerror=null},e.onerror=function(){s(),e.onload=null,e.onerror=null},e.readAsBinaryString(t)}).then(i.bind(this._onLoadBinaryString,this),i.bind(this._onError,this)):s.reject("FileReader.readAsBinaryString is not supported")},_onLoadBinaryString:function(t){return s.resolve({binary:t,file:this.file})},_onError:function(t){return s.reject("Failed to read file")}},{read:function(t,e){var i=new h(t,e);return i.promise},canReadFiles:function(){return n}});e.exports=h},{"app/vendor/jpegmeta":305,lodash:"K2RcUv","prima/class":426,when:"RG2dij"}],488:[function(t,e){"use strict";var i=t("lodash"),s=t("when"),o=t("prima/class"),n=o.extend({constructor:function(t){null!=t&&this.load(t)},load:function(t){if(this.src=t,!t)return s.reject("No URL to load");var e=this,o=s.promise(function(i,s){var o=new Image;o.src=t,e._img=o,o.onload=function(){i(o),o.onload=null,o.error=null},o.onerror=function(){s(o),o.onload=null,o.error=null},o.complete&&(o.naturalWidth||o.naturalHeight?"function"==typeof o.onload&&o.onload():"function"==typeof o.onerror&&o.onerror())});return this.promise=o=o.then(i.bind(this._onLoad,this),i.bind(this._onError,this)),o},_onLoad:function(t){return this._img===t?(this.width=t.naturalWidth,this.height=t.naturalHeight,this.src=t.src,this.loaded=!0,s.resolve({width:this.width,height:this.height,src:this.src})):this.promise},_onError:function(t){return this._img===t?(this.width=null,this.height=null,this.src=t.src,this.loaded=!1,s.reject(this.src+" failed to load")):this.promise}},{load:function(t){var e=new n(t);return e.promise}});e.exports=n},{lodash:"K2RcUv","prima/class":426,when:"RG2dij"}],489:[function(t,e){"use strict";function i(t){return/.+[.](jpg|jpeg|png|gif)([?]|$)/.test(t)===!0}function s(t){var e={jpeg:"jpg"},i=n.last((t||"").split("/")).toLowerCase();return n.has(e,i)?e[i]:i}function o(t){var e,o;return n.isString(t)&&(o=t.match(/^data:(image\/.*?);/i),o?e=o[1]:i(t)&&(e=a.getExtension(t))),e?s(e):void 0}var n=t("lodash"),a=t("prima/utils/filename");e.exports={convertToNormalizedType:s,getImageType:o,isImageUrl:i}},{lodash:"K2RcUv","prima/utils/filename":483}],490:[function(t,e){"use strict";var i,s=t("../lib/data"),o=t("./getpath"),n=function(t,e){var i=t&&t.timing&&t.timing.responseStart||Date.now();return function(){return e+(Date.now()-i)}}(window.performance,s.get("Context/time")),a={getRealNow:o("Tumblr.getRealNow"),realStartedAt:o("Tumblr.real_started_at"),startedAt:o("Tumblr.started_at")},r=function(){return i||(i=a.getRealNow?a:{getRealNow:n,realStartedAt:n(),startedAt:(new Date).getTime()}),i};e.exports=r(),e.exports.getElapsed=function(t){return t||(t=this.getRealNow()),t-this.realStartedAt}},{"../lib/data":431,"./getpath":484}],491:[function(t,e){"use strict";var i=function(t,e){return e||(e=this),function(){var i=Array.prototype.slice.call(arguments);return i.unshift(this),t.apply(e,i)}};e.exports=i},{}],492:[function(t,e){"use strict";var i=t("lodash"),s=t("when/sequence"),o=function(t,e){t=i.map(t,function(t){return i.bind(t,this)},e||this);var o=Array.prototype.slice.call(arguments,1);return o[0]=t,s.apply(void 0,o)};e.exports=o},{lodash:"K2RcUv","when/sequence":521}],493:[function(t,e){"use strict";function i(t,e,i){"string"==typeof t&&(i=e,e=t,t=window),e=e.split(".");for(var s,o=e.pop();e.length;)s=e.shift(),t=s in t?t[s]:t[s]={};return t[o]=i}e.exports=i},{}],494:[function(t,e){"use strict";var i=t("lodash"),s={aElement:document.createElement("a"),acceptedProtocols:["http:","https:","tumblr:","mailto:"],parseUrl:function(t){if(!i.startsWith(t,"http"))throw new URIError("Missing protocol in URL to be parsed. Must be http or https");return this.aElement.setAttribute("href",t),{url:t,protocol:this.aElement.protocol,host:this.aElement.hostname,port:this.aElement.port,query:this.aElement.search,hash:this.aElement.hash,path:this.aElement.pathname}},parseTumblelogUrl:function(t){try{-1===t.indexOf("://")&&(t="http://"+t);var e=this.parseUrl(t),s=!1;if(i.endsWith(e.host,"tumblr.com")?s=e.host.match(/([a-zA-Z0-9-_]+)\.tumblr\.com/i):i.endsWith(e.host,"tumblr.net")?s=e.host.match(/([a-zA-Z0-9-_]+)\.[a-zA-Z0-9-_]+\.[a-zA-Z0-9-_]+\.tumblr.net/i):i.endsWith(e.host,"t.dev")&&(s=e.host.match(/([a-zA-Z0-9-_]+)\.t\.dev/i)),s){var o=s[1];if("www"===o)return!1;var n={tumblelog_name:o},a=e.path.match(/post\/([0-9]+)/i);return a&&(n.post_id=a[1]),n}return!1}catch(r){return!1}},isTumblelogUrl:function(t){return this.parseTumblelogUrl(t)===!1?!1:!0},isTumblrMediaUrl:function(t){return t?(-1===t.indexOf("://")&&(t="http://"+t),!!t.match(/^https?:\/\/(\d+\.)media\.tumblr\.com\//i)):!1},hasAllowedProtocol:function(t){this.aElement.setAttribute("href",t);var e=this.aElement.protocol;if(":"===e&&(e=location.protocol),-1===this.acceptedProtocols.indexOf(e))throw new Error("Unsupported protocol detected in URL: "+t);return!0},isAbsoluteUrl:function(t){var e=new RegExp("^(?:[a-z]+:)?//","i");return!!e.test(t||"")},getParameter:function(t){return decodeURIComponent((new RegExp("[?|&]"+t+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null},httpBuildQuery:function(t,e){var i=[];for(var s in t)if(t.hasOwnProperty(s)){var o=e?e+"["+s+"]":s,n=t[s];if(!n)continue;i.push("object"==typeof n?this.httpBuildQuery(n,o):encodeURIComponent(o)+"="+encodeURIComponent(n))}return i.join("&")},buildUrl:function(t,e){return t+"?"+this.httpBuildQuery(e)},getQueryStringHash:function(t){var e={};return t.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function(t,i,s,o){e[i]=o}),e},isProtocolRelative:function(t){var e=new RegExp("^//[^/]","i");return e.test(t||"")},addProtocolIfMissing:function(t,e){if(i.any(this.acceptedProtocols,function(e){return i.startsWith(t,e)}))return t;if(-1===this.acceptedProtocols.indexOf(e))throw new Error("Attempting to add an unsupported protocol: "+e);return(this.isProtocolRelative(t)?e:e+"//")+t}};e.exports=s},{lodash:"K2RcUv"}],495:[function(t,e){"use strict";function i(t){return t&&/^[a-zA-Z0-9._+-]+@[a-zA-Z0-9][a-zA-Z0-9.-]*[.]{1}[a-zA-Z]{2,20}$/.test(t)}function s(t){return t&&/^\d+$/.test(t)&&(10===t.length||11===t.length)}function o(t){return t&&/^\d+$/.test(t)&&(5===t.length||9===t.length)}e.exports={isEmail:i,isPhoneNumber:s,isPostalCode:o}},{}],496:[function(t,e){"use strict";function i(t,e){e||(e={}),t||(t=[]),s.each(t,function(t){s.isFunction(this[t])&&this[t].call(this,e)},this)}var s=t("lodash"),o=t("backbone"),n=t("./lib/extendwithmixins"),a=["model","collection","el","id","attributes","className","tagName","events"],r=["_setup"],l=o.View.extend({constructor:function(t){this.cid=s.uniqueId("view"),t||(t={}),s.extend(this,s.pick(t,a)),this._elAttributes=this.attributes,this.attributes={},this._ensureElement(),this.setupMethods=s.union(r,this.constructor.__super__.setupMethods,this.setupMethods),i.call(this,this.setupMethods,t),this.initialize.apply(this,arguments),this.delegateEvents()},_setup:s.noop,_ensureElement:function(){if(this.el)this.setElement(s.result(this,"el"),!1);else{var t=s.extend({},s.result(this,"_elAttributes"));this.id&&(t.id=s.result(this,"id")),this.className&&(t["class"]=s.result(this,"className"));var e=o.$("<"+s.result(this,"tagName")+">").attr(t);this.setElement(e,!1)}}});n.applyTo(l),e.exports=l},{"./lib/extendwithmixins":435,backbone:"5kFNoY",lodash:"K2RcUv"}],497:[function(t,e){"use strict";var i=t("lodash"),s=t("backbone"),o=t("./item"),n=o.extend({setupMethods:["_setupBaseView"],_setupBaseView:function(t){t||(t={}),this.subviews=i.extend({},this.subviews||{},t.subviews||{})},initialize:i.noop,_registerSubview:function(t){return this._subviews||(this._subviews=[]),this._subviews.push(t),t},appendSubview:function(t,e){return i.isString(e)&&(e=this.$(e)),this._registerSubview(t),t.render(),(e||this.$el).append(t.el),t},renderSubviews:function(){this.subviews&&i.each(this.subviews,function(t,e){t instanceof s.View?this.renderSubview(t,{name:e}):this.renderSubview(e)},this)},renderSubview:function(t,e){e||(e={});var o,n;i.isString(t)?(n=t,t=this.subviews[t],o={selector:t.container||"[data-subview="+n+"]",options:i.result(t,"options")||{},prepareView:t.prepareView||function(e,i){var s=new t.constructor(i);return s.$el.attr('data-subview="'+n+'"'),e.replaceWith(s.$el),s}}):t instanceof s.View&&(n=e.name||"",o={selector:e.container||"[data-subview="+n+"]",prepareView:e.prepareView||function(e){return t.$el.attr('data-subview="'+n+'"'),e.replaceWith(t.$el),t}});var a=i.bind(function(){var e;this.el&&(e=this.$(o.selector))&&(t=this[n]=o.prepareView.call(this,e,o.options),t.render(),this._registerSubview(t))},this);this.rendered?a():this.once("rendered",a,this)},_afterRender:function(){this.renderSubviews(),o.prototype._afterRender.apply(this,arguments)},_beforeRemove:function(){this._subviews&&i.chain(this._subviews).flatten().invoke("remove")}});e.exports=n},{"./item":498,backbone:"5kFNoY",lodash:"K2RcUv"}],498:[function(t,e){"use strict";function i(t){return s.isFunction(t.serialize)?t.serialize():s.isFunction(t.toJSON)?t.toJSON():void 0}var s=t("lodash"),o=t("prima/mixins/accessor/simple"),n=t("../view"),a=n.extend({rendered:!1,disposed:!1,keepElement:!1,_setup:function(t){var e=s.extend({},s.result(this.constructor.__super__,"defaults"),s.result(this,"defaults"));s.extend(e,s.pick(t,s.keys(e))),this.attributes={},this.set(e),this.changed={};var i=this.render;this.render=s.bind(function(){this._beforeRender.apply(this,arguments),this.beforeRender.apply(this,arguments);var t=i.apply(this,arguments);return this.afterRender.apply(this,arguments),this._afterRender.apply(this,arguments),t},this);var o=this.remove;this.remove=s.bind(function(){if(this.disposed)return this;this._beforeRemove.apply(this,arguments),this.beforeRemove.apply(this,arguments);var t=o.apply(this,arguments);return this.afterRemove.apply(this,arguments),this._afterRemove.apply(this,arguments),t},this)},_beforeRender:s.noop,beforeRender:s.noop,render:function(){return this.disposed?!1:(this.renderWithTemplate(),this)},_afterRender:function(){this.rendered=!0,this.trigger("rendered",this)},afterRender:s.noop,getTemplateData:function(){var t=i(this);return this.model&&(t.model=i(this.model)),this.collection&&(t.collection={items:i(this.collection),length:this.collection.length}),t},renderWithTemplate:function(t){if(!this.template)throw new Error("Template function needed.");var e;return e=s.isFunction(this.template)?this.template(t||this.getTemplateData()):this.template,this.$el.html(e),this},_beforeRemove:s.noop,beforeRemove:s.noop,remove:function(){return this.keepElement?(this.undelegateEvents(),this.stopListening()):n.prototype.remove.apply(this,arguments),this},_afterRemove:function(){var t=["el","$el","options","model","collection","subviews","_subviews","defaults","attributes"];s.each(t,s.bind(function(t){this[t]&&delete this[t]},this)),this.rendered=!1,this.disposed=!0},afterRemove:s.noop,cacheElements:function(t){for(var e in t)this[e]=this.$(t[e])}});o.mixin.applyTo(a.prototype),e.exports=a},{"../view":496,lodash:"K2RcUv","prima/mixins/accessor/simple":459}],499:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="note-count"></div><div class="inner"><span class="text">'+(null==(__t=__("Post"))?"":_.escape(__t))+"</span></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],500:[function(t,e){!function(t){"use strict";function i(){this.frames=[],this.lastId=0,this.raf=s,this.batch={hash:{},read:[],write:[],mode:null}}{var s=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)};window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.msCancelRequestAnimationFrame||function(t){window.clearTimeout(t)}}i.prototype.read=function(t,e){var i=this.add("read",t,e),s=i.id;this.batch.read.push(i.id);var o="reading"===this.batch.mode||this.batch.scheduled;
return o?s:(this.scheduleBatch(),s)},i.prototype.write=function(t,e){var i=this.add("write",t,e),s=this.batch.mode,o=i.id;this.batch.write.push(i.id);var n="writing"===s||"reading"===s||this.batch.scheduled;return n?o:(this.scheduleBatch(),o)},i.prototype.defer=function(t,e,i){"function"==typeof t&&(i=e,e=t,t=1);var s=this,o=t-1;return this.schedule(o,function(){s.run({fn:e,ctx:i})})},i.prototype.clear=function(t){if("function"==typeof t)return this.clearFrame(t);var e=this.batch.hash[t];if(e){var i=this.batch[e.type],s=i.indexOf(t);delete this.batch.hash[t],~s&&i.splice(s,1)}},i.prototype.clearFrame=function(t){var e=this.frames.indexOf(t);~e&&this.frames.splice(e,1)},i.prototype.scheduleBatch=function(){var t=this;this.schedule(0,function(){t.batch.scheduled=!1,t.runBatch()}),this.batch.scheduled=!0},i.prototype.uniqueId=function(){return++this.lastId},i.prototype.flush=function(t){for(var e;e=t.shift();)this.run(this.batch.hash[e])},i.prototype.runBatch=function(){try{this.batch.mode="reading",this.flush(this.batch.read),this.batch.mode="writing",this.flush(this.batch.write),this.batch.mode=null}catch(t){throw this.runBatch(),t}},i.prototype.add=function(t,e,i){var s=this.uniqueId();return this.batch.hash[s]={id:s,fn:e,ctx:i,type:t}},i.prototype.run=function(t){var e=t.ctx||this,i=t.fn;if(delete this.batch.hash[t.id],!this.onError)return i.call(e);try{i.call(e)}catch(s){this.onError(s)}},i.prototype.loop=function(){var t=this,e=this.raf;this.looping||(e(function i(){var s=t.frames.shift();t.frames.length?e(i):t.looping=!1,s&&s()}),this.looping=!0)},i.prototype.schedule=function(t,e){return this.frames[t]?this.schedule(t+1,e):(this.loop(),this.frames[t]=e)},t=t||new i,"undefined"!=typeof e&&e.exports?e.exports=t:"function"==typeof define&&define.amd?define(function(){return t}):window.fastdom=t}(window.fastdom)},{}],501:[function(){(function(t){function e(t,i){if({}.hasOwnProperty.call(e.cache,t))return e.cache[t];var s=e.resolve(t);if(!s)throw new Error("Failed to resolve module "+t);var o={id:t,require:e,filename:t,exports:{},loaded:!1,parent:i,children:[]};i&&i.children.push(o);var n=t.slice(0,t.lastIndexOf("/")+1);return e.cache[t]=o.exports,s.call(o.exports,o,o.exports,n,t),o.loaded=!0,e.cache[t]=o.exports}e.modules={},e.cache={},e.resolve=function(t){return{}.hasOwnProperty.call(e.modules,t)?e.modules[t]:void 0},e.define=function(t,i){e.modules[t]=i};var i=function(e){return e="/",{title:"browser",version:"v0.10.26",browser:!0,env:{},argv:[],nextTick:t.setImmediate||function(t){setTimeout(t,0)},cwd:function(){return e},chdir:function(t){e=t}}}();e.define("/gif.coffee",function(t){function i(t,e){return{}.hasOwnProperty.call(t,e)}function s(t,e){for(var i=0,s=e.length;s>i;++i)if(i in e&&e[i]===t)return!0;return!1}function o(t,e){function s(){this.constructor=t}for(var o in e)i(e,o)&&(t[o]=e[o]);return s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype,t}var n,a,r,l,h;r=e("events",t).EventEmitter,n=e("/browser.coffee",t),h=function(t){function e(t){var e,i;this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(t);for(e in a)i=a[e],null!=this.options[e]?this.options[e]:this.options[e]=i}return o(e,t),a={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null},l={delay:500,copy:!1},e.prototype.setOption=function(t,e){return this.options[t]=e,null==this._canvas||"width"!==t&&"height"!==t?void 0:this._canvas[t]=e},e.prototype.setOptions=function(t){var e,s;return function(o){for(e in t)i(t,e)&&(s=t[e],o.push(this.setOption(e,s)));return o}.call(this,[])},e.prototype.addFrame=function(t,e){var i,s;null==e&&(e={}),i={},i.transparent=this.options.transparent;for(s in l)i[s]=e[s]||l[s];if(null!=this.options.width||this.setOption("width",t.width),null!=this.options.height||this.setOption("height",t.height),"undefined"!=typeof ImageData&&null!=ImageData&&t instanceof ImageData)i.data=t.data;else if("undefined"!=typeof CanvasRenderingContext2D&&null!=CanvasRenderingContext2D&&t instanceof CanvasRenderingContext2D||"undefined"!=typeof WebGLRenderingContext&&null!=WebGLRenderingContext&&t instanceof WebGLRenderingContext)e.copy?i.data=this.getContextData(t):i.context=t;else{if(null==t.childNodes)throw new Error("Invalid image");e.copy?i.data=this.getImageData(t):i.image=t}return this.frames.push(i)},e.prototype.render=function(){var t,e;if(this.running)throw new Error("Already running");if(null==this.options.width||null==this.options.height)throw new Error("Width and height must be set prior to rendering");this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(e){for(var i=function(){var t;t=[];for(var e=0;0<=this.frames.length?e<this.frames.length:e>this.frames.length;0<=this.frames.length?++e:--e)t.push(e);return t}.apply(this,arguments),s=0,o=i.length;o>s;++s)t=i[s],e.push(null);return e}.call(this,[]),e=this.spawnWorkers();for(var i=function(){var t;t=[];for(var i=0;e>=0?e>i:i>e;e>=0?++i:--i)t.push(i);return t}.apply(this,arguments),s=0,o=i.length;o>s;++s)t=i[s],this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},e.prototype.abort=function(){for(var t;;){if(t=this.activeWorkers.shift(),!(null!=t))break;console.log("killing active worker"),t.terminate()}return this.running=!1,this.emit("abort")},e.prototype.spawnWorkers=function(){var t;return t=Math.min(this.options.workers,this.frames.length),function(){var e;e=[];for(var i=this.freeWorkers.length;this.freeWorkers.length<=t?t>i:i>t;this.freeWorkers.length<=t?++i:--i)e.push(i);return e}.apply(this,arguments).forEach(function(t){return function(e){var i;return console.log("spawning worker "+e),i=new Worker(t.options.workerScript),i.onmessage=function(t){return function(e){return t.activeWorkers.splice(t.activeWorkers.indexOf(i),1),t.freeWorkers.push(i),t.frameFinished(e.data)}}(t),t.freeWorkers.push(i)}}(this)),t},e.prototype.frameFinished=function(t){return console.log("frame "+t.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[t.index]=t,s(null,this.imageParts)?this.renderNextFrame():this.finishRendering()},e.prototype.finishRendering=function(){var t,e,i,s,o,n,a;o=0;for(var r=0,l=this.imageParts.length;l>r;++r)e=this.imageParts[r],o+=(e.data.length-1)*e.pageSize+e.cursor;o+=e.pageSize-e.cursor,console.log("rendering finished - filesize "+Math.round(o/1e3)+"kb"),t=new Uint8Array(o),n=0;for(var h=0,d=this.imageParts.length;d>h;++h){e=this.imageParts[h];for(var c=0,u=e.data.length;u>c;++c)a=e.data[c],i=c,t.set(a,n),n+=i===e.data.length-1?e.cursor:e.pageSize}return s=new Blob([t],{type:"image/gif"}),this.emit("finished",s,t)},e.prototype.renderNextFrame=function(){var t,e,i;if(0===this.freeWorkers.length)throw new Error("No free workers");return this.nextFrame>=this.frames.length?void 0:(t=this.frames[this.nextFrame++],i=this.freeWorkers.shift(),e=this.getTask(t),console.log("starting frame "+(e.index+1)+" of "+this.frames.length),this.activeWorkers.push(i),i.postMessage(e))},e.prototype.getContextData=function(t){return t.getImageData(0,0,this.options.width,this.options.height).data},e.prototype.getImageData=function(t){var e;return null!=this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),e=this._canvas.getContext("2d"),e.setFill=this.options.background,e.fillRect(0,0,this.options.width,this.options.height),e.drawImage(t,0,0),this.getContextData(e)},e.prototype.getTask=function(t){var e,i;if(e=this.frames.indexOf(t),i={index:e,last:e===this.frames.length-1,delay:t.delay,transparent:t.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,repeat:this.options.repeat,canTransfer:"chrome"===n.name},null!=t.data)i.data=t.data;else if(null!=t.context)i.data=this.getContextData(t.context);else{if(null==t.image)throw new Error("Invalid frame");i.data=this.getImageData(t.image)}return i},e}(r),t.exports=h}),e.define("/browser.coffee",function(t){var e,i,s,o,n;o=navigator.userAgent.toLowerCase(),s=navigator.platform.toLowerCase(),n=o.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],i="ie"===n[1]&&document.documentMode,e={name:"version"===n[1]?n[3]:n[1],version:i||parseFloat("opera"===n[1]&&n[4]?n[4]:n[2]),platform:{name:o.match(/ip(?:ad|od|hone)/)?"ios":(o.match(/(?:webos|android)/)||s.match(/mac|win|linux/)||["other"])[0]}},e[e.name]=!0,e[e.name+parseInt(e.version,10)]=!0,e.platform[e.platform.name]=!0,t.exports=e}),e.define("events",function(t,e){i.EventEmitter||(i.EventEmitter=function(){});var s=e.EventEmitter=i.EventEmitter,o="function"==typeof Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},n=10;s.prototype.setMaxListeners=function(t){this._events||(this._events={}),this._events.maxListeners=t},s.prototype.emit=function(t){if("error"===t&&(!this._events||!this._events.error||o(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var e=this._events[t];if(!e)return!1;if("function"!=typeof e){if(o(e)){for(var i=Array.prototype.slice.call(arguments,1),s=e.slice(),n=0,a=s.length;a>n;n++)s[n].apply(this,i);return!0}return!1}switch(arguments.length){case 1:e.call(this);break;case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:var i=Array.prototype.slice.call(arguments,1);e.apply(this,i)}return!0},s.prototype.addListener=function(t,e){if("function"!=typeof e)throw new Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",t,e),this._events[t])if(o(this._events[t])){if(!this._events[t].warned){var i;i=void 0!==this._events.maxListeners?this._events.maxListeners:n,i&&i>0&&this._events[t].length>i&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),console.trace())}this._events[t].push(e)}else this._events[t]=[this._events[t],e];else this._events[t]=e;return this},s.prototype.on=s.prototype.addListener,s.prototype.once=function(t,e){var i=this;return i.on(t,function s(){i.removeListener(t,s),e.apply(this,arguments)}),this},s.prototype.removeListener=function(t,e){if("function"!=typeof e)throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[t])return this;var i=this._events[t];if(o(i)){var s=i.indexOf(e);if(0>s)return this;i.splice(s,1),0==i.length&&delete this._events[t]}else this._events[t]===e&&delete this._events[t];return this},s.prototype.removeAllListeners=function(t){return t&&this._events&&this._events[t]&&(this._events[t]=null),this},s.prototype.listeners=function(t){return this._events||(this._events={}),this._events[t]||(this._events[t]=[]),o(this._events[t])||(this._events[t]=[this._events[t]]),this._events[t]}}),t.GIF=e("/gif.coffee")}).call(this,this)},{}],502:[function(t,e){var i=t("./debugConsole"),s=function(){function t(t,e){"number"==typeof t&&"number"==typeof e&&this.element.css({left:t+"px",top:e+"px"})}function e(){var t=this.element.get(0).getBoundingClientRect().left;0>t&&this.element.css("left","+="+-1*t+"px");var e=this.element.get(0).getBoundingClientRect().top;0>e&&this.element.css("top","+="+-1*e+"px")}var s=function(t){return this.element?(t=t||{},this.onShow=t.onShow||function(t){t.element.show()},this.onHide=t.onHide||function(t){t.element.hide()},this.isShown=!1,void this.element.hide()):(i.error("ControlBase requires an element"),null)};return s.prototype.hide=function(){this.isShown&&(this.isShown=!1,this.onHide(this))},s.prototype.showOverTarget=function(t,i){var s=t-this.element.width()/2,o=i-this.element.height()-10;this.show(s,o),e.call(this)},s.prototype.show=function(e,i){t.call(this,e,i),this.isShown||(this.isShown=!0,this.onShow(this))},s.prototype.size=function(t,e){t&&"number"==typeof t&&this.element.width(t),e&&"number"==typeof e&&this.element.width(e)},s}();e.exports=s},{"./debugConsole":504}],503:[function(t,e){var i=t("lodash"),s=t("jquery"),o=t("./sanitize"),n=function(){function t(t){t.normalize();for(var e=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1);e.nextNode();){var i=e.currentNode,o=s(i).parent().is(t);o&&""!==i.nodeValue.trim()&&s(i).wrap("<p>")}}function e(e){t(e),s(e).children().each(function(){var t=s(this).get(0),e=t.nodeName===g,i=t.nodeName===f;_(t)||v(t)||e||i||s(this).wrap("<p>")})}function n(t){return i.filter(s(t).find("*").toArray(),function(t){return _(t)||y(t)})}function a(t,o){t.normalize(),o||e(t);var a=n(t);(a.length||!o)&&(o&&(e(t),a=n(t)),s(t).empty(),i.each(a,function(e){var o=i.some(s(e).children().toArray(),function(t){return _(t)});(y(e)||!d(e)&&!o)&&s(t).append(e)}))}function r(t,e){var o=n(t);i.each(o,function(t){s(t).find("li").contents().unwrap(),e&&(s(t).find("br:last-child").remove(),s(t).append("<br>")),s(t).contents().unwrap()})}function l(t){var i=w(t);i.shift();for(var o=i.shift();o&&!s(o).is("[contentEditable]");){var n=o.parentNode;s(o).contents().unwrap(),e(n),o=i.shift()}}function h(t){if(t&&t.length){for(var e=t.shift(),o=!1,n=["style","dir"];e;){var a=s(e).find("span").toArray();"SPAN"===e.nodeName&&a.push(e),a.length&&(o=!0),s(a).contents().unwrap(),i.each(n,function(t){s(e).removeAttr(t),s(e).find("["+t+"]").removeAttr(t)}),e=t.shift()}return o}}function d(t,e){var i=s(t).text();e&&(i=i.replace(/\n|\r/gm,"").trim());var o=t&&t.nodeName===f;return""===i&&!v(t)&&!b(t)&&!o}function c(t){var e=document.implementation.createHTMLDocument("");return e.body.innerHTML=t,e.body}function u(t){var e=document.implementation.createHTMLDocument("");return e.body.appendChild(t.cloneNode(!0)),e.body}var p=["P","FIGURE","H2","BLOCKQUOTE","UL","OL","PRE"],m=["FIGURE","IFRAME","IMG","HR"],g="DIV",f="HR",_=function(t){return i.contains(p,t.nodeName)},v=function(t){return t&&i.contains(m,t.nodeName)},b=function(t){return s(t).find(m.join()).length},y=function(t){return"false"===s(t).attr("contenteditable")},w=function(t){return i.filter(t,function(t){return i.contains(p,t.nodeName)})},x=function(t){this.sanitizeConfig=t};return x.prototype.flattenBlocksDown=function(t,e){a(t,e)},x.prototype.unwrapParentBlocks=function(t){l(t)},x.prototype.scrubSpansAndBadAttrs=function(t,e){return h(t,e)},x.prototype.blockifyInlineNodes=function(t){e(t)},x.prototype.inlinify=function(t,e){r(t,e)},x.prototype.getBlockNodes=function(t){return n(t)},x.prototype.isEmptyElement=function(t,e){return d(t,e)},x.prototype.filterHTML=function(t){var e=c(t),i=new o(this.sanitizeConfig),s=i.clean_node(e),n=u(s),a=n.innerHTML,r=a.replace(/[<]p[>][ ]*[<]\/p[>]/g,"");return r},x.prototype.filterPlaintext=function(t,e){var s=i.escape(t);return s=s.replace(/\r\n/g,"\n"),s=s.replace(/\r/g,"\n"),e&&(s=s.replace(/\n([ ]*\n)+/g,"</p><p>")),s=s.replace(/\n/g,"<br>"),e&&(s="<p>"+s+"</p>"),s},x.prototype.convertToBrowserSpaces=function(t){return t.replace(/[ ]{2}/g,"  ").replace(/[ ]$/," ")},x.prototype.sanitizeIFrames=function(t){var e=c(t);return s(e).find("iframe").each(function(){s(this).attr("data-original-src",s(this).attr("src")),s(this).attr("src","javascript:''")}),e.innerHTML},x.prototype.unSanitizeIFrames=function(t){var e=c(t);return s(e).find("iframe[data-original-src]").each(function(){s(this).attr("src",s(this).attr("data-original-src")),s(this).removeAttr("data-original-src")}),e.innerHTML},x}();e.exports=n},{"./sanitize":514,jquery:"HlZQrA",lodash:"K2RcUv"}],504:[function(t,e){var i=t("lodash"),s=t("./ligature"),o=["assert","clear","constructor","count","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","timeline","timelineEnd","trace","warn"],n=function(t){return function(){return s.debugMode?window.console[t].bind(window.console).apply(this,arguments):i.noop}},a={};i.each(o,function(t){a[t]=n(t)}),e.exports=a},{"./ligature":509,lodash:"K2RcUv"}],505:[function(t,e){var i=t("lodash"),s=t("jquery"),o=t("velocity-animate"),n=o.animate,a=t("./controlBase"),r=function(){function t(){var t=this,e=i.reduce(this.controlsOrder,function(t,e){return i.has(this.controls,e)&&t.push(this.template(i.extend({name:e},this.controls[e]))),t},[],this);this.element=s("<div />",{"class":"bubbles"}).css({position:"absolute",top:0,left:0}).html(e),this.buttons=s(this.element).find("[data-command]"),this.hide(),this.buttons.on("mousedown",function(t){t.preventDefault()}),this.buttons.on("mouseup",function(e){e.preventDefault(),l.call(t,this)})}function e(){i.each(this.controls,function(t,e){i.has(t,"keyboard")&&this.keyboardEvents.on(t.keyboard,i.partial(r.bind(this),e)),i.has(t,"keyboardInverse")&&this.keyboardEvents.on(t.keyboardInverse,i.partial(o.bind(this),e))},this)}function o(t){i.has(this.controls,t)&&u[t]&&r.call(this,t)}function r(t){var e,s,o,n;i.has(this.controls,t)&&(e=u[t],s=this.controls[t],o=s.command,n=s.el,e&&this.inverseCommand&&"function"==typeof this.inverseCommand?this.inverseCommand(o,n,this):this.applyCommand&&"function"==typeof this.applyCommand&&this.applyCommand(o,n,this),this.onAction(this))}function l(t){r.call(this,s(t).attr("data-name"))}function h(){this.buttons.removeClass("active"),this.buttons.filter(function(){return u[s(this).attr("data-name")]}).addClass("active")}function d(t,e){var i=!1;return s.each(t,function(t,s){return s===e||"undefined"!=typeof s.nodeName&&s.nodeName===e?(i=!0,!1):void 0}),i}var c='<div class="<%= className %>" title="<%= title %>" data-name="<%= name %>" data-el="<%= el %>" data-command="<%= command %>" data-type="<%= type %>">&nbsp;</div>',u={},p=function(s,o,n){n=n||{},this.applyCommand=s,this.inverseCommand=o,this.template=i.template(n.template||c),this.controls=n.controls||{},this.controlsOrder=n.controlsOrder||i.keys(this.controls),this.onAction=n.onAction||i.noop,this.keyboardEvents=n.keyboardEvents,t.call(this),this.keyboardEvents&&e.call(this),a.call(this,n)};return i.assign(p.prototype,a.prototype),p.prototype.setActives=function(t){u=i.reduce(this.controls,function(e,i,s){var o=i.command,n=(i.el||"").toUpperCase(),a=d(t,n),r=!1;try{r=document.queryCommandEnabled(o)&&document.queryCommandState(o)}catch(l){r=!1}return e[s]=r||a,e},{},this),h.call(this)},p.prototype.open=function(t,e){if(!this.isShown){var i=s(this.element).children("[data-command]"),o=s(this.element).find(".shim");s(this.element).css({width:"auto"}),o.remove(),i.removeAttr("style")}this.showOverTarget(t,e)},p.prototype.closeWithShim=function(t,e,o,a){var r=s(this.element),l=s(t),h=s('<div class="shim">&nbsp;</div>').get(0),d=i.has(n,"Promise");o=d?o:200;var c=r.width();r.css("width",c+e);var u=l.position().left,p=c/2-(u+e/2);l.before(h).hide();var m=s(h).offset().left+p,g=s(h).offset().top;this.isAnimating=!0,i.forEach(this.buttons,function(t){n(t,"stop"),n(t,{opacity:0},{duration:.5*o})}),n(r,{left:"+="+p},{easing:"ease",duration:o});var f=n(h,{width:e},{easing:"ease",duration:o}),_=i.bind(function(){i.isFunction(a)&&a.call(this,m,g),this.isAnimating=!1,this.hide()},this);d?f.then(_):i.delay(_,o)},p.prototype.getActiveStates=function(){return u},p}();e.exports=r},{"./controlBase":502,jquery:"HlZQrA",lodash:"K2RcUv","velocity-animate":"lWl/mc"}],506:[function(t,e){var i=t("lodash"),s=function(){function t(){return navigator.platform.match(/^Win/i)?"Win":navigator.platform.match(/^Mac/i)?"Mac":navigator.platform.match(/^Linux/i)?"Linux":navigator.platform}function e(){return i.extend({},this.prettyMapping,this.platformPrettyMapping[t.call(this)])}function s(){return this.platformModifiers[t.call(this)]||{}}function o(){var e=t.call(this);return i.has(this.platformPrettySeperators,e)?this.platformPrettySeperators[e]:this.seperator}function n(t){return this.specialKeys[t.keyCode]||String.fromCharCode(t.keyCode)}function a(t){return i.filter(this.modifiers,function(e){return t[e+"Key"]})}function r(t){return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()}var l=["ctrl","meta","alt","shift"],h="+",d={37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN",187:"PLUS",61:"PLUS",188:"COMMA",189:"MINUS",173:"MINUS",190:"DOT",32:"SPACE"},c={LEFT:"←",RIGHT:"→",DOWN:"↓",UP:"↑",PLUS:"+",COMMA:",",MINUS:"-",DOT:".",SPACE:"Space"},u={Win:{meta:"ctrl"},Linux:{meta:"ctrl"}},p={Mac:{meta:"⌘",shift:"⇧",alt:"⌥"}},m={Win:"-",Linux:"-",Mac:""},g=function(t){t=t||{},this.modifiers=t.modifiers||l,this.separator=t.separator||h,this.specialKeys=t.specialKeys||d,this.prettyMapping=t.prettyMapping||c,this.platformModifiers=t.platformsModififiers||u,this.platformPrettyMapping=t.platformPrettyModifiers||p,this.platformPrettySeperators=t.platformPrettySeperators||m};return g.prototype.translate=function(t){var e=a.call(this,t);return 0===e.length?null:e.concat(n.call(this,t)).join(this.separator)},g.prototype.normalize=function(t){var e=t.split(this.separator),o=s.call(this),n="";return i.each(this.modifiers,function(t){var s=i.indexOf(e,t.toLowerCase()),a=o[t]||t;s>=0&&(n+=a+this.separator,e.splice(s,1))},this),n+e.join(this.separator).toUpperCase()},g.prototype.pretty=function(t){var s=this.normalize(t),n=e.call(this),a=o.call(this);return i.map(s.split(this.separator),function(t){return n[t]||r(t)},this).join(a)},g}();e.exports=s},{lodash:"K2RcUv"}],507:[function(t,e){var i=t("lodash"),s=t("jquery"),o=t("./controlBase"),n=function(){function t(){this.element=s("<div />",{"class":"inline-controls"}).css({position:"absolute",top:0,left:0}),this.opener=s("<div />",{"class":"opener"}),this.isTrayOpen=!1;var t=this;this.opener.on("mousedown",function(i){return i.preventDefault(),i.stopPropagation(),e.call(t,null,!0),!1}),this.tray=s("<div />",{"class":"tray"}),this.element.append(this.opener),this.element.append(this.tray),this.hide()}function e(t,e){"boolean"!=typeof t&&(t=!this.isTrayOpen),t?(this.openTray.call(this,this.tray),this.isTrayOpen=!0,this.onTrayOpened.call(this,e)):(this.closeTray.call(this,this.tray),this.isTrayOpen=!1,this.onTrayClosed.call(this,e)),s(this.opener).toggleClass("open",this.isTrayOpen),e?s(this.opener).toggleClass("closed",!this.isTrayOpen):s(this.opener).removeClass("closed")}var n=function(e){e=e||{},this.openTray=e.openTray||this.openTray,this.closeTray=e.closeTray||this.closeTray,this.onTrayOpened=e.onTrayOpened||function(){},this.onTrayClosed=e.onTrayClosed||function(){},this.customOffset=e.customOffset||i.noop,this.keyboardEvents=e.keyboardEvents,t.call(this),o.call(this,e)};i.assign(n.prototype,o.prototype);var a=i.memoize(function(t,e){var s;return i.isFunction(e)?s=e.call():i.isObject(e)&&(s=e),i.pick(i.defaults(i.isObject(s)?s:{},{x:t.x||t,y:t.y||0}),["x","y"])});return n.prototype.addToTray=function(t,e){var i;e=e||{},this.tray.append(t),i=e.keyboard,this.keyboardEvents&&i&&this.keyboardEvents.on(i.shortcut,i.callback,i.context)},n.prototype.openTray=function(t){t.show()},n.prototype.closeTray=function(t){t.hide()},n.prototype.open=function(t,i){if(t){i=a(i||0,this.customOffset||0);var o=s(t).position(),n=parseInt(s(t).css("margin-top"),10)||0;e.call(this,!1),this.show(o.left+i.x,o.top+i.y+n)}},n.prototype.close=function(){e.call(this,!1),this.hide()},n.prototype.toggleTrayWithIntent=function(t){e.call(this,t,!0)},n}();e.exports=n},{"./controlBase":502,jquery:"HlZQrA",lodash:"K2RcUv"}],508:[function(t,e){var i=t("lodash"),s=t("jquery"),o=t("./humanKeys"),n=function(){function t(){s(this.element).on("keydown.keycombos",n.bind(this)),this.listening=!0}function e(){s(this.element).off("keydown.keycombos"),this.listening=!1}function n(t){var e=this.humanKeys.translate(t);e&&r.call(this,e)&&(a.call(this,e,t),t.preventDefault(),t.stopImmediatePropagation())}function a(t,e){i.each(h.call(this,t),function(s){i.has(s,"callback")&&i.has(s,"context")&&s.callback.call(s.context,e,t)})}function r(t){return h.call(this,t).length>0}function l(t,e){var s=h.call(this,t);return i.filter(s,{callback:e}).length>0}function h(t){return i.has(this.subscribers,t)?this.subscribers[t]:[]}function d(e,s,o){return l.call(this,e,s)?void 0:(i.has(this.subscribers,e)||(this.subscribers[e]=[]),this.subscribers[e].push({callback:s,context:o}),this.listening||t.call(this),this)}function c(){this.subscribers={},e.call(this)}function u(t,s){return t?i.has(this.subscribers,t)?(s&&(this.subscribers[t]=i.reject(this.subscribers[t],{callback:s})),s&&0!==this.subscribers[t].length||delete this.subscribers[t],0===i.values(this.subscribers).length&&e.call(this),this):this:(c.call(this),this)}var p=function(t){t=t||{},this.debounceRate=t.debounceRate||100,this.element=t.element||document,this.humanKeys=t.humanKeys||new o,this.subscribers={},this.listening=!1};return p.prototype.on=function(t,e,s){i.each((t||"").split(" "),function(t){d.call(this,this.humanKeys.normalize(t),e,s)},this)},p.prototype.off=function(t,e){t?i.each(t.split(" "),function(t){u.call(this,this.humanKeys.normalize(t),e)},this):u.call(this,null,e)},p}();e.exports=n},{"./humanKeys":506,jquery:"HlZQrA",lodash:"K2RcUv"}],509:[function(t,e){var i={debugMode:!1};e.exports=i},{}],510:[function(t,e){var i=t("lodash"),s=t("jquery"),o=t("velocity-animate"),n=t("./utils"),a=t("./selectionPersistence"),r=t("./controlBase"),l=t("./debugConsole"),h=function(){function t(){this.element=s("<div />",{"class":"link-bubbles"}).css({position:"absolute",top:0,left:0}),this.linkUrl=s("<div />",{"class":"url"}),this.linkEditInput=s("<input />",{type:"text",placeholder:"http://"}),this.linkEditDone=s("<div />",{"class":"done"}).text("Done"),this.linkUrl.hide(),this.linkUrl.append(this.linkEditInput).append(this.linkEditDone),e.call(this),this.element.append(this.linkUrl),this.hide()}function e(){var t=this,e=s("<div />",{"class":"options"}),i={edit:function(){h.call(this)},remove:function(){var t=window.getSelection(),e=document.createRange();e.selectNodeContents(this.linkElement),t.removeAllRanges(),t.addRange(e),window.document.execCommand("unlink",!1,null),t.removeAllRanges(),this.onChange(),this.hide()},open:function(){var t=s(this.linkElement).attr("href");-1===t.indexOf("://")&&(t="http://"+t),window.open(t,"_blank")}};for(var o in i){var n=s("<div />",{"class":o}).text(o);s(n).on("click",function(e){return function(){e.call(t)}}(i[o])),e.append(n)}e.hide(),s(this.element).append(e)}function h(){this.linkElement||l.error("Cannot edit link without a valid linkElement");var t=this.linkElement;d.call(this,function(e){s(t).attr("href",e)},s(t).attr("href"))}function d(t,e){e&&(this.linkEditInput.val(e),this.linkUrl.addClass("modified"));var i=this,o=function(){var e=s(i.linkEditInput).val().trim();t(e),i.onChange(),i.close()};s(this.linkEditInput).on("keydown",function(t){i.linkUrl.addClass("modified"),t.keyCode===u.enter?(t.preventDefault(),o()):t.keyCode===u.esc&&(i.close(),i.onDismiss(),t.stopPropagation())}),s(this.linkEditInput).on("keyup",function(t){t.keyCode!==u.esc&&t.keyCode!==u.enter&&c.call(i)}),s(this.linkEditInput).on("paste",function(){i.linkUrl.addClass("modified"),c.call(i)}),this.linkEditDone.on("click",function(t){t.preventDefault(),o()}),this.element.find(".options").hide(),this.linkUrl.show(),this.show(),c.call(this),s(this.linkEditInput).focus()}function c(){var t=s(this.linkEditInput).val(),e=s(this.linkEditDone).outerWidth(),i=s(this.linkUrl).outerWidth()-s(this.linkUrl).width(),a=n.calcTextWidth(s(this.linkEditInput).get(0),t),r=n.calcTextWidth(s(this.linkEditInput).get(0),"A"),l=a+e+i+r,h=l<this.minWidth?this.minWidth:l;h=h>this.maxWidth?this.maxWidth:h;var d=s(this.element),c=h-d.width();if(0!==c){var u=Math.floor(c/2);o(d,{width:h,left:"-="+u},{duration:40,easing:"ease"})}}var u={shift:16,enter:13,esc:27,"delete":8,tab:9},p=function(e){this.onChange="onChange"in e&&i.isFunction(e.onChange)?e.onChange:i.noop,this.onDismiss=e.onDismiss||i.noop,this.bypassClasses="bypassClasses"in e&&i.isArray(e.bypassClasses)?e.bypassClasses:[],this.maxWidth="maxWidth"in e&&i.isNumber(e.maxWidth)?e.maxWidth:600,this.minWidth="minWidth"in e&&i.isNumber(e.minWidth)?e.minWidth:200,this.linkElement=null,t.call(this),r.call(this)};return i.assign(p.prototype,r.prototype),p.prototype.createLink=function(t){d.call(this,function(e){a.restoreSelection(t),window.document.execCommand("createLink",!1,e);var i=window.getSelection(),s=i.getRangeAt(0);s.collapse(!1),i.removeAllRanges(),i.addRange(s)})},p.prototype.showOptions=function(t){this.linkElement=t,this.linkUrl.hide(),this.element.css({width:"",left:0}),this.element.find(".options").show()},p.prototype.close=function(){this.linkUrl.hide(),this.element.find(".options").hide(),this.element.css("width",""),this.linkEditInput.val("").unbind(),this.linkEditDone.unbind(),this.linkUrl.removeClass("modified"),this.linkElement=null,this.hide()},p.prototype.isValidLink=function(t){return t?!i.some(this.bypassClasses,function(e){return s(t).hasClass(e)}):!1},p}();e.exports=h},{"./controlBase":502,"./debugConsole":504,"./selectionPersistence":516,"./utils":519,jquery:"HlZQrA",lodash:"K2RcUv","velocity-animate":"lWl/mc"}],511:[function(t,e){var i=t("lodash"),s=t("./ligature");e.exports=i.extend(s,{RichTextEditor:t("./richTextEditor"),PlainTextEditor:t("./plainTextEditor"),SelectionContext:t("./selectionContext"),SelectionPersistence:t("./selectionPersistence"),Utils:t("./utils"),HumanKeys:t("./humanKeys")})},{"./humanKeys":506,"./ligature":509,"./plainTextEditor":512,"./richTextEditor":513,"./selectionContext":515,"./selectionPersistence":516,"./utils":519,lodash:"K2RcUv"}],512:[function(t,e){var i=t("lodash"),s=t("jquery"),o=t("./dataFilter"),n=t("./selectionPersistence"),a=t("./selectionContext"),r=t("./undoManager"),l=t("./smartQuoter"),h=t("./keyComboEvents"),d=t("./debugConsole"),c=function(){function t(){g.call(this,C);var t=s("<div />",{"data-js":"editor-wrapper","class":"editor-wrapper"}).css("position","relative"),i=s("<div />",{"data-js":"editor-slot","class":"editor-slot"}).css("position","relative");s(this.element).wrap(t).wrap(i),this.placeholderElement=s("<div />",{"data-js":"editor-placeholder","class":"editor-placeholder"}).css("position","absolute"),i=s(this.element).parent(),i.append(this.placeholderElement),u.call(this),e.call(this)}function e(){var t=this,e=function(){y.call(this),c.call(this),this.onChange()};s(this.element).on("input keydown keyup keypress mousedown mouseup",function(e){t.config.onClientEvent.call(t,e)}),s(this.element).on("keydown",function(e){if(e.keyCode===$.shift)t.keyModifiers.shift=!0;else if(e.keyCode===$.backspace)k.call(t);else if(e.keyCode===$.enter)return t.config.forceSingleLine||e.metaKey||v.call(t,this,!1),void e.preventDefault();i.defer(function(){t.onChange(e)})}),s(this.element).on("keyup",function(s){s.keyCode===$.shift?t.keyModifiers.shift=!1:s.keyCode===$.enter?k.call(t):(s.keyCode===$.backspace||s.keyCode===$["delete"])&&i.defer(function(){k.call(t)}),e.call(t)}),s(this.element).on("input",function(){e.call(t)}),s(this.element).on("blur",function(){t.onChange()});var o=!1;s(this.element).on("mouseup",function(){o=!1,c.call(t)}),s(this.element).on("mousedown",function(){o=!0}),s(this.element).on("mouseleave",function(){o&&c.call(t)}),s(this.element).on("paste",function(e){var i=(e.originalEvent||e).clipboardData;t.config.pasteHook(i,t.keyModifiers.shift)||p.call(t,i,e),e.preventDefault()}),s(this.element).on("drop",function(t){t.stopPropagation(),t.preventDefault()}),this.placeholderElement.on("click",function(){t.isEmpty()&&s(t.element).focus()}),s(this.element).on("focus",function(){i.defer(function(){t.onChange()})})}function c(){var t=this;setTimeout(function(){var e=a.getSelection();t.config.onSelection.call(t,e)},200)}function u(){var t=this.isEmpty()?this.config.placeholder:"",e=s(this.placeholderElement);e.html(t);var i=e.outerHeight();
i&&s(this.element).css("min-height",Math.max(parseInt(e.css("min-height"),10)||0,i))}function p(t,e){var s="";if(i.contains(t.types,"text/plain"))s=t.getData("text/plain"),s=this.dataFilter.filterPlaintext(s),_.call(this,s);else{if(!i.contains(t.types,"text/html"))return;s=t.getData("text/html"),s=this.dataFilter.filterHTML(s);var o=s.replace(/<br(\s*)\/*>/gi,"\n").replace(/(<[p|div])/gi,"\n$1"),n=document.implementation.createHTMLDocument("");n.body.innerHTML=o;var a=n.body,r=a.textContent||a.innerText||"",l=r.split("\n").join("<br>");_.call(this,l)}if(this.config.forceSingleLine){var h=f.call(this).replace(/<br\s*\/*>/g," ");g.call(this,h)}this.onChange(e)}function m(){s(this.element).contents().filter(function(){return 3===this.nodeType}).wrap("<span></span>")}function g(t){s(this.element).html(t)}function f(){return s(this.element).html().trim()}function _(t){if(t=t.replace(/[<]br\s?\/?[>]$/,""),t=this.dataFilter.convertToBrowserSpaces(t),!t)return void d.warn("Cannot insert empty data");var e=a.getSelection();if(!e||!e.focusNode)return void d.warn("Cannot insert without the editor having a cursor or selection");var i=e.getRangeAt(0);i.deleteContents();var s=i.createContextualFragment(t);i.insertNode(s),e.removeAllRanges(),i.collapse(!1),e.addRange(i)}function v(t,e){e||t.lastChild&&"br"===t.lastChild.nodeName.toLowerCase()||t.appendChild(document.createElement("br"));var i=a.getSelection();if(i){var s=i.getRangeAt(0),o=document.createElement("br");s.deleteContents(),s.insertNode(o),s.setStartAfter(o),s.setEndAfter(o),s.collapse(!1),i.removeAllRanges(),i.addRange(s)}}function b(t){s(t).contents().each(function(t,e){e.nodeType===Node.TEXT_NODE?e.textContent=e.textContent.replace(T,""):e.nodeType===Node.ELEMENT_NODE&&b(e)})}function y(){if(!this.isEmpty()){var t=w.call(this);if(t&&t.nodeType===Node.ELEMENT_NODE){var e=t.textContent||t.innerText||"",i=e.match(T);if(i){var s=n.saveSelection(t);s.start-=(e.substr(0,s.start).match(T)||"").length||0,s.end-=(e.substr(0,s.end).match(T)||"").length||0,b(t),n.restoreSelection(s)}}}}function w(){var t=x.call(this);if(!t){var e=s(this.element).children();if(!e.length)return null;t=e.last().get(0)}return t}function x(t){return t||(t=!a.getSelection()&&this.lastSelection?a.getParentNodes(this.lastSelection.anchorNode):a.getNodeList()),i.find(t.reverse(),function(t){return t.nodeType===Node.ELEMENT_NODE})}function k(){this.isEmpty()&&(g.call(this,C),this.setCursorToEnd())}var C="<span>&#8203;</span>",S="<span>​</span>",T=/\u200B/g,$={shift:16,enter:13,esc:27,backspace:8,"delete":46,tab:9,right:39},E=function(e,s){if(!e)throw new Error("A valid element parameter is required to initalize the editor");this.element=e,this.keyComboEvents=s.keyComboEvents||new h({element:this.element}),this.keyComboEvents.on("meta+b meta+i meta+k meta+u",i.noop),this.config={placeholder:!1,onChange:function(){},onSelection:function(){},onClientEvent:function(){},pasteHook:function(){return!1},filterForSetData:function(t){return t},filterForGetData:function(t){return t},filterRules:{elements:["p","br","div"],attributes:{},remove_contents:["style","noscript","script","meta"],protocols:{}},forceSingleLine:!1,smartQuotes:{enabled:!1,config:{}}},i.extend(this.config,s||{}),this.dataFilter=new o(this.config.filterRules),this.onChange=function(){this.previousRawData!==f.call(this)&&(m.call(this),u.call(this),this.config.onChange.apply(this,arguments),this.previousRawData=f.call(this))},this.keyModifiers={shift:!1},this.undoManager=new r(this),this.config.smartQuotes.enabled&&(this.smartQuoter=new l(this)),t.call(this)};return E.prototype.getData=function(t){var e=f.call(this);e=this.config.filterForGetData.call(this,e);var i=e.replace(/<br(\s*)\/*>/gi,"\n").replace(/(<[p|div])/gi,"\n$1").replace(T,""),s=document.createElement("div");s.innerHTML=i;var o=s.textContent||s.innerText||"",n=t?o.trim():o;return n},E.prototype.setData=function(t){t=this.config.filterForSetData.call(this,t),t=this.dataFilter.filterPlaintext(t),g.call(this,t),k.call(this),this.onChange()},E.prototype.setHTML=function(t){g.call(this,t),this.onChange()},E.prototype.getHTML=function(){return f.call(this)},E.prototype.insertData=function(t,e){e&&(t=this.dataFilter.filterHTML(t)),_.call(this,t),this.onChange()},E.prototype.blur=function(){return s(this.element).blur()},E.prototype.focus=function(t){var e=s(this.element).focus();return t||this.setCursorToEnd(),e},E.prototype.hasFocus=function(){return s(this.element).is(":focus")},E.prototype.setPlaceholder=function(t){this.config.placeholder=t,u.call(this)},E.prototype.isEmpty=function(){var t=this.getData(!1);if(""===t||"\n"===t||"\r\n"===t)return!0;var e=f.call(this);return e===C||e===S||""===e},E.prototype.getCurrentElement=function(){return a.getNearestElement()},E.prototype.setCursorToStart=function(t){var e=s(this.element);t=t&&e.find(t).first().get(0)||e.children().first().get(0),t&&n.setToStart(t)},E.prototype.setCursorToEnd=function(t){var e=s(this.element);t=t&&e.find(t).last().get(0)||e.children().last().get(0),t&&n.setToEnd(t)},E.prototype.teardown=function(){this.undoManager.teardown(),this.keyComboEvents.off()},E}();e.exports=c},{"./dataFilter":503,"./debugConsole":504,"./keyComboEvents":508,"./selectionContext":515,"./selectionPersistence":516,"./smartQuoter":517,"./undoManager":518,jquery:"HlZQrA",lodash:"K2RcUv"}],513:[function(t,e){var i=t("lodash"),s=t("jquery"),o=t("velocity-animate").animate,n=t("./linkControl"),a=t("./formattingControls"),r=t("./dataFilter"),l=t("./selectionPersistence"),h=t("./selectionContext"),d=t("./inlineControls"),c=t("./utils"),u=t("./undoManager"),p=t("./smartQuoter"),m=t("./keyComboEvents"),g=t("./humanKeys"),f=(window.URL||window.webkitURL||window.mozURL||window.msURL||{}).createObjectURL,_=t("./debugConsole"),v=function(){function t(t,e){return i.mapValues(t,function(t,e){return e.match(/^on[A-Z]/)&&i.isFunction(t)?i.bind(t,this):t},e)}function e(){N.call(this,ce);var t=s("<div />",{"data-js":"editor-wrapper","class":"editor-wrapper"}).css("position","relative"),e=s("<div />",{"data-js":"editor-slot","class":"editor-slot"}).css("position","relative");s(this.element).wrap(t).wrap(e),e=s(this.element).parent(),this.wrapper=e.parent().get(0),this.placeholderElement=s("<div />",{"data-js":"editor-placeholder","class":"editor-placeholder"}).css("position","absolute"),e.append(this.contextualControls.element),e.append(this.linkControl.element),e.append(this.placeholderElement),e.append(this.inlineControls.element),O.call(this),this.controlBar=s("<div />",{"data-js":"control-bar","class":"control-bar disabled"});var o=s("<div />",{"class":"static-controls control"});this.controlBar.append(o),this.controlBar.append(this.staticControls.element);var n=this;o.on("mousedown",function(t){t.preventDefault(),t.stopPropagation();var e=h.getNodeList();n.staticControls.setActives(i.pluck(e,"nodeName"));var o=s(this).position();return n.staticControls.isShown?n.staticControls.hide():n.staticControls.open(o.left+s(this).width()/2,0),n.contextualControls.hide(),n.linkControl.close(),!1}),this.config.showStaticControls&&s(this.wrapper).append(this.controlBar),v.call(this),T.call(this)}function v(){var t=this,e=function(){var e=t.inlineControls.isTrayOpen||t.contextualControls.isShown||t.staticControls.isShown||t.linkControl.isShown;return e};s(this.element).on("input keydown keyup keypress mousedown mouseup",function(e){t.controlBar.removeClass("disabled"),t.config.onClientEvent.call(t,e)});var o=function(){U.call(this),this.onChange()};s(this.element).on("keydown",function(i){if(i.keyCode===_e.shift)t.keyModifiers.shift=!0;else{if(i.keyCode===_e.esc)return void(e()&&(t.contextualControls.hide(),t.staticControls.hide(),t.inlineControls.isTrayOpen&&t.inlineControls.toggleTrayWithIntent(!1),i.stopPropagation()));i.keyCode===_e.backspace?(S.call(t,i),K.call(t)):i.keyCode===_e.enter&&(w.call(t,i),y.call(t,i),c.browser.safari&&i.shiftKey&&(i.preventDefault(),b.call(t)))}F.call(t,i),U.call(t,i)}),s(this.element).on("keyup",function(e){e.keyCode===_e.shift?t.keyModifiers.shift=!1:e.keyCode===_e.enter?(K.call(t),x.call(t)):(e.keyCode===_e.backspace||e.keyCode===_e["delete"])&&(I.call(t),i.defer(function(){C.call(t)}));var s=!1;e.keyCode===_e.right&&!e.shiftKey&&t.inlineControls&&(s=t.inlineControls.isShown),e.keyCode===_e.esc||s||o.call(t)}),s(this.element).on("input",function(){o.call(t)});var n=!1;s(this.element).on("mouseup",function(){n=!1,U.call(t)}),s(this.element).on("mousedown",function(){n=!0}),document.addEventListener("mousedown",function(e){t.wrapper===e.target||s.contains(t.wrapper,e.target)||(n=!1,k.call(t),t.controlBar.addClass("disabled"))},!0),document.addEventListener("mouseup",function(){n&&(U.call(t),n=!1)},!0),s(this.element).on("focus",function(){t.controlBar.removeClass("disabled"),i.defer(function(){t.onChange()})}),s(this.element).on("blur",function(s){var o=function(s){if(!e()){var o=h.getSelection();o&&h.isInContext(o,t.element)&&o.removeAllRanges(),t.lastSelection=null,U.call(t,function(){t.onChange(),i.isFunction(s)&&s()})}};t.config.blurHook(s,o)||i.defer(o)}),s(this.element).on("paste",function(e){var i=(e.originalEvent||e).clipboardData;i&&(t.config.pasteHook(i,t.keyModifiers.shift)||q.call(t,i),M.call(t),e.preventDefault())}),s(this.element).on("cut",function(){t.contextualControls.hide(),t.staticControls.hide(),t.linkControl.close(),i.defer(function(){C.call(t),M.call(t),t.onChange()})})}function b(){for(var t=V.call(this),e=i.contains(me,t.nodeName)?"\n":"<br>",s=h.isCursorAtEnd(t)&&!h.isCursorAtStart(t)?1:0,o=0;s>o;o++)e+=e;H.call(this,e)}function y(t){var e,o,n=h.getNodeByNames(me);n&&!this.keyModifiers.shift&&h.isCursorAtEnd(n)&&(o=s(n),e=o.text(),t.preventDefault(),e.match(/\n\n$/)?(i.last(o.contents()).remove(),this.insertNewParagraphAfter(n)):(o.append("\n\n"),l.setToEnd(n)))}function w(t){var e=h.getNodeByNames(["BLOCKQUOTE"]);if(e&&!this.keyModifiers.shift&&h.isCursorAtEnd(e)){t.preventDefault();var i="BR"===e.lastChild.nodeName?e.lastChild:null;if(!i){var o=document.createElement("br");s(e).append(o),i=o}if(i.previousSibling&&"BR"===i.previousSibling.nodeName)s(i).remove(),this.insertNewParagraphAfter(e);else{var n=document.createElement("br"),a=document.createElement("span");s(e).append(n),s(e).append(a),l.setToStart(a),s(a).remove()}}}function x(){var t=h.getNodeByNames(["BLOCKQUOTE"]);if(t){var e=h.getNodeByNames(pe),i=e===t,o=s(e).is(":last-child");i&&this.dataFilter.isEmptyElement(t)?E.call(this,"formatBlock","p"):!i&&this.dataFilter.isEmptyElement(e)&&o&&(s(e).remove(),s(t).find("p").each(function(){s(this).find("br:last-child").length||s(this).append("<br>"),s(this).contents().unwrap()}),this.insertNewParagraphAfter(t))}}function k(){this.contextualControls.hide(),this.staticControls.hide(),this.linkControl.close(),this.inlineControls.close()}function C(){if(!s(this.element).has(fe.join()).length){var t=s(this.element).find("ul:not(:has(li)),ol:not(:has(li))");t.remove();var e=i.some(s(this.element).children().toArray(),function(t){return s(t).text().length>0});e||(N.call(this,""),K.call(this),O.call(this))}}function S(t){var e=h.getSelection();if(e.isCollapsed){var i=V.call(this);if(i&&!(l.saveSelection(i).start>0)){var o=s(i).prev().get(0);o&&le.call(this,o)&&(s(o).remove(),t.preventDefault())}}}function T(){var t=this,e=s(t.element).offset().top,o=null,n="dragstart dragenter dragleave dragover dragend drop",a=!1,r=function(t){var e=t.dataTransfer.types&&i.some(t.dataTransfer.types,function(t){return"Files"===t});return e},l=function(t){return"false"===s(t.target||t.srcElement).attr("contenteditable")},h=function(e,s,o){e.length&&(t.onChange(),i.each(e,function(e){t.config.onFileAdded.call(t,e,s,o)}),U.call(t))},d=function(t,e){return t<e.top+.66*e.height},c=function(t,i){var o=s(i).offset().top-e,n=s(i).get(0).getBoundingClientRect().height,a=t>o+.66*n;return{element:i,top:o,bottom:o+n,height:n,isAfter:a}},u=function(){s(t.element).find(".over-top, .over-bottom").each(function(){s(this).removeClass("over-top").removeClass("over-bottom"),""===s(this).attr("class").trim()&&s(this).removeAttr("class")})},p=function(i){var n=null,a=i.pageY-e,r=s(t.element).children();o&&a>o.top&&d(a,o)||(r.each(function(){var t=c(a,this);return d(a,t)&&(i.target||i.srcElement)!==this?(n=t,!1):void 0}),n||(n=c(a,r.last().get(0)),n.isAfter=!0),n&&o&&o.element===n.element&&o.isAfter===n.isAfter||(u(),o=n))};s(t.element).unbind(n),s(t.element).on("dragleave",function(){u()}),s(t.element).on("dragover",function(t){return a?(i.debounce(p,100)(t.originalEvent),o&&(s(o.element).addClass(o.isAfter?"over-bottom":"over-top"),r(t.originalEvent)&&t.stopPropagation()),void t.preventDefault()):(t.preventDefault(),void t.stopPropagation())}),s(t.element).on("dragenter",function(t){t.preventDefault(),r(t.originalEvent)&&(a="file")}),s(t.element).on("dragstart",function(e){if(k.call(t),l(e.originalEvent)){a="media";var o=e.originalEvent.target||e.originalEvent.srcElement,n=e.originalEvent.dataTransfer;if(n){n.effectAllowed="move",n.dropEffect="move";try{var r=s(o).find("img").attr("src")||"";r.match(/^\s*data:/)&&(r=""),n.setData("text/uri-list",r),n.setData("text/plain",r)}catch(e){}}i.defer(function(){s(o).addClass("dragging")})}}),s(t.element).on("drop",function(t){u(),r(t.originalEvent)&&h(t.originalEvent.dataTransfer.files,o.element,o.isAfter?1:-1),t.stopPropagation(),t.preventDefault()}),s(t.element).on("dragend",function(e){if(l(e.originalEvent)){u();var i=e.originalEvent.target||e.originalEvent.srcElement,n=s(i).data("origHeight"),r=i;if(o&&r!==o.element){var h=s(i).remove();o.isAfter?s(o.element).after(h):s(o.element).before(h),oe.call(t,h)}s(r).animate({height:n},200,function(){s(r).removeClass("dragging")}),t.onChange(),U.call(t)}a=!1})}function $(t,e,i){var o=s(this.element),n=l.saveSelection(this.element);o.find(i).wrap("<"+e+">"),o.find(i).contents().unwrap(),l.restoreSelection(n),window.document.execCommand(t),o.find(e).wrap("<"+i+">"),o.find(e).contents().unwrap(),l.restoreSelection(n)}function E(t,e,o){var n=this,a=function(){window.document.execCommand(t),n.config.flattenBlocks&&A.call(n)},r=function(){var t=l.saveSelection(n.element),e=200,i=240;!o||o.isAnimating||t.selection.isCollapsed||setTimeout(function(){s(n.linkControl.linkEditInput).focus();var a=function(i,o){var a=i-s(n.wrapper).offset().left,r=o-s(n.wrapper).offset().top;n.linkControl.size(e),n.linkControl.show(a,r),n.linkControl.createLink(t)};o.closeWithShim(o.element.find(".link").get(0),e,i,a),t.selection.removeAllRanges(),n.blur(!0)},30)},d=function(t){var e=h.getNodeByNames(["BLOCKQUOTE"]);e&&(R.call(n,"formatBlock",e.nodeName.toLowerCase()),n.dataFilter.inlinify(e,!0));var i=h.getNodeByNames(me);i&&R.call(n,"formatBlock",i.nodeName.toLowerCase()),P.call(n,["UL","OL"]);var s=window.document.execCommand("formatBlock",!1,"<"+t+">");s||"blockquote"!==t||window.document.execCommand("indent"),j.call(this)},c=function(){var t=n.contextualControls.controls,e=n.contextualControls.getActiveStates();i.each(e,function(e,i){var s=t[i];e&&R.call(n,s.command,s.el)}),window.document.execCommand("removeFormat")};switch(t){case"formatBlock":d(e);break;case"createLink":r();break;case"insertOrderedList":a();break;case"insertUnorderedList":a();break;case"removeFormat":c();break;case"insertHTML":$.call(this,"underline","U",e);break;default:window.document.execCommand(t)}U.call(this),I.call(this),n.onChange()}function R(t,e){switch(t){case"formatBlock":switch(e){case"blockquote":P.call(this,["UL","OL"]);break;default:window.document.execCommand("formatBlock",!1,"<p>")}A.call(this);break;case"insertOrderedList":P.call(this,"OL");break;case"insertUnorderedList":P.call(this,"UL");break;case"createLink":window.document.execCommand("unlink");break;case"insertHTML":$.call(this,"underline","U",e);break;default:window.document.execCommand(t)}I.call(this),U.call(this),this.onChange()}function F(t){var e=function(){var t=h.getNodeByNames(["UL","OL"]);return!!t};t.keyCode===_e.tab&&e()&&(t.preventDefault(),t.stopPropagation(),t.shiftKey?(E.call(this,"outdent"),e()||E.call(this,"formatBlock","p")):E.call(this,"indent"))}function j(){var t=h.getNodeByNames(me);t&&s(t).find("br").replaceWith("\n")}function P(t){for(var e=["UL","OL"],s=!1,o=null;o=h.getNodeByNames(t);)window.document.execCommand(i.contains(e,o.nodeName)?"outdent":"outdent");s||h.getNodeByNames(["H2"])||window.document.execCommand("formatBlock",!1,"<p>"),this.dataFilter.blockifyInlineNodes(this.element)}function A(){var t=l.saveSelection(this.element),e=h.getNodeList(null,!0);this.dataFilter.unwrapParentBlocks(e),l.restoreSelection(t)}function I(){var t=l.saveSelection(this.element),e=h.getNodeList(),i=this.dataFilter.scrubSpansAndBadAttrs(e);i&&t.end>t.start&&l.restoreSelection(t)}function U(t){var e=this;setTimeout(function(){var s=h.getSelection();return s?(s.isCollapsed?D.call(e,s):L.call(e,s),ee.call(e),W.call(e),e.config.onSelection.call(e,s),h.isInContext(s,e.element)&&(e.lastSelection=l.saveSelection(e.element)),M.call(e),O.call(e),void(i.isFunction(t)&&t())):(ee.call(e),void(i.isFunction(t)&&t()))},20)}function L(t){if(h.isInContext(t,this.element)){var e=h.getContextCoordinates(s(this.element).parent().parent()),o=h.getNodeList(t);this.contextualControls.setActives(i.pluck(o,"nodeName")),this.staticControls.setActives(i.pluck(o,"nodeName")),this.linkControl.close(),this.inlineControls.close(),""!==t.toString().trim()&&e&&!this.staticControls.isShown&&this.contextualControls.open(e.x,e.y)}}function D(t){this.contextualControls.hide();var e=h.getNodeList(t),o=i.find(e,function(t){return"A"===t.nodeName});if(this.linkControl.isValidLink(o)){var n=h.getContextCoordinates(s(this.element).parent().parent(),o);this.linkControl.showOptions(o),this.linkControl.showOverTarget(n.x,n.y)}else this.linkControl.close();this.staticControls.setActives(i.pluck(e,"nodeName"))}function M(){var t=h.getSelection(),e=t&&t.isCollapsed;if(!e||!h.isInContext(t,this.element))return void this.inlineControls.close();var i=V.call(this);if(i&&"P"===i.nodeName&&this.dataFilter.isEmptyElement(i)&&!this.isEmpty())this.inlineControls.open(i);else if(this.isEmpty()){this.inlineControls.open(i);var s=c.calcTextWidth(this.placeholderElement,this.config.placeholder);this.inlineControls.open(i,s)}else this.inlineControls.close()}function O(){var t=this.isEmpty()?this.config.placeholder:"",e=s(this.placeholderElement);e.html(t);var i=e.outerHeight();i&&s(this.element).css("min-height",Math.max(parseInt(e.css("min-height"),10)||0,i))}function q(t){var e="";if(t.items&&t.items.length){var o=i.find(t.items,function(t){return/image\/\w+/.test(t.type)});if(o){var n=o.getAsFile();if(n)return void this.config.onFileAdded.call(this,n)}}i.contains(t.types,"text/html")?e=t.getData("text/html"):(e=t.getData("text/plain"),e=this.dataFilter.filterPlaintext(e,!0)),e=e.replace(new RegExp("</t(d|h)></tr>","g"),"<br></td></tr>"),e=e.replace(/\u00a0/g," "),e=this.dataFilter.filterHTML(e),e=this.dataFilter.convertToBrowserSpaces(e);var a=document.createElement("div");a.innerHTML=e,this.dataFilter.flattenBlocksDown(a,!0),s(a).find(fe.join()).remove();var r=i.some(a.children,function(t){return i.contains(pe,t.nodeName)});if(r){var l=h.getSelection(),d=l.getRangeAt(0);d.deleteContents();var c=V.call(this);if(""===s(c).text().trim()){var u=s(c).index(),p=s(c).parent(),m=u+a.children.length-1;s(c).replaceWith(a.children);var g=s(p).children().eq(m).get(0);d.selectNodeContents(g),d.collapse(!1),l.removeAllRanges(),l.addRange(d)}else this.dataFilter.inlinify(a),H.call(this,a.innerHTML)}else H.call(this,a.innerHTML);this.onChange()}function N(t){s(this.element).html(t)}function B(){return s(this.element).html().trim()}function H(t){if(!t)return void _.warn("Cannot insert empty data");var e=h.getSelection();if(!e||!e.focusNode)return void _.warn("Cannot insert without the editor having a cursor or selection");var i=e.getRangeAt(0);i.deleteContents(),t=this.dataFilter.convertToBrowserSpaces(t);var s=document.createElement("div");s.innerHTML=t;for(var o,n=s.lastChild,a=document.createDocumentFragment();o=s.firstChild;)a.appendChild(o);i.insertNode(a),i.setStartAfter(n),i.collapse(!1),e.removeAllRanges(),e.addRange(i)}function z(){var t=V.call(this);if(!t){var e=s(this.element).children(pe.join());if(!e.length)return null;t=e.last().get(0)}return t}function V(){var t=h.getSelection()||this.lastSelection;return h.getNodeByNames(pe,!0,t)}function K(){var t=z.call(this);if(t){if("div"===t.nodeName.toLowerCase())try{window.document.execCommand("formatBlock",!1,"<p>")}catch(e){}}else N.call(this,ce),this.setCursorToStart()}function W(){var t=s(this.element).children(ge.join()).last().get(0);t||s(this.element).append(ce)}function G(t,e,o,n,a){var r=this,l=function(t){var l,h,d,c,u=i.uniqueId(),p=0===t.lastIndexOf("data:",0)?"file":t;r.mediaTracker[u]={originalSource:p,file:e},h=s("<img />",{src:t}),l=h.get(0),c=s("<figure />"),d=c.get(0),h.attr(r.config.imgKeyAttr,u),c.append(h),X.call(r,d,o,n,a),J.call(r,l,function(i){Q.call(r,l,i),r.config.onAsyncImageAdded.call(r,u,t,e,i||{})}),r.onChange()};if(!t&&e)if(f)l(f(e));else{var h=new FileReader;h.onload=function(t){l(t.target.result)},h.readAsDataURL(e)}else{if("string"!=typeof t)return void _.warn("Unknown source type for inserting an image.");l(t)}}function Q(t,e){var o,n={},a=this.config,r=s(t).parent("figure").get(0),l={toImg:t,toImgParent:r};a.addImgAttrs&&(o=i.reduce(l,function(t,e,i){return(a.addImgAttrs===!0||a.addImgAttrs[i]===!0)&&t.push(e),t},[])),i.isEmpty(o)||!a.imgSizeAttrs||i.isEmpty(e)||(a.imgSizeAttrs.height&&(n[a.imgSizeAttrs.height]=e.height),a.imgSizeAttrs.height&&(n[a.imgSizeAttrs.width]=e.width),s(o).attr(n))}function J(t,e){var o=function(t){var s={width:t.naturalWidth,height:t.naturalHeight};i.isFunction(e)&&e.call(this,s)};t.complete?o.call(this,t):s(t).one({"load.getImageAttributes":i.bind(i.partial(o,t),this),error:i.bind(function(){s(t).off(".getImageAttributes"),e.call(this,null)},this)})}function Z(t){return s(this.element).find("img["+this.config.imgKeyAttr+'="'+t+'"]').get(0)}function Y(t,e,o){var n=Z.call(this,t);i.isEmpty(o)||Q.call(this,n,o),e&&(s(n).attr("src",e),this.mediaTracker[t].updatedSource=e)}function X(t,e,i,o){var n;e=e||z.call(this),n=this.dataFilter.isEmptyElement(e.outerHTML,!0)?0:h.isCursorAtStart(e)?-1:1,i="number"==typeof i?i:n;var a=s(t).get(0),r=se.call(this,a);oe.call(this,r),0>i?s(e).before(r):i>0?s(e).after(r):0===i&&s(e).replaceWith(r),k.call(this);var d=s(r).nextAll(ge.join()).get(0);d||(d=s(ce).get(0),s(r).after(d)),o||(this.focus(!0),l.setToStart(d)),te.call(this,r,!1,U)}function te(t,e,n){var a=this;e=e||!1,n=n||i.noop;var r=s(t),l=r.find("figure"),h=r.find(".media-button"),d=200;return r.length&&l.length?(e&&h.length&&h.hide(),o(l,{opacity:e?0:[1,0],translateY:e?-25:[0,-25]},{duration:.9*d,easing:"easeOutQuad",complete:function(){l.removeAttr("style")}}),void o(t,e?"slideUp":"slideDown",{duration:d,easing:"easeOutQuart",begin:function(){r.css("pointer-events","none")},complete:function(){r.css("pointer-events",""),n.call(a,t)}})):void n.call(a)}function ee(){var t=this,e=V.call(this);s(e).removeClass(t.config.fakeClass),s(t.element).children("p").each(function(i,o){e!==o&&t.dataFilter.isEmptyElement(o)&&(0===i&&le.call(t,s(o).next().get(0))||s(o).is(":last-child")&&le.call(t,s(o).prev().get(0))?ie.call(t,o):le.call(t,s(o).prev().get(0))&&le.call(t,s(o).next().get(0))?ie.call(t,o):s(o).hasClass(t.config.fakeClass)&&s(o).remove()),void 0!==s(o).attr("class")&&""===s(o).attr("class").trim()&&s(o).removeAttr("class")}),s(this.element).children("."+this.config.mediaHolderClass).each(function(){var e=s(this).next().get(0);(!e||le.call(t,e))&&s(this).after(ie.call(t));var i=s(this).prev().get(0);i||s(this).before(ie.call(t))})}function ie(t){return t=t||s(ce).get(0),s(t).addClass(this.config.fakeClass),t}function se(t){var e=s(t),o=s("<div />",{"class":this.config.mediaHolderClass,contentEditable:!1,draggable:!0});e.wrap(o),o=e.parent(),i.isFunction(this.config.mediaHolderCallback)&&this.config.mediaHolderCallback(this,t,e,o);var n=s(this.config.mediaKillerMarkup);n.addClass("media-killer"),o.append(n);var a=!o.hasClass("media-holder-draggable");if(a){var r=s(this.config.mediaMoverMarkup);r.addClass("media-mover"),o.append(r)}return o}function oe(t){var e=this,i=t?s(t):s(this.element).find('[contenteditable="false"]'),o=this.config.mediaHolderEvents;i.each(function(t,i){var n=s(i),a=null;n.off("keydown").on("keydown",function(t){o.keydown.call(null,t,n),t.isPropagationStopped()||((t.keyCode===_e["delete"]||t.keyCode===_e.backspace)&&n.remove(),t.preventDefault(),t.stopPropagation())}),n.off("keyup").on("keyup",function(t){o.keyup.call(null,t,n)}),n.on("mousedown",function(t){a=t.originalEvent.target,o.mousedown.call(null,t,n,a)}),n.on("mouseup",function(t){o.mouseup.call(null,t,n,a);var i=s(a);i.hasClass("media-killer")&&a===t.target&&te.call(e,n,!0,function(){n.remove(),C.call(e),U.call(e),e.onChange()})}),n.on("mouseenter",function(t){s(t.currentTarget).addClass("show-controls"),o.mouseenter.call(null,t,n,a)}),n.on("mouseleave",function(t){s(t.currentTarget).removeClass("show-controls"),o.mouseleave.call(null,t,n,a)}),n.on("dragstart",function(t){var e=s(a);e.hasClass("media-killer")&&(t.preventDefault(),t.stopPropagation()),n.hasClass("media-holder-draggable")||e.hasClass("media-mover")||(t.preventDefault(),t.stopPropagation()),o.dragstart.call(null,t,n,a)})})}function ne(t){i.each(s(t).find("."+this.config.mediaHolderClass),function(t){s(t).find(".media-killer, .media-mover").remove();var e=s(t).children().first();e.length?s(e).unwrap():(s(t).contents().wrap("<div>"),s(t).children().first().unwrap().contents().unwrap())})}function ae(t){var e=this,o=s(t).find("."+this.config.fakeClass+", ."+this.config.fakeClass+"-intent");i.each(o,function(t){e.dataFilter.isEmptyElement(t)&&s(t).remove()})}function re(){var t=this;i.each(s(this.element).find(fe.join()),function(e){var s=h.getParentNodes(e),o=i.some(s,function(t){return i.contains(fe,t.nodeName)});he.call(t,e)||o||se.call(t,e)})}function le(t){return s(t).hasClass(this.config.mediaHolderClass)}function he(t){var e=s(t).closest("[class="+this.config.mediaHolderClass+"]");return e.length?e.get(0):null}function de(t,e,o){var n,a;return e=i.isBoolean(e)?e:!1,t=t||z.call(this),n=s(t)[e?"prev":"next"](),!o&&n.length>0&&this.dataFilter.isEmptyElement(n)?(l.setToStart(n.get(0)),n):(a=s(ce).get(0),s(t)[e?"before":"after"](a),l.setToStart(a),a)}var ce="<p><br></p>",ue="<p></p>",pe=["P","FIGURE","H2","BLOCKQUOTE","UL","OL","DIV","PRE"],me=["PRE"],ge=["P","H2","BLOCKQUOTE","UL","OL","PRE"],fe=["IMG","IFRAME","FIGURE","HR"],_e={shift:16,enter:13,esc:27,backspace:8,"delete":46,tab:9,right:39},ve=function(o,c){if(!o)throw new Error("A valid element parameter is required to initalize the editor");c=c||{},this.element=o,this.humanKeys=new g,this.keyComboEvents=c.keyComboEvents||new m({element:this.element,humanKeys:this.humanKeys});var f=i.template("<%= title %> (<%= shortcut %>)"),_=i.bind(function(t,e){return f({title:t,shortcut:this.humanKeys.pretty(e)})},this);this.config={placeholder:!1,onChange:i.noop,onSelection:function(){},onAsyncImageAdded:function(){},onFileAdded:function(){},onClientEvent:function(){},flattenBlocks:!0,smartQuotes:{enabled:!1,config:{}},runIFrameSanitization:!1,mediaHolderClass:"media-holder",mediaHolderCallback:function(t,e,s,o){s.is("hr, img, figure")&&i.isEmpty(s.find("iframe"))&&o.addClass("media-holder-draggable"),o.addClass("media-holder-"+s.prop("tagName").toLowerCase())},mediaHolderEvents:{keydown:i.noop,keyup:i.noop,mousedown:i.noop,mouseup:i.noop,mouseenter:i.noop,mouseleave:i.noop,click:i.noop,dragstart:i.noop},imgKeyAttr:"data-img-key",imgSizeAttrs:{width:"data-orig-width",height:"data-orig-height"},addImgAttrs:{toImg:!1,toImgParent:!1},fakeClass:"fake",mediaKillerMarkup:"<div>×</div>",mediaMoverMarkup:"<div>&#8597;</div>",pasteHook:function(){return!1},blurHook:function(){return!1},filterForSetData:function(t){return t},filterForGetData:function(t){return t},filterRules:{elements:["a","b","i","ul","ol","li","p","h2","blockquote","img","iframe","figure","br","hr","pre","sub","sup","small"],attributes:{a:["href","title"],img:["src","alt","data-orig-width","data-orig-height"],hr:["data-label"],iframe:["src","width","height","frameborder"],figure:["data-orig-width","data-orig-height"]},classnames:{hr:["read-more"]},remove_contents:["style","noscript","script","meta"],protocols:{a:{href:["http","https","mailto"]}}},animateShowControls:function(t){t.element.show()},animateHideControls:function(t){t.element.hide()},linkConfig:{bypassClasses:[],onChange:function(){this.onChange.call(this)},onDismiss:function(){this.lastSelection&&(l.restoreSelection(this.lastSelection),U.call(this))}},inlineControlsConfig:{openTray:d.prototype.openTray,closeTray:d.prototype.closeTray,onTrayOpened:function(){},onTrayClosed:function(){},keyboardEvents:this.keyComboEvents},formattingControlsConfig:{controls:{bold:{el:"b",className:"bold",command:"bold",type:"inline",title:_("Bold","meta+b"),keyboard:"meta+b"},italic:{el:"i",className:"italic",command:"italic",type:"inline",title:_("Italic","meta+i"),keyboard:"meta+i"},headline:{el:"h2",className:"headline",command:"formatBlock",type:"block",title:_("Headline","meta+shift+2"),keyboard:"meta+shift+2"},link:{el:"a",className:"link",command:"createLink",type:"inline",title:_("Link","meta+k"),keyboard:"meta+k"},strikethrough:{el:"strike",className:"strikethrough",command:"strikethrough",type:"inline",title:_("Strikethrough","meta+shift+6"),keyboard:"meta+shift+6"},orderedList:{el:"ol",className:"ordered-list",command:"insertOrderedList",type:"list",title:_("Ordered List","meta+shift+7"),keyboard:"meta+shift+7"},unorderedList:{el:"ul",className:"unordered-list",command:"insertUnorderedList",type:"list",title:_("Unordered List","meta+shift+8"),keyboard:"meta+shift+8"},blockquote:{el:"blockquote",className:"quote",command:"formatBlock",type:"block",title:_("Blockquote","meta+shift+9"),keyboard:"meta+shift+9"},clear:{el:"",command:"removeFormat",type:"inline",keyboard:"meta+shift+0"},pre:{el:"pre",command:"formatBlock",type:"block",keyboard:"meta+alt+1"},superscript:{el:"sup",command:"superscript",type:"inline",keyboard:"meta+dot"},subscript:{el:"sub",command:"subscript",type:"inline",keyboard:"meta+comma"},small:{el:"small",command:"insertHTML",type:"inline",keyboard:"meta+shift+minus",keyboardInverse:"meta+shift+plus"}},controlsOrder:["bold","italic","headline","link","strikethrough","orderedList","unorderedList","blockquote"],onShow:function(t){i.isFunction(this.animateShowControls)?this.animateShowControls.call(this,t):t.element.show()},onHide:function(t){i.isFunction(this.animateHideControls)?this.animateHideControls.call(this,t):t.element.hide()},onAction:function(t){var e=h.getNodeList();t.setActives(e)}},showStaticControls:!0},i.merge(this.config,c||{}),this.applyCommand=i.bind(E,this),this.inverseCommand=i.bind(R,this),this.animateShowControls=i.bind(this.config.animateShowControls,this),this.animateHideControls=i.bind(this.config.animateHideControls,this),this.onChange=function(){var t=B.call(this);this.previousRawData!==t&&(O.call(this),this.config.onChange.call(this),this.previousRawData=t)};var v=t(this.config.linkConfig,this);this.linkControl=new n(v);var b=t(this.config.inlineControlsConfig,this);this.inlineControls=new d(b);var y=t(i.defaults({keyboardEvents:this.keyComboEvents},this.config.formattingControlsConfig),this);this.contextualControls=new a(this.applyCommand,this.inverseCommand,y);var w=this.config.formattingControlsConfig.onShow,x=this.config.formattingControlsConfig.onHide,k=t(i.defaults({onShow:function(t){w.apply(this,arguments),t.listener=t.listener||function(){var e=h.getNodeList();t.setActives(e),document.removeEventListener("mousedown",t.listener,!1)},document.addEventListener("mousedown",t.listener)},onHide:function(t){x.apply(this,arguments),document.removeEventListener("mousedown",t.listener,!1)
}},this.config.formattingControlsConfig),this);this.staticControls=new a(this.applyCommand,this.inverseCommand,k),this.dataFilter=new r(this.config.filterRules),this.keyModifiers={shift:!1},this.undoManager=new u(this,i.bind(function(){for(var t in this.mediaTracker){var e=this.mediaTracker[t].updatedSource;if(e){var i=Z.call(this,t);s(i).attr("src",e)}}M.call(this)},this)),this.config.smartQuotes.enabled&&(this.smartQuoter=new p(this,this.config.smartQuotes.config)),this.mediaTracker={},e.call(this)};return ve.prototype.getData=function(t,e){var o=this,n=B.call(this);n=this.config.filterForGetData.call(this,n),this.config.runIFrameSanitization&&(n=this.dataFilter.unSanitizeIFrames(n));var a=document.createElement("div");if(a.innerHTML=n,ne.call(this,a),ae.call(this,a),e||s(a).find("["+o.config.imgKeyAttr+"]").removeAttr(o.config.imgKeyAttr),t)for(var r=function(t){var e=s(a).children(":"+t+"-child").get(0);return e&&o.dataFilter.isEmptyElement(e,!0)?e:null},l=function(){return i.compact([r("first"),r("last")])};l().length;)i.forEach(l(),function(t){s(t).remove()});return a.innerHTML},ve.prototype.setData=function(t,e,i){e&&(t=this.config.filterForSetData.call(this,t),t=this.dataFilter.filterHTML(t)),this.config.runIFrameSanitization&&(t=this.dataFilter.sanitizeIFrames(t)),N.call(this,t),i?this.dataFilter.flattenBlocksDown(this.element):this.dataFilter.blockifyInlineNodes(this.element),K.call(this),re.call(this),oe.call(this),W.call(this),this.onChange()},ve.prototype.insertData=function(t,e,i){e&&(t=this.dataFilter.filterHTML(t)),H.call(this,t),i&&this.dataFilter.flattenBlocksDown(h.getNearestElement()),this.onChange()},ve.prototype.blur=function(t){return t||k.call(this),s(this.element).blur()},ve.prototype.focus=function(t){var e=s(this.element).focus();return t||this.setCursorToEnd(),e},ve.prototype.hasFocus=function(){return s(this.element).is(":focus")},ve.prototype.setPlaceholder=function(t){this.config.placeholder=t,O.call(this)},ve.prototype.insertMedia=function(t,e,i,s){e&&(t=this.dataFilter.filterHTML(t)),X.call(this,t,i,s),this.onChange()},ve.prototype.addControl=function(t){var e=s(this.wrapper).find("[data-js=control-bar]");e.append(t)},ve.prototype.isEmpty=function(){var t=B.call(this);return""===t||"<br>"===t||t===ce||t===ue},ve.prototype.getCurrentElement=function(){return h.getNearestElement()},ve.prototype.getAsyncImage=function(t){return Z.call(this,t)},ve.prototype.insertAsyncImage=function(t,e,i,s,o){G.call(this,t,e,i,s,o),this.onChange()},ve.prototype.updateAsyncImage=function(t,e,i){Y.call(this,t,e,i),this.onChange("updateAsyncImage")},ve.prototype.setCursorToStart=function(t,e){var i=s(this.element);t=t&&i.find(t).first().get(0)||i.children().first().get(0),t&&l.setToStart(t),e||U.call(this)},ve.prototype.setCursorToEnd=function(t,e){var i=s(this.element);t=t&&i.find(t).last().get(0)||i.children().last().get(0),t&&l.setToEnd(t),e||U.call(this)},ve.prototype.insertNewParagraphAfter=function(t,e){return de.call(this,t,!1,e)},ve.prototype.insertNewParagraphBefore=function(t,e){return de.call(this,t,!0,e)},ve.prototype.isEmptyElement=function(t){return t=t||z.call(this),this.dataFilter.isEmptyElement(t)},ve.prototype.hasSelection=function(t){return t=t||z.call(this),h.hasSelection(t)},ve.prototype.isCursorAtEnd=function(t){return t=t||z.call(this),h.isCursorAtEnd(t)},ve.prototype.isCursorAtStart=function(t){return t=t||z.call(this),h.isCursorAtStart(t)},ve.prototype.teardown=function(){this.undoManager.teardown(),this.keyComboEvents.off()},ve}();e.exports=v},{"./dataFilter":503,"./debugConsole":504,"./formattingControls":505,"./humanKeys":506,"./inlineControls":507,"./keyComboEvents":508,"./linkControl":510,"./selectionContext":515,"./selectionPersistence":516,"./smartQuoter":517,"./undoManager":518,"./utils":519,jquery:"HlZQrA",lodash:"K2RcUv","velocity-animate":"lWl/mc"}],514:[function(t,e){function i(){var t,e;for(e=arguments[0]||{},this.config={},this.config.elements=e.elements?e.elements:[],this.config.attributes=e.attributes?e.attributes:{},this.config.attributes[i.ALL]=this.config.attributes[i.ALL]?this.config.attributes[i.ALL]:[],this.config.allow_comments=e.allow_comments?e.allow_comments:!1,this.allowed_elements={},this.config.protocols=e.protocols?e.protocols:{},this.config.classnames=e.classnames?e.classnames:{},this.config.add_attributes=e.add_attributes?e.add_attributes:{},this.dom=e.dom?e.dom:document,t=0;t<this.config.elements.length;t++)this.allowed_elements[this.config.elements[t]]=!0;if(this.config.remove_element_contents={},this.config.remove_all_contents=!1,e.remove_contents)if(e.remove_contents instanceof Array)for(t=0;t<e.remove_contents.length;t++)this.config.remove_element_contents[e.remove_contents[t]]=!0;else this.config.remove_all_contents=!0;this.transformers=e.transformers?e.transformers:[]}i.REGEX_PROTOCOL=/^([A-Za-z0-9\+\-\.\&\;\*\s]*?)(?:\:|&*0*58|&*x0*3a)/i,i.RELATIVE="__RELATIVE__",i.ALL="__ALL__",i.prototype.clean_node=function(t){function e(t,e){var i;for(i=0;i<e.length;i++)if(e[i]===t)return i;return-1}function s(){var t,e,i=[],s={};for(t=0;t<arguments.length;t++)if(arguments[t]&&arguments[t].length)for(e=0;e<arguments[t].length;e++)s[arguments[t][e]]||(s[arguments[t][e]]=!0,i.push(arguments[t][e]));return i}function o(t){var e;switch(t.nodeType){case 1:a.call(this,t);break;case 3:e=t.cloneNode(!1),this.current_element.appendChild(e);break;case 5:e=t.cloneNode(!1),this.current_element.appendChild(e);break;case 8:this.config.allow_comments&&(e=t.cloneNode(!1),this.current_element.appendChild(e));break;default:console&&console.log&&console.log("unknown node type",t.nodeType)}}function n(t,i){for(var s=[],o=0;o<t.length;o++)-1!==e(t[o],i)&&s.push(t[o]);return s}function a(t){var a,l,h,d,c,u,p,m,g,f,_,v=r.call(this,t);if(t=v.node,h=t.nodeName.toLowerCase(),l=this.current_element,this.allowed_elements[h]||v.whitelist){this.current_element=this.dom.createElement(t.nodeName),l.appendChild(this.current_element);var b=this.config.attributes;for(d=s(b[h],b[i.ALL],v.attr_whitelist),this.config.classnames[h]&&this.config.classnames[h].length&&d.push("class"),a=0;a<d.length;a++){u=d[a];var y="object"==typeof d[a]||d[a]instanceof Object;u=y?d[a].name:d[a],c=t.attributes[u],c&&(m=c.value,_=!0,this.config.protocols[h]&&this.config.protocols[h][u]&&(g=this.config.protocols[h][u],f=c.value.toLowerCase().match(i.REGEX_PROTOCOL),_=f?-1!==e(f[1],g):-1!==e(i.RELATIVE,g)),"class"===u&&this.config.classnames[h]&&(m=n(m.split(" "),this.config.classnames[h]).join(" "),_=!!m),y&&(_=c.value.toLowerCase().match(d[a].value)),_&&(p=document.createAttribute(u),p.value=m,this.current_element.setAttributeNode(p)))}if(this.config.add_attributes[h])for(u in this.config.add_attributes[h])p=document.createAttribute(u),p.value=this.config.add_attributes[h][u],this.current_element.setAttributeNode(p)}else if(-1!==e(t,this.whitelist_nodes)){for(this.current_element=t.cloneNode(!0);this.current_element.childNodes.length>0;)this.current_element.removeChild(this.current_element.firstChild);l.appendChild(this.current_element)}if(!this.config.remove_all_contents&&!this.config.remove_element_contents[h])for(a=0;a<t.childNodes.length;a++)o.call(this,t.childNodes[a]);this.current_element.normalize&&this.current_element.normalize(),this.current_element=l}function r(t){var i,o,n,a={attr_whitelist:[],node:t,whitelist:!1};for(i=0;i<this.transformers.length;i++)if(n=this.transformers[i]({allowed_elements:this.allowed_elements,config:this.config,node:t,node_name:t.nodeName.toLowerCase(),whitelist_nodes:this.whitelist_nodes,dom:this.dom}),null!==n){if("object"!=typeof n)throw new Error("transformer output must be an object or null");if(n.whitelist_nodes&&n.whitelist_nodes instanceof Array)for(o=0;o<n.whitelist_nodes.length;o++)-1===e(n.whitelist_nodes[o],this.whitelist_nodes)&&this.whitelist_nodes.push(n.whitelist_nodes[o]);a.whitelist=n.whitelist?!0:!1,n.attr_whitelist&&(a.attr_whitelist=s(a.attr_whitelist,n.attr_whitelist)),a.node=n.node?n.node:a.node}return a}var l=this.dom.createDocumentFragment();this.current_element=l,this.whitelist_nodes=[];for(var h=0;h<t.childNodes.length;h++)o.call(this,t.childNodes[h]);return l.normalize&&l.normalize(),l},e.exports=i},{}],515:[function(t,e){var i=t("lodash"),s=t("jquery"),o=function(){var t={getParentNodes:function(e,i){if(i=i||[],!e||t.isEditorNode(e))return i;var s=e.parentNode;return t.isEditorNode(s)?i:s?(i.push(s),t.getParentNodes(s,i)):i},getNodeList:function(e,s){e=e||t.getSelection();var o=e&&e.anchorNode?e.anchorNode:null;if(!o||t.isEditorNode(o))return[];var n=e.focusNode,a=[o];n&&!t.isEditorNode(n)&&(a=a.concat([n]));var r=t.getParentNodes(o);if(a=a.concat(r),!s){var l=t.getParentNodes(n);a=a.concat(l)}var h=i.union(a);return h},getNodeByNames:function(e,s,o){var n=[].concat(e),a=t.getNodeList(o);return i.find(s?a.reverse():a,function(t){return i.contains(n,t.nodeName)})},getNearestElement:function(e){e=e||t.getSelection();var s=t.getNodeList();return i.find(s,function(t){return 1===t.nodeType})},getContextCoordinates:function(e,i){var o=t.getSelection(),n=o.getRangeAt(0).cloneRange(),a=s(e).offset();if(i||!o.isCollapsed){var r=(i||n).getBoundingClientRect();return{x:r.left+r.width/2-a.left,y:r.top-a.top+s(window).scrollTop()}}if(n.getClientRects){n.collapse(!0);var l=n.getClientRects()[0];if(l)return{x:l.left-a.left,y:l.top-a.top+s(window).scrollTop()}}},getSelection:function(){var t=window.getSelection();if(t.anchorNode){var e=s(t.anchorNode).closest("[contenteditable]").length;return e?t:null}return null},collapseToEnd:function(){var e=t.getSelection();e&&e.collapseToEnd()},collapseToStart:function(){var e=t.getSelection();e&&e.collapseToStart()},isInContext:function(t,e){return s(t.anchorNode).closest(e).length>0},isEditorNode:function(t){return s(t).is('[contentEditable="true"]')},hasSelection:function(){var e=t.getSelection();return e&&!e.isCollapsed},rangeFromElement:function(e){var i,s,o=t.getSelection();return o&&o.isCollapsed?(s=o.getRangeAt(0),i=s.cloneRange(),i.selectNodeContents(e),i.setEnd(s.startContainer,s.startOffset),i):!1},isCursorAtEnd:function(t){var e=this.rangeFromElement(t);return e?e.toString().length===t.textContent.length:!1},isCursorAtStart:function(t){var e=this.rangeFromElement(t);return e?0===e.startOffset&&0===e.endOffset:!1}};return t}();e.exports=o},{jquery:"HlZQrA",lodash:"K2RcUv"}],516:[function(t,e){var i=function(){return{saveSelection:function(t,e){if(e=e||window.getSelection(),!e||!e.rangeCount)return null;var i=e.getRangeAt(0),s=i.cloneRange();s.selectNodeContents(t),s.setEnd(i.startContainer,i.startOffset);var o=s.toString().length;return{container:t,start:o,end:o+i.toString().length,selection:e,anchorNode:e.anchorNode}},restoreSelection:function(t){if(t){var e=0,i=document.createRange();i.setStart(t.container,0),i.collapse(!0);for(var s,o=[t.container],n=!1,a=!1;!a&&(s=o.pop());)if(3===s.nodeType){var r=e+s.length;!n&&t.start>=e&&t.start<r&&(i.setStart(s,t.start-e),n=!0),n||r!==t.end||(i.setStart(s,t.end-e),n=!0),n&&t.end>=e&&t.end<=r&&(i.setEnd(s,t.end-e),a=!0),e=r}else for(var l=s.childNodes.length;l--;)o.push(s.childNodes[l]);var h=window.getSelection();h.removeAllRanges();try{h.addRange(i)}catch(d){}}},setToStart:function(t){if(t){var e=document.createRange();e.setStart(t,0),e.setEnd(t,0),e.collapse(!0);var i=window.getSelection();i.removeAllRanges();try{i.addRange(e)}catch(s){}}},setToEnd:function(t){for(var e=[t],i=null,s=t,o=0;i=e.pop();)if(3===i.nodeType)s=i,o=i.length;else for(var n=i.childNodes.length;n--;)e.push(i.childNodes[n]);var a=document.createRange();a.setStart(s,o),a.setEnd(s,o),a.collapse(!0);var r=window.getSelection();r.removeAllRanges();try{r.addRange(a)}catch(l){}}}}();e.exports=i},{}],517:[function(t,e){var i=t("lodash"),s=t("jquery"),o=t("./selectionContext"),n=t("./selectionPersistence"),a=t("./utils"),r=function(){function t(){var t=this;s(this.editor.element).on("keypress",function(i){var s=!1;if(34===i.charCode)s=r.call(t);else{if(39!==i.charCode)return;s=e.call(t)}s&&i.preventDefault()})}function e(){var t=this.config.singleQuotes;return l.call(this,t.open,t.close,t.prime)}function r(){var t=this.config.doubleQuotes;return l.call(this,t.open,t.close,t.prime)}function l(t,e,a){var r=o.getSelection();if(!r.isCollapsed)return!1;var l=r.anchorNode;l.normalize();var h=n.saveSelection(l),d=l.textContent,c=d.slice(0,h.start),u=c.charAt(c.length-1),p=l.lastChild&&"BR"===l.lastChild.nodeName?l.lastChild:null,m=i.any(this.config.openingMatches,function(t){return t.test(u)})||p,g="";g=!u||m?t:/\d/.test(u)?a:e;var f=document.createTextNode(g),_=r.getRangeAt(0);return _.deleteContents(),_.insertNode(f),p&&p.previousSibling&&"BR"===p.previousSibling.nodeName&&s(p).remove(),_.setEndAfter(f),_.collapse(!1),r.removeAllRanges(),r.addRange(_),!0}var h=function(e,s){return a.browser.msie?null:(this.editor=e,this.config={openingMatches:[/\s/,/\u200B/,/[=]/],singleQuotes:{open:"‘",close:"’",prime:"′"},doubleQuotes:{open:"“",close:"”",prime:"″"}},i.extend(this.config,s||{}),void t.call(this))};return h}();e.exports=r},{"./selectionContext":515,"./selectionPersistence":516,"./utils":519,jquery:"HlZQrA",lodash:"K2RcUv"}],518:[function(t,e){var i=t("lodash"),s=t("jquery"),o=t("./selectionPersistence"),n=function(){function t(){var t=this,i=function(t){return/Mac/.test(navigator.platform)?t.metaKey:t.ctrlKey};s(this.editor.element).on("keydown.undoManager",function(s){return s.keyCode===d.z&&i(s)&&!s.altKey?(s.shiftKey?n.call(t):e.call(t),s.preventDefault(),!1):void 0})}function e(){if(l.call(this),this.undoStates.length){var t=this.undoStates.pop();h.call(this,t),this.redoStates.push(this.currState),a.call(this)}}function n(){if(this.redoStates.length){var t=this.redoStates.pop();h.call(this,t),this.undoStates.push(this.currState),a.call(this)}}function a(){this.currState=r.call(this)}function r(){var t={data:this.editor.getData(!0,!0),selection:o.saveSelection(this.editor.element)};return t}function l(){var t=r.call(this);return this.currState?void(t.data!==this.currState.data&&(this.undoStates.push(this.currState),this.currState=t)):void(this.currState=t)}function h(t){if(this.isRestoring=!0,this.editor.setData(t.data,!0),t.selection)o.restoreSelection(t.selection);else{var e=window.getSelection();e.removeAllRanges()}this.afterRestore()}var d={command:91,control:17,shift:16,z:90},c=500,u=function(e,s){this.editor=e,this.modifierKeyCode=!1,this.isShift=!1,this.currState=null,this.undoStates=[],this.redoStates=[],this.afterRestore=s||function(){},this.isRestoring=!1;var o=this,n=i.debounce(function(){o.isTorndown||l.call(o)},c);this.defaultOnChange=e.onChange,e.onChange=function(t){if(o.isRestoring)o.isRestoring=!1;else{if("updateAsyncImage"===t)return;o.currState?n():l.call(o)}o.defaultOnChange.call(this)},t.call(this)};return u.prototype.undo=function(){e.call(this)},u.prototype.redo=function(){n.call(this)},u.prototype.teardown=function(){this.isTorndown=!0,this.editor.onChange=this.defaultOnChange,this.undoStates.length=0,this.redoStates.length=0,this.currState=null,s(this.editor.element).off(".undoManager")},u}();e.exports=n},{"./selectionPersistence":516,jquery:"HlZQrA",lodash:"K2RcUv"}],519:[function(t,e){var i=t("lodash"),s=t("jquery"),o=function(){var t=function(){};return t.calcTextWidth=function(t,e){var o=["font-style","font-weight","font-size","font-family"],n=i.reduce(o,function(e,i){return e+" "+s(t).css(i)},"").trim(),a=document.createElement("canvas"),r=a.getContext("2d");r.font=n;var l=r.measureText(e);return Math.round(l.width)},t.browser=function(){var t=function(t){t=t.toLowerCase();var e=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(trident)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return{browser:e[1]||"",version:e[2]||"0"}},e=t(navigator.userAgent),i={};return e.browser&&(i[e.browser]=!0,i.version=e.version),i.trident&&(i.msie=!0),i.chrome?i.webkit=!0:i.webkit&&(i.safari=!0),i}(),t}();e.exports=o},{jquery:"HlZQrA",lodash:"K2RcUv"}],520:[function(t,e){var i=document.createElement("style");document.head.appendChild(i);var s=i.styleSheet?function(t){i.styleSheet.cssText=t}:function(t){for(;i.firstChild;)i.removeChild(i.firstChild);i.appendChild(document.createTextNode(t))},o=function(t){return s(i.innerHTML.replace(t,""))};e.exports.style=i,e.exports.inject=s,e.exports.eject=o},{}],521:[function(t,e){!function(t){t(function(t){var e=t("./when"),i=e.Promise.all,s=Array.prototype.slice;return function(t){function o(t){return n.push(t),n}var n=[];return i(s.call(arguments,1)).then(function(i){return e.reduce(t,function(t,s){return e(s.apply(void 0,i),o)},n)})}})}("function"==typeof define&&define.amd?define:function(i){e.exports=i(t)})},{"./when":"RG2dij"}]},{},[]);