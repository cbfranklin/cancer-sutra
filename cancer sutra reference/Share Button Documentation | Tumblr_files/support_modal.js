/*! scripts/support_modal.js */
(function(e,b){var c=null;var f=function(){if(!c){return}c=null;e("#support_form_submit").prop("disabled",false);alert(l10n_str.ajax_error)};var d=function(){var g=e("#inline_support_form");var h=e("#support_form_target");h.off("load");h.on("load",function(i){if(c){clearTimeout(c);c=null}try{if(h.contentWindow.document.body.id!="support_modal_response"){e("#support_form_submit").prop("disabled",false);alert(l10n_str.ajax_error)}}catch(j){c=setTimeout(f,3000)}})};var a=function(h){var g=e("#error_"+h.target.name);g.removeClass("is_error");setTimeout(function(){e(h.target).off("focus",a)},0);var i=e("#support_form_error_container");if(!i.find(".is_error").length){i.removeClass("delay");i.removeClass("has_errors")}};SupportModal=Backbone.View.extend({el:"#inline_support_modal_container",events:{"submit form ":"on_submit","click #support_form_cancel":"on_cancel"},create:function(g){g=g||{};this.created=true;this.dont_show_on_create=g.dont_show_on_create||false;this.show(g)},show:function(h){if(!this.created){this.create(h)}var g=this;this.show_tos_after=false;if(e("#popover_alert_tos_container").length&&typeof(LegalPrompts)!="undefined"&&e(LegalPrompts.popover_alert_tos.popover).hasClass("modal_is_visible")){LegalPrompts.popover_alert_tos.hide();this.show_tos_after=true}h=h||{};if(h.type){this.set_category(h.type)}if(h.subject){e("#support_form_subject").val(h.subject)}this.$el.show();setTimeout(function(){Tumblr.Glass.show(g.hide.bind(g),"dark");g.$el.removeClass("belowscreen").removeClass("abovescreen").addClass("up").addClass("modal_is_visible");e(document.body).addClass("popover_alert_active")},1)},hide:function(){var g=this;if(Tumblr.Glass.visible){return Tumblr.Glass.hide()}g.$el.addClass("abovescreen").removeClass("up").removeClass("belowscreen").removeClass("modal_is_visible");e(document.body).removeClass("popover_alert_active");g.on_hide()},on_hide:function(){if(this.show_tos_after){setTimeout(function(){LegalPrompts.popover_alert_tos.show.call(LegalPrompts.popover_alert_tos)},1)}},on_submit:function(g){this.$("form").attr("target","support_form_target");this.$("#support_form_submit").prop("disabled",true)},evaluate_response:function(l){clearTimeout(c);c=null;this.$("#support_form_submit").prop("disabled",false);if(typeof(l.meta)=="undefined"||typeof(l.response)=="undefined"){alert(l10n_str.ajax_error)}if(l.meta.status==201||l.meta.status==200){e("#inline_support_success").html(l.response.message);this.show_success();return}var k,h,m,o=false;var n=l.response.errors;var g;var j=e("#support_form_error_container ul");j.html("");if(!n.length){return}for(k=0,h=n.length;k<h;k+=1){g=e(".support_form [name="+n[k].name+"]");if(g&&g.length){g=g[0]}else{o=true;break}g.on("focus",a);m=e("<li>").attr("id","error_"+n[k].name);m.html(n[k].error);m.addClass("is_error");j.append(m)}if(o){alert(l10n_str.ajax_error);return}this.$("#support_form_error_container").addClass("delay").addClass("has_errors");this.$el.addClass("animated").addClass("shake");setTimeout(function(){this.$el.removeClass("animated").removeClass("shake")},1250)},show_success:function(g){this.$("form")[0].reset();this.$("#inline_support_container .enter_info").hide();this.$("#inline_support_container success").show();setTimeout(_.bind(function(){this.hide()},this),5000)},set_category:function(g){if(g){this.$("form input[name=support_type]").val(g)}},on_cancel:function(g){this.hide()}});b.SupportModal=SupportModal})(jQuery,Tumblr);jQuery(document).ready(function(a){window.help_modal=new Tumblr.SupportModal()});