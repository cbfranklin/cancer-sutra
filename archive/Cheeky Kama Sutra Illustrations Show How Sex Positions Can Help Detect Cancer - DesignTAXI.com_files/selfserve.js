(function(undefined){var tag=document.getElementById('bsaPROdfpselfserve');if(!tag)return;var ppfdfphost='pro.buysellads.com';var cdnhost='cdn.buysellads.com';var dossl=true;var storagekey='_ppfdfp-localstore';var pubid=tag.getAttribute('data-key');var cartid=false;var elements={};function dropHTML(){if(document.register)document.register("x-publisher-pro-for-dfp");elements.ppfdfp=document.createElement("x-publisher-pro-for-dfp");elements.ppfdfp.innerHTML='<a id="_ppfdfp-tabclose" href="#">x</a><span class="_ppfdfp-tab" id="_ppfdfp-tab"><em class="_ppfdfp-text">Your Cart</em><em id="_ppfdfp-amount">0</em></span><span class="_ppfdfp-cart" id="_ppfdfp-cart"><span class="_ppfdfp-cartempty"><span class="_ppfdfp-emptymsg">Your cart is currently empty<a href="#" class="_ppfdfp-cartempty-link" id="_ppfdfp-viewallinventory">view all available inventory</a></span></span><ul id="_ppfdfp-items"></ul><em class="_ppfdfp-total" id="_ppfdfp-total">Order total: <strong id="_ppfdfp-totalcost">$0.00</strong></em><a href="#" class="_ppfdfp-button _ppfdfp-go" id="_ppfdfp-checkout">Checkout</a><a href="#" class="_ppfdfp-altlink" id="_ppfdfp-viewinventory">or, view all available inventory</a></span><span class="_ppfdfp-modalmask" id="_ppfdfp-modalmask"></span><span class="_ppfdfp-modal" id="_ppfdfp-modal"><span class="_ppfdfp-modalwrap" id="_ppfdfp-modalcontent"><span class="_ppfdfp-modalheader"><span id="_ppfdfp-modaltitle"> </span><span id="_ppfdfp-modalwhat">?</span><span id="_ppfdfp-modalclose">Close</span></span></span></span>';elements.ppfdfp.innerHTML+="<style>x-publisher-pro-for-dfp{display:none}</style>";var css=document.createElement("link");css.setAttribute("rel","stylesheet");css.setAttribute("href","//cdn.buysellads.com/ac/selfserve.css");tag.parentNode.insertBefore(css,tag);css=document.createElement("link");css.setAttribute("rel","stylesheet");css.setAttribute("href","//"+cdnhost+"/ppfdfpcss/"+pubid+".css");tag.parentNode.insertBefore(css,tag);document.body.appendChild(elements.ppfdfp);elements.receiver=document.createElement("iframe");elements.receiver.setAttribute("src",(dossl?"https://":"http://")+ppfdfphost+"/dfp/selfserve/receive");elements.receiver.className="_ppfdfp-receiver";elements.ppfdfp.appendChild(elements.receiver);addClass(elements.ppfdfp,"_ppfdfp-loaded");elements.tab=document.getElementById('_ppfdfp-tab');elements.tabcount=document.getElementById('_ppfdfp-amount');elements.cart=document.getElementById('_ppfdfp-cart');elements.cartempty=document.getElementById('_ppfdfp-cartempty');elements.items=document.getElementById('_ppfdfp-items');elements.totalcost=document.getElementById('_ppfdfp-totalcost');elements.checkout=document.getElementById('_ppfdfp-checkout');elements.viewinventory=document.getElementById('_ppfdfp-viewinventory');elements.viewallinventory=document.getElementById('_ppfdfp-viewallinventory');elements.modal=document.getElementById('_ppfdfp-modal');elements.modalmask=document.getElementById('_ppfdfp-modalmask');elements.modalclose=document.getElementById('_ppfdfp-modalclose');elements.help=document.getElementById('_ppfdfp-modalwhat');elements.tabclose=document.getElementById('_ppfdfp-tabclose');elements.modalcontent=document.getElementById('_ppfdfp-modalcontent');elements.modaltitle=document.getElementById('_ppfdfp-modaltitle')}function loadCart(){var cart;if(!window.localStorage||!window.localStorage[storagekey]){cart=false}else{cart=JSON.parse(window.localStorage[storagekey])}if(!cart){cartid=false;renderCartItems([])}else{var cart=JSON.parse(window.localStorage[storagekey]);cartid=cart.id;renderCartItems(cart.items)}}function createCartItem(data){var title=data.title;var rate="$"+data.rate+" "+data.unit;var qty=data.qty;var ad=data.ad;var product=data.product;var item=document.createElement("li");item.className="_ppfdfp-cf";if(ad!==undefined){var span=document.createElement("span");span.className="_ppfdfp-removeicn";span.innerHTML="&times;";on(span,"click",function(){sendMessage({remove:{cart:cartid,ad:ad}})});item.appendChild(span)}var em=document.createElement("em");em.className="_ppfdfp-ztitle";em.appendChild(document.createTextNode(title));on(em,"click",function(){loadItem(product)});item.appendChild(em);if(rate!==undefined){var em=document.createElement("em");em.className="_ppfdfp-zrate";em.appendChild(document.createTextNode(rate));item.appendChild(em)}if(qty!==undefined){var em=document.createElement("em");em.className="_ppfdfp-zqty";em.appendChild(document.createTextNode(qty));item.appendChild(em)}return item}function renderCartItems(items){while(elements.items.childNodes.length>0)elements.items.removeChild(elements.items.firstChild);var total=0;if(items.length==0){addClass(elements.ppfdfp,"_ppfdfp-noitems");removeClass(elements.ppfdfp,"_ppfdfp-hasitems")}else{for(var i=0;i<items.length;i++){elements.items.appendChild(createCartItem(items[i]));total+=items[i].price}addClass(elements.ppfdfp,"_ppfdfp-hasitems");removeClass(elements.ppfdfp,"_ppfdfp-noitems")}elements.tabcount.firstChild.nodeValue=items.length;elements.totalcost.firstChild.nodeValue="$"+total.toFixed(2)}function addToCart(product){var o={pub:pubid,product:product};if(cartid)o.cart=cartid;sendMessage({add:o})}function loadView(which){loadModalContent((dossl?'https://':'http://')+ppfdfphost+'/dfp/selfserve/'+which);showModal()}function loadInventory(){loadView('cart'+(cartid?'/id/'+cartid:'')+'/pub/'+pubid+'/inventory/1')}function loadItem(product){loadView('cart/id/'+cartid+'/pub/'+pubid+'/highlight/'+product)}function loadCheckout(){if(!cartid)return loadInventory();loadView('cart/id/'+cartid+'/pub/'+pubid+'/checkout/1')}function loadHelp(){loadView('help'+(cartid?'/cart/'+cartid:'')+'/pub/'+pubid)}function openCart(){removeClass(elements.ppfdfp,'_ppfdfp-tabdismissed');addClass(elements.cart,'_ppfdfp-cart-enter')}function toggleCart(){toggleClass(elements.cart,'_ppfdfp-cart-enter')}function toggleModal(){toggleClass(elements.modalmask,'_ppfdfp-on');toggleClass(elements.modal,'_ppfdfp-on')}function closeCart(){removeClass(elements.cart,'_ppfdfp-cart-enter')}function closeModal(){removeClass(elements.modalmask,'_ppfdfp-on');removeClass(elements.modal,'_ppfdfp-on');setModalTitle(" ")}function closeTab(){addClass(elements.ppfdfp,'_ppfdfp-tabdismissed')}function showModal(){removeClass(elements.ppfdfp,'_ppfdfp-tabdismissed');addClass(elements.modalmask,'_ppfdfp-on');addClass(elements.modal,'_ppfdfp-on')}function loadModalContent(src){var existing=document.getElementById('_ppfdfp-modalframe');if(existing){existing.parentNode.removeChild(existing)}var frame=document.createElement('iframe');frame.id='_ppfdfp-modalframe';frame.width='100%';frame.height='100%';frame.frameBorder='0';frame.src=src;document.getElementById('_ppfdfp-modalcontent').appendChild(frame)}function setModalTitle(title){elements.modaltitle.firstChild.nodeValue=title}function hasClass(el,name){return new RegExp('(\\s|^)'+name+'(\\s|$)').test(el.className)}function addClass(el,name){if(!hasClass(el,name)){el.className+=(el.className?' ':'')+name}}function toggleClass(elem,className){var newClass=' '+elem.className.replace(/[\t\r\n]/g,' ')+' ';if(hasClass(elem,className)){while(newClass.indexOf(' '+className+' ')>=0){newClass=newClass.replace(' '+className+' ',' ')}elem.className=newClass.replace(/^\s+|\s+$/g,'')}else{elem.className+=' '+className}}function removeClass(el,name){if(hasClass(el,name)){el.className=el.className.replace(new RegExp('(\\s|^)'+name+'(\\s|$)'),' ').replace(/^\s+|\s+$/g,'')}}var receivers={cart:function(cart){if(cart){window.localStorage[storagekey]=JSON.stringify(cart);openCart()}else window.localStorage.removeItem(storagekey);loadCart()},title:function(title){setModalTitle(title)},showcart:function(){openCart()}};function receiveMessage(e){if(e.origin==(dossl?"https://":"http://")+ppfdfphost&&JSON.parse(e.data)){var data=JSON.parse(e.data);if(receivers.hasOwnProperty(data.func)){receivers[data.func](data.arg)}}}function sendMessage(data){data=JSON.stringify(data);elements.receiver.contentWindow.postMessage(data,(dossl?"https://":"http://")+ppfdfphost)}function on(el,event,func){if(el.addEventListener)el.addEventListener(event,func,false);else if(el.attachEvent)el.attachEvent("on"+event,function(e){e.preventDefault=function(){e.returnValue=false};func(e)})}function init(){dropHTML();on(elements.checkout,'click',function(e){e.preventDefault();loadCheckout()});on(elements.viewinventory,'click',function(e){e.preventDefault();loadInventory()});on(elements.viewallinventory,'click',function(e){e.preventDefault();loadInventory()});on(elements.tabclose,'click',function(e){e.preventDefault();closeTab()});on(elements.tab,'click',toggleCart);on(elements.modalclose,'click',closeModal);on(elements.help,'click',loadHelp);on(window,'message',receiveMessage);loadCart();if(hasClass(elements.ppfdfp,"_ppfdfp-noitems"))addClass(elements.ppfdfp,"_ppfdfp-tabdismissed");var invlaunch=document.querySelectorAll(".ppfdfp-load-inventory");for(var i=0;i<invlaunch.length;i++){on(invlaunch[i],"click",function(e){e.preventDefault();loadInventory()})}var addcart=document.querySelectorAll(".ppfdfp-add-to-cart");for(var i=0;i<addcart.length;i++){var product=parseInt(addcart[i].getAttribute("data-ppfdfp-product"),10);if(product)on(addcart[i],"click",(function(p){return function(e){e.preventDefault();addToCart(p)}})(product))}}if(document.addEventListener)on(document,"DOMContentLoaded",init);else on(window,"load",init);window.bsaPROdfpselfserve={inventory:loadInventory}})();